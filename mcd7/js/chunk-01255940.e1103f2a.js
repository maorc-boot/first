(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-01255940"],{2244:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("section",{staticStyle:{width:"98%",margin:"0 auto","margin-top":"15px"}},[e("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},["info"!==this.$route.query.mode?e("el-breadcrumb-item",{attrs:{to:{path:"/5g/messagePlatform"}}},[t._v("模板管理")]):t._e(),e("el-breadcrumb-item",[t._v(t._s(t.titlePage))])],1),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{width:"100%","element-loading-text":"处理中","element-loading-spinner":"el-icon-loading"}},[e("el-row",{attrs:{gutter:10,type:"flex"}},[e("el-col",{attrs:{span:22}},[e("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"100px",size:t.cmpSize}},[e("el-input",{attrs:{type:"hidden"},model:{value:t.form.Id,callback:function(e){t.$set(t.form,"Id",e)},expression:"form.Id"}}),e("el-row",[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"模板名称",prop:"name"}},[e("el-input",{attrs:{disabled:t.isInfoDisabled,type:"text",placeholder:"请输入模板名称(30字内)",maxlength:"30","show-word-limit":""},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1)],1),t.displayTemplateClass?e("span",[e("el-form-item",{attrs:{label:"模板类别",prop:"templateClass","label-width":"100px"}},[e("div",{staticStyle:{width:"100%","margin-left":"-405px"},attrs:{align:"center"}},[e("el-radio-group",{attrs:{disabled:t.isInfoDisabled},model:{value:t.form.templateClass,callback:function(e){t.$set(t.form,"templateClass",e)},expression:"form.templateClass"}},[e("el-radio",{attrs:{label:0,disabled:t.tempDisable4}},[t._v("空白模板")]),e("el-radio",{attrs:{label:3,disabled:t.tempDisable3}},[t._v("静态模板")]),"media"!==t.fatherActive?e("el-radio",{attrs:{label:1,disabled:t.tempDisable1}},[t._v("动态模板")]):t._e()],1)],1)])],1):t._e(),"card"===t.fatherActive?e("div",{staticStyle:{"margin-bottom":"41px"}},[e("div",{staticClass:"require ml-24",staticStyle:{"margin-left":"35px"}},[t._v("模板内容")]),e("el-row",[e("el-col",{attrs:{span:22}},[e("el-carousel",{ref:"myCards",attrs:{height:"550px",arrow:t.elementList.length>1?"always":"never","indicator-position":"none",autoplay:!1},on:{change:t.cardChange}},t._l(t.elementList,(function(a,i){return e("el-carousel-item",{key:i,attrs:{name:"idx"}},[e("div",{staticStyle:{width:"80%"},attrs:{align:"center"}},[e("span",{staticStyle:{color:"#2F87EC"}},[e("b",[t._v(" 卡片"+t._s(i+1)+" ")])])]),e("div",{style:t.styleObj,attrs:{id:"header11",align:"center"}},[e("div",{staticClass:"inp",staticStyle:{width:"260px","margin-top":"10px"},attrs:{align:"center"}},[e("img",{staticClass:"image",attrs:{slot:"trigger",src:t.imgSrc},on:{click:function(e){return t.toSelect(0)}},slot:"trigger"}),t.isSelectImg?e("span",{staticClass:"el-upload-list__item-preview"},[e("i",{staticClass:"el-icon-refresh",staticStyle:{"line-height":"77px"}}),e("div",{on:{click:function(e){return t.toSelect(0)}}},[t._v("重新选择")])]):t._e(),1==t.eleType?e("span",[e("el-input",{attrs:{type:"text",placeholder:"媒体文件URL(必填)",maxlength:"512","show-word-limit":"",disabled:t.isInfoDisabled},on:{change:t.urlChange},model:{value:a.material,callback:function(e){t.$set(a,"material",e)},expression:"item.material"}}),e("el-input",{attrs:{type:"text",placeholder:"封面文件URL(选填)",maxlength:"512",disabled:t.isInfoDisabled,"show-word-limit":""},on:{change:t.thumbnailChange},model:{value:a.thumbnail,callback:function(e){t.$set(a,"thumbnail",e)},expression:"item.thumbnail"}})],1):t._e(),e("div",{staticStyle:{padding:"1px"}}),e("el-input",{attrs:{type:"textarea",placeholder:"请输入卡片标题",disabled:t.isInfoDisabled,maxlength:"64",prop:"cardTitle","show-word-limit":""},on:{change:t.checkParam,focus:function(e){t.lastFocus="cardTitle"}},model:{value:a.cardTitle,callback:function(e){t.$set(a,"cardTitle",e)},expression:"item.cardTitle"}}),e("div",{staticStyle:{padding:"1px"}}),e("el-input",{attrs:{disabled:t.isInfoDisabled,type:"textarea",rows:4,placeholder:"请输入卡片内容",maxlength:"500","show-word-limit":""},on:{change:t.checkParam,focus:function(e){t.lastFocus="cardContent"}},model:{value:a.cardContent,callback:function(e){t.$set(a,"cardContent",e)},expression:"item.cardContent"}})],1),"1"==t.form.templateClass||"2"==t.form.templateClass?e("span",[t._v("   "),t.isInfoDisabled?t._e():e("el-button",{staticClass:"btn btn-primary",staticStyle:{position:"absolute",right:"96px",bottom:"225px"},attrs:{type:"primary",size:"mini",icon:"el-icon-circle-plus",round:"",plain:""},on:{click:function(e){return t.handleDynamicParam(0)}}},[t._v(" 动态参数 ")]),t.isInfoDisabled?t._e():e("el-button",{staticClass:"btn btn-primary",staticStyle:{position:"absolute",right:"96px",bottom:"183px"},attrs:{type:"primary",size:"mini",icon:"el-icon-circle-plus",round:"",plain:""},on:{click:function(e){return t.handleDynamicParam(1)}}},[t._v(" 动态参数 ")])],1):t._e(),e("div",{attrs:{id:"lay_bottom",align:"center"}},[e("div",{attrs:{id:"nav"}},[t._l(t.floatButtonList[i],(function(a,i){return e("span",{key:i},[e("el-button",{attrs:{disabled:t.isInfoDisabled,type:"primary",size:"mini",plain:"",round:""},on:{click:function(e){return t.deleteBtn(a.id)}}},[t._v(t._s(a.displayText))])],1)})),e("br"),t._l(t.floatMenuList,(function(a){return e("span",{key:a.id},[e("el-button",{attrs:{size:"mini",plain:""},on:{click:function(e){return t.deleteBtn(a.id)}}},[t._v(t._s(a.displayText))])],1)})),t.isInfoDisabled?t._e():e("el-button",{staticClass:"btn btn-primary",attrs:{type:"primary",size:"mini",icon:"el-icon-circle-plus",round:"",plain:""},on:{click:function(e){return t.handleInsideBtn(0)}}},[t._v(" 内置按钮 ")])],2)])])])})),1)],1),e("el-col",{attrs:{span:2}},[e("div",{staticStyle:{height:"550px",display:"table-cell","vertical-align":"middle"},attrs:{align:"center"}},[e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.tipAddCard,placement:"right"}},[t.isInfoDisabled?t._e():e("el-button",{staticStyle:{"margin-bottom":"20px"},attrs:{type:"primary",icon:"el-icon-plus",circle:""},on:{click:t.addCard}})],1),e("br"),e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.tipDelCard,placement:"right"}},[t.isInfoDisabled?t._e():e("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:t.deleteCard}})],1)],1)])],1)],1):t._e(),"txt"===t.fatherActive?e("div",{staticStyle:{"margin-bottom":"78px"}},[e("div",{staticClass:"require ml-24"},[t._v("模板内容")]),e("el-row",[e("el-col",{attrs:{span:22}},[e("div",{staticStyle:{top:"28px"},style:t.styleObj,attrs:{id:"header01",align:"center"}},[e("div",{staticStyle:{width:"260px"},attrs:{align:"center"}},[e("br"),e("br"),e("el-input",{staticStyle:{"margin-top":"50px"},attrs:{type:"textarea",disabled:t.isInfoDisabled,rows:10,placeholder:"请输入文字内容(500字以内)",maxlength:"500","show-word-limit":""},on:{change:t.checkParam},model:{value:t.textConent,callback:function(e){t.textConent=e},expression:"textConent"}})],1),"1"==t.form.templateClass||"2"==t.form.templateClass?e("span",[t._v("   "),t.isInfoDisabled?t._e():e("el-button",{staticClass:"btn btn-primary",staticStyle:{position:"absolute",right:"96px",bottom:"225px"},attrs:{type:"primary",size:"mini",icon:"el-icon-circle-plus",round:"",plain:""},on:{click:function(e){return t.handleDynamicParam(0)}}},[t._v(" 动态参数 ")])],1):t._e(),e("div",{attrs:{id:"lay_bottom",align:"center"}},[e("div",{attrs:{id:"nav"}},t._l(t.floatMenus,(function(a,i){return e("span",{key:i},[t.isInfoDisabled?t._e():e("el-button",{attrs:{size:"mini",disabled:t.isInfoDisabled,plain:""},on:{click:function(e){return t.deleteBtn(a.id)}}},[t._v(t._s(a.displayText))])],1)})),0)])])])],1)],1):t._e(),"media"===t.fatherActive?e("div",{staticStyle:{"margin-bottom":"50px"}},[e("div",{staticClass:"require ml-24"},[t._v("模板内容")]),e("div",{staticStyle:{"margin-right":"125px"},attrs:{align:"center"}},[e("el-radio-group",{attrs:{disabled:t.isInfoDisabled},model:{value:t.eleType,callback:function(e){t.eleType=e},expression:"eleType"}},[e("el-radio",{attrs:{label:0,disabled:t.disabled0}},[t._v("选择素材")])],1)],1),e("el-row",[e("el-col",{attrs:{span:22}},[e("div",{style:t.styleObj,attrs:{id:"header07",align:"center"}},[e("div",{staticStyle:{width:"260px","margin-top":"10px"},attrs:{align:"center"}},[e("img",{staticClass:"imageContent",attrs:{slot:"trigger",src:t.imgSrc},on:{click:function(e){return t.toSelect(1)}},slot:"trigger"}),t.isSelectImg?e("span",{staticClass:"el-upload-list__item-preview"},[e("i",{staticClass:"el-icon-refresh",staticStyle:{"line-height":"77px"}}),e("div",{on:{click:function(e){return t.toSelect(1)}}},[t._v("重新选择")])]):t._e(),1==t.eleType?e("span",[e("el-input",{attrs:{disabled:t.isInfoDisabled,type:"text",placeholder:"媒体文件URL(必填)",maxlength:"512","show-word-limit":""},on:{change:t.urlChange},model:{value:t.form.mediaUrl,callback:function(e){t.$set(t.form,"mediaUrl",e)},expression:"form.mediaUrl"}}),e("div",{staticStyle:{padding:"1px"}}),e("el-input",{attrs:{disabled:t.isInfoDisabled,type:"text",placeholder:"封面文件URL(选填)",maxlength:"512","show-word-limit":""},on:{change:t.thumbnailChange},model:{value:t.form.thumbnailUrl,callback:function(e){t.$set(t.form,"thumbnailUrl",e)},expression:"form.thumbnailUrl"}})],1):t._e()]),e("div",{attrs:{id:"lay_bottom",align:"center"}},[e("div",{attrs:{id:"nav"}},t._l(t.floatMenus,(function(a,i){return e("span",{key:i},[e("el-button",{attrs:{size:"mini",disabled:t.isInfoDisabled,plain:""},on:{click:function(e){return t.deleteBtn(a.id)}}},[t._v(t._s(a.displayText))])],1)})),0)])])])],1)],1):t._e(),e("div",{staticStyle:{width:"81%","margin-bottom":"36px"},attrs:{align:"center"}},[e("el-button",{staticClass:"btn btn-primary",staticStyle:{"margin-right":"80px"},attrs:{disabled:t.isInfoDisabled,size:"mini",icon:"el-icon-circle-plus",plain:""},on:{click:function(e){t.addMenuVisible=!0,t.addWhat="menu"}}},[t._v(" 悬浮菜单 ")])],1),e("div",{staticClass:"ax_default_line"},[e("img",{staticClass:"img",attrs:{src:a("6e41")}})]),e("div",{staticStyle:{"margin-bottom":"66px"}},[e("div",{staticClass:"ml-24"},[e("p",[t._v("回落内容")]),e("p",{staticClass:"mt-16"},[t._v("对于5G消息未在线送达的手机终端，可选择发送短信提醒用户")])]),e("br"),e("div",{staticStyle:{width:"100%","margin-bottom":"30px","margin-left":"-150px"},attrs:{align:"center"}},[e("el-radio-group",{attrs:{disabled:t.isInfoDisabled},model:{value:t.form.templateClass1,callback:function(e){t.$set(t.form,"templateClass1",e)},expression:"form.templateClass1"}},[e("el-radio",{attrs:{label:0,disabled:t.tempDisable0}},[t._v("短信小程序2.0")]),e("el-radio",{attrs:{label:2,disabled:t.tempDisable2}},[t._v("视频短信")]),e("el-radio",{attrs:{label:10,disabled:t.tempDisable10}},[t._v("文字短信")]),e("el-radio",{attrs:{label:5,disabled:t.tempDisable5}},[t._v("不回落")])],1)],1),"0"==t.form.templateClass1?e("div",{staticClass:"custom-step"},[e("el-steps",{staticStyle:{width:"250px"},attrs:{active:t.step,"finish-status":"success",simple:""}},[e("el-step",{attrs:{title:"卡片样式"}}),e("el-step",{attrs:{title:"短信原文"}})],1)],1):t._e(),"0"==t.form.templateClass1?e("span",[e("el-row",[e("el-col",{attrs:{span:22}},["text"===t.SmsClass?e("div",{style:t.styleObj,attrs:{id:"header11",align:"center"}},[e("div",{staticStyle:{width:"260px","margin-top":"10px"},attrs:{align:"center"}},[1==t.eleType?e("span",[e("el-input",{attrs:{disabled:t.isInfoDisabled,type:"text",placeholder:"媒体文件URL(必填)",maxlength:"512","show-word-limit":""},on:{change:t.urlChange},model:{value:t.item.material,callback:function(e){t.$set(t.item,"material",e)},expression:"item.material"}}),e("el-input",{attrs:{disabled:t.isInfoDisabled,type:"text",placeholder:"封面文件URL(选填)",maxlength:"512","show-word-limit":""},on:{change:t.thumbnailChange},model:{value:t.item.thumbnail,callback:function(e){t.$set(t.item,"thumbnail",e)},expression:"item.thumbnail"}})],1):t._e(),e("el-form",{ref:"msgCard",staticClass:"demo-ruleForm",attrs:{model:t.msgCard}},[e("el-form-item",{attrs:{label:"",prop:"cardTitle",rules:[{required:!0,message:"ID不能为空"},{type:"number",message:"ID必须为数字值"}]}},[e("el-input",{staticStyle:{"margin-top":"168px"},attrs:{disabled:t.isInfoDisabled,type:"text",placeholder:"请输入ID(必填 17字内)",maxlength:"17","show-word-limit":""},on:{change:t.checkParam,focus:function(e){t.lastFocus=""}},model:{value:t.msgCard.cardTitle,callback:function(e){t.$set(t.msgCard,"cardTitle",t._n(e))},expression:"msgCard.cardTitle"}})],1)],1)],1),e("div",{attrs:{id:"lay_bottom",align:"center"}},[e("div",{attrs:{id:"nav"}},[e("br")])]),e("div",{staticStyle:{width:"100%",position:"absolute",bottom:"-44px"},attrs:{align:"center"}},["text"===t.SmsClass?e("el-button",{staticClass:"btn btn-primary",attrs:{disabled:t.isInfoDisabled,type:"primary",size:"small",round:"",plain:""},on:{click:function(e){return t.next()}}},[t._v(" 下一步 ")]):t._e()],1)]):e("div",{style:t.styleObj,attrs:{id:"header11",align:"center"}},[e("div",{staticStyle:{width:"260px","margin-top":"10px"},attrs:{align:"center"}},[e("div",{staticStyle:{padding:"1px","padding-top":"105px"}}),e("el-form",{ref:"msgText",staticClass:"demo-ruleForm",attrs:{model:t.msgText}},[e("el-form-item",{staticStyle:{"margin-bottom":"0"},attrs:{prop:"cardTitle",rules:[{required:!0,message:"请输入标题",trigger:"blur"}]}},[e("el-input",{attrs:{disabled:t.isInfoDisabled,type:"text",placeholder:"请输入标题(需使用【】包裹)",maxlength:"64",prop:"cardTitle","show-word-limit":""},on:{change:t.checkParam,focus:function(e){t.lastFocus="cardTitle"}},model:{value:t.msgText.cardTitle,callback:function(e){t.$set(t.msgText,"cardTitle",e)},expression:"msgText.cardTitle"}})],1),e("div",{staticStyle:{padding:"1px"}}),e("div",{staticStyle:{position:"relative"}},[e("div",{staticStyle:{"text-align":"left"}},[e("vEdit",{staticStyle:{"padding-bottom":"30px","line-height":"22px","overflow-y":"auto","text-align":"left","border-radius":"2px"},attrs:{"is-video":t.form.templateClass1,"is-info-disabled":t.isInfoDisabled},model:{value:t.msgStr,callback:function(e){t.msgStr=e},expression:"msgStr"}})],1)]),e("div",{staticStyle:{padding:"1px"}}),e("el-form-item",{attrs:{prop:"cardSign",rules:[{required:!0,message:"请输入签名",trigger:"blur"}]}},[e("el-input",{attrs:{disabled:t.isInfoDisabled,type:"text",placeholder:"请输入签名(需使用【】包裹)",maxlength:"64",prop:"cardTitle","show-word-limit":""},on:{change:t.checkParam,focus:function(e){t.lastFocus="cardTitle"}},model:{value:t.msgText.cardSign,callback:function(e){t.$set(t.msgText,"cardSign",e)},expression:"msgText.cardSign"}})],1)],1)],1)]),e("div",{staticStyle:{"margin-top":"19px"},attrs:{align:"center"}},["message"===t.SmsClass?e("el-button",{staticClass:"btn btn-primary",attrs:{disabled:t.isInfoDisabled,type:"primary",size:"small",round:"",plain:""},on:{click:function(e){return t.backStep()}}},[t._v(" 上一步 ")]):t._e()],1)])],1)],1):t._e(),"2"==t.form.templateClass1?e("span",[e("el-form",{ref:"SmsContent",staticClass:"demo-ruleForm",attrs:{model:t.SmsContent}},[e("el-form-item",{staticStyle:{display:"flex","justify-content":"center"},attrs:{label:"",prop:"videoMsg",rules:[{required:!0,message:"请输入标题"}]}},[e("el-row",[e("el-col",{attrs:{span:6}},[e("el-input",{staticStyle:{width:"328px"},attrs:{disabled:t.isInfoDisabled,type:"text",placeholder:"请输入标题(必填 15字内)",maxlength:"15","show-word-limit":""},on:{change:t.checkParam,focus:function(e){t.lastFocus="cardTitle"}},model:{value:t.SmsContent.videoMsg,callback:function(e){t.$set(t.SmsContent,"videoMsg",e)},expression:"SmsContent.videoMsg"}}),e("div",{staticStyle:{padding:"1px"}})],1)],1)],1)],1),1==t.addText?e("span",{staticStyle:{display:"flex","justify-content":"center","margin-right":"100px"}},[e("el-form",{ref:"dynamicValidateForm",attrs:{model:t.dynamicValidateForm,"label-width":"100px"}},t._l(t.dynamicValidateForm.domains,(function(a,i){return e("el-form-item",{key:i,staticStyle:{"text-align":"center"},attrs:{label:""+i,prop:"domains."+i+".content",rules:{required:!0,message:"内容不能为空",trigger:"change"}}},["0"===a.type?e("span",{staticStyle:{display:"flex"}},[e("div",{staticStyle:{"text-align":"left"}},[e("vEdit",{staticStyle:{"line-height":"22px","overflow-y":"auto","text-align":"left","padding-bottom":"30px","border-radius":"2px"},attrs:{"is-video":t.form.templateClass1,"is-info-disabled":t.isInfoDisabled},model:{value:a.content,callback:function(e){t.$set(a,"content",e)},expression:"domain.content"}}),e("el-button",{staticClass:"insertUrl",attrs:{disabled:t.isInfoDisabled,icon:"el-icon-link"},on:{click:function(e){return t.insertUrl(1,a)}}},[t._v("插入链接（必选）")])],1),e("el-button",{staticStyle:{"margin-top":"188px",width:"44px",height:"32px"},attrs:{disabled:t.isInfoDisabled,icon:"el-icon-close"},on:{click:function(e){return e.preventDefault(),t.removeDomain(i)}}})],1):e("span",[e("img",{staticClass:"image2",attrs:{slot:"trigger",src:a.mediaImgSrc||t.defaultMediaImg},on:{click:function(e){return t.toSelect(2,a)}},slot:"trigger"}),e("el-button",{attrs:{disabled:t.isInfoDisabled,icon:"el-icon-close"},on:{click:function(e){return e.preventDefault(),t.removeMedia(i)}}})],1)])})),1)],1):t._e(),e("div",{attrs:{id:"lay_bottom1",align:"center"}},[e("div",{attrs:{id:"nav"}},[e("el-button",{staticClass:"btn btn-primary",attrs:{disabled:t.isInfoDisabled,type:"primary",size:"mini",icon:"el-icon-circle-plus",round:"",plain:""},on:{click:t.handleAddText}},[t._v(" 添加文字 ")]),e("el-button",{staticClass:"btn btn-primary",attrs:{disabled:t.isInfoDisabled,type:"primary",size:"mini",icon:"el-icon-circle-plus",round:"",plain:""},on:{click:t.handleMedia}},[t._v(" 添加多媒体 ")])],1)])],1):t._e(),"10"==t.form.templateClass1?e("span",[e("el-row",[e("el-col",{attrs:{span:22}},[e("div",{style:t.styleObj,attrs:{id:"header11",align:"center"}},[e("div",{staticStyle:{width:"260px","margin-top":"10px"},attrs:{align:"center"}},[e("div",{staticStyle:{padding:"1px","padding-top":"162px"}}),e("el-form",{ref:"SmsContent",staticClass:"demo-ruleForm",attrs:{model:t.SmsContent}},[e("el-form-item",{attrs:{label:"",prop:"cardContent"}},[e("div",{staticStyle:{position:"relative"}},[e("div",{staticStyle:{"text-align":"left"}},[e("vEdit",{staticStyle:{"border-radius":"2px","line-height":"22px","overflow-y":"auto","text-align":"left","padding-bottom":"30px"},attrs:{"is-video":t.form.templateClass1,"is-info-disabled":t.isInfoDisabled},model:{value:t.str,callback:function(e){t.str=e},expression:"str"}})],1),e("el-button",{staticClass:"insertUrl",attrs:{disabled:t.isInfoDisabled,icon:"el-icon-link"},on:{click:function(e){return t.insertUrl(2)}}},[t._v("插入链接（必选）")])],1)])],1)],1)])])],1)],1):t._e(),"5"==t.form.templateClass1?e("span"):t._e()]),e("div",{staticClass:"ax_default_line1"},[e("img",{staticClass:"img1",attrs:{src:a("6e41")}})]),e("el-form-item",{attrs:{label:"提交审核说明"}},[e("br"),e("el-row",[e("el-col",{attrs:{span:8}},[e("el-input",{staticStyle:{width:"645px"},attrs:{disabled:t.isInfoDisabled,type:"textarea",rows:7,placeholder:"请说明该信息模板的实际应用场景，以便审核。如：供用户查询账单信息",maxlength:"30","show-word-limit":""},on:{change:t.checkParam,focus:function(e){t.lastFocus="cardContent"}},model:{value:t.submitCheck.Content,callback:function(e){t.$set(t.submitCheck,"Content",e)},expression:"submitCheck.Content"}})],1)],1)],1),t.isInfoDisabled?t._e():e("el-form-item",{staticStyle:{"margin-top":"30px"}},[e("div",{staticStyle:{width:"92%"},attrs:{align:"center"}},[e("el-button",{staticClass:"btn btn-default",attrs:{disabled:t.isInfoDisabled},on:{click:t.back2list}},[e("i",{staticClass:"fa fa-undo"}),t._v("  取消返回   ")]),e("el-button",{staticClass:"btn btn-primary",attrs:{disabled:t.isInfoDisabled,type:"primary"},on:{click:function(e){return t.submitForm("form")}}},[e("i",{staticClass:"fa fa-save"}),t._v("  保存草稿   ")])],1)])],1)],1),e("el-col",{attrs:{span:2}})],1)],1),e("el-dialog",{attrs:{title:"menu"===t.addWhat?"新增悬浮菜单":"新增内置按钮",visible:t.addMenuVisible,width:"50%"},on:{"update:visible":function(e){t.addMenuVisible=e},close:t.handleClose}},[e("el-form",{ref:"form1",attrs:{model:t.menuForm,rules:t.menuRules,"label-width":"100px",size:t.cmpSize}},[e("el-form-item",{attrs:{label:"按钮类型",prop:"action"}},[e("el-select",{staticStyle:{width:"219px"},attrs:{placeholder:"请选择按钮类型"},on:{change:t.actionChange},model:{value:t.menuForm.action,callback:function(e){t.$set(t.menuForm,"action",e)},expression:"menuForm.action"}},[e("el-option",{attrs:{label:"回复按钮-是",value:"reply_yes"}}),e("el-option",{attrs:{label:"回复按钮-否",value:"reply_no"}}),e("el-option",{attrs:{label:"打开链接",value:"urlAction"}}),e("el-option",{attrs:{label:"拨打电话",value:"dialerAction"}})],1)],1),e("el-form-item",{attrs:{label:"按钮名称",prop:"displayText"}},[e("el-input",{staticStyle:{width:"219px"},attrs:{type:"text",maxlength:"8","show-word-limit":"",placeholder:"请输入按钮名称(尽量简短)"},model:{value:t.menuForm.displayText,callback:function(e){t.$set(t.menuForm,"displayText",e)},expression:"menuForm.displayText"}})],1),e("el-form-item",{attrs:{label:t.btnTargetLabel,prop:"target"}},[1==t.isSelectNet?e("span",[e("el-select",{staticStyle:{width:"219px"},attrs:{placeholder:"请选择",loading:t.loading},model:{value:t.menuForm.target,callback:function(e){t.$set(t.menuForm,"target",e)},expression:"menuForm.target"}},t._l(t.netsData,(function(a){return e("el-option",{key:a.id,attrs:{label:a.name,value:a.thumbnailUrl}},[e("span",{staticStyle:{float:"left"}},[t._v(t._s(a.name))])])})),1)],1):e("span",[e("el-input",{staticStyle:{width:"219px"},attrs:{type:"text",disabled:t.targetDisabled,placeholder:"请输入信息"},model:{value:t.menuForm.target,callback:function(e){t.$set(t.menuForm,"target",e)},expression:"menuForm.target"}})],1)])],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.addMenuVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.addMenu()}}},[t._v("确 定")])],1)],1),e("el-dialog",{attrs:{title:"选择模板",visible:t.selectElementVisible,width:"75%"},on:{"update:visible":function(e){t.selectElementVisible=e}}},[e("el-row",{attrs:{gutter:10}},[e("el-col",{attrs:{span:12}},[t._v("   ")]),e("el-col",{attrs:{span:12}},[e("el-input",{attrs:{disabled:t.isInfoDisabled,placeholder:"素材名称(支持模糊查询)",size:"mini"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchList.apply(null,arguments)}},model:{value:t.params.searchName,callback:function(e){t.$set(t.params,"searchName",e)},expression:"params.searchName"}},[e("el-button",{attrs:{slot:"append",disabled:t.isInfoDisabled,icon:"el-icon-search"},on:{click:t.searchList},slot:"append"})],1)],1)],1),e("el-tabs",{staticStyle:{height:"400px",overflow:"auto"},attrs:{"tab-position":t.selectTabPosition},on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[e("el-tab-pane",{attrs:{disabled:t.isInfoDisabled,name:"pic"}},[e("span",{attrs:{slot:"label"},slot:"label"},[t._v("图片 "),e("i",{staticClass:"fa fa-picture-o",attrs:{"aria-hidden":"true"}})]),e("div",{staticClass:"nav3"},[e("ul",{staticClass:"ul3"},t._l(t.tableData,(function(a,i){return e("li",{key:i,staticClass:"li3"},[e("el-card",{attrs:{"body-style":{padding:"5px"},shadow:"hover"},nativeOn:{click:function(e){return t.checkEle(a)}}},[e("div",{staticClass:"class_div3"},[e("el-image",{staticClass:"image3",attrs:{src:t.apiUrl+"/img/"+a.titlePage,fit:"cover"}})],1),e("div",{staticStyle:{padding:"5px"}},[e("el-radio",{ref:"eleBox",refInFor:!0,staticClass:"ellipsis",attrs:{disabled:t.isInfoDisabled,label:a},model:{value:t.radio,callback:function(e){t.radio=e},expression:"radio"}},[e("el-tooltip",{attrs:{content:a.name,placement:"top-start"}},[e("span",{staticClass:"time3"},[t._v(t._s(a.name))])])],1)],1)])],1)})),0)])]),e("el-tab-pane",{attrs:{disabled:t.isInfoDisabled,name:"video"}},[e("span",{attrs:{slot:"label"},slot:"label"},[t._v("视频 "),e("i",{staticClass:"fa fa-video-camera",attrs:{"aria-hidden":"true"}})]),e("div",{staticClass:"nav3"},[e("ul",{staticClass:"ul3"},t._l(t.videoData,(function(a,i){return e("li",{key:i,staticClass:"li3"},[e("el-card",{attrs:{"body-style":{padding:"5px"},shadow:"hover"},nativeOn:{click:function(e){return t.checkEle(a)}}},[e("div",{staticClass:"class_div3"},[e("el-image",{staticClass:"image3",attrs:{src:t.apiUrl+"/img/"+a.titlePage,fit:"cover"}})],1),e("div",{staticStyle:{padding:"5px"}},[e("el-radio",{ref:"eleBox",refInFor:!0,staticClass:"ellipsis",attrs:{disabled:t.isInfoDisabled,label:a},model:{value:t.radio,callback:function(e){t.radio=e},expression:"radio"}},[e("el-tooltip",{attrs:{content:a.name,placement:"top-start"}},[e("span",{staticClass:"time3"},[t._v(t._s(a.name))])])],1)],1)])],1)})),0)])]),e("el-tab-pane",{attrs:{disabled:t.isInfoDisabled,name:"audio"}},[e("span",{attrs:{slot:"label"},slot:"label"},[t._v("音频 "),e("i",{staticClass:"fa fa-music",attrs:{"aria-hidden":"true"}})]),e("div",{staticClass:"nav3"},[e("ul",{staticClass:"ul3"},t._l(t.audioData,(function(a,i){return e("li",{key:i,staticClass:"li3"},[e("el-card",{attrs:{"body-style":{padding:"5px"},shadow:"hover"},nativeOn:{click:function(e){return t.checkEle(a)}}},[e("div",{staticClass:"class_div3"},[e("el-image",{staticClass:"image3",attrs:{src:t.apiUrl+"/img/"+a.titlePage,fit:"cover"}})],1),e("div",{staticStyle:{padding:"5px"}},[e("el-radio",{ref:"eleBox",refInFor:!0,staticClass:"ellipsis",attrs:{disabled:t.isInfoDisabled,label:a},model:{value:t.radio,callback:function(e){t.radio=e},expression:"radio"}},[e("el-tooltip",{attrs:{content:a.name,placement:"top-start"}},[e("span",{staticClass:"time3"},[t._v(t._s(a.name))])])],1)],1)])],1)})),0)])])],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("div",{staticClass:"block",staticStyle:{float:"left"}},[e("el-pagination",{attrs:{"current-page":t.params.pageNum,"page-size":t.params.pageSize,"page-sizes":[8,16,24,32],layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"current-change":t.currentChange,"size-change":t.sizeChange}})],1),e("el-button",{attrs:{disabled:t.isInfoDisabled},on:{click:function(e){t.selectElementVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{disabled:t.isInfoDisabled,type:"primary"},on:{click:function(e){return t.doSelectEle()}}},[t._v("选 择")])],1)],1),e("el-dialog",{attrs:{title:"新增额外参数",visible:t.addParamVisible,width:"40%"},on:{"update:visible":function(e){t.addParamVisible=e}}},[e("el-form",{ref:"form2",attrs:{model:t.paramForm,rules:t.paramRules,"label-width":"100px",size:t.cmpSize}},[e("el-form-item",{attrs:{label:"参数名称",prop:"paramName"}},[e("el-col",{attrs:{span:12}},[e("el-input",{attrs:{width:"200",type:"text",placeholder:"请输入参数中文名称"},model:{value:t.paramForm.paramName,callback:function(e){t.$set(t.paramForm,"paramName",e)},expression:"paramForm.paramName"}})],1)],1),e("el-form-item",{attrs:{label:"参数代码",prop:"paramCode"}},[e("el-col",{attrs:{span:12}},[e("el-input",{attrs:{type:"text",placeholder:"请输入参数代码"},model:{value:t.paramForm.paramCode,callback:function(e){t.$set(t.paramForm,"paramCode",e)},expression:"paramForm.paramCode"}})],1)],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.addParamVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.addParam()}}},[t._v("确 定")])],1)],1),e("el-dialog",{attrs:{title:"新增动态参数",visible:t.addDynamicParamVisible,width:"60%"},on:{"update:visible":function(e){t.addDynamicParamVisible=e}}},[e("el-form",{ref:"form3",attrs:{model:t.paramDynamicForm,rules:t.paramDynamicRules,"label-width":"100px",size:t.cmpSize}},[e("el-form-item",{attrs:{label:"参数代码",prop:"paramName"}},[e("el-col",{attrs:{span:16}},[e("el-input",{attrs:{type:"text",placeholder:"请输入参数代码(建议英文)"},model:{value:t.paramDynamicForm.paramName,callback:function(e){t.$set(t.paramDynamicForm,"paramName",e)},expression:"paramDynamicForm.paramName"}})],1)],1),e("el-form-item",{attrs:{label:"参数类型",prop:"type"}},[e("el-col",{attrs:{span:16}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择参数类型"},on:{change:t.actionChange},model:{value:t.paramDynamicForm.type,callback:function(e){t.$set(t.paramDynamicForm,"type",e)},expression:"paramDynamicForm.type"}},[e("el-option",{attrs:{label:"纯中文，字数上限10",value:"0"}}),e("el-option",{attrs:{label:"纯英文，字数上限20",value:"1"}}),e("el-option",{attrs:{label:"纯数字，字数上限20",value:"2"}}),e("el-option",{attrs:{label:"中文+英文+数字+符号,字数上限30",value:"3"}}),e("el-option",{attrs:{label:"英文+数字+符号,字数上限20",value:"4"}})],1)],1)],1),""!=t.paramDynamicForm.type?e("span",[e("el-form-item",{attrs:{label:"参数示例",prop:"example"}},[e("el-col",{attrs:{span:16}},[e("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:8},placeholder:"请输入参数值示例(符合参数类型要求)"},model:{value:t.paramDynamicForm.example,callback:function(e){t.$set(t.paramDynamicForm,"example",e)},expression:"paramDynamicForm.example"}})],1)],1)],1):t._e()],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.addDynamicParamVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.addDynamicParam()}}},[t._v("确 定")])],1)],1),e("el-dialog",{staticClass:"urlDialog",attrs:{title:"新增链接",visible:t.addUrl,width:"60%",center:"","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.addUrl=e}}},[e("el-tabs",{staticStyle:{height:"220px"},attrs:{"tab-position":t.selectTabPosition1},on:{"tab-click":t.handleUrlClick},model:{value:t.selectName,callback:function(e){t.selectName=e},expression:"selectName"}},[e("el-tab-pane",{attrs:{label:"网页或者文章素材",name:"urlOrText"}},[e("div",{staticClass:"nav3"},[e("el-form",{ref:"form4",attrs:{model:t.addUrlForm,rules:t.urlRules,"label-width":"100px",size:t.cmpSize}},[e("el-form-item",{staticStyle:{"text-align":"left"},attrs:{label:"连接URL",prop:"target"}},[e("el-col",{attrs:{span:16}},[e("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择",loading:t.loading},model:{value:t.addUrlForm.target,callback:function(e){t.$set(t.addUrlForm,"target",e)},expression:"addUrlForm.target"}},t._l(t.netsData,(function(a){return e("el-option",{key:a.id,attrs:{label:a.name,value:a.tid}},[e("span",{staticStyle:{float:"left"}},[t._v(t._s(a.name))])])})),1)],1)],1)],1)],1)]),e("el-tab-pane",{attrs:{label:"Chatbot H5",name:"H5"}},[e("div",{staticClass:"nav3"},[e("el-form",{ref:"form5",attrs:{model:t.addH5Form,"label-width":"100px",rules:t.H5Rules}},[e("el-form-item",{attrs:{label:"",prop:"target"}},[e("el-row",[e("el-col",[e("el-radio",{attrs:{label:"1"},model:{value:t.addH5Form.target,callback:function(e){t.$set(t.addH5Form,"target",e)},expression:"addH5Form.target"}},[t._v(" 免登录链接 ")]),e("div",{staticClass:"time3"},[t._v("用户打开免登录链接后，无需登录即可查看5G消息内容，方便快捷，使用体验更佳，有效高转化率")])],1),e("el-col",[e("el-radio",{attrs:{label:"2"},model:{value:t.addH5Form.target,callback:function(e){t.$set(t.addH5Form,"target",e)},expression:"addH5Form.target"}},[t._v(" 标准链接 ")]),e("div",{staticClass:"time3"},[t._v("用户打开链接后，需登录才能查看5G消息内容，平台可获取用户行为数据")])],1)],1)],1)],1)],1)])],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.cancelAddUrl}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.handleAddUrl()}}},[t._v("确 定")])],1)],1)],1)},s=[],l=(a("d9e2"),a("14d9"),a("0fea")),r=a("cf74"),n=a("66f9"),o=a.n(n),m=a("65fc"),d=a.n(m),c=a("73fe"),h=a.n(c),p=function(){var t=this,e=t._self._c;return e("div",{ref:"editor",staticClass:"textarea-content",staticStyle:{height:"218px",width:"258px",border:"1px solid #999"},attrs:{contenteditable:!t.isInfoDisabled,placeholder:t.placeholder},domProps:{innerHTML:t._s(t.innerText)},on:{focus:function(e){t.isLocked=!0},blur:function(e){t.isLocked=!1},keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"delete",[8,46],e.key,["Backspace","Delete","Del"])?null:t.changeText.apply(null,arguments)},keyup:function(e){return t.checkLimitLength(e)}}})},u=[],f={name:"editDiv",props:{value:{type:String,default:""},isInfoDisabled:{type:Boolean,default:!1},isVideo:{type:Number,default:0}},data(){return{innerText:this.value,isLocked:!1,placeholder:"请输入短信内容"}},watch:{value(t){this.isLocked||(this.$el.innerHTML=t,this.innerText=t)}},created(){2===this.isVideo&&(this.placeholder="请输入文字内容")},mounted(){this.$refs.editor.addEventListener("DOMNodeInserted",this.changeText,!1),this.$refs.editor.addEventListener("DOMNodeRemoved",this.changeText,!1),this.$refs.editor.addEventListener("DOMCharacterDataModified",this.changeText,!1)},methods:{changeText(){this.$emit("input",this.$el.innerHTML)},checkLimitLength(t){const e=t.target.innerHTML,a=t.target.innerHTML.length;""===t.target.innerHTML&&t.target.blur(),a>260&&0===this.isVideo&&(t.target.blur(),t.target.innerHTML=e.substr(0,260),this.$message.warning("字数不能超过260")),a>500&&2===this.isVideo&&(t.target.blur(),t.target.innerHTML=e.substr(0,500),this.$message.warning("字数不能超过500")),a>300&&10===this.isVideo&&(t.target.blur(),t.target.innerHTML=e.substr(0,300),this.$message.warning("字数不能超过300"))}}},g=f,b=(a("2559"),a("2877")),y=Object(b["a"])(g,p,u,!1,null,null,null),v=y.exports,x="";const S='<button class="tag" contenteditable="false">Chatbot H5链接（免登录）</button>',T='<button class="tag" contenteditable="false">Chatbot H5链接</button>';var C={components:{vEdit:v},data(){var t=(t,e,a)=>{if(""===e)a(new Error("请输入参数示例"));else{let t=null;"0"===this.paramDynamicForm.type?t=/^[\u4e00-\u9fa5]{1,10}$/:"1"===this.paramDynamicForm.type?t=/^([a-z]|[A-Z]){1,20}$/:"2"===this.paramDynamicForm.type?t=/^[0-9]{1,20}$/:"3"===this.paramDynamicForm.type?t=/^(\w|\W){1,30}$/:"4"===this.paramDynamicForm.type&&(t=/^[^\u4e00-\u9fa5]{1,20}$/),t.test(e)?a():a(new Error("请按照参数类型格式输入示例."))}},e=(t,e,a)=>{if(""===e)a(new Error("请输入参数代码"));else{let t=!1;"card"===this.fatherActive?this.paramsDynamicDataList[this.currentIdx]:this.paramsDynamicData.some((i,s)=>{if(i.paramName===e)return a(new Error("动态参数已经存在,请勿重复输入")),t=!0,!0}),t||a()}};return{defaultMediaImg:d.a,vidStr:"",str:"",msgStr:"",isInfoDisabled:!1,titlePage:"",indexUrl:"",apiUrl:this.StoreApiUrl,cmpSize:"small",userId:this.StoreUserId,rules:{name:[{required:!0,message:"请输入模板名称",trigger:"blur"},{max:30,message:"字数小于30",trigger:"blur"}],chatbotId:[{required:!1,message:"请输入chatbot id",trigger:"blur"},{max:50,message:"字数小于50",trigger:"blur"}],content:[{required:!0,message:"请输入模板内容",trigger:"blur"},{max:1e3,message:"字数小于1000",trigger:"blur"}]},loading:!1,chatbotList:[],displayTemplateClass:!0,eleType:0,disabled0:!1,disabled1:!1,disableChatbot:!1,tempDisable0:!1,tempDisable1:!1,tempDisable2:!1,tempDisable3:!1,tempDisable5:!1,tempDisable10:!1,tempDisable4:!1,form:{id:"",name:"",templateClass:3,templateClass1:0,chatbotId:null,templateId:null,status:null,type:2,templateType:2,titlePage:"",smsBody:"",mediaSms:"",aimSms:"",userId:"",mediaUrl:"",thumbnailUrl:"",cardTitle:"",cardContent:"",extraParams:"",smsType:"",commitDesc:"",fallback:""},SmsClass:"text",currentIdx:0,elementList:[],floatButtonList:[],floatMenuList:[],paramsDataList:[],paramsDynamicDataList:[],loadElementObj:{},elementObj:{cardContent:"",cardTitle:"",desc:"",floatMenu:"",id:null,materailBtn:"",material:"",materialSize:null,templateId:null,elementId:null,thumbnail:"",thumbnailSize:null,thumbnailType:"",until:"",fileName:"",extraParams:"",type:null,mediaSource:null,elementType:null,tid:null},menuForm:{id:"",displayText:"",action:"",target:"",data:"",url:"",phone:""},dynamicValidateForm:{domains:[],domainsMedia:[],mediaInsertUrl:""},menuRules:{displayText:[{required:!0,message:"请输入按钮名称",trigger:"blur"}],action:[{required:!0,message:"请选择按钮类型",trigger:"blur"}]},imgSrc:o.a,SmsImgSrc:o.a,styleObj:{width:"80%",height:"512px",background:"url("+h.a+") no-repeat center center",backgroundSize:"70% 100%",position:"relative"},styleObj1:{background:"url("+o.a+") no-repeat center center",backgroundSize:"80% 100%",position:"relative"},tipAddCard:"新增一个卡片",tipDelCard:"删除当前卡片",tipSms:"短信回落",tipMediaSms:"视频短信回落",tipAimSms:"短小2.0回落",addMenuVisible:!1,disabled:!1,btnTargetLabel:"目标",targetDisabled:!1,addWhat:"",floatButtons:[],floatMenus:[],noteTip:"点击图片可选择或更换素材",isSelectNet:!1,netsData:[],selectElementVisible:!1,selectTabPosition:"left",selectTabPosition1:"top",activeName:"pic",selectName:"urlOrText",radio:"",params:{searchName:"",searchType:0,searchStatus:9,elementType:1,pageNum:1,pageSize:8,cfgName:"MATERIAL_BASE_URL",cfgType:"URL",videoSmsFlag:""},tableData:[],videoData:[],audioData:[],total:0,addParamVisible:!1,paramForm:{paramName:"",paramCode:""},addDynamicParamVisible:!1,paramDynamicForm:{paramName:"",type:"",example:""},addUrl:!1,addUrlForm:{target:""},addH5Form:{target:""},urlRules:{target:[{required:!0,message:"请选择链接",trigger:"blur"}]},H5Rules:{target:[{required:!0,message:"选择内容不能为空",trigger:"change"}]},SmsContent:{videoMsg:"",cardContent:"",mediaInsertUrl:""},msgCard:{cardTitle:"",cardContent:""},msgText:{cardTitle:"",cardContent:"",cardSign:""},submitCheck:{Content:""},addText:!1,addMedia:!1,randomNum:0,filelist:[],num:1,selectEle:"",isShowMedia:!1,selectType:"",inputShow:!1,paramRules:{paramName:[{required:!0,message:"请输入参数中文名称",trigger:"blur"}],paramCode:[{required:!0,message:"请输入参数代码",trigger:"blur"}]},paramDynamicRules:{paramName:[{required:!0,validator:e,trigger:"blur"}],type:[{required:!0,message:"请选择参数类型",trigger:"change"}],example:[{required:!0,validator:t,trigger:"blur"}]},lastFocus:"",paramsData:[],fatherActive:"",fatherQueryParam:{},visible:!0,step:1,textConent:"",paramsDynamicData:[],customUrl:"",isSelectImg:!1}},computed:{chatbotId(){return sessionStorage.getItem("chatBotId")},StoreApiUrl(){return this.$store.state.RESOUCE_BASE_URL},StoreUserId(){return this.$store.state.userId}},created(){location.href.indexOf("index/")>-1?this.indexUrl="/index":this.indexUrl="";const t=new FormData;t.append("cfgName",this.params.cfgName),t.append("cfgType",this.params.cfgType),t.append("pageNum",this.params.pageNum),t.append("pageSize",this.params.pageSize),Object(l["i"])(r["a"].temapi.cfgList,t).then(t=>{this.$store.dispatch("setBaseUrl",t.list[0].cfgValue),this.apiUrl=t.list[0].cfgValue})},async mounted(){const t=this.$route.query.templateId;t||(this.fatherActive=this.$route.query.active,this.fatherQueryParam=this.$route.query.queryObj),"card"===this.fatherActive?this.titlePage="新增卡片模板":"txt"===this.fatherActive?this.titlePage="新增文本模板":"media"===this.fatherActive&&(this.titlePage="新增多媒体模板");const e=this.$route.query.mode;if(x=e,this.getChatbots(),this.netsData=await this.getNets(""),this.isInfoDisabled=!1,"edit"===e){this.isSelectImg=!0,"card"===this.fatherActive?this.titlePage="编辑卡片模板":"txt"===this.fatherActive?this.titlePage="编辑文本模板":"media"===this.fatherActive&&(this.titlePage="编辑多媒体模板");const t=this.$route.query.row;this.form={...this.form,...t},this.disableChatbot=!1;const e={};e.id=t.id,Object(l["i"])(r["a"].temapi.eles,e).then(t=>{var e,a=t||t.data;this.elementList=a.list,null===(e=this.elementList)||void 0===e||e.forEach((t,e,a)=>{var i=[],s=[],l=[],r=[];null!=t.materailBtn&&""!==t.materailBtn&&(i=JSON.parse(t.materailBtn)),null!=t.floatMenu&&""!==t.floatMenu&&(s=JSON.parse(t.floatMenu)),null!=t.extraParams&&""!==t.extraParams&&(l=JSON.parse(t.extraParams)),null!=t.dynamicParams&&""!==t.dynamicParams&&(r=JSON.parse(t.dynamicParams)),this.floatButtonList.push(i),this.paramsDataList.push(l),this.paramsDynamicDataList.push(r),s.length>0&&(this.floatMenuList=s)});var i=a.list[0];if(this.form.cardTitle=i.cardTitle,this.form.cardContent=i.cardContent,this.form.mediaUrl=i.material,this.form.thumbnailUrl=i.thumbnail,this.elementObj=i,this.loadElementObj=i,this.textConent=i.material,this.eleType=this.elementObj.mediaSource,0===this.eleType?(this.disabled0=!1,this.disabled1=!0):(this.disabled0=!0,this.disabled1=!1),this.tempDisable1=!1,this.tempDisable3=!1,this.tempDisable4=!1,1===this.form.templateClass?this.tempDisable1=!1:this.tempDisable3=!1,"3"===a.msgTemplate.smsType){if(this.tempDisable10=!1,a.msgTemplate.smsBody.includes("SDATA[noLoginSmsShortLink]"))this.str=a.msgTemplate.smsBody.replace("SDATA[noLoginSmsShortLink]",S);else if(a.msgTemplate.smsBody.includes("SDATA[mppSmsShortLink]"))this.str=a.msgTemplate.smsBody.replace("SDATA[mppSmsShortLink]",T);else if(a.msgTemplate.smsBody.includes(":")){const t=a.msgTemplate.smsBody.slice(a.msgTemplate.smsBody.lastIndexOf(":")+1).split("]")[0];this.urlVal=t;const e=this.netsData.find(({tid:e})=>e===t).name;this.val1=e,this.customUrl=`<button class="tag" contenteditable="false">${this.val1}</button>`,this.str=a.msgTemplate.smsBody.replace("SDATA[customUrl:"+t+"]",this.customUrl)}else this.str=a.msgTemplate.smsBody;this.form.templateClass1=10}else if("2"===a.msgTemplate.smsType){const t=JSON.parse(a.msgTemplate.mediaSms.slice(9,-3));this.dynamicValidateForm.domains=t.filelist,this.dynamicValidateForm.domains.forEach(t=>{if(t.content)if(t.content.includes("SDATA[noLoginSmsShortLink]"))t.content=t.content.replace("SDATA[noLoginSmsShortLink]",S);else if(t.content.includes("SDATA[mppSmsShortLink]"))t.content=t.content.replace("SDATA[mppSmsShortLink]",T);else if(t.content.includes(":")){const e=t.content.slice(t.content.lastIndexOf(":")+1).split("]")[0];this.urlVal=e;const a=this.netsData.find(({tid:t})=>t===e).name;this.val1=a,this.customUrl=`<button class="tag" contenteditable="false">${this.val1}</button>`,t.content=t.content.replace("SDATA[customUrl:"+e+"]",this.customUrl)}}),this.num=this.dynamicValidateForm.domains[this.dynamicValidateForm.domains.length-1].order,this.addText=!0,this.SmsContent.videoMsg=t.title,this.tempDisable2=!1,this.form.templateClass1=2}else if("1"===a.msgTemplate.smsType){const t=JSON.parse(a.msgTemplate.aimSms);this.msgText.cardTitle=t.title,this.msgStr=t.content,this.msgText.cardSign=t.sign,this.msgCard.cardTitle=t.aimTemplateId,this.tempDisable0=!1,this.form.templateClass1=0}else this.tempDisable5=!1,this.form.templateClass1=5;this.submitCheck.Content=a.msgTemplate.commitDesc,null!=i.thumbnailType&&""!==i.thumbnailType?this.imgSrc=this.$store.state.RESOUCE_BASE_URL+"/img/"+i.thumbnailType:this.imgSrc=o.a,null!=i.materailBtn&&""!==i.materailBtn&&(this.floatButtons=JSON.parse(i.materailBtn)),null!=i.floatMenu&&""!==i.floatMenu&&(this.floatMenus=JSON.parse(i.floatMenu)),null!=i.extraParams&&""!==i.extraParams&&(this.paramsData=JSON.parse(i.extraParams)),null!=i.dynamicParams&&""!==i.dynamicParams&&(this.paramsDynamicData=JSON.parse(i.dynamicParams))})}else if("info"===e){const e=sessionStorage.getItem("contentType"),a=this;switch(this.isInfoDisabled=!0,e){case"1":a.titlePage="文本模板详情",a.fatherActive="txt";break;case"2":a.titlePage="多媒体模板详情",a.fatherActive="media";break;case"3":a.titlePage="卡片模板详情",a.fatherActive="card";break;default:break}this.disableChatbot=!1,Object(l["i"])(r["a"].temapi.detail,{templateId:t}).then(t=>{var e,a=t||t.data;this.form={...this.form,...a.msgTemplate},this.elementList=a.list,null===(e=this.elementList)||void 0===e||e.forEach((t,e,a)=>{var i=[],s=[],l=[],r=[];null!=t.materailBtn&&""!==t.materailBtn&&(i=JSON.parse(t.materailBtn)),null!=t.floatMenu&&""!==t.floatMenu&&(s=JSON.parse(t.floatMenu)),null!=t.extraParams&&""!==t.extraParams&&(l=JSON.parse(t.extraParams)),null!=t.dynamicParams&&""!==t.dynamicParams&&(r=JSON.parse(t.dynamicParams)),this.floatButtonList.push(i),this.paramsDataList.push(l),this.paramsDynamicDataList.push(r),s.length>0&&(this.floatMenuList=s)});var i=a.list[0];if(this.form.cardTitle=i.cardTitle,this.form.cardContent=i.cardContent,this.form.mediaUrl=i.material,this.form.thumbnailUrl=i.thumbnail,this.elementObj=i,this.loadElementObj=i,this.textConent=i.material,this.eleType=this.elementObj.mediaSource,0===this.eleType?(this.disabled0=!1,this.disabled1=!0):(this.disabled0=!0,this.disabled1=!1),this.tempDisable1=!1,this.tempDisable3=!1,this.tempDisable4=!1,1===this.form.templateClass?this.tempDisable1=!1:this.tempDisable3=!1,"3"===a.msgTemplate.smsType){if(this.tempDisable10=!1,a.msgTemplate.smsBody.includes("SDATA[noLoginSmsShortLink]"))this.str=a.msgTemplate.smsBody.replace("SDATA[noLoginSmsShortLink]",S);else if(a.msgTemplate.smsBody.includes("SDATA[mppSmsShortLink]"))this.str=a.msgTemplate.smsBody.replace("SDATA[mppSmsShortLink]",T);else if(a.msgTemplate.smsBody.includes(":")){const t=a.msgTemplate.smsBody.slice(a.msgTemplate.smsBody.lastIndexOf(":")+1).split("]")[0];this.urlVal=t;const e=this.netsData.find(({tid:e})=>e===t).name;this.val1=e,this.customUrl=`<button class="tag" contenteditable="false">${this.val1}</button>`,this.str=a.msgTemplate.smsBody.replace("SDATA[customUrl:"+t+"]",this.customUrl)}else this.str=a.msgTemplate.smsBody;this.form.templateClass1=10}else if("2"===a.msgTemplate.smsType){const t=JSON.parse(a.msgTemplate.mediaSms.slice(9,-3));this.dynamicValidateForm.domains=t.filelist,this.dynamicValidateForm.domains.forEach(t=>{if(t.content)if(t.content.includes("SDATA[noLoginSmsShortLink]"))t.content=t.content.replace("SDATA[noLoginSmsShortLink]",S);else if(t.content.includes("SDATA[mppSmsShortLink]"))t.content=t.content.replace("SDATA[mppSmsShortLink]",T);else if(t.content.includes(":")){const e=t.content.slice(t.content.lastIndexOf(":")+1).split("]")[0];this.urlVal=e;const a=this.netsData.find(({tid:t})=>t===e).name;this.val1=a,this.customUrl=`<button class="tag" contenteditable="false">${this.val1}</button>`,t.content=t.content.replace("SDATA[customUrl:"+e+"]",this.customUrl)}}),this.num=this.dynamicValidateForm.domains[this.dynamicValidateForm.domains.length-1].order,this.addText=!0,this.SmsContent.videoMsg=t.title,this.tempDisable2=!1,this.form.templateClass1=2}else if("1"===a.msgTemplate.smsType){const t=JSON.parse(a.msgTemplate.aimSms);this.msgText.cardTitle=t.title,this.msgStr=t.content,this.msgText.cardSign=t.sign,this.msgCard.cardTitle=t.aimTemplateId,this.tempDisable0=!1,this.form.templateClass1=0}else this.tempDisable5=!1,this.form.templateClass1=5;this.submitCheck.Content=a.msgTemplate.commitDesc,null!=i.thumbnailType&&""!==i.thumbnailType?this.imgSrc=this.$store.state.RESOUCE_BASE_URL+"/img/"+i.thumbnailType:this.imgSrc=o.a,null!=i.materailBtn&&""!==i.materailBtn&&(this.floatButtons=JSON.parse(i.materailBtn)),null!=i.floatMenu&&""!==i.floatMenu&&(this.floatMenus=JSON.parse(i.floatMenu)),null!=i.extraParams&&""!==i.extraParams&&(this.paramsData=JSON.parse(i.extraParams)),null!=i.dynamicParams&&""!==i.dynamicParams&&(this.paramsDynamicData=JSON.parse(i.dynamicParams))})}else if(this.disableChatbot=!1,"card"===this.fatherActive&&this.addCard(),"media"===this.fatherActive||"txt"===this.fatherActive){var a={mediaSource:0};this.elementList.push(a)}},methods:{getChatbots(){const t=new FormData;t.append("opId",this.$store.state.user.opId),Object(l["i"])("/msg5g-svc/combox/getChatbots",t).then(t=>{this.chatbotList=t||[],this.loading=!1})},getNets(t){const e=new FormData;return e.append("name",t),Object(l["i"])("/msg5g-svc/combox/getNets",e)},cardChange(t,e){this.currentIdx=t,this.radio=null;const a=this.elementList[t];null!=a.thumbnailType&&""!==a.thumbnailType?this.imgSrc=this.$store.state.RESOUCE_BASE_URL+"/img/"+a.thumbnailType:this.imgSrc=o.a},addCard(){if(this.isSelectImg=!1,this.elementList.length<12){var t={mediaSource:0,cardTitle:"",cardContent:""};this.floatButtonList.push([]),this.paramsDataList.push([]),this.paramsDynamicDataList.push([]),this.elementList.push(t),setTimeout(this.nextCard,800),this.$nextTick(()=>{this.nextCard()})}else this.$message({type:"warning",message:"模板最多拥有12个卡片."})},nextCard(){this.$refs.myCards.setActiveItem(this.elementList.length-1),this.loading=!1},deleteCard(){1===this.elementList.length?this.$message({type:"warning",message:"模板需要至少一个卡片,请先新增卡片或修改当前卡片."}):this.$confirm("确认删除当前卡片吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.elementList.splice(this.currentIdx,1),this.floatButtonList.splice(this.currentIdx,1),this.paramsDataList.splice(this.currentIdx,1),this.paramsDynamicDataList.splice(this.currentIdx,1),0===this.currentIdx?(this.$refs.myCards.setActiveItem(0),this.cardChange(0)):this.$refs.myCards.prev()}).catch(()=>{this.$message({type:"info",message:"已取消"})})},searchList(){const t={};t.name=this.params.searchName,t.type=this.params.searchType,t.status=this.params.searchStatus,t.elementType=this.params.elementType,t.pageNum=this.params.pageNum,t.pageSize=this.params.pageSize,t.videoSmsFlag=this.params.videoSmsFlag,t.chatbotId=this.chatbotId,Object(l["i"])(r["a"].temapi.eleList,t).then(t=>{var e=t||t.data;this.total=e.total,"pic"===this.activeName?this.tableData=e.list:"video"===this.activeName?this.videoData=e.list:this.audioData=e.list})},handleClick(t,e){"pic"===this.activeName?this.params.searchType=0:"video"===this.activeName?this.params.searchType=1:this.params.searchType=2,this.searchList()},handleUrlClick(t,e){"urlOrText"===this.selectName?this.$refs["form5"].resetFields():this.$refs["form4"].resetFields()},handleTextClick(t){this.SmsClass="text"===t?"text":"message"},insertUrl(t,e){if(0===t)this.selectType=0;else if(1===t){if(this.obj=e,this.btnExist(this.obj.content))return this.$message.warning("只能插入一个链接");this.selectType=1}else{if(this.btnExist(this.str))return this.$message.warning("只能插入一个链接");this.selectType=2}this.addUrl=!0},btnExist(t){return t.includes('<button class="tag" contenteditable="false">')},isNumber(t,e){const a=t.charAt(t.indexOf(e));return t=0!==t.length&&0!==t.indexOf(e)&&Number.isFinite(Number(t.charAt(t.indexOf(e)-1)))?t.replace(a,"。"+a):t.replace("]","]。"),t},handleAddUrl(){"urlOrText"===this.selectName&&this.$refs["form4"].validate(t=>{if(t){if(this.urlVal=this.addUrlForm.target,this.$verification(this.SmsContent.cardContent)&&(this.SmsContent.cardContent=""),this.val1=this.netsData.find(({tid:t})=>t===this.urlVal).name,this.customUrl=`<button class="tag" contenteditable="false">${this.val1}</button>`,0===this.selectType);else if(2===this.selectType){if(-1!==this.str.indexOf(this.customUrl))return;this.str+=this.customUrl}else{var e;if(-1!==(null===(e=this.obj)||void 0===e?void 0:e.content.indexOf(this.customUrl)))return;this.obj.content+=this.customUrl,this.obj.customUrl=this.customUrl,this.obj.val1=this.val1,this.obj.urlVal=this.urlVal}this.addUrl=!1,this.$refs["form4"].resetFields()}}),"H5"===this.selectName&&this.$refs["form5"].validate(t=>{if(t){if("1"===this.addH5Form.target&&2===this.selectType){if(-1!==this.str.indexOf(S))return;this.str+=S}else if("1"===this.addH5Form.target&&0===this.selectType);else if("1"===this.addH5Form.target&&1===this.selectType){var e;if(-1!==(null===(e=this.obj)||void 0===e?void 0:e.content.indexOf(S)))return;this.obj.content+=S,this.obj.customUrl=this.customUrl,this.obj.val1=this.val1}else if("2"===this.addH5Form.target&&2===this.selectType){if(-1!==this.str.indexOf(T))return;this.str+=T}else if("2"===this.addH5Form.target&&0===this.selectType);else{var a;if(-1!==(null===(a=this.obj)||void 0===a?void 0:a.content.indexOf(S)))return;this.obj.content+=T,this.obj.customUrl=this.customUrl,this.obj.val1=this.val1}this.org=this.addH5Form.target,this.addUrl=!1,this.$refs["form5"].resetFields()}})},handleAddText(){this.addText=!0,this.addWhat="button",this.dynamicValidateForm.domains.push({key:Date.now(),order:this.num,filename:(new Date).getTime()+".txt",content:"",type:"0"}),this.num++},handleMedia(){this.addText=!0,this.addWhat="button",this.dynamicValidateForm.domains.push({key:Date.now(),order:this.num,filename:"",content:"",type:"1",mediaImgSrc:o.a}),this.num++},removeDomain(t){this.dynamicValidateForm.domains.splice(t,1),this.num>0&&this.num--},removeMedia(t){this.dynamicValidateForm.domains.splice(t,1),this.num>0&&this.num--},handleDynamicParam(t){this.addDynamicParamVisible=!0,this.lastFocus=0===t?"cardTitle":1===t?"cardContent":2===t?"cardTitle1":"cardContent1"},handleInsideBtn(t){if(0===t){if(4===this.floatButtonList[this.currentIdx].length)return this.$message.warning("最多支持4个按钮");this.addWhat="button"}this.addMenuVisible=!0},cancelAddUrl(){this.addUrl=!1,this.$refs["form4"].resetFields(),this.$refs["form5"].resetFields()},currentChange(t){this.params.pageNum=t,this.searchList()},sizeChange(t){this.params.pageSize=t,this.searchList()},toSelect(t,e){this.currentImg=e,0===t?(this.selectEle=0,this.params.videoSmsFlag=""):1===t?(this.selectEle=1,this.params.videoSmsFlag=""):(this.selectEle=2,this.params.videoSmsFlag=1),0===this.eleType&&"info"!==this.$route.query.mode&&(this.selectElementVisible=!0,this.searchList())},checkEle(t){this.radio=t},doSelectEle(){if(null==this.radio||""===this.radio)this.$message({message:"请选择一个素材！",type:"warning"});else{var t=this.elementList[this.currentIdx];null==this.radio.titlePage&&0===this.radio.type?(this.imgSrc=this.apiUrl+"/img/"+this.radio.fileName,this.form.titlePage=this.radio.fileName):0===this.selectEle?(this.imgSrc=this.apiUrl+"/img/"+this.radio.titlePage,this.form.titlePage=this.radio.titlePage,"card"===this.fatherActive&&(t.cardTitle+=this.radio.name)):1===this.selectEle?(this.imgSrc=this.apiUrl+"/img/"+this.radio.titlePage,this.form.titlePage=this.radio.titlePage,this.SmsImgSrc=this.apiUrl+"/img/"+this.radio.titlePage):(this.currentImg.mediaImgSrc=this.apiUrl+"/img/"+this.radio.titlePage,this.currentImg.content=this.radio.tid,this.currentImg.filename=this.radio.name,this.styleObj1=""),t.fileName=this.radio.fileName,t.elementId=this.radio.id,t.materialSize=this.radio.size,t.thumbnail=this.radio.thumbnailUrl,t.thumbnailSize=this.radio.tpSize,t.until=this.radio.until,t.elementType=this.radio.elementType,t.tid=this.radio.tid,t.material=this.radio.url,null!=this.radio.titlePage&&2!==this.selectEle&&(t.thumbnailType=this.radio.titlePage,this.form.titlePage=this.radio.titlePage),this.selectElementVisible=!1,this.radio="",this.isSelectImg=!0}},actionChange(t){"reply_yes"===t||"reply_no"===t?(this.btnTargetLabel="目标",this.targetDisabled=!0,this.isSelectNet=!1):"urlAction"===t?(this.targetDisabled=!1,this.btnTargetLabel="连接URL",this.isSelectNet=!0):"dialerAction"===t&&(this.targetDisabled=!1,this.btnTargetLabel="拨打号码",this.isSelectNet=!1)},deleteBtn(t){"card"===this.fatherActive&&(this.floatButtonList[this.currentIdx]=this.floatButtonList[this.currentIdx].filter((function(e){if(e.id!==t)return e})),this.floatMenuList=this.floatMenuList.filter((function(e){if(e.id!==t)return e}))),"txt"!==this.fatherActive&&"media"!==this.fatherActive||(this.floatMenus=this.floatMenus.filter((function(e){if(e.id!==t)return e})))},handleClose(){this.$refs["form1"].resetFields()},addMenu(){this.$refs["form1"].validate(t=>{if(t){const t={};t.id=(new Date).getTime(),t.displayText=this.menuForm.displayText,"reply_yes"===this.menuForm.action?(t.action="reply",t.data="set_by_chatbot_reply_yes"):"reply_no"===this.menuForm.action?(t.action="reply",t.data="set_by_chatbot_reply_no"):"urlAction"===this.menuForm.action?(t.action="urlAction",t.data="set_by_chatbot_open_url",t.url=this.menuForm.target):"dialerAction"===this.menuForm.action&&(t.action="dialerAction",t.data="set_by_chatbot_open_dialer",t.phoneNumber=this.menuForm.target),"button"===this.addWhat?this.floatButtonList[this.currentIdx].push(t):(this.floatMenuList.push(t),this.floatMenus.push(t)),this.$refs["form1"].resetFields(),this.addMenuVisible=!1}})},addDynamicParam(){this.$refs["form3"].validate(t=>{if(t){var e=this.elementList[this.currentIdx];"card"===this.fatherActive?(this.$verification(e.cardTitle)&&(e.cardTitle=""),this.$verification(e.cardContent)&&(e.cardContent=""),"cardTitle"===this.lastFocus?e.cardTitle=e.cardTitle+"${"+this.paramDynamicForm.paramName+"}":"cardContent"===this.lastFocus?e.cardContent=e.cardContent+"${"+this.paramDynamicForm.paramName+"}":"cardTitle1"===this.lastFocus?this.msgCard.cardTitle=this.msgCard.cardTitle+"${"+this.paramDynamicForm.paramName+"}":this.msgCard.cardContent=this.msgCard.cardContent+"${"+this.paramDynamicForm.paramName+"}"):this.textConent=this.textConent+"${"+this.paramDynamicForm.paramName+"}";const t={paramName:this.paramDynamicForm.paramName};"0"===this.paramDynamicForm.type?(t.chars=["chinese"],t.maxLen=10):"1"===this.paramDynamicForm.type?(t.chars=["english"],t.maxLen=20):"2"===this.paramDynamicForm.type?(t.chars=["digit"],t.maxLen=20):"3"===this.paramDynamicForm.type?(t.chars=["chinese","english","digit","symbol"],t.maxLen=30):"4"===this.paramDynamicForm.type&&(t.chars=["english","digit","symbol"],t.maxLen=20),t.example=this.paramDynamicForm.example,"card"===this.fatherActive&&this.paramsDynamicDataList[this.currentIdx].push(t),this.paramsDynamicData.push(t),this.$refs["form3"].resetFields(),this.addDynamicParamVisible=!1}})},addParam(){var t=this.elementList[this.currentIdx];"cardTitle"===this.lastFocus?t.cardTitle=t.cardTitle+"^<"+this.paramForm.paramCode+"^>":t.cardContent=t.cardContent+"^<"+this.paramForm.paramCode+"^>";const e={paramCode:this.paramForm.paramCode,paramName:this.paramForm.paramName};this.paramsDataList[this.currentIdx].push(e),this.$refs["form2"].resetFields(),this.addParamVisible=!1},checkParam(t){var e=this.elementList[this.currentIdx];if("card"===this.fatherActive){var a=e.cardTitle+e.cardContent;this.paramsDataList[this.currentIdx]=this.paramsDataList[this.currentIdx].filter((function(t){const e="^<"+t.paramCode+"^>";if(a.indexOf(e)>-1)return t})),this.paramsDynamicDataList[this.currentIdx]=this.paramsDynamicDataList[this.currentIdx].filter((function(t){const e="${"+t.paramName+"}";if(a.indexOf(e)>-1)return t}))}else{var i=this.textConent;this.paramsDynamicData=this.paramsDynamicData.filter((function(t){var e="${"+t.paramName+"}";if(i.indexOf(e)>-1)return t}))}},checkParam1(t,e){this.dynamicValidateForm.domains.find((a,i)=>{i===e&&(a.content=t)})},urlChange(t){var e=this.elementList[this.currentIdx];""!==e.thumbnail&&null!=e.thumbnail?this.imgSrc=this.form.thumbnailUrl:this.imgSrc=""===t||null==t?o.a:t,this.form.titlePage=this.imgSrc},thumbnailChange(t){""!==t&&null!=t&&(this.imgSrc=t),this.form.titlePage=this.imgSrc},submitForm(t){let e=!0,a="卡片";if(this.elementList.forEach((t,i,s)=>{(this.$verification(t.fileName)||this.$verification(t.cardTitle))&&"card"===this.fatherActive?(e=!1,a=a+(i+1)+","):e=!0}),a+="缺少素材或者卡片标题为空,请检查.",e){let e=!0;if(2!==this.form.templateClass1&&10!==this.form.templateClass1||this.$refs["SmsContent"].validate(t=>{if(!t)return e=!1,!1}),0===this.form.templateClass1&&"text"===this.SmsClass&&this.$refs["msgCard"].validate(t=>{if(!t)return e=!1,!1}),0===this.form.templateClass1&&"message"===this.SmsClass&&this.$refs["msgText"].validate(t=>{if(!t)return e=!1,!1}),!e)return!1;this.$refs[t].validate(t=>{if(!t)return!1;{const t={};"card"===this.fatherActive&&2!==this.selectEle&&(this.form.titlePage=this.elementList[0].thumbnailType),null!=this.form.chatbotId&&""!==this.form.chatbotId||(this.chatbotId?this.form.chatbotId=this.chatbotId:this.form.chatbotId=""),null!=this.form.userId&&""!==this.form.userId||(this.userId?this.form.userId=this.userId:this.form.userId="");let i=!0;if(0===this.form.templateClass1&&""!==this.msgStr)this.form.smsType="1",this.form.smsBody="",this.form.mediaSms="",this.form.fallback="AIMSMS",this.form.aimSms=JSON.stringify({title:this.formatTitleAndSign(this.msgText.cardTitle),content:this.msgStr,sign:this.formatTitleAndSign(this.msgText.cardSign),linkType:"1",aimTemplateId:this.msgCard.cardTitle});else if(2===this.form.templateClass1){this.form.smsType="2",this.form.smsBody="",this.form.aimSms="",this.form.fallback="MEDIASMS";for(var e=0;e<this.dynamicValidateForm.domains.length;e++){const t=this.dynamicValidateForm.domains[e],a=t.content.replace("\\","");if("0"===t.type&&!this.btnExist(a))return void this.$message.warning("请先插入链接")}for(let e=0;e<this.dynamicValidateForm.domains.length;e++){const t=this.dynamicValidateForm.domains[e],a=t.content.replace("\\","");"0"===t.type&&(a.includes(S)?(t.content=a.replace(S,"SDATA[noLoginSmsShortLink]"),t.content=this.isNumber(t.content,"SDATA[noLoginSmsShortLink]")):a.includes(T)?(t.content=a.replace(T,"SDATA[mppSmsShortLink]"),t.content=this.isNumber(t.content,"SDATA[mppSmsShortLink]")):(t.content=a.replace(t.customUrl,"SDATA[customUrl:"+t.urlVal+"]"),t.content=this.isNumber(t.content,"SDATA[customUrl:"+t.urlVal+"]")))}const t="<![CDATA["+JSON.stringify({title:this.SmsContent.videoMsg,filelist:this.dynamicValidateForm.domains})+"]]>";this.form.mediaSms=t}else if(10===this.form.templateClass1&&""!==this.str)this.form.smsType="3",this.form.aimSms="",this.form.mediaSms="",this.form.fallback="SMS",this.btnExist(this.str)?this.str.includes(S)?(this.str=this.str.replace(S,"SDATA[noLoginSmsShortLink]"),this.form.smsBody=this.isNumber(this.str,"SDATA[noLoginSmsShortLink]")):this.str.includes(T)?(this.str=this.str.replace(T,"SDATA[mppSmsShortLink]"),this.form.smsBody=this.isNumber(this.str,"SDATA[mppSmsShortLink]")):(this.str=this.str.replace(this.customUrl,"SDATA[customUrl:"+this.urlVal+"]"),this.form.smsBody=this.isNumber(this.str,"SDATA[customUrl:"+this.urlVal+"]")):(this.$message.warning("请先插入链接"),i=!1);else{if(5!==this.form.templateClass1)return void this.$message.warning("请输入短信内容");this.form.smsType="0",this.form.smsBody="",this.form.aimSms="",this.form.mediaSms="",this.form.fallback=""}if(this.form.commitDesc=this.submitCheck.Content,"card"===this.fatherActive?(this.t=2,this.tT=2):"txt"===this.fatherActive?(this.t=0,this.tT=0):(this.t=1,this.tT=1),!i)return!1;var a={id:this.form.id,name:this.form.name,templateClass:this.form.templateClass,chatbotId:this.chatbotId,templateId:this.form.templateId,titlePage:this.form.titlePage,status:this.form.status,smsBody:this.form.smsBody,mediaSms:this.form.mediaSms,aimSms:this.form.aimSms,userId:this.form.userId,type:this.t,templateType:this.tT,smsType:this.form.smsType,fallback:this.form.fallback,commitDesc:this.form.commitDesc};let s;t.msgTemplate=a,1===this.eleType&&(this.elementObj=this.loadElementObj),this.elementObj.mediaSource=this.eleType,this.floatButtonList.forEach((t,e,a)=>{null==t||0===t.length?this.elementList[e].materailBtn="":this.elementList[e].materailBtn=JSON.stringify(t)}),null==this.floatMenuList||0===this.floatMenuList.length?this.elementList.forEach((t,e,a)=>{t.floatMenu=""}):this.elementList.forEach((t,e,a)=>{t.floatMenu=JSON.stringify(this.floatMenuList)}),this.paramsDataList.forEach((t,e,a)=>{null==t||0===t.length?this.elementList[e].extraParams="":this.elementList[e].extraParams=JSON.stringify(t)}),this.paramsDynamicDataList.forEach((t,e,a)=>{null==t||0===t.length?this.elementList[e].dynamicParams="":this.elementList[e].dynamicParams=JSON.stringify(t)}),t.list=this.elementList,"txt"===this.fatherActive&&(this.elementObj.material=this.textConent,null==this.floatMenus||0===this.floatMenus.length?this.elementObj.floatMenu="":this.elementObj.floatMenu=JSON.stringify(this.floatMenus),null==this.paramsDynamicData||0===this.paramsDynamicData.length?this.elementObj.dynamicParams="":this.elementObj.dynamicParams=JSON.stringify(this.paramsDynamicData),t.list=[this.elementObj]),s="edit"===x?r["a"].temapi.update:r["a"].temapi.add,Object(l["i"])(s,t).then(t=>{this.loading=!1,this.$router.push({path:"/5g/messagePlatform",query:{queryObj:this.fatherQueryParam,active:this.fatherActive}})}).catch(()=>{this.loading=!1})}})}else this.$message({message:a,type:"warning"})},formatTitleAndSign(t){let e="";return t.startsWith("【")&&t.endsWith("】")&&(e=t),t.startsWith("【")||t.endsWith("】")||(e=`【${t}】`),t.startsWith("【")&&!t.endsWith("】")&&(e=t+"】"),!t.startsWith("【")&&t.endsWith("】")&&(e="【"+t),e},backStep(){this.SmsClass="text",this.addWhat="button",this.step=1},next(){this.msgCard.cardTitle?(this.step=2,this.SmsClass="message",this.addWhat="button"):this.$message.warning("请先输入ID")},resetForm(t){this.$refs[t].resetFields()},back2list(){this.$router.push({path:"/5g/messagePlatform",query:{queryObj:this.fatherQueryParam,active:this.fatherActive}})}}},D=C,k=(a("51a1"),Object(b["a"])(D,i,s,!1,null,null,null));e["default"]=k.exports},2559:function(t,e,a){"use strict";a("2b08")},"2b08":function(t,e,a){},"51a1":function(t,e,a){"use strict";a("b3fa")},"65fc":function(t,e,a){t.exports=a.p+"img/media_add.d1d3f208.png"},"66f9":function(t,e,a){t.exports=a.p+"img/card_add.8418b626.png"},"6e41":function(t,e,a){t.exports=a.p+"img/u9.7354953d.svg"},"73fe":function(t,e,a){t.exports=a.p+"img/iphone_bg.4e87e31d.png"},b3fa:function(t,e,a){},cf74:function(t,e,a){"use strict";const i="/msg5g-svc";e["a"]={temapi:{add:i+"/MsgTemplate/add",approve:i+"/MsgTemplate/approve",check:i+"/MsgTemplate/check",checkBatch:i+"/MsgTemplate/checkBatch",commit:i+"/MsgTemplate/commit",delete:i+"/MsgTemplate/delete",deleteBatch:i+"/MsgTemplate/deleteBatch",eles:i+"/MsgTemplate/eles",detail:i+"/MsgTemplate/detail",list:i+"/MsgTemplate/list",query5GTemplates:i+"/MsgTemplate/query5GTemplates",refresh:i+"/MsgTemplate/refresh",refreshBatch:i+"/MsgTemplate/refreshBatch",test:i+"/MsgTemplate/test",update:i+"/MsgTemplate/update",templateDetail:i+"/MsgTemplate/getTemplateDetail",eleAdd:i+"/MsgElement/add",eleCheck:i+"/MsgElement/check",eleCheckBatch:i+"/MsgElement/checkBatch",eleDelete:i+"/MsgElement/delete",eleDeleteBatch:i+"/MsgElement/deleteBatch",eleList:i+"/MsgElement/list",eleRefresh:i+"/MsgElement/refresh",eleRefreshBatch:i+"/MsgElement/refreshBatch",rename:i+"/MsgElement/rename",upload:i+"/MsgElement/upload",uploadBatch:i+"/MsgElement/uploadBatch",send:i+"/MsgSend/send",MenuCommit:i+"/MsgMenu/commit",MenuDelete:i+"/MsgMenu/delete",get:i+"/MsgMenu/get",query:i+"/MsgMenu/query",queryTemp:i+"/MsgMenu/queryTemp",save:i+"/MsgMenu/save",status:i+"/MsgMenu/getMenuStatus",all:i+"/MsgMenu/getMenuAll",cfgList:i+"/cfg/list",queryFiveKeywords:"/plan-svc/action/jx/msg5g_keywords/getFiveGKeywordsInfo",addFiveKeywords:"/plan-svc/action/jx/msg5g_keywords/updateFiveGKeywordsInfo",delFiveKeywords:"/plan-svc/action/jx/msg5g_keywords/deleteFiveGKeywordsInfo"}}}}]);