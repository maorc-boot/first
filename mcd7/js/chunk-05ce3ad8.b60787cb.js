(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-05ce3ad8"],{"0da2":function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"info-edit"},[t("van-sticky",[t("van-nav-bar",{attrs:{title:"个性化话术编辑","left-text":"返回","left-arrow":"",border:"","safe-area-inset-top":""},on:{"click-left":e.back}})],1),t("van-skeleton",{attrs:{round:"",row:11,loading:e.loading}},[t("main",[e.loading||e.form.scriptId?[t("van-form",{ref:"ruleForm",attrs:{"label-width":"5rem"}},[t("van-field",{attrs:{disabled:"",label:"产品名称"},model:{value:e.form.planName,callback:function(t){e.$set(e.form,"planName",t)},expression:"form.planName"}}),t("van-field",{attrs:{disabled:"",label:"应用渠道"},model:{value:e.form.channelName,callback:function(t){e.$set(e.form,"channelName",t)},expression:"form.channelName"}}),t("van-field",{attrs:{disabled:"",label:"运营位"},model:{value:e.form.adivName,callback:function(t){e.$set(e.form,"adivName",t)},expression:"form.adivName"}}),t("van-field",{attrs:{disabled:"",label:"话术类型"},model:{value:e.form.scriptTypeStr,callback:function(t){e.$set(e.form,"scriptTypeStr",t)},expression:"form.scriptTypeStr"}}),t("van-field",{attrs:{disabled:"",label:"内容类型"},model:{value:e.form.contentTypeStr,callback:function(t){e.$set(e.form,"contentTypeStr",t)},expression:"form.contentTypeStr"}}),t("van-field",{attrs:{rows:"1",autosize:"",type:"textarea",label:"话术名称",rules:e.rules.scriptName},model:{value:e.form.scriptName,callback:function(t){e.$set(e.form,"scriptName",t)},expression:"form.scriptName"}}),t("van-field",{attrs:{readonly:"",clickable:"",name:"cityId",label:"应用地市",placeholder:"请选择地市",rules:e.rules.cityId},nativeOn:{click:function(t){e.showPicker=!0}},model:{value:e.form.cityName,callback:function(t){e.$set(e.form,"cityName",t)},expression:"form.cityName"}}),e._l(e.form.marketingWords,(function(a){var l,s;return[null!==(l=a.list)&&void 0!==l&&l.length||a.uploadType?e._e():t("van-field",{attrs:{rows:"1",autosize:"",type:"textarea",label:a.typeName,rules:e.rules.content},model:{value:a.content,callback:function(t){e.$set(a,"content",t)},expression:"item.content"}}),null!==(s=a.list)&&void 0!==s&&s.length?t("div",{staticClass:"rich"},[t("div",{staticClass:"title"},[e._v(e._s(a.typeName))]),t("div",{staticClass:"r-container"},[t("div",{staticClass:"left"},[t("van-sidebar",{model:{value:e.activeKey,callback:function(t){e.activeKey=t},expression:"activeKey"}},e._l(a.list,(function(e){return t("van-sidebar-item",{key:e.id,attrs:{title:e.name}})})),1)],1),t("div",{staticClass:"right"},e._l(a.list,(function(l,s){return t("div",{key:l.id},[a.isRich?[t("Editor",{directives:[{name:"show",rawName:"v-show",value:e.activeKey===s,expression:"activeKey === index"}],attrs:{placeholder:"请输入"+l.name},model:{value:l.content,callback:function(t){e.$set(l,"content",t)},expression:"subItem.content"}})]:t("div",{staticClass:"text-container"},[t("van-field",{directives:[{name:"show",rawName:"v-show",value:e.activeKey===s,expression:"activeKey === index"}],attrs:{rows:"8",autosize:"",type:"textarea",placeholder:"请输入"+l.name},model:{value:l.content,callback:function(t){e.$set(l,"content",t)},expression:"subItem.content"}})],1)],2)})),0)])]):e._e(),"1"===a.uploadType?[t("van-field",{attrs:{name:"uploadfileUrl",label:"图片"},scopedSlots:e._u([{key:"input",fn:function(){return[t("van-uploader",{attrs:{"max-count":1,"before-read":e.beforeRead,"after-read":e.afterRead},on:{delete:e.deleteFile},model:{value:e.imgList,callback:function(t){e.imgList=t},expression:"imgList"}})]},proxy:!0}],null,!0)}),t("van-field",{attrs:{label:"链接地址",rules:e.rules.linkUrl},model:{value:a.linkUrl,callback:function(t){e.$set(a,"linkUrl",t)},expression:"item.linkUrl"}})]:e._e()]}))],2),t("footer",[t("van-button",{attrs:{round:"",block:"",type:"info","native-type":"submit",loading:e.submitLoading},nativeOn:{click:function(t){return e.submit.apply(null,arguments)}}},[e._v("提交")])],1)]:t("van-empty",{attrs:{image:"network",description:"加载失败"}})],2)]),t("van-popup",{attrs:{round:"",position:"bottom"},model:{value:e.showPicker,callback:function(t){e.showPicker=t},expression:"showPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:e.cityList},on:{cancel:function(t){e.showPicker=!1},confirm:e.confirmCity}})],1)],1)},s=[],n=(a("14d9"),a("5a4a")),r=a("0fea"),i=a("cdbb"),o=a("5af3"),c=a("89ff"),p=a("ceb0"),m={components:{Editor:p["a"]},data(){return{loading:!1,submitLoading:!1,form:{},rules:{scriptName:[{required:!0,message:"请输入话术名称",trigger:"blur"},{max:50,message:"请最多输入50字",trigger:"blur"}],cityId:[{required:!0,message:"请选择应用地市",trigger:"change"}],content:[{required:!0,message:"请输入话术内容",trigger:"blur"}],linkUrl:[{required:!0,message:"请输入链接地址",trigger:"blur"}]},showPicker:!1,cityList:[],activeKey:0,imgList:[]}},watch:{$route(e){"ScriptInfoEdit"===e.name&&(this.imgList=[],this.getScriptInfo())}},methods:{back(){this.$router.go(-1)},async getScriptInfo(){try{this.loading=!0;const e=await Object(r["l"])(i["a"].getScriptPreview+"?scriptId="+this.$route.query.id);this.form=this.assemblyForm(e)}catch(e){this.form={}}finally{this.loading=!1}},assemblyForm(e){const t=Object(n["c"])(e);if("1"===t.scriptType&&(t.scriptType="2",t.scriptTypeStr="个性化"),"8"===t.contentType||"9"===t.contentType){const{uploadFileUrl:e}=t.marketingWords[0];Object(o["d"])(e).then(e=>{this.imgList=[{url:e,isImage:!0}]})}return t},async getCityList(){try{const e=await Object(r["l"])(c["a"].blackList.queryAllCitys);this.cityList=e.map(e=>({text:e.cityName,value:e.cityId}))}catch(e){}},confirmCity(e){this.form.cityId=e.value,this.form.cityName=e.text,this.showPicker=!1},beforeRead(e){return!(e.size>5242880)||(this.$toast("图片大小不能超过 5MB"),!1)},afterRead(e){e.status="uploading",e.message="上传中...",this.uploadFile(e)},deleteFile(e){this.imgList=[],this.$set(this.form.marketingWords[0],"uploadFileUrl",""),this.$set(this.form.marketingWords[0],"uploadFileName","")},async uploadFile(e){try{const t=new FormData;t.append("file",e.file);const{resourceUrl:a,resourceName:l}=await Object(r["k"])(i["a"].uploadScriptMaterial,t,this.uploadProgressEvent);this.$set(this.form.marketingWords[0],"uploadFileUrl",a),this.$set(this.form.marketingWords[0],"uploadFileName",l),e.status="done",e.message=""}catch(t){e.status="failed",e.message="上传失败"}},uploadProgressEvent(e){},delay(e){return new Promise(t=>{setTimeout(()=>{t()},e)})},validateField(){const e=this.form.contentType;if(e<5){const e=this.form.marketingWords.find(e=>{var t;return null===(t=e.list)||void 0===t?void 0:t.length});if(e){const t=e.list.findIndex(e=>!e.content);if(t>-1)return this.$toast("请输入"+e.list[t].name),!1}}else if(("8"===e||"9"===e)&&!this.form.marketingWords[0].uploadFileUrl)return this.$toast("请上传图片"),!1;return!0},async submit(){try{if(await this.$refs.ruleForm.validate(),this.form.contentType<3&&await this.delay(100),!this.validateField())return;this.submitLoading=!0;const e={...Object(n["d"])(this.form),createType:"2",scriptId:"",scriptStatus:"0",score:null,parentId:this.form.parentId||this.form.scriptId},t=await Object(r["l"])(i["a"].saveScript,e);t.length?(this.$toast.success("提交成功"),setTimeout(()=>{this.$router.push({name:"ScriptLibH5"})},500)):this.$toast.error(res.message)}catch(e){}finally{this.submitLoading=!1}}},created(){this.getScriptInfo(),this.getCityList()}},d=m,u=(a("9e6e"),a("2877")),f=Object(u["a"])(d,l,s,!1,null,"2ffeeb6b",null);t["default"]=f.exports},"89ff":function(e,t,a){"use strict";t["a"]={bigSrceenConfig:{queryFrontSecondScreens:"/plan-svc/mcd/front/secondScreen/queryFrontSecondScreens",updateFrontSecondScreens:"/plan-svc/mcd/front/secondScreen/updateFrontSecondScreens"},blackList:{deleBlackList:"/plan-svc/customer/black/list/deleBlackList",downloadImpOrDelBlacklistTemplate:"/plan-svc/customer/black/list/downloadImpOrDelBlacklistTemplate",impOrDelBlacklistFile:"/plan-svc/customer/black/list/impOrDelBlacklistFile",queryBlackList:"/plan-svc/customer/black/list/queryBlackList",queryAllCitys:"/plan-svc/customer/black/list/queryAllCitys",createOrUpdate:"/plan-svc/mcd-hmh5-blacklist-task/createOrUpdate",delete:"/plan-svc/mcd-hmh5-blacklist-task/delete",listTask:"/plan-svc/mcd-hmh5-blacklist-task/listTask",getTaskDetailByTaskId:"/plan-svc/mcd-hmh5-blacklist-task/getTaskDetailByTaskId",submitBlacklist:"/plan-svc/mcd-hmh5-blacklist-task/submitBlacklist",getBlacklistApprover:"/plan-svc/mcd-hmh5-blacklist-task/getBlacklistApprover",approveBlacklistRecord:"/plan-svc/mcd-hmh5-blacklist-task/approveBlacklistRecord"},careRelation:{queryChannelByCityAndCounty:"/plan-svc/mcd/front/guardList/queryChannelByCityAndCounty",exportGuardUserList:"/plan-svc/mcd/front/guardList/exportGuardUserList",queryGuardUserList:"/plan-svc/mcd/front/guardList/queryGuardUserList"},messageTemplate:{approveSmsTemplateRecord:"/plan-svc/sms/template/approveSmsTemplateRecord",delCareSmsTemplate:"/plan-svc/sms/template/delCareSmsTemplate",deleteTemplateLabel:"/plan-svc/sms/template/deleteTemplateLabel",getCareSmsTemplate:"/plan-svc/sms/template/getCareSmsTemplate",getCareSmsTemplateApprover:"/plan-svc/sms/template/getCareSmsTemplateApprover",getCareSmsTemplateDetail:"/plan-svc/sms/template/getCareSmsTemplateDetail",getCustGroupVars:"/plan-svc/sms/template/getCustGroupVars",getLabelListDaiwei:"/plan-svc/sms/template/getLabelListDaiwei",getRelaLabels:"/plan-svc/sms/template/getRelaLabels",saveCareSmsTemplate:"/plan-svc/sms/template/saveCareSmsTemplate",saveOrUpdateRela:"/plan-svc/sms/template/saveOrUpdateRela",subCareSmsTemplateApprove:"/plan-svc/sms/template/subCareSmsTemplateApprove"},labelConfig:{mcdCustomLabelDefGet:"/plan-svc/mcdCustomLabelDef",mcdCustomLabelDefPut:"/plan-svc/mcdCustomLabelDef",commitProcess:"/plan-svc/mcdCustomLabelDef/commitProcess",getNodeApprover:"/plan-svc/mcdCustomLabelDef/getNodeApprover",modifySelfDefinedLabelConf:"/plan-svc/mcdCustomLabelDef/modifySelfDefinedLabelConf",selectSelfDefinedLabelConf:"/plan-svc/mcdCustomLabelDef/selectSelfDefinedLabelConf",selectSelfDefinedLabelConfDetail:"/plan-svc/mcdCustomLabelDef/selectSelfDefinedLabelConfDetail",mcdCustomLabelDef:"/plan-svc/mcdCustomLabelDef"},warningConfig:{mcdAppAlarmInfoGet:"/plan-svc/mcdAppAlarmInfo",mcdAppAlarmInfoPost:"/plan-svc/mcdAppAlarmInfo",mcdAppAlarmInfoPut:"/plan-svc/mcdAppAlarmInfo",mcdAppAlarmInfoDelete:"/plan-svc/mcdAppAlarmInfo",batchImportAutoClearAlarm:"/plan-svc/mcdAppAlarmInfo/batchImportAutoClearAlarm",commitProcess:"/plan-svc/mcdAppAlarmInfo/commitProcess",getNodeApprover:"/plan-svc/mcdAppAlarmInfo/getNodeApprover",queryDataSourceList:"/plan-svc/mcdAppAlarmInfo/queryDataSourceList",queryDataTableList:"/plan-svc/mcdAppAlarmInfo/queryDataTableList",querySourceTable:"/plan-svc/mcdAppAlarmInfo/querySourceTable",selectAlarmDetailById:"/plan-svc/mcdAppAlarmInfo/selectAlarmDetailById",selectAlarmType:"/plan-svc/mcdAppAlarmInfo/selectAlarmType",terminateAlarm:"/plan-svc/mcdAppAlarmInfo/terminateAlarm",queryHasRole:"/plan-svc/mcdAppAlarmInfo/queryHasRole",updateAlarmThreshold:"/plan-svc/mcdAppAlarmInfo/updateAlarmThreshold",queryAllCitys:"/plan-svc/mcdAppAlarmInfo/queryAllCitys"},customerCommunicationUseCondition:{exportCampsegHandleDetail:"/plan-svc/action/jx/onlinelChannel/exportCampsegHandleDetail",exportCampsegHandleSummary:"/plan-svc/action/jx/onlinelChannel/exportCampsegHandleSummary",exportChannelUsageList:"/plan-svc/action/jx/onlinelChannel/exportChannelUsageList",exportCityUsageList:"/plan-svc/action/jx/onlinelChannel/exportCityUsageList",exportCountyUsageList:"/plan-svc/action/jx/onlinelChannel/exportCountyUsageList",exportGridUsageList:"/plan-svc/action/jx/onlinelChannel/exportGridUsageList",exportOppoCampCityHandle:"/plan-svc/action/jx/onlinelChannel/exportOppoCampCityHandle",queryCampsegHandleDetail:"/plan-svc/action/jx/onlinelChannel/queryCampsegHandleDetail",queryCampsegHandleSummary:"/plan-svc/action/jx/onlinelChannel/queryCampsegHandleSummary",queryChannelUsageList:"/plan-svc/action/jx/onlinelChannel/queryChannelUsageList",queryCityUsageList:"/plan-svc/action/jx/onlinelChannel/queryCityUsageList",queryCountyUsageList:"/plan-svc/action/jx/onlinelChannel/queryCountyUsageList",queryGridUsageList:"/plan-svc/action/jx/onlinelChannel/queryGridUsageList",queryOppoCampCityHandle:"/plan-svc/action/jx/onlinelChannel/queryOppoCampCityHandle"},customerContactMaintainCondition:{reportSmsMessage:"/plan-svc/reportSmsMessage",export:"/plan-svc/reportSmsMessage/export"},customerCommunicationWarningCondition:{reportYjCityDetailNew:"/plan-svc/reportYjCityDetailNew",reportYjCityDetailNewExport:"/plan-svc/reportYjCityDetailNew/export",reportYjCountyDetailNew:"/plan-svc/reportYjCountyDetailNew",reportYjCountyDetailNewExport:"/plan-svc/reportYjCountyDetailNew/export",reportYjDetailInfo:"/plan-svc/reportYjDetailInfo",reportYjDetailInfoExport:"/plan-svc/reportYjDetailInfo/export",reportYjGridDetailNew:"/plan-svc/reportYjGridDetailNew",reportYjGridDetailNewExport:"/plan-svc/reportYjGridDetailNew/export",reportYjStaffDetailNew:"/plan-svc/reportYjStaffDetailNew",reportYjStaffDetailNewExport:"/plan-svc/reportYjStaffDetailNew/export"},jobNoQuery:{queryFrontStafferList:"/plan-svc/mcd/front/staffer/queryFrontStafferList"},problemFeedback:{addNewReply:"/plan-svc/mcdFeedbackQa/addNewReply",addNewReplyPicture:"/plan-svc/mcdFeedbackQa/addNewReplyPicture",downloadImage:"/plan-svc/mcdFeedbackQa/downloadImage",getAllRepliesByBusinessId:"/plan-svc/mcdFeedbackQa/getAllRepliesByBusinessId",getRecentlyReplyFeedback:"/plan-svc/mcdFeedbackQa/getRecentlyReplyFeedback",mcdManagerFeedback:"/plan-svc/mcdManagerFeedback"},proxyCustomerLabel:{mcdFrontCareSmsLabelGet:"/plan-svc/mcdFrontCareSmsLabel",mcdFrontCareSmsLabelPost:"/plan-svc/mcdFrontCareSmsLabel",mcdFrontCareSmsLabelPut:"/plan-svc/mcdFrontCareSmsLabel",mcdFrontCareSmsLabelDelete:"/plan-svc/mcdFrontCareSmsLabel"},noticeBoard:{mcdBulletinBoardGet:"/plan-svc/mcdBulletinBoard",mcdBulletinBoardPost:"/plan-svc/mcdBulletinBoard",mcdBulletinBoardPut:"/plan-svc/mcdBulletinBoard",mcdBulletinBoardDelete:"/plan-svc/mcdBulletinBoard",deleteImage:"/plan-svc/mcdBulletinBoard/deleteImage",downloadImage:"/plan-svc/mcdBulletinBoard/downloadImage",modifyBulletinStatus:"/plan-svc/mcdBulletinBoard/modifyBulletinStatus",uploadBulletinPictures:"/plan-svc/mcdBulletinBoard/uploadBulletinPictures"},mainPackageConfig:{queryFrontMainOffers:"/plan-svc/mcd/front/mainOfferInfo/queryFrontMainOffers",deleteMainOfferInfo:"/plan-svc/mcd/front/mainOfferInfo/deleteMainOfferInfo",getMainOfferInfoDetail:"/plan-svc/mcd/front/mainOfferInfo/getMainOfferInfoDetail",saveOrUpdateMainOffer:"/plan-svc/mcd/front/mainOfferInfo/saveOrUpdateMainOffer",updateMainOfferInfoStatus:"/plan-svc/mcd/front/mainOfferInfo/updateMainOfferInfoStatus"},keyMonitoring:{queryFrontKeyMonitors:"/plan-svc/mcd/front/keyMonitor/queryFrontKeyMonitors"}}},"9169d":function(e,t,a){},"9e6e":function(e,t,a){"use strict";a("9169d")}}]);