(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-06ffb932"],{"0173":function(e,t,a){"use strict";a("f624")},"024d":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"clientele-content"},[t("el-tabs",{attrs:{type:"card"},model:{value:e.tabActive,callback:function(t){e.tabActive=t},expression:"tabActive"}},[t("el-tab-pane",{attrs:{label:"策略池",name:"pool",lazy:!0}},[t("PlanningPool")],1),t("el-tab-pane",{attrs:{label:"计算结果",name:"result",lazy:!0}},["result"==e.tabActive?t("PlanningResult"):e._e()],1)],1)],1)},l=[],s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"wrap-pool-content"},[t("div",{staticClass:"top-search-edit"},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{size:"mini",placeholder:"请输入策略名称"},model:{value:e.camgseKeywords,callback:function(t){e.camgseKeywords="string"===typeof t?t.trim():t},expression:"camgseKeywords"}},[t("i",{staticClass:"el-input__icon el-icon-search cursor-pointer",attrs:{slot:"suffix"},on:{click:e.searchTable},slot:"suffix"})])],1),t("div",{staticClass:"query-content"},[t("div",{staticClass:"left"},[t("QueryFormCell",{attrs:{list:e.QueryFormList,defaultSizeForm:e.defaultSizeForm},on:{emptyFrom:e.clearDate,queryForm:e.queryForm}})],1),t("div",{staticClass:"middle"},[t("el-row",[t("el-col",{attrs:{span:24}},[t("section",[t("span",[e._v("客群类型：")]),t("el-select",{attrs:{size:"mini",placeholder:"请选择客群类型"},on:{change:e.searchTable},model:{value:e.searchForm.updateCycle,callback:function(t){e.$set(e.searchForm,"updateCycle",t)},expression:"searchForm.updateCycle"}},e._l(e.custgroupTypeList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)])],1),t("el-row",[t("el-col",{attrs:{span:24}},[t("section",[t("span",[e._v("创建人：")]),t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{size:"mini",placeholder:"请输入创建人"},model:{value:e.createUser,callback:function(t){e.createUser="string"===typeof t?t.trim():t},expression:"createUser"}},[t("i",{staticClass:"el-input__icon el-icon-search cursor-pointer",attrs:{slot:"suffix"},on:{click:e.searchTable},slot:"suffix"})])],1)])],1)],1),t("div",{staticClass:"right"},[t("el-row",[t("el-col",{attrs:{span:24}},[t("section",[t("span",[e._v("策略类型：")]),t("el-select",{attrs:{size:"mini",placeholder:"请选择策略类型"},model:{value:e.searchForm.campTypeId,callback:function(t){e.$set(e.searchForm,"campTypeId",t)},expression:"searchForm.campTypeId"}},[t("el-option",{attrs:{label:"策略类",value:"1"}})],1)],1)])],1),t("el-row",[t("el-col",{attrs:{span:24}},[t("section",[t("span",[e._v("产品类型：")]),t("el-select",{attrs:{size:"mini",placeholder:"请选择产品类型"},model:{value:e.searchForm.planType,callback:function(t){e.$set(e.searchForm,"planType",t)},expression:"searchForm.planType"}},[t("el-option",{attrs:{label:"实物产品",value:"1"}})],1)],1)])],1)],1)]),t("div",{staticStyle:{position:"relative",height:"0",width:"100%"}},[e.total>0&&e.allData.length>0?t("el-button",{staticStyle:{position:"absolute",right:"10px","z-index":"1",transform:"translateY(-115%)"},attrs:{type:"primary",size:"mini",loading:e.searchLoading},on:{click:e.selectAllOrCancel}},[e._v(e._s(e.isSelectAll?"全部取消":"全部选择"))]):e._e()],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableData,stripe:"",height:"100%"}},[t("el-table-column",{attrs:{type:"index",label:"序号",align:"center"}}),t("el-table-column",{attrs:{label:"策略名称","min-width":"150","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.gotoDetail(a.row)}}},[e._v(e._s(a.row.campsegName))])]}}])}),t("el-table-column",{attrs:{label:"产品名称",prop:"planName","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{label:"执行周期",prop:"execPeriod","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{label:"客群类型",prop:"updateCycleName","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{label:"客户数",prop:"customNum","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{label:"创建人",prop:"createUserName","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{label:"操作","header-align":"center",align:"center",width:"60"},scopedSlots:e._u([{key:"default",fn:function(a){return[e.selectTableData.some(e=>e.campsegId==a.row.campsegId)?t("el-button",{staticStyle:{color:"#999"},attrs:{type:"text",size:"mini"},on:{click:function(t){return e.cancelData(a.row)}}},[e._v("取消")]):t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.selectData(a.row)}}},[e._v("选择")])]}}])})],1),t("el-pagination",{attrs:{size:"mini","current-page":e.searchForm.current,"page-sizes":[10,20,30,40],"page-size":e.searchForm.size,"pager-count":5,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),t("footer",[t("div",{staticClass:"footer-content"},[t("div",{staticClass:"footer-left"},[t("span",{staticClass:"icon",on:{click:function(t){e.showSelectTable=!e.showSelectTable}}},[t("i",{staticClass:"el-icon-shopping-cart-full"})]),t("span",{staticClass:"desc",on:{click:function(t){e.showSelectTable=!e.showSelectTable}}},[e._v("已选策略"+e._s(e.selectTableData.length)+"个")])]),t("div",{staticClass:"footer-right"},[t("span",{staticClass:"desc"},[e._v("客户总数："+e._s(e.totalCust))]),t("el-button",{attrs:{type:"primary",round:""},on:{click:e.openDialog}},[e._v("融合计算")])],1)]),t("div",{staticClass:"footer-table",class:{show:e.showSelectTable}},[t("SelectTable",{attrs:{totalData:e.selectTableData},on:{cancelData:e.cancelData,close:()=>e.showSelectTable=!1,cancelAll:e.cancelAll}})],1)]),t("CalcConfigDialog",{attrs:{visible:e.dialogVisible,selectTableData:e.selectTableData},on:{"update:visible":function(t){e.dialogVisible=t},success:e.cancelAll}})],1)},r=[],n=(a("13d5"),a("14d9"),a("0fea")),o=a("5e05"),c=a("d39c"),d=a("72ae"),p=a("4e3f"),u=function(){var e=this,t=e._self._c;return t("div",{staticClass:"select-table-content"},[t("div",{staticClass:"top"},[t("i",{staticClass:"el-icon-close",on:{click:function(t){return e.$emit("close")}}}),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$emit("cancelAll")}}},[e._v("全部取消")])],1),t("el-table",{attrs:{data:e.tableData,stripe:"",height:"100%"}},[t("el-table-column",{attrs:{type:"index",label:"序号"}}),t("el-table-column",{attrs:{label:"策略名称",prop:"campsegName","min-width":"150","header-align":"center",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"执行周期",prop:"execPeriod","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{label:"策略状态","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v("执行中")])]}}])}),t("el-table-column",{attrs:{label:"创建人",prop:"createUserName","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{label:"操作","header-align":"center",align:"center",fixed:"right",width:"80"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.$emit("cancelData",a.row)}}},[e._v("取消")])]}}])})],1),t("el-pagination",{attrs:{size:"mini","current-page":e.pageNum,"page-sizes":[10,20,30,40],"page-size":e.pageSize,"pager-count":5,layout:"total, sizes, prev, pager, next, jumper",total:e.totalData.length},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},m=[],h={name:"SelectTable",props:["totalData"],computed:{tableData(){return this.totalData.slice((this.pageNum-1)*this.pageSize,this.pageNum*this.pageSize)}},data(){return{pageNum:1,pageSize:10}},methods:{handleSizeChange(e){this.pageSize=e,this.pageNum=1},handleCurrentChange(e){this.pageNum=e}}},g=h,v=(a("78f0"),a("2877")),y=Object(v["a"])(g,u,m,!1,null,"214ecbbf",null),b=y.exports,f=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"计算规则配置",visible:e.visible,width:"30%",top:"30vh","append-to-body":"","destroy-on-close":!0,"close-on-click-modal":!1,"show-close":!1},on:{"update:visible":function(t){e.visible=t}}},[t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:"任务名称：",prop:"taskName","label-width":"100px"}},[t("el-input",{attrs:{placeholder:"请输入任务名称",maxlength:20},model:{value:e.form.taskName,callback:function(t){e.$set(e.form,"taskName",t)},expression:"form.taskName"}})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.closeDialog}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.confirm}},[e._v("确 认")])],1)],1)},C=[],D={name:"CalcConfigDialog",props:{visible:{type:Boolean,default:!1},selectTableData:{type:Array,default:()=>[]}},data(){return{loading:!1,form:{taskName:""},rules:{taskName:[{required:!0,message:"请输入任务名称",trigger:"blur"}]}}},methods:{closeDialog(){this.$emit("update:visible",!1)},confirm(){this.$refs.form.validate(async e=>{if(e)try{this.loading=!0;const e={list:this.selectTableData,taskModel:{taskName:this.form.taskName}},t=await Object(n["i"])(d["a"].ecapi.saveStrategicCoordinationTask,e);"SUCCESS"==t.status?(this.$message.success(t.message),this.$emit("success"),this.$emit("update:visible",!1)):this.$message.error(t.message)}catch(t){}finally{this.loading=!1}})}}},T=D,x=(a("bfe6"),Object(v["a"])(T,f,C,!1,null,"1b21f6fd",null)),S=x.exports,k={name:"PlanningPool",components:{QueryFormCell:p["a"],SelectTable:b,CalcConfigDialog:S},data(){return{loading:!1,searchLoading:!1,searchForm:{campsegIdOrName:"",updateCycle:0,createUserName:"",startDate:"",endDate:"",campTypeId:"1",planType:"1",channelId:"802",current:1,size:10},camgseKeywords:"",createUser:"",campsegStat:"",custgroupTypeList:[{label:"全部",value:0},{label:"一次性",value:1},{label:"周期性",value:2}],defaultSizeForm:{dateModel:["",""],radioModel:["","","802"]},QueryFormList:[{dateType:"daterange",isDate:!0,label:"执行周期",values:[]},{label:"策略状态",values:[{label:"执行中",value:""}]},{label:"归属渠道",values:[{label:"10085外呼",value:"802"}]}],tableData:[],total:0,allData:[],showSelectTable:!1,selectTableData:[],dialogVisible:!1}},computed:{totalCust(){const e=this.selectTableData.reduce((e,t)=>{let a=parseInt(t.customNum)||0;return e+a},0);return e.toLocaleString()},isSelectAll(){return this.allData.every(e=>this.selectTableData.some(t=>t.campsegId==e.campsegId))}},methods:{async getCampsegStat(){try{let e=await Object(n["i"])(o["a"].common.getSysEnum,{enumType:"CAMP_DIM_STATUS"});if(!e.length)return;e=e.filter(e=>"20"!=e.enumKey&&"59"!=e.enumKey&&"91"!=e.enumKey);const t=e.map(e=>({label:e.enumValue,value:e.enumKey}));this.$set(this.QueryFormList[1],"values",[...this.QueryFormList[1].values,...t])}catch(e){}},async getChannels(){try{const e=await Object(n["i"])(c["a"].seapi.getOnlineChannels,{onlineStatus:"1"});if(!e.length)return;const t=e.map(e=>({label:e.channelName,value:e.channelId}));this.$set(this.QueryFormList[2],"values",[...this.QueryFormList[2].values,...t])}catch(e){}},clearDate(){this.defaultSizeForm.dateModel=["",""],this.searchForm.startDate="",this.searchForm.endDate="",this.searchTable()},queryForm(e){this.campsegStat=e.form.radioModel[1],this.searchForm.channelId=e.form.radioModel[2],this.searchForm.startDate=e.form.dateModel[0][0],this.searchForm.endDate=e.form.dateModel[0][1],this.searchTable()},gotoDetail(e){const{campsegPId:t,campsegId:a}=e;this.$router.push({path:"/MarketingPlanning/MarketingDetails",query:{campsegRootId:t,campsegId:a,backName:this.$router.currentRoute.name,queryParams:JSON.stringify(this.searchForm)}})},searchTable(){this.searchForm.campsegIdOrName=this.camgseKeywords,this.searchForm.createUserName=this.createUser,this.searchForm.current=1,this.getTableData(!0)},handleSizeChange(e){this.searchForm.current=1,this.searchForm.size=e,this.getTableData()},handleCurrentChange(e){this.searchForm.current=e,this.getTableData()},async getTableData(e=!1){try{this.loading=!0;const{records:e,total:t}=await Object(n["i"])(d["a"].ecapi.queryStrategicCoordination,this.searchForm);this.tableData=e,this.total=t}catch(t){}finally{this.loading=!1}e&&this.searchAllTableData(this.total)},async searchAllTableData(e){if(0!=this.total)if(this.total<=this.searchForm.size)this.allData=this.tableData;else try{const{records:t}=await Object(n["i"])(d["a"].ecapi.queryStrategicCoordination,{...this.searchForm,current:1,size:e});this.allData=t}catch(t){this.allData=[]}},selectData(e){this.selectTableData.push(e)},cancelData(e){this.selectTableData=this.selectTableData.filter(t=>t.campsegId!=e.campsegId)},selectAllOrCancel(){this.isSelectAll?this.selectTableData=[]:(this.selectTableData=[...this.selectTableData,...this.allData],this.selectTableData=this.selectTableData.filter((e,t,a)=>a.findIndex(t=>t.campsegId==e.campsegId)==t))},cancelAll(){this.selectTableData=[]},openDialog(){0!=this.selectTableData.length?this.dialogVisible=!0:this.$message({type:"warning",message:"请先选择策略"})}},created(){this.$route.params.queryParams&&(this.searchForm={...this.searchForm,...JSON.parse(this.$route.params.queryParams)},this.camgseKeywords=this.searchForm.campsegIdOrName,this.createUser=this.searchForm.createUserName),this.getTableData(!0)}},M=k,w=(a("5a91"),Object(v["a"])(M,s,r,!1,null,"2cc806a2",null)),P=w.exports,I=function(){var e=this,t=e._self._c;return t("div",{staticClass:"result-content"},[t("div",{staticClass:"top"},[t("el-button",{attrs:{type:"primary",icon:"el-icon-refresh"},on:{click:e.searchTable}},[e._v("刷新")])],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableData,stripe:"",height:"100%"},on:{"expand-change":e.handleExpandChange}},[t("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("div",{staticStyle:{padding:"0 10px"}},[t("InnerTable",{attrs:{pid:a.taskId,refresh:a.refreshChildren},on:{"selection-change":e.selectChild,approve:e.approveData,export:e.exportData,"destory-child":e.destoryChild}})],1)]}}])}),t("el-table-column",{attrs:{type:"index",label:"序号",width:"45",align:"center"}}),t("el-table-column",{attrs:{prop:"taskName",label:"任务名称",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"customTotalNum",label:"客户总数",align:"center"}}),t("el-table-column",{attrs:{prop:"planTotalNum",label:"产品总数",align:"center"}}),t("el-table-column",{attrs:{prop:"execStatus",label:"状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[a.execStatus<=25?t("span",[e._v(e._s(e.STATUS.get(+a.execStatus||10)||"-"))]):t("span",[e._v("计算完成")])]}}])}),t("el-table-column",{attrs:{prop:"createUserName",label:"创建人",align:"center"}}),t("el-table-column",{attrs:{prop:"calcTime",label:"计算时间",align:"center"}}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"操作",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[a.hasChildTasks?t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.approveData(a,!0)}}},[e._v("批量审批")]):e._e(),25==a.execStatus?t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.recountCampTask(a)}}},[e._v("重新计算")]):e._e(),a.execStatus>25?t("el-button",{staticStyle:{color:"red"},attrs:{type:"text"},on:{click:function(t){return e.deleteData(a)}}},[e._v("删除")]):e._e()]}}])})],1),t("el-pagination",{attrs:{"current-page":e.searchParams.current,"page-sizes":[10,20,30,40],"page-size":e.searchParams.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),t("el-dialog",{attrs:{title:"选择审批人",visible:e.dialogVisible,width:"450px",top:"30vh","append-to-body":"","show-close":!1,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.nextNodesApproverloading,expression:"nextNodesApproverloading"}],staticClass:"approve-content"},[t("el-form",{ref:"nextNodesApproverForm",attrs:{"label-width":"110px"}},e._l(e.nextNodesList,(function(a,i){return t("el-form-item",{key:i,attrs:{label:a.node.nodeName,rules:[{required:!0,message:"请选择审批人",trigger:"change"}]}},[t("el-select",{attrs:{placeholder:"请选择审批人"},model:{value:e.approverUserList[i],callback:function(t){e.$set(e.approverUserList,i,t)},expression:"approverUserList[index]"}},e._l(a.approverUser,(function(e,a){return t("el-option",{key:a,attrs:{label:e.userName,value:e.userId}})})),1)],1)})),1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",loading:e.approveLoading},on:{click:e.sumbitApprove}},[e._v("确 认")])],1)])],1)},A=[],F=(a("88a7"),a("271a"),a("5494"),function(){var e=this,t=e._self._c;return t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableData},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",selectable:e.selectableHandle,width:"42"}}),e._l(e.columnList,(function(e){return t("el-table-column",{key:e.id,attrs:{prop:e.prop,label:e.label,width:e.width||"auto","min-width":e.minWidth||"auto",align:"center","show-overflow-tooltip":""}})})),t("el-table-column",{attrs:{label:"操作",width:"170",align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.exportExcel(a)}}},[e._v("导出样例")]),30==a.execStatus?t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.approve(a)}}},[e._v("审批")]):e._e()]}}])})],2)}),q=[],L={props:{pid:{type:String|Number,default:""},refresh:{type:Number}},watch:{refresh(){this.getTableData()}},data(){return{loading:!1,STATUS:new Map([[10,"待执行"],[20,"计算中"],[25,"计算失败"],[30,"待审批"],[40,"审批中"],[41,"审批驳回"],[54,"审批通过"],[90,"已推送"]]),columnList:[{prop:"taskId",label:"任务子编号"},{prop:"tagName",label:"标签名称"},{prop:"tagId",label:"标签编号"},{prop:"custTypeName",label:"客户类型"},{prop:"customTotalNum",label:"客户数"},{prop:"planTotalNum",label:"产品数"},{prop:"execStatusName",label:"状态"},{prop:"orderBy",label:"优先级"}],tableData:[],multipleSelection:[]}},methods:{async getTableData(){try{this.loading=!0;const e=await Object(n["i"])(d["a"].ecapi.childTaskRecord,{id:this.pid});this.tableData=e.map(e=>({...e,execStatusName:this.STATUS.get(e.execStatus||10)||""}))}catch(e){}finally{this.loading=!1}},handleSelectionChange(e){this.multipleSelection=e,this.$emit("selection-change",this.multipleSelection,this.pid)},selectableHandle(e){return 30==e.execStatus},exportExcel(e){this.$emit("export",e)},approve(e){this.$emit("approve",e)}},created(){this.getTableData()},beforeDestroy(){this.$emit("destory-child",this.pid)}},z=L,N=Object(v["a"])(z,F,q,!1,null,"46eb258e",null),_=N.exports,O={name:"PlanningResult",components:{InnerTable:_},data(){return{loading:!1,nextNodesApproverloading:!1,approveLoading:!1,searchParams:{current:1,size:10},tableData:[],total:0,STATUS:new Map([[10,"待执行"],[20,"计算中"],[25,"计算失败"],[30,"待审批"],[40,"审批中"],[41,"审批驳回"],[54,"审批通过"],[90,"已推送"]]),selectChildren:{},dialogVisible:!1,nextNodesList:[],approverUserList:[],approveParams:{approvalType:"TASK",berv:0,nodeId:"",businessId:"",childBusinessId:"",nextNodesApprover:[]},expandedRows:[]}},methods:{handleSizeChange(e){this.searchParams.size=e,this.searchParams.current=1,this.getTableData()},handleCurrentChange(e){this.searchParams.current=e,this.getTableData()},searchTable(){this.searchParams.current=1,this.getTableData()},async getTableData(){try{this.loading=!0;const{records:e,total:t}=await Object(n["i"])(d["a"].ecapi.queryCampCoordinationTask,this.searchParams);this.tableData=e.map(e=>(e.exportloading=!1,e.refreshChildren=0,e)),this.total=t}catch(e){}finally{this.loading=!1}},async exportData(e){if(e.execStatus<25)return this.$alert("正在计算结果中，请稍后！","提示",{confirmButtonText:"确定"});if(25==e.execStatus)return this.$alert("计算结果失败，请重新计算！","提示",{confirmButtonText:"确定",callback:t=>{"confirm"==t&&this.recountCampTask(e)}});try{this.$set(e,"exportloading",!0);const{data:t}=await Object(n["b"])(d["a"].ecapi.exportExampleFile,e),a=new Blob([t],{type:t.type}),i=e.taskName+"_"+e.taskId+"样例.xlsx";if("download"in document.createElement("a")){const e=document.createElement("a");e.download=i,e.style.display="none",e.href=URL.createObjectURL(a),document.body.appendChild(e),e.click(),URL.revokeObjectURL(e.href),document.body.removeChild(e)}else navigator.msSaveBlob(a,i)}catch(t){}finally{this.$set(e,"exportloading",!1)}},async recountCampTask(e){try{await Object(n["i"])(d["a"].ecapi.recountCampTask,{taskId:e.taskId});this.getTableData()}catch(t){}},handleExpandChange(e,t){this.expandedRows=t},async approveData(e,t=!1){let a="",i="";if(t){a=e.taskId;const t=(this.selectChildren[e.taskId]||[]).filter(t=>t.taskPId==e.taskId);if(0==t.length)return this.$message.warning("请选择子任务！");i=t.map(e=>e.taskId).join(",")}else a=e.taskPId,i=e.taskId;try{this.nextNodesApproverloading=!0,this.dialogVisible=!0,this.approverUserList=[];const e=await Object(n["i"])(d["a"].ecapi.getApproveConfig+"TASK"),t={approvalType:"TASK",businessId:a,processId:e.processId,berv:e.berv,nodeId:"",instanceId:null,triggerParm:{}},l=await Object(n["i"])(d["a"].ecapi.getNodeApprover,t);this.nextNodesList=l.nextNodesApprover,this.approveParams.berv=e.berv,this.approveParams.nodeId=l.nodeId,this.approveParams.businessId=a,this.approveParams.childBusinessId=i,this.approveParams.processId=e.processId}catch(l){}finally{this.nextNodesApproverloading=!1}},async sumbitApprove(){if(this.approverUserList.length!==this.nextNodesList.length)return this.$message.error("请选择审批人后再提交");const e=[];this.nextNodesList.forEach((t,a)=>{let i=this.approverUserList[a];const l=[];t.approverUser.map(e=>{e.userId===i&&l.push(e)}),e.push({approverUser:l,node:t.node})}),this.approveParams.nextNodesApprover=e;try{this.approveLoading=!0;await Object(n["i"])(d["a"].ecapi.subTaskApprove,this.approveParams);this.dialogVisible=!1,this.getTableData()}catch(t){}finally{this.approveLoading=!1}},selectChild(e,t){this.selectChildren[t]=e},destoryChild(e){this.selectChildren[e]=[]},pushData(e){return e.execStatus<40?this.$alert("推送需审批通过！","提示",{confirmButtonText:"确定",callback:e=>{}}):e.execStatus<54?this.$alert("任务需审批通过才允许推送！","提示",{confirmButtonText:"确定",callback:e=>{}}):void(54==e.execStatus&&this.$confirm("是否确认将文件推送至触点？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const t=await Object(n["i"])(d["a"].ecapi.pushCampCoordinationFile,e);"SUCCESS"==t.status?(this.$message({type:"success",message:t.message}),this.getTableData()):this.$message({type:"error",message:t.message})}catch(t){}}).catch(()=>{}))},deleteData(e){this.$confirm("即将删除该任务，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{let t=e.taskId;const a=await Object(n["i"])(d["a"].ecapi.childTaskRecord,{id:t});let i=!0,l="";if(a.length&&(i=!1,(a.every(e=>e.execStatus<40)||a.every(e=>90==e.execStatus)||a.every(e=>41==e.execStatus))&&(i=!0),l=a.map(e=>e.taskId).join(","),t=t+","+l),!i)return this.$message.error("子任务未完成推送或正在审批中，不允许删除！");const s=await Object(n["i"])(d["a"].ecapi.delCampCoordinationTaskList,{taskId:t});"SUCCESS"==s.status?(this.$message({type:"success",message:s.message}),this.getTableData()):this.$message({type:"error",message:s.message})}catch(t){}}).catch(()=>{})}},created(){this.searchTable()}},U=O,j=(a("1025"),Object(v["a"])(U,I,A,!1,null,"2c1f22bb",null)),$=j.exports,B={components:{PlanningPool:P,PlanningResult:$},data(){return{tabActive:"pool"}}},E=B,R=(a("0173"),Object(v["a"])(E,i,l,!1,null,"52c1fa72",null));t["default"]=R.exports},1025:function(e,t,a){"use strict";a("7e81")},"13d5":function(e,t,a){"use strict";var i=a("23e7"),l=a("d58f").left,s=a("a640"),r=a("2d00"),n=a("605d"),o=!n&&r>79&&r<83,c=o||!s("reduce");i({target:"Array",proto:!0,forced:c},{reduce:function(e){var t=arguments.length;return l(this,e,t,t>1?arguments[1]:void 0)}})},"1da4":function(e,t,a){},"271a":function(e,t,a){"use strict";var i=a("cb2d"),l=a("e330"),s=a("577e"),r=a("d6d6"),n=URLSearchParams,o=n.prototype,c=l(o.getAll),d=l(o.has),p=new n("a=1");!p.has("a",2)&&p.has("a",void 0)||i(o,"has",(function(e){var t=arguments.length,a=t<2?void 0:arguments[1];if(t&&void 0===a)return d(this,e);var i=c(this,e);r(t,1);var l=s(a),n=0;while(n<i.length)if(i[n++]===l)return!0;return!1}),{enumerable:!0,unsafe:!0})},"4e3f":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"query-form-cell-wrap"},[t("el-form",{ref:"form",attrs:{model:e.sizeForm,"label-width":e.labelWidth,"label-position":e.labelPosition,size:"mini"}},e._l(e.list,(function(a,i){return t("el-form-item",{key:i+"list",class:{disabled:a.disabled},attrs:{"label-width":a.labelWidth||e.labelWidth,label:a.label+"："}},[Array.isArray(a.values)?t("div",{staticClass:"fe-d-flex"},[t("div",{staticClass:"radio-box"},[a.dateType?e._e():t("el-radio-group",{attrs:{size:"mini",disabled:a.disabled},on:{change:function(t){return e.radioChange(e.sizeForm.radioModel[i],i)}},model:{value:e.sizeForm.radioModel[i],callback:function(t){e.$set(e.sizeForm.radioModel,i,t)},expression:"sizeForm.radioModel[index]"}},e._l(a.values,(function(a,i){return t("el-radio-button",{key:i+"listValues",attrs:{label:a.value}},[e._v(e._s(a.label)+" ")])})),1)],1),t("div",{staticClass:"date-box"},["date"===a.dateType?t("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd",clearable:!1},on:{change:e.dateChange},model:{value:e.sizeForm.dateModel[i],callback:function(t){e.$set(e.sizeForm.dateModel,i,t)},expression:"sizeForm.dateModel[index]"}}):e._e(),"month"===a.dateType?t("el-date-picker",{attrs:{type:"month",placeholder:"选择月","value-format":"yyyy-MM",clearable:!1},on:{change:e.dateChange},model:{value:e.sizeForm.dateModel[i],callback:function(t){e.$set(e.sizeForm.dateModel,i,t)},expression:"sizeForm.dateModel[index]"}}):e._e(),"daterange"===a.dateType?t("el-date-picker",{attrs:{type:"daterange","value-format":"yyyy-MM-dd","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",clearable:!0},on:{change:e.dateChange},model:{value:e.sizeForm.dateModel[i],callback:function(t){e.$set(e.sizeForm.dateModel,i,t)},expression:"sizeForm.dateModel[index]"}}):e._e(),"datetimerange"===a.dateType?t("el-date-picker",{attrs:{type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",clearable:!1},on:{change:e.dateChange},model:{value:e.sizeForm.dateModel[i],callback:function(t){e.$set(e.sizeForm.dateModel,i,t)},expression:"sizeForm.dateModel[index]"}}):e._e()],1)]):t("div",{staticClass:"input-box"},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{placeholder:"请输入内容"},on:{change:e.inputChange},model:{value:e.sizeForm.radioModel[i],callback:function(t){e.$set(e.sizeForm.radioModel,i,t)},expression:"sizeForm.radioModel[index]"}})],1)])})),1)],1)},l=[],s={name:"QueryFormCell",props:{labelWidth:{type:String,default:()=>"82px"},labelPosition:{type:String,default:()=>"right"},defaultSizeForm:{type:Object,default:()=>({})},list:{type:Array,default:()=>[{label:"数据时间",values:[{label:"不限",value:"1"}],isDate:!0,dateType:"date"},{label:"接口类型",values:[{label:"不限",value:"不限"},{label:"文件接口",value:"文件接口"}],isDate:!1}]}},data(){return{sizeForm:{dateModel:["2021-05-08","",""],radioModel:["自定义","不限","不限","不限"]}}},watch:{defaultSizeForm:{handler:function(e){this.sizeForm=e},deep:!0,immediate:!0}},methods:{radioChange(e,t){this.sizeForm.dateModel&&this.$set(this.sizeForm.dateModel,t,"date"===this.list[t].dateType?"":["",""]),this.$emit("queryForm",{index:t,value:e,form:this.sizeForm})},dateChange(e){e?(this.$set(this.sizeForm.dateModel,0,e),this.$emit("queryForm",{value:e,form:this.sizeForm})):this.$emit("emptyFrom",this.sizeForm)},inputChange(e){e&&this.$emit("queryForm",{value:e,form:this.sizeForm})}}},r=s,n=(a("a28d"),a("2877")),o=Object(n["a"])(r,i,l,!1,null,null,null);t["a"]=o.exports},"522c":function(e,t,a){},5494:function(e,t,a){"use strict";var i=a("83ab"),l=a("e330"),s=a("edd0"),r=URLSearchParams.prototype,n=l(r.forEach);i&&!("size"in r)&&s(r,"size",{get:function(){var e=0;return n(this,(function(){e++})),e},configurable:!0,enumerable:!0})},"5a91":function(e,t,a){"use strict";a("1da4")},"605d":function(e,t,a){"use strict";var i=a("da84"),l=a("c6b6");e.exports="process"===l(i.process)},"72ae":function(e,t,a){"use strict";const i="/mcd-cep-web/action",l="/evt-svc/api";t["a"]={ecapi:{queryEventClass:i+"/cep/rule/nx/queryEventClass.do",queryEventDictByDictCode:i+"/cep/rule/nx/queryEventDictByDictCode.do",queryParentDictByDictCode:i+"/cep/rule/nx/queryParentDictByDictCode.do",queryConfigDict:i+"/cep/rule/nx/queryConfigDict.do",queryEventClassLevel:i+"/cep/rule/queryEventClass.do",queryCepRuleNum:i+"/cep/rule/queryCepRuleNum.do",createRule:i+"/cep/rule/nx/createRule.do",manageList:l+"/event/list",manageUpdateStatus:l+"/event/updateStatus",manageDelete:l+"/event",manageListByParent:l+"/businessCategory/listByParent",manageListByLevel:l+"/businessCategory/listByLevel",manageCategoryList:l+"/businessCategory/list",manageGetDetail:l+"/event",eventSave:l+"/event/save",eventListByLevel:l+"/category/listByLevel",eventListByParent:l+"/category/listByParent",areaList:l+"/area/list",areaGetDetail:l+"/area",areaDelete:l+"/area",areaSave:l+"/area/save",areaStationList:l+"/area/stationList",stationList:l+"/station/list",listByCategory:l+"/categoryValue/listByCategory",queryEventsByUserId:"/plan-svc/api/action/cep/event/eventManager/queryEventsByUserId",queryShareById:"/plan-svc/cepRuleShare/queryShareById",saveOrUpdate:"/plan-svc/cepRuleShare/saveOrUpdate",delCampCoordinationTaskList:"/plan-svc/mcd/strategic/coordination/delCampCoordinationTaskList",exportExampleFile:"/plan-svc/mcd/strategic/coordination/exportExampleFile",pushCampCoordinationFile:"/plan-svc/mcd/strategic/coordination/pushCampCoordinationFile",queryCampCoordinationTask:"/plan-svc/mcd/strategic/coordination/queryCampCoordinationTask",queryStrategicCoordination:"/plan-svc/mcd/strategic/coordination/queryStrategicCoordination",saveStrategicCoordinationTask:"/plan-svc/mcd/strategic/coordination/saveStrategicCoordinationTask",selectAllStrategicCoordination:"/plan-svc/mcd/strategic/coordination/selectAllStrategicCoordination",recountCampTask:"/plan-svc/mcd/strategic/coordination/recountCampTask",queryCampCoordinationTaskDetail:"/plan-svc/mcd/strategic/coordination/queryCampCoordinationTaskDetail",childTaskRecord:"/plan-svc/mcd/strategic/coordination/childTaskRecord",approveTaskRecord:"/plan-svc/api/campCoordinate/taskApprove/approveTaskRecord",approveChildTaskRecord:"/plan-svc/api/campCoordinate/taskApprove/approveChildTaskRecord",subTaskApprove:"/plan-svc/api/campCoordinate/taskApprove/subTaskApprove",updateTaskStatus:"/plan-svc/api/campCoordinate/taskApprove/updateTaskStatus",queryAppTypeList:"/approve-svc/jx/cmpApprovalProcessConf/queryAppTypeList",getApproveConfig:"/approve-svc/jx/cmpApprovalProcessConf/getApproveConfig?systemId=",getNodeApprover:"/approve-svc/jx/cmpApproveProcessInstance/getNodeApprover",submitProcess:"/approve-svc/jx/cmpApproveProcessInstance/submitProcess",delPlanConfList:"/plan-svc/mcd/strategic/coordination/delPlanConfList",qryNotCfgPlanTypeAndPri:"/plan-svc/mcd/strategic/coordination/qryNotCfgPlanTypeAndPri",qryPlanConfList:"/plan-svc/mcd/strategic/coordination/qryPlanConfList",qryPlanConfListByPlanTypeOnSave:"/plan-svc/mcd/strategic/coordination/qryPlanConfListByPlanTypeOnSave",qryPlanConfListByPlanTypeOnUpdate:"/plan-svc/mcd/strategic/coordination/qryPlanConfListByPlanTypeOnUpdate",qryPlanTypeList:"/plan-svc/mcd/strategic/coordination/qryPlanTypeList",savePlanConf:"/plan-svc/mcd/strategic/coordination/savePlanConf",updatePriority:"/plan-svc/mcd/strategic/coordination/updatePriority",getSysDics:"/plan-svc/action/iop/common/getSysDics",delTagConfig:"/plan-svc/orchestrate/tag/delTagConfig",queryAccessLabel:"/plan-svc/orchestrate/tag/queryAccessLabel",queryTag:"/plan-svc/orchestrate/tag/queryTag",queryTagType:"/plan-svc/orchestrate/tag/queryTagType",saveTag:"/plan-svc/orchestrate/tag/saveTag",updateTagOrderBy:"/plan-svc/orchestrate/tag/updateTagOrderBy",queryAllTag:"/plan-svc/orchestrate/tag/queryAllTag"}}},"75b8":function(e,t,a){},"78f0":function(e,t,a){"use strict";a("522c")},"7e81":function(e,t,a){},"88a7":function(e,t,a){"use strict";var i=a("cb2d"),l=a("e330"),s=a("577e"),r=a("d6d6"),n=URLSearchParams,o=n.prototype,c=l(o.append),d=l(o["delete"]),p=l(o.forEach),u=l([].push),m=new n("a=1&a=2&b=3");m["delete"]("a",1),m["delete"]("b",void 0),m+""!=="a=2"&&i(o,"delete",(function(e){var t=arguments.length,a=t<2?void 0:arguments[1];if(t&&void 0===a)return d(this,e);var i=[];p(this,(function(e,t){u(i,{key:t,value:e})})),r(t,1);var l,n=s(e),o=s(a),m=0,h=0,g=!1,v=i.length;while(m<v)l=i[m++],g||l.key===n?(g=!0,d(this,l.key)):h++;while(h<v)l=i[h++],l.key===n&&l.value===o||c(this,l.key,l.value)}),{enumerable:!0,unsafe:!0})},a28d:function(e,t,a){"use strict";a("cddb")},a640:function(e,t,a){"use strict";var i=a("d039");e.exports=function(e,t){var a=[][e];return!!a&&i((function(){a.call(null,t||function(){return 1},1)}))}},bfe6:function(e,t,a){"use strict";a("75b8")},cddb:function(e,t,a){},d39c:function(e,t,a){"use strict";const i="/element-svc/api",l="/preview-svc",s="/mcd-web/action";t["a"]={seapi:{querylistEnumValue:"/element-svc/mcd-plan-label/queryLabelByKey",loadImage:i+"/mcdDimMaterial/loadImage",queryTableList:"/element-svc/api/jx/mcdPlanDef/queryPlanDefPageList",saveStatus:i+"/mcdPlanDef/updatePlanDefStatus",queryDetail:"/element-svc/api/jx/mcdPlanDef/getPlanDetailById",mcdChannelList:i+"/mcdDimMaterial/queryChannel",mcdContList:i+"/mcdDimMaterial/queryContact",mcdPositList:i+"/mcdDimMaterial/queryPosition",getChannels:i+"/mcdDimChannel/pagelistDimChannel",queryContactByChannelId:i+"/iop/operatingPositionManager/queryContactByChannelId.do",queryPosition:i+"/iop/template/queryPosition",getOnlineChannels:i+"/mcdDimChannel/listDimChannel  ",getOnlineChannelsByUser:i+"/mcdDimChannel/jx/listDimChannel",getSysDics:"/plan-svc/action/iop/common/getSysDics",queryDigitalProductContents:i+"/iopDigitalProduct/queryDigitalProductPageList",queryConentDetailById:i+"/iopDigitalProduct/getDigitalProduct",updateDigitalProuctStatus:i+"/iopDigitalProduct/updateDigitalProductStatus",queryMaterialInfo:i+"/mcdDimMaterial/queryMaterialPageList",deleteMaterById:i+"/mcdDimMaterial/deleteMaterial",queryMaterialById:i+"/mcdDimMaterial/getMaterial",saveOrUpdateMaterial:i+"/mcdDimMaterial/saveOrUpdateMaterial",uploadMaterImg:i+"/mcdDimMaterial/uploadMaterialPicture",uploadMaterVideo:i+"/mcdDimMaterial/uploadMaterialVideo",uploadMaterFile:i+"/mcdDimMaterial/uploadMaterialsFile",queryIopContactList:i+"/jx/mcdDimContact/pagelistMcdDimContact",queryContactDetailById:i+"/jx/mcdDimContact/getDimContactDetail",listAllChannelName:i+"/mcdDimChannel/listAllChannelNameAndId",deleteContactById:i+"/mcdDimContact/removeContact",saveOrUpdateContact:i+"/jx/mcdDimContact/saveOrUpdateContact",validateContactName:i+"/mcdDimContact/getValidateContactName",displayChannelList:"/element-svc/api/mcdDimChannel/jx/pagelistDimChannel",validateChannelName:i+"/mcdDimChannel/getValidateChannelName",saveOrUpdateChannel:"/element-svc/api/mcdDimChannel/jx/saveOrUpdateDimChannel",deleteChannelById:i+"/mcdDimChannel/removeDimChannel",channelDetail:i+"/mcdDimChannel/getDimChannel",customerLike:"/preview-svc/jx/chnPre/queryPreData",channelDetail:"/element-svc/mcd-dim-channel-desc/query",uploaChanPromptFile:"/element-svc/api/mcdDimChannel/jx/uploaChanPromptFile",downloadChanPromptFile:"/plan-svc/mcd/chan/prompt/downloadChanPromptFile",queryDimChannelInfo:"/element-svc/api/mcdDimChannel/jx/queryDimChannelInfo",queryChannelEValData:"/groupmarket/enterprise/queryChannelEValData",queryIopOperatingPosition:i+"/mcdDimAdivInfo/pagelistAdivInfo",deleteOperatingPositionById:i+"/mcdDimAdivInfo/removeAdivInfo",queryOperPositionDetail:i+"/mcdDimAdivInfo/getAdivInfo",queryOpelistData:i+"/mcdDimAdivInfo/listChannelInfoAndContactInfo",queryCampsegInfoWithThisPosId:i+"/mcdDimAdivInfo/listpageCampsegInfoWithThisAdivId",getConfigList:i+"/mcdDimAttrConf/queryConfigList",validateOperationName:i+"/mcdDimAdivInfo/getValidateAdivInfoName",getValidateAdivInfoId:i+"/jx/mcdDimAdivInfo/getValidateAdivInfoId",saveOrUpdateOperPosition:i+"/mcdDimAdivInfo/saveOrUpdateAdivInfo",getChannelScheduleList:s+"/channelview/getChannelScheduleList",querySensitiveCust:l+"/mcd-channel-sensitive-cust-conf/querySensitiveCust",saveSensitiveCust:l+"/mcd-channel-sensitive-cust-conf/saveSensitiveCust",deleteSensitiveCust:l+"/mcd-channel-sensitive-cust-conf/deleteSensitiveCust",batchDeleteSensitiveCust:l+"/mcd-channel-sensitive-cust-conf/batchDeleteSensitiveCust",pagelistApproveMaterial:i+"/mcdDimMaterialApprove/pagelistApproveMaterial",approveRecord:i+"/mcdDimMaterialApprove/approveRecord",pagelistMyMaterial:i+"/mcdDimMaterialTemplate/pagelistMyMaterial",pagelistExcellentMaterial:i+"/mcdDimMaterialTemplate/pagelistExcellentMaterial",pagelistHotSpotMaterial:i+"/mcdDimMaterialTemplate/pagelistHotSpotMaterial",updateMaterialStatus:i+"/mcdDimMaterial/updateMaterialStatus",getMaterialApprover:i+"/mcdDimMaterialApprove/getMaterialApprover",getCmpApprovalProcess:i+"/mcdDimMaterialApprove/getCmpApprovalProcess",subMaterialApprove:i+"/mcdDimMaterialApprove/subMaterialApprove",addExcellentMaterialLibrary:i+"/mcdDimMaterialTemplate/addExcellentMaterialLibrary",removeExcellentMaterialLibrary:i+"/mcdDimMaterialTemplate/removeExcellentMaterialLibrary",createExcellentMaterial:i+"/mcdDimMaterialTemplate/createExcellentMaterial",createHotSpotMaterial:i+"/mcdDimMaterialTemplate/createHotSpotMaterial",removeMyMaterial:i+"/mcdDimMaterialTemplate/removeMyMaterial",getIntell:i+"/mcdDimMaterial/getIntelligentMatchingMaterialList"}}},d58f:function(e,t,a){"use strict";var i=a("59ed"),l=a("7b0b"),s=a("44ad"),r=a("07fa"),n=TypeError,o=function(e){return function(t,a,o,c){var d=l(t),p=s(d),u=r(d);i(a);var m=e?u-1:0,h=e?-1:1;if(o<2)while(1){if(m in p){c=p[m],m+=h;break}if(m+=h,e?m<0:u<=m)throw new n("Reduce of empty array with no initial value")}for(;e?m>=0:u>m;m+=h)m in p&&(c=a(c,p[m],m,d));return c}};e.exports={left:o(!1),right:o(!0)}},d6d6:function(e,t,a){"use strict";var i=TypeError;e.exports=function(e,t){if(e<t)throw new i("Not enough arguments");return e}},edd0:function(e,t,a){"use strict";var i=a("13d2"),l=a("9bf2");e.exports=function(e,t,a){return a.get&&i(a.get,t,{getter:!0}),a.set&&i(a.set,t,{setter:!0}),l.f(e,t,a)}},f624:function(e,t,a){}}]);