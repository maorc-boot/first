(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0e6d5c0e"],{"7f0a":function(e,t,n){},8234:function(e,t,n){"use strict";n("7f0a")},"82be":function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return u})),n.d(t,"e",(function(){return d})),n.d(t,"f",(function(){return m})),n.d(t,"d",(function(){return p}));n("d9e2"),n("14d9");var a=n("c1df"),i=n.n(a);const s=[{label:"=",value:"="},{label:">",value:">"},{label:"<",value:"<"},{label:">=",value:">="},{label:"<=",value:"<="},{label:"( ) 介于，左右不包括",value:"()"},{label:"( ] 介于，左不包括右包括",value:"(]"},{label:"[ ) 介于，左包括右不包括",value:"[)"},{label:"[ ] 介于，左右都包括",value:"[]"}],o=[{label:"等于",value:"="},{label:"不等于",value:"!="}],l={up:"提升",down:"降低",any:"任何变化",exact:"变成","=":"等于:","!=":"不等于:",">":"大于:","<":"小于:",">=":"大于等于:","<=":"小于等于:","[]":"介于:","()":"介于:","(]":"介于:","[)":"介于:",IN:"包含:",LK:"LIKE:"},r=sessionStorage.getItem("userId"),c=sessionStorage.getItem("userNameCn");function u(e){const t=["=","!=",">","<",">=","<="],n=["[]","()","(]","[)"],a=function(e){return"number"===typeof e?e:e||""},i=function(e){return e.condition=e.condition||e.conditions,"e="===e.condition?"非规范值":t.indexOf(e.condition)>=0?l[e.condition]+a(e["stringVal"])+(a(e["remark"])||a(e["startValue"])?a(e["startValue"])+""+a(e["remark"]):""):n.indexOf(e.condition)>=0?e["remark"]?l[e.condition]+`${e["startValue"]}-${e["endValue"]}`+e["remark"]:l[e.condition]+e["startValue"]+"至"+e["endValue"]:l[e.condition]+a(e["stringVal"])+(a(e["remark"])?a(e["remark"]):"")};return i(e)}function d(e,t){var n;return{sign:"",requestNo:"",version:"",pageIndex:0,pageSize:0,customerVo:{treeDetails:[{id:1,parentId:0,type:"root",calType:"=",columnName:null,columnNum:+(null===(n=t.customerInfo)||void 0===n?void 0:n.columnNum)||0,selectedValues:["Y"],updateCycle:null},...e.map((e,t)=>{var n;return{id:t+2,parentId:t+1,type:"normal",isFission:0,calType:e.calType,columnName:e.columnName,columnNum:e.columnNum,selectedValues:e.selectedValues,numVal1:null!==(n=e.numVal1)&&void 0!==n?n:e.value,numVal2:e.numVal2,updateCycle:null}})]}}}function m(e,t){var n;return[{id:1,parentId:0,type:"root",calType:"=",columnName:null,columnNum:+(null===(n=t.customerInfo)||void 0===n?void 0:n.columnNum)||0,selectedValues:["Y"],updateCycle:null},...e.map((e,t)=>{var n;return{id:t+2,parentId:t+1,type:"normal",isFission:0,calType:e.calType,columnName:e.columnName,columnNum:e.columnNum,selectedValues:e.selectedValues,numVal1:null!==(n=e.numVal1)&&void 0!==n?n:e.value,numVal2:e.numVal2,updateCycle:null}})]}function p(e){const{crossJoin:t=!1,taskType:n,productList:a,channelId:s,ruleList:o,scoreRange:l,isManualPerfection:u=1,peopleCnt:d=null}=e;let m=[];if(!d&&!l||!d&&2!==l.length)throw this.$message.error("请正确填写客群规模或得分区间！"),new Error("参数异常");if(t||1===n){if(o.length)for(let i=0;i<a.length;i++)for(let e=0;e<o.length;e++)m.push({ruleList:[o[e]],planId:a[i].planId,priority:0,custgroupList:[]})}else m=a.map(e=>{const t={ruleList:o,planId:e.planId,priority:0,custgroupList:[]};return 0===o.length&&delete t.ruleList,t});const p=o.length?{prodCustGroupList:m}:{};return{isManualPerfection:u,resByAIReqVO:{taskType:0,channelId:s,coordinationSwitch:0,executeType:0,hotSwitch:0,marketGoal:"1,3",recommendGoal:0,recommendProdNum:-1,taskEffectTime:i()().format("yyyy-MM-DD"),taskFailTime:"2099-12-31",taskId:"",taskName:"task_"+Date.now()+parseInt(1e3*Math.random()),execFlag:"0",createUserId:r,createUserName:c,downshiftFilter:"1",...p,prodPriorityList:a.map(e=>({peopleCnt:d,planId:e.planId,priority:0,planDescribe:e.planDesc,limitScore:d?null:l[0],maxScore:d?null:l[1],recommendMode:1,presetCustName:""}))}}}},afd9:function(e,t,n){"use strict";t["a"]={search0:"/plan-svc/api/intellpushprism/column/search0",valuePage:"/plan-svc/api/intellpushprism/column/valuePage",getTargetUserCount:"/plan-svc/api/intellpushprism/column/getTargetUserCount",batchImportProduct:"/plan-svc/api/intellpushprism/batchImportProduct",batchImpPlanTmpDownload:"/plan-svc/api/intellpushprism/batchImpPlanTmpDownload",saveScene:"/plan-svc/api/intellpushprism/saveScene",batchImportCust:"/plan-svc/api/intellpushprism/batchImportCust",batchImpCustTmpDownload:"/plan-svc/api/intellpushprism/batchImpCustTmpDownload",batchImportLabel:"/plan-svc/api/intellpushprism/batchImportLabel",batchImpLabelTmpDownload:"/plan-svc/api/intellpushprism/batchImpLabelTmpDownload",queryScoreRangeBatch:"/plan-svc/api/intellpushprism/ai/queryScoreRangeBatch",downloadChanPromptFile:"/plan-svc/mcd/chan/prompt/downloadChanPromptFile",getInferenceResByAI:"/plan-svc/api/intellpushprism/ai/getInferenceResByAI",queryScoreRange:"/plan-svc/api/intellpushprism/ai/queryScoreRange",queryAICustLoseWeightRes:"/plan-svc/api/intellpushprism/ai/queryAICustLoseWeightRes",OperationWorkshop:{queryMyAttentionPlan:"/plan-svc/api/intellpushprism/ai/queryMyAttentionPlan",addMyAttentionPlan:"/plan-svc/api/intellpushprism/ai/addMyAttentionPlan",getCampEvalTop5ByPlan:"/plan-svc/api/intellpushprism/ai/getCampEvalTop5ByPlan",getAITagTop10ByPlan:"/plan-svc/api/intellpushprism/ai/getAITagTop10ByPlan",removeMyAttentionPlan:"/plan-svc/api/intellpushprism/ai/removeMyAttentionPlan"}}},dfb2:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"aihelp-layout"},[t("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"AI客群瘦身",name:"aihelp"}},[t("SubSection",{attrs:{title:"已选客群标签："}},[t("div",{staticClass:"customer-num"},[t("span",[e._v(e._s(e.form.customerNum)+"人")]),e.calcLoading?t("span",{staticClass:"tip"},[t("i",{staticClass:"el-icon-loading"}),e._v("计算中")]):e._e(),e.calcError?t("span",{staticStyle:{color:"red"}},[e._v(e._s(e.calcError))]):e._e()]),t("div",{staticClass:"label-content"},[e._l(e.form.selectedConditionList,(function(n,a){return t("div",{key:n.id,staticClass:"col",class:{del:e.form.addConditionList.some(e=>e.id==n.id)}},[t("p",[e._v(e._s(a+1)+"、")]),t("p",[e._v(e._s(n.conditionDesc))])])})),e._l(e.form.addConditionList.filter(t=>!e.form.selectedConditionList.some(e=>e.id==t.id)),(function(n,a){return t("div",{key:n.id+n.columnNum,staticClass:"col new"},[t("p",[e._v(e._s(a+1+e.form.selectedConditionList.length)+"、")]),t("p",[e._v(e._s(n.conditionDesc))])])}))],2)]),t("SubSection",{attrs:{title:"AI客群瘦身分析结果："}},[t("Analysis",{attrs:{rulesList:e.form.selectedConditionList,params:e.form.analysisParams,addList:e.form.addConditionList},on:{add:e.addOrRemove,remove:e.addOrRemove}})],1)],1)],1),t("div",{staticClass:"bottom__button"},[t("el-button",{attrs:{type:"primary",size:"medium"},on:{click:e.save}},[e._v("确定")]),t("el-button",{attrs:{size:"medium"},on:{click:e.cancel}},[e._v("取消")])],1)],1)},i=[],s=(n("14d9"),n("0fea")),o=n("afd9"),l=n("82be"),r={components:{SubSection:()=>n.e("chunk-2bfdb478").then(n.bind(null,"0917")),Analysis:()=>n.e("chunk-63c4a000").then(n.bind(null,"1988"))},props:{node:{type:Object,default:()=>({})},modify:{type:Boolean,default:!1}},data(){return{activeName:"aihelp",calcLoading:!1,calcError:null,source:null,form:{customerNum:null,selectedConditionList:[],analysisParams:{},addConditionList:[],calcParams:{},finallyParams:[]}}},methods:{initData(){this.modify?this.form=this.node.businessData:this.getAllPCondition()},getAllPCondition(){const{nodeLines:e}=this.node,t=[];let n=[];e.forEach(e=>{if("Scene"===e.nodeType){const a=$graph.findDataById(e.nodeId).businessData;t.push(...a.conditions),this.form.customerNum=a.customerNum,n=a.conditionParams}}),this.form.selectedConditionList=n.map(e=>{if("root"===e.type)return e;const n=t.find(t=>t.columnNum===e.columnNum&&JSON.stringify(t.selectedValues)===JSON.stringify(e.selectedValues));return e.conditionDesc=null===n||void 0===n?void 0:n.conditionDesc,e.selectedConditions=[],e.selectedValues.forEach(n=>{const a=t.find(t=>t.columnNum==e.columnNum),i=a.valueList.find(e=>e.value==n);e.selectedConditions.push(i)}),e}),this.form.selectedConditionList.splice(0,1),this.form.analysisParams={planId:this.node.businessData.productList[0].planId,treeDetails:this.form.selectedConditionList,custColumnNum:null}},getParams(e=1){const t=this.form.selectedConditionList[0].customerInfo,n=this.form.addConditionList.filter(e=>1==e.isExtend),a=this.form.addConditionList.filter(e=>0==e.isExtend);let i=[];return this.form.selectedConditionList.forEach(e=>{a.some(t=>t.id==e.id)||i.push(e)}),i=[...i,...n],1===e?Object(l["e"])(i,{customerInfo:t}):Object(l["f"])(i,{customerInfo:t})},async calcCustomerNum(){this.calcLoading&&this.source.cancel("取消未完成的请求"),this.source=this.$CancelToken.source();const e=this.getParams(1);this.form.customerNum=null,this.calcError=null;try{this.calcLoading=!0;const{count:t}=await Object(s["i"])(o["a"].getTargetUserCount,e,this.source.token,12e4);this.form.customerNum=t,this.calcLoading=!1}catch(t){if("取消未完成的请求"===t.message)return;this.calcError=t.message,this.calcLoading=!1,this.form.customerNum=0}},addOrRemove(e,t){if(1===t){const t=JSON.parse(JSON.stringify(e));this.form.addConditionList.push(t)}else{const t=this.form.addConditionList.findIndex(t=>t.id==e.id);this.form.addConditionList.splice(t,1)}this.calcCustomerNum()},save(){return this.calcLoading?this.$message.error("客群数计算中，请稍后"):this.form.customerNum?0===this.form.addConditionList.length?this.$message.error("请添加或剔除标签规则！"):(this.form.finallyParams=this.getParams(0),1===this.form.finallyParams.length?this.$message.error("标签规则不能为空！"):void this.$emit("save","LabelOptimize",this.form)):this.$message.error("客群数不能为0，请更新标签规则！")},cancel(){this.$emit("cancel")}},created(){this.initData()}},c=r,u=(n("8234"),n("2877")),d=Object(u["a"])(c,a,i,!1,null,"c95dc55e",null);t["default"]=d.exports}}]);