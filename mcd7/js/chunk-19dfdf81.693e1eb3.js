(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-19dfdf81"],{"0657":function(e,t,a){"use strict";a("5d19")},"0918":function(e,t,a){},"0e5d":function(e,t,a){"use strict";a("996d")},"0ed7":function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){return n}));var i=a("0fea"),s=a("cdbb");async function l(e){return Object(i["i"])(s["a"].getScriptPreview+"?scriptId="+e)}async function r(e){return Object(i["i"])(s["a"].clickScript+"?scriptId="+e)}async function n(){const e=await Object(i["g"])(s["a"].getTermRule);return e}},"16c5":function(e,t,a){},"17e3":function(e,t,a){},"1bd8":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("BaseDialog",{attrs:{title:"话术预览",visible:e.dialogVisible,width:"1000px",top:"5vh","confirm-button-text":"关 闭","show-cancel-button":!1},on:{confirm:e.close,close:e.close},scopedSlots:e._u([e.enableEvaluate&&e.form.scriptId?{key:"footerBtn",fn:function(){return[t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.evaluteVisible=!0}}},[e._v("评价")]),t("el-button",{attrs:{type:"warning",loading:e.likeLoading},on:{click:e.like}},[e._v("点赞")])]},proxy:!0}:null],null,!0)},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"label-width":"120px"}},[t("el-form-item",{attrs:{label:"话术名称："}},[e._v(" "+e._s(e.form.scriptName)+" ")]),t("el-form-item",{attrs:{label:"产品编码/名称："}},[e.form.planId?t("span",[e._v(" "+e._s(e.form.planId+" "+e.form.planName)+" ")]):e._e()]),t("el-form-item",{attrs:{label:"话术类型："}},[e._v(" "+e._s(e.form.scriptTypeName)+" ")]),t("el-form-item",{attrs:{label:"应用渠道："}},[e._v(" "+e._s(e.form.channelName)+" ")]),t("el-form-item",{attrs:{label:"运营位："}},[e._v(" "+e._s(e.form.adivName)+" ")]),"2"===e.form.scriptType?t("el-form-item",{attrs:{label:"应用地市："}},[e._v(" "+e._s(e.form.cityName)+" ")]):e._e(),t("el-form-item",{attrs:{label:"内容类型："}},[e._v(" "+e._s(e.form.contentTypeName)+" ")]),t("el-form-item",{attrs:{label:"话术内容："}},[t("MarketingWordsPreview",{attrs:{marketingWords:e.form.marketingWords||[]}})],1)],1),e.enableEvaluate?t("EvaluateDialog",{attrs:{currentRow:e.form,dialogVisible:e.evaluteVisible},on:{"update:dialogVisible":function(t){e.evaluteVisible=t},"update:dialog-visible":function(t){e.evaluteVisible=t}}}):e._e()],1)},s=[],l=a("ea45"),r=a("2102"),n=a("571b"),o=a("0ed7"),c=a("5a4a"),u=a("ac7c"),p={components:{BaseDialog:l["a"],MarketingWordsPreview:r["a"],EvaluateDialog:n["a"]},props:{dialogVisible:{type:Boolean,default:!1},id:{type:String|Number,default:""},enableEvaluate:{type:Boolean,default:!1}},watch:{dialogVisible(e){e?this.getScriptInfo():this.$nextTick(()=>{this.form={}})}},data(){return{loading:!1,form:{},evaluteVisible:!1,likeLoading:!1}},methods:{async getScriptInfo(){try{var e,t;this.loading=!0;const a=await Object(o["b"])(this.id);a.contentTypeName=null===(e=u["a"].find(e=>e.value==a.contentType))||void 0===e?void 0:e.label,a.scriptTypeName=null===(t=u["j"].find(e=>e.value==a.scriptType))||void 0===t?void 0:t.label,this.form=Object(c["c"])(a)}catch(a){this.form={}}finally{this.loading=!1}},async like(){try{this.likeLoading=!0;const e=await Object(o["c"])(this.form.scriptId);this.$message.success(e.message)}catch(e){}finally{this.likeLoading=!1}},close(){this.$emit("update:dialogVisible",!1)}}},d=p,m=(a("c0ec"),a("2877")),f=Object(m["a"])(d,i,s,!1,null,"836eb7b0",null);t["a"]=f.exports},"1c07":function(e,t,a){"use strict";a("77fd")},2102:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"script-container"},[t("el-form",e._l(e.marketingWords,(function(a,i){var s;return t("el-form-item",{key:i,attrs:{label:e.marketingWords.length>1?a.typeName+"：":"","label-width":e.marketingWords.length>1?"100px":"10px"}},[a.list&&a.list.length?e._l(a.list,(function(a){return t("div",{key:a.name},[t("header",[e._v("【"+e._s(a.name)+"】")]),t("div",{domProps:{innerHTML:e._s(a.content)}})])})):e._e(),a.uploadType||null!==(s=a.list)&&void 0!==s&&s.length?e._e():t("span",[e._v(e._s(a.content))]),a.uploadType?[t("Upload",{attrs:{"is-view":!0,type:"1"==a.uploadType?"image":"2"==a.uploadType?"video":"3"==a.uploadType?"audio":"image"},model:{value:e.marketingWords[i],callback:function(t){e.$set(e.marketingWords,i,t)},expression:"marketingWords[i]"}}),t("div",{staticClass:"link"},[t("span",[e._v("跳转链接：")]),t("el-link",{attrs:{underline:!1,href:a.linkUrl,target:"_blank"}},[e._v(e._s(a.linkUrl))])],1)]:e._e()],2)})),1)],1)},s=[],l=a("eae4"),r={components:{Upload:l["a"]},props:{marketingWords:{type:Array,default:()=>[]}}},n=r,o=(a("327a"),a("2877")),c=Object(o["a"])(n,i,s,!1,null,"4a48a557",null);t["a"]=c.exports},26471:function(e,t,a){"use strict";a("798c")},2937:function(e,t,a){},"2d61":function(e,t,a){"use strict";a("d383")},"327a":function(e,t,a){"use strict";a("0918")},"571b":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("BaseDialog",{attrs:{title:`话术评价【${e.currentRow.scriptName}】`,visible:e.dialogVisible,width:"500px",top:"25vh","confirm-button-text":"提 交","show-cancel-button":!1,"confirm-loading":e.loading},on:{confirm:e.submit,close:e.close}},[t("el-form",{ref:"ruleForm",attrs:{model:e.form}},e._l(e.form,(function(a,i){return t("el-form-item",{key:i,attrs:{label:e.keyMap.get(i),prop:i,rules:[{required:!0,validator:e.validate,trigger:"change"}]}},[t("el-rate",{attrs:{"show-text":"",max:5,colors:e.colors,texts:e.texts},model:{value:e.form[i],callback:function(t){e.$set(e.form,i,t)},expression:"form[key]"}})],1)})),1)],1)},s=[],l=(a("d9e2"),a("0fea")),r=a("cdbb"),n=a("ea45"),o={components:{BaseDialog:n["a"]},props:{dialogVisible:{type:Boolean,default:!1},currentRow:{type:Object,default:()=>({})}},watch:{dialogVisible(e){if(!e){this.$refs.ruleForm.clearValidate();for(const e in this.form)this.form.hasOwnProperty(e)&&(this.form[e]=null)}}},data(){return{loading:!1,keyMap:new Map([["syxStarNumber","实用性"],["tyxStarNumber","通用性"],["zqxStarNumber","准确性"]]),form:{syxStarNumber:null,tyxStarNumber:null,zqxStarNumber:null},colors:["#99A9BF","#67a6e7","#2F87EC"],texts:["很差","差","一般","满意","优秀"]}},methods:{validate(e,t,a){const i=this.keyMap.get(e.field);t<1?a(new Error(`请对${i}进行星级评价`)):a()},submit(){this.$refs.ruleForm.validate(async e=>{if(e)try{this.loading=!0;const e={...this.form,scriptId:this.currentRow.scriptId,scriptName:this.currentRow.scriptName};await Object(l["i"])(r["a"].getScriptAppraise,e);this.$message.success("评价成功"),this.$emit("refresh"),this.$nextTick(()=>{this.close()})}catch(t){}finally{this.loading=!1}})},close(){this.$emit("update:dialogVisible",!1)}}},c=o,u=(a("d6bd"),a("2877")),p=Object(u["a"])(c,i,s,!1,null,"3b927ad5",null);t["a"]=p.exports},"5d19":function(e,t,a){},"72ae":function(e,t,a){"use strict";const i="/mcd-cep-web/action",s="/evt-svc/api";t["a"]={ecapi:{queryEventClass:i+"/cep/rule/nx/queryEventClass.do",queryEventDictByDictCode:i+"/cep/rule/nx/queryEventDictByDictCode.do",queryParentDictByDictCode:i+"/cep/rule/nx/queryParentDictByDictCode.do",queryConfigDict:i+"/cep/rule/nx/queryConfigDict.do",queryEventClassLevel:i+"/cep/rule/queryEventClass.do",queryCepRuleNum:i+"/cep/rule/queryCepRuleNum.do",createRule:i+"/cep/rule/nx/createRule.do",manageList:s+"/event/list",manageUpdateStatus:s+"/event/updateStatus",manageDelete:s+"/event",manageListByParent:s+"/businessCategory/listByParent",manageListByLevel:s+"/businessCategory/listByLevel",manageCategoryList:s+"/businessCategory/list",manageGetDetail:s+"/event",eventSave:s+"/event/save",eventListByLevel:s+"/category/listByLevel",eventListByParent:s+"/category/listByParent",areaList:s+"/area/list",areaGetDetail:s+"/area",areaDelete:s+"/area",areaSave:s+"/area/save",areaStationList:s+"/area/stationList",stationList:s+"/station/list",listByCategory:s+"/categoryValue/listByCategory",queryEventsByUserId:"/plan-svc/api/action/cep/event/eventManager/queryEventsByUserId",queryShareById:"/plan-svc/cepRuleShare/queryShareById",saveOrUpdate:"/plan-svc/cepRuleShare/saveOrUpdate",delCampCoordinationTaskList:"/plan-svc/mcd/strategic/coordination/delCampCoordinationTaskList",exportExampleFile:"/plan-svc/mcd/strategic/coordination/exportExampleFile",pushCampCoordinationFile:"/plan-svc/mcd/strategic/coordination/pushCampCoordinationFile",queryCampCoordinationTask:"/plan-svc/mcd/strategic/coordination/queryCampCoordinationTask",queryStrategicCoordination:"/plan-svc/mcd/strategic/coordination/queryStrategicCoordination",saveStrategicCoordinationTask:"/plan-svc/mcd/strategic/coordination/saveStrategicCoordinationTask",selectAllStrategicCoordination:"/plan-svc/mcd/strategic/coordination/selectAllStrategicCoordination",recountCampTask:"/plan-svc/mcd/strategic/coordination/recountCampTask",queryCampCoordinationTaskDetail:"/plan-svc/mcd/strategic/coordination/queryCampCoordinationTaskDetail",childTaskRecord:"/plan-svc/mcd/strategic/coordination/childTaskRecord",approveTaskRecord:"/plan-svc/api/campCoordinate/taskApprove/approveTaskRecord",approveChildTaskRecord:"/plan-svc/api/campCoordinate/taskApprove/approveChildTaskRecord",subTaskApprove:"/plan-svc/api/campCoordinate/taskApprove/subTaskApprove",updateTaskStatus:"/plan-svc/api/campCoordinate/taskApprove/updateTaskStatus",queryAppTypeList:"/approve-svc/jx/cmpApprovalProcessConf/queryAppTypeList",getApproveConfig:"/approve-svc/jx/cmpApprovalProcessConf/getApproveConfig?systemId=",getNodeApprover:"/approve-svc/jx/cmpApproveProcessInstance/getNodeApprover",submitProcess:"/approve-svc/jx/cmpApproveProcessInstance/submitProcess",delPlanConfList:"/plan-svc/mcd/strategic/coordination/delPlanConfList",qryNotCfgPlanTypeAndPri:"/plan-svc/mcd/strategic/coordination/qryNotCfgPlanTypeAndPri",qryPlanConfList:"/plan-svc/mcd/strategic/coordination/qryPlanConfList",qryPlanConfListByPlanTypeOnSave:"/plan-svc/mcd/strategic/coordination/qryPlanConfListByPlanTypeOnSave",qryPlanConfListByPlanTypeOnUpdate:"/plan-svc/mcd/strategic/coordination/qryPlanConfListByPlanTypeOnUpdate",qryPlanTypeList:"/plan-svc/mcd/strategic/coordination/qryPlanTypeList",savePlanConf:"/plan-svc/mcd/strategic/coordination/savePlanConf",updatePriority:"/plan-svc/mcd/strategic/coordination/updatePriority",getSysDics:"/plan-svc/action/iop/common/getSysDics",delTagConfig:"/plan-svc/orchestrate/tag/delTagConfig",queryAccessLabel:"/plan-svc/orchestrate/tag/queryAccessLabel",queryTag:"/plan-svc/orchestrate/tag/queryTag",queryTagType:"/plan-svc/orchestrate/tag/queryTagType",saveTag:"/plan-svc/orchestrate/tag/saveTag",updateTagOrderBy:"/plan-svc/orchestrate/tag/updateTagOrderBy",queryAllTag:"/plan-svc/orchestrate/tag/queryAllTag"}}},"75c8":function(e,t,a){},"77fd":function(e,t,a){},7860:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{ref:"scriptLibRef",staticClass:"word-lib app-content"},[t("div",{staticClass:"top"},[t("span",{staticClass:"search-part"},[t("span",[e._v("产品编码/名称：")]),t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{placeholder:"请输入产品编码或名称",clearable:""},model:{value:e.planKey,callback:function(t){e.planKey="string"===typeof t?t.trim():t},expression:"planKey"}})],1),t("span",{staticClass:"search-part"},[t("span",[e._v("话术编码/名称：")]),t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{placeholder:"请输入话术编码或名称",clearable:""},model:{value:e.scriptKey,callback:function(t){e.scriptKey="string"===typeof t?t.trim():t},expression:"scriptKey"}})],1),t("span",{staticClass:"search-part"},[t("span",[e._v("话术关键词：")]),t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{placeholder:"请输入话术内容",clearable:""},model:{value:e.contentKey,callback:function(t){e.contentKey="string"===typeof t?t.trim():t},expression:"contentKey"}})],1),t("el-button",{staticClass:"search-btn",attrs:{type:"primary"},on:{click:e.search}},[e._v("查询")]),t("QueryFormCell",{attrs:{list:e.queryFormList,defaultSizeForm:e.defaultSizeForm},on:{queryForm:e.queryForm}})],1),t("section",{staticClass:"table-top"},[t("div",{staticClass:"left"},[t("span",{staticClass:"title"},[e._v("话术列表")]),t("span",{staticClass:"desc"},[e._v(" 话术推荐指数规则说明 "),t("i",{staticClass:"el-icon-info",on:{click:e.openViewRuleDialog}})])]),t("div",{staticClass:"right"},[t("el-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新建")]),t("el-button",{attrs:{type:"primary",loading:e.exportLoading},on:{click:e.exportScript}},[e._v("导出")]),e.ruleConfigPermission?t("el-button",{attrs:{type:"primary"},on:{click:e.openEditRuleDialog}},[e._v("规则配置")]):e._e()],1)]),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",staticClass:"table",attrs:{border:"","row-key":"scriptId",data:e.tableData,lazy:!0,"tree-props":{hasChildren:"hasChildren",children:"children"},load:e.loadChildData},on:{"sort-change":e.sortTable}},[e._l(e.columnList,(function(e){return t("el-table-column",{key:e.prop,attrs:{prop:e.prop,label:e.label,sortable:e.sortable||!1,"header-align":"center",align:e.align||"center","show-overflow-tooltip":""}})})),t("el-table-column",{attrs:{prop:"score",label:"状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("div",{staticClass:"recommend"},[t("span",[e._v(e._s(a.statusName))]),4==a.scriptStatus?t("el-popover",{attrs:{"popper-class":"score-popover reject-status-popover",placement:"top",trigger:"hover"},on:{show:function(t){return e.getOpinion(a)}}},[t("div",{staticClass:"opinion"},[t("header",[e._v("审批意见：")]),t("main",{directives:[{name:"loading",rawName:"v-loading",value:!!a.opLoading,expression:"!!row.opLoading"}],attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"#303133"}},[e._v(e._s(a.opinion||"-"))])]),t("el-icon",{staticClass:"el-icon-info",attrs:{slot:"reference"},slot:"reference"})],1):e._e()],1)]}}])}),t("el-table-column",{attrs:{prop:"score",width:"110",align:"center",sortable:""},scopedSlots:e._u([{key:"header",fn:function(a){return[t("span",[e._v("推荐指数")]),t("el-tooltip",{attrs:{effect:"dark",content:"鼠标移入推荐指数时可查看话术分项得分和对应计算规则",placement:"top"}},[t("i",{staticClass:"el-icon-question"})])]}},{key:"default",fn:function({row:a}){return[t("div",{staticClass:"recommend"},[t("el-popover",{attrs:{"popper-class":"score-popover",placement:"left",title:"",trigger:"hover",width:"250",content:a.scoreExplain}},[t("span",{staticClass:"s-p",attrs:{slot:"reference"},slot:"reference"},[e._v(e._s(a.score))])]),a.score>9?t("img",{attrs:{src:e.good}}):e._e()],1)]}}])}),t("el-table-column",{attrs:{label:"操作",width:"300",fixed:"right","header-align":"center",align:"left"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleView(a)}}},[e._v("预览")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handlePersonal(a)}}},[e._v("个性化")]),0==a.scriptStatus||4==a.scriptStatus?t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleEdit(a)}}},[e._v("编辑")]):e._e(),0==a.scriptStatus?t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.submit(a)}}},[e._v("提交")]):e._e(),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleEvalute(a)}}},[e._v("评价")]),t("el-button",{attrs:{type:"text",loading:a.likeLoading},on:{click:function(t){return e.like(a)}}},[e._v("点赞")]),2!=a.scriptStatus&&e.userId===a.createUserId?t("el-popconfirm",{attrs:{title:"确定要删除该话术吗？",cancelButtonType:""},on:{confirm:function(t){return e.deleteData(a)}}},[t("el-button",{staticStyle:{color:"red","margin-left":"10px"},attrs:{slot:"reference",type:"text"},on:{click:function(e){}},slot:"reference"},[e._v("删除")])],1):e._e()]}}])})],2),t("el-pagination",{attrs:{"current-page":e.query.current,"page-sizes":[5,10,20,50],"page-size":e.query.size,"pager-count":5,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),t("div",{staticStyle:{display:"none"}},[e._v(e._s(e.isClearCurrentRow))]),t("EvaluateDialog",{attrs:{currentRow:e.currentRow,dialogVisible:e.evaluteVisible},on:{"update:dialogVisible":function(t){e.evaluteVisible=t},"update:dialog-visible":function(t){e.evaluteVisible=t},refresh:e.getTableData}}),t("EditRuleDialog",{attrs:{dialogVisible:e.editRuleVisible,"is-view":e.isViewRule},on:{"update:dialogVisible":function(t){e.editRuleVisible=t},"update:dialog-visible":function(t){e.editRuleVisible=t}}}),t("ScriptViewDialog",{attrs:{dialogVisible:e.viewVisible,id:e.currentRow.scriptId},on:{"update:dialogVisible":function(t){e.viewVisible=t},"update:dialog-visible":function(t){e.viewVisible=t}}}),t("ScriptAddEditDialog",{attrs:{dialogVisible:e.addEditVisible,id:e.currentRow.scriptId,"channel-list":e.queryFormList[3].values,"city-list":e.queryFormList[1].values,"is-personal":e.isPersonal},on:{"update:dialogVisible":function(t){e.addEditVisible=t},"update:dialog-visible":function(t){e.addEditVisible=t},refresh:e.search}}),t("SubmitDialog",{attrs:{dialogVisible:e.submitVisible,id:e.currentRow.scriptId},on:{"update:dialogVisible":function(t){e.submitVisible=t},"update:dialog-visible":function(t){e.submitVisible=t},refresh:e.getTableData}})],1)},s=[],l=a("ac7c"),r=a("0ed7"),n=a("0fea"),o=a("cdbb"),c=a("89ff"),u=a("5af3"),p=a("d4f7"),d=a.n(p),m=a("4e3f"),f=a("571b"),v=function(){var e=this,t=e._self._c;return t("BaseDialog",{attrs:{title:"话术评估规则说明",visible:e.dialogVisible,width:"1100px",top:"5vh","confirm-button-text":"关 闭","show-cancel-button":!1},on:{confirm:e.close,close:e.close}},[t("div",{staticClass:"rule-text-content"},e._l(e.list,(function(a){return t("section",{key:a.title},[t("header",[e._v(e._s(a.title))]),e._l(a.content,(function(a,i){return t("span",{key:i},e._l(a,(function(a){return t("main",{key:a.label,staticClass:"rule-content"},["evaluate"!==a.label?t("span",[e._v(e._s(a.label))]):e._e(),t("span",[e._v(e._s(a.value))]),t("div",[e._v("营销权重⽐："+e._s(a.weight))])])})),0)}))],2)})),0)])},h=[],g=a("ea45"),b={components:{BaseDialog:g["a"]},props:{dialogVisible:{type:Boolean,default:!1}},data(){return{list:[{title:"话术类型",content:[[{label:"话术类型评分规则：",value:"0-30次：1分；30-80次：3分；80-150次：5分；151-300次：7分；300-500次：9分；500次以上：10分",weight:"20%"}]]},{title:"营销引用次数",content:[[{label:"营销活动引⽤话术评分规则：",value:"0-30次：1分；30-80次：3分；80-150次：5分；151-300次：7分；300-500次：9分；500次以上：10分",weight:"30%"}]]},{title:"营销活动营销效果",content:[[{label:"营销接触率评分规则：",value:"小于3%：3分；3%-5%：5分；5%-7%：7分；7%-9%：9分；9%以上：10分",weight:"15%"}],[{label:"营销办理率评分规则：",value:"小于3%：3分；3%-5%：5分；5%-7%：7分；7%-9%：9分；9%以上：10分",weight:"15%"}]]},{title:"话术预览次数及点赞",content:[[{label:"话术营销接触率累计次数评分规则：",value:"0-20次：1分；20-50次：3分；0-100次：5分；100-150次：7分；150-200次：9分；200次以上：10分",weight:"15%"}],[{label:"话术营销办理率累计次数评分规则：",value:"0-20次：1分；20-50次：3分；0-100次：5分；100-150次：7分；150-200次：9分；200次以上：10分",weight:"15%"}]]},{title:"话术评价",content:[[{label:"evaluate",weight:"10%"}]]}]}},methods:{close(){this.$emit("update:dialogVisible",!1)}}},y=b,C=(a("26471"),a("2877")),T=Object(C["a"])(y,v,h,!1,null,"7b4e2f6d",null),k=T.exports,w=function(){var e=this,t=e._self._c;return t("BaseDialog",{attrs:{title:e.title,visible:e.dialogVisible,width:"1100px",top:"5vh","confirm-button-text":e.isView?"关 闭":"提 交","show-cancel-button":!e.isView,"confirm-loading":e.submitLoading},on:{confirm:()=>{e.isView?e.close():e.submit()},close:e.close}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ruleForm",staticClass:"rule-form",class:{forbidden:e.isView},attrs:{model:e.form,"label-width":"78px",inline:""}},[e._e(),t("section",[t("header",[e._v("营销引⽤次数："),t("span",[e._v("对营销活动引⽤情况按照规则进⾏评分")])]),t("div",{staticClass:"rule-content"},[t("div",{staticClass:"title"},[e._v("规则配置：")]),e._l(e.form.referenceTimes.rules,(function(a,i){return t("div",{key:a.uuid},[t("el-form-item",{attrs:{label:"业务类型:",prop:`referenceTimes.rules[${i}].bussinessType`,rules:e.rules.bussinessTypeRule}},[t("el-select",{staticClass:"w150",attrs:{size:"mini"},on:{change:function(t){return e.changeBussinessType("referenceTimes")}},model:{value:e.form.referenceTimes.rules[i].bussinessType,callback:function(t){e.$set(e.form.referenceTimes.rules[i],"bussinessType",t)},expression:"form.referenceTimes.rules[index].bussinessType"}},e._l(e.REFERENCING_NUMBER,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value,disabled:e.disabled}})})),1)],1),t("el-form-item",{attrs:{prop:`referenceTimes.rules[${i}].valueRange`,rules:e.rules.valueRangeRule}},[t("el-select",{staticClass:"w100",attrs:{size:"mini"},model:{value:e.form.referenceTimes.rules[i].valueRange,callback:function(t){e.$set(e.form.referenceTimes.rules[i],"valueRange",t)},expression:"form.referenceTimes.rules[index].valueRange"}},e._l(e.VALUE_RANGE,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{prop:`referenceTimes.rules[${i}].value1`,rules:e.rules.valueRule}},[t("el-input",{staticClass:"w70",attrs:{size:"mini",type:"number",min:0,oninput:"return(value=parseInt(value))"},model:{value:e.form.referenceTimes.rules[i].value1,callback:function(t){e.$set(e.form.referenceTimes.rules[i],"value1",t)},expression:"form.referenceTimes.rules[index].value1"}}),e._v(" 次 ")],1),"between"===e.form.referenceTimes.rules[i].valueRange?t("el-form-item",{attrs:{prop:`referenceTimes.rules[${i}].value2`,rules:e.rules.valueRule}},[t("span",{staticStyle:{display:"inline-block",transform:"translateX(-10px)"}},[e._v("-")]),t("el-input",{staticClass:"w70",attrs:{size:"mini",type:"number",min:0,oninput:"return(value=parseInt(value))"},model:{value:e.form.referenceTimes.rules[i].value2,callback:function(t){e.$set(e.form.referenceTimes.rules[i],"value2",t)},expression:"form.referenceTimes.rules[index].value2"}}),e._v(" 次")],1):t("div",{staticClass:"placeholder"}),t("el-form-item",{attrs:{label:"得分:","label-width":"50px",prop:`referenceTimes.rules[${i}].score`,rules:e.rules.scoreRule}},[t("el-input",{staticClass:"w70",attrs:{size:"mini",type:"number",oninput:"if(value>10)value=10;else if(value<0)value=0",placeholder:"0-10"},model:{value:e.form.referenceTimes.rules[i].score,callback:function(t){e.$set(e.form.referenceTimes.rules[i],"score",t)},expression:"form.referenceTimes.rules[index].score"}}),e._v(" 分 ")],1),e.isView?e._e():t("el-form-item",[e.form.referenceTimes.rules.length>1?t("div",{staticClass:"remove",attrs:{title:"删除规则"},on:{click:function(t){return e.removeRule("referenceTimes",i)}}},[t("i",{staticClass:"el-icon-remove-outline"})]):e._e(),e.form.referenceTimes.rules.length-1===i?t("div",{staticClass:"add",attrs:{title:"添加规则"},on:{click:function(t){return e.addRule("referenceTimes")}}},[t("i",{staticClass:"el-icon-circle-plus-outline"}),t("span",[e._v("添加规则")])]):e._e(),t("br")])],1)}))],2),t("div",{staticClass:"rule-content"},[t("div",{staticClass:"title"},[e._v("权重配置：")]),t("el-form-item",{attrs:{label:"业务类型:",rules:e.rules.bussinessTypeRule}},[t("el-select",{staticClass:"w150",attrs:{size:"mini",value:"1",disabled:!e.isView}},e._l(e.REFERENCING_NUMBER,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"权重占比:",prop:"referenceTimes.referenceTimesWeight",rules:e.rules.weightRule}},[t("el-input",{staticClass:"w70",attrs:{size:"mini",type:"number",min:1,oninput:"if(value>100)value=100;else if(value<1)value=1",placeholder:"0-100"},model:{value:e.form.referenceTimes.referenceTimesWeight,callback:function(t){e.$set(e.form.referenceTimes,"referenceTimesWeight",t)},expression:"form.referenceTimes.referenceTimesWeight"}}),e._v(" % ")],1)],1)]),t("section",[t("header",[e._v("营销活动营销效果："),t("span",[e._v("对营销活动营销效果情况进⾏评分")])]),t("div",{staticClass:"rule-content"},[t("div",{staticClass:"title"},[e._v("规则配置：")]),e._l(e.form.marketingEffect.rules,(function(a,i){return t("div",{key:a.uuid},[t("el-form-item",{attrs:{label:"业务类型:",prop:`marketingEffect.rules[${i}].bussinessType`,rules:e.rules.bussinessTypeRule}},[t("el-select",{staticClass:"w150",attrs:{size:"mini"},on:{change:function(t){return e.changeBussinessType("marketingEffect")}},model:{value:e.form.marketingEffect.rules[i].bussinessType,callback:function(t){e.$set(e.form.marketingEffect.rules[i],"bussinessType",t)},expression:"form.marketingEffect.rules[index].bussinessType"}},e._l(e.MARKETING_EFFECT,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value,disabled:e.disabled}})})),1)],1),t("el-form-item",{attrs:{prop:`marketingEffect.rules[${i}].valueRange`,rules:e.rules.valueRangeRule}},[t("el-select",{staticClass:"w100",attrs:{size:"mini"},model:{value:e.form.marketingEffect.rules[i].valueRange,callback:function(t){e.$set(e.form.marketingEffect.rules[i],"valueRange",t)},expression:"form.marketingEffect.rules[index].valueRange"}},e._l(e.VALUE_RANGE,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{prop:`marketingEffect.rules[${i}].value1`,rules:e.rules.valueRule}},[t("el-input",{staticClass:"w70",attrs:{size:"mini",type:"number",min:0,oninput:"if(value>100)value=100;else if(value<0)value=0",placeholder:"0-100"},model:{value:e.form.marketingEffect.rules[i].value1,callback:function(t){e.$set(e.form.marketingEffect.rules[i],"value1",t)},expression:"form.marketingEffect.rules[index].value1"}}),e._v(" % ")],1),"between"===e.form.marketingEffect.rules[i].valueRange?t("el-form-item",{attrs:{prop:`marketingEffect.rules[${i}].value2`,rules:e.rules.valueRule}},[t("span",{staticStyle:{display:"inline-block",transform:"translateX(-10px)"}},[e._v("-")]),t("el-input",{staticClass:"w70",attrs:{size:"mini",type:"number",min:0,oninput:"if(value>100)value=100;else if(value<0)value=0",placeholder:"0-100"},model:{value:e.form.marketingEffect.rules[i].value2,callback:function(t){e.$set(e.form.marketingEffect.rules[i],"value2",t)},expression:"form.marketingEffect.rules[index].value2"}}),e._v(" %")],1):t("div",{staticClass:"placeholder"}),t("el-form-item",{attrs:{label:"得分:","label-width":"50px",prop:`marketingEffect.rules[${i}].score`,rules:e.rules.scoreRule}},[t("el-input",{staticClass:"w70",attrs:{size:"mini",type:"number",min:0,oninput:"if(value>10)value=10;else if(value<0)value=0",placeholder:"0-10"},model:{value:e.form.marketingEffect.rules[i].score,callback:function(t){e.$set(e.form.marketingEffect.rules[i],"score",t)},expression:"form.marketingEffect.rules[index].score"}}),e._v(" 分 ")],1),e.isView?e._e():t("el-form-item",[e.form.marketingEffect.rules.length>1?t("div",{staticClass:"remove",attrs:{title:"删除规则"},on:{click:function(t){return e.removeRule("marketingEffect",i)}}},[t("i",{staticClass:"el-icon-remove-outline"})]):e._e(),e.form.marketingEffect.rules.length-1===i?t("div",{staticClass:"add",attrs:{title:"添加规则"},on:{click:function(t){return e.addRule("marketingEffect")}}},[t("i",{staticClass:"el-icon-circle-plus-outline"}),t("span",[e._v("添加规则")])]):e._e(),t("br")])],1)}))],2),t("div",{staticClass:"rule-content"},[t("div",{staticClass:"title"},[e._v("权重配置：")]),t("el-row",[t("el-form-item",{attrs:{label:"业务类型:",rules:e.rules.bussinessTypeRule}},[t("el-select",{staticClass:"w150",attrs:{size:"mini",value:"1",disabled:!e.isView}},e._l(e.MARKETING_EFFECT,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"权重占比:",prop:"marketingEffect.contactRateWeight",rules:e.rules.weightRule}},[t("el-input",{staticClass:"w70",attrs:{size:"mini",type:"number",min:1,oninput:"if(value>100)value=100;else if(value<1)value=1",placeholder:"0-100"},model:{value:e.form.marketingEffect.contactRateWeight,callback:function(t){e.$set(e.form.marketingEffect,"contactRateWeight",t)},expression:"form.marketingEffect.contactRateWeight"}}),e._v(" % ")],1)],1),t("el-row",[t("el-form-item",{attrs:{label:"业务类型:",rules:e.rules.bussinessTypeRule}},[t("el-select",{staticClass:"w150",attrs:{size:"mini",value:"2",disabled:!e.isView}},e._l(e.MARKETING_EFFECT,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"权重占比:",prop:"marketingEffect.handleRateWeight",rules:e.rules.weightRule}},[t("el-input",{staticClass:"w70",attrs:{size:"mini",type:"number",min:1,oninput:"if(value>100)value=100;else if(value<1)value=1",placeholder:"0-100"},model:{value:e.form.marketingEffect.handleRateWeight,callback:function(t){e.$set(e.form.marketingEffect,"handleRateWeight",t)},expression:"form.marketingEffect.handleRateWeight"}}),e._v(" % ")],1)],1)],1)]),t("section",[t("header",[e._v("话术预览及点赞："),t("span",[e._v("对话术预览情况及业务⼈员点赞情况进⾏评分")])]),t("div",{staticClass:"rule-content"},[t("div",{staticClass:"title"},[e._v("规则配置：")]),e._l(e.form.like.rules,(function(a,i){return t("div",{key:a.uuid},[t("el-form-item",{attrs:{label:"业务类型:",prop:`like.rules[${i}].bussinessType`,rules:e.rules.bussinessTypeRule}},[t("el-select",{staticClass:"w150",attrs:{size:"mini"},on:{change:function(t){return e.changeBussinessType("like")}},model:{value:e.form.like.rules[i].bussinessType,callback:function(t){e.$set(e.form.like.rules[i],"bussinessType",t)},expression:"form.like.rules[index].bussinessType"}},e._l(e.STATISTICS_TYPE,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value,disabled:e.disabled}})})),1)],1),t("el-form-item",{attrs:{prop:`like.rules[${i}].valueRange`,rules:e.rules.valueRangeRule}},[t("el-select",{staticClass:"w100",attrs:{size:"mini"},model:{value:e.form.like.rules[i].valueRange,callback:function(t){e.$set(e.form.like.rules[i],"valueRange",t)},expression:"form.like.rules[index].valueRange"}},e._l(e.VALUE_RANGE,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{prop:`like.rules[${i}].value1`,rules:e.rules.valueRule}},[t("el-input",{staticClass:"w70",attrs:{size:"mini",type:"number",min:0,oninput:"return(value=parseInt(value))"},model:{value:e.form.like.rules[i].value1,callback:function(t){e.$set(e.form.like.rules[i],"value1",t)},expression:"form.like.rules[index].value1"}}),e._v(" 次 ")],1),"between"===e.form.like.rules[i].valueRange?t("el-form-item",{attrs:{prop:`like.rules[${i}].value2`,rules:e.rules.valueRule}},[t("span",{staticStyle:{display:"inline-block",transform:"translateX(-10px)"}},[e._v("-")]),t("el-input",{staticClass:"w70",attrs:{size:"mini",type:"number",min:0,oninput:"return(value=parseInt(value))"},model:{value:e.form.like.rules[i].value2,callback:function(t){e.$set(e.form.like.rules[i],"value2",t)},expression:"form.like.rules[index].value2"}}),e._v(" 次")],1):t("div",{staticClass:"placeholder"}),t("el-form-item",{attrs:{label:"得分:","label-width":"50px",prop:`like.rules[${i}].score`,rules:e.rules.scoreRule}},[t("el-input",{staticClass:"w70",attrs:{size:"mini",type:"number",min:0,oninput:"if(value>10)value=10;else if(value<0)value=0",placeholder:"0-10"},model:{value:e.form.like.rules[i].score,callback:function(t){e.$set(e.form.like.rules[i],"score",t)},expression:"form.like.rules[index].score"}}),e._v(" 分 ")],1),e.isView?e._e():t("el-form-item",[e.form.like.rules.length>1?t("div",{staticClass:"remove",attrs:{title:"删除规则"},on:{click:function(t){return e.removeRule("like",i)}}},[t("i",{staticClass:"el-icon-remove-outline"})]):e._e(),e.form.like.rules.length-1===i?t("div",{staticClass:"add",attrs:{title:"添加规则"},on:{click:function(t){return e.addRule("like")}}},[t("i",{staticClass:"el-icon-circle-plus-outline"}),t("span",[e._v("添加规则")])]):e._e(),t("br")])],1)}))],2),t("div",{staticClass:"rule-content"},[t("div",{staticClass:"title"},[e._v("权重配置：")]),t("el-row",[t("el-form-item",{attrs:{label:"业务类型:",rules:e.rules.bussinessTypeRule}},[t("el-select",{staticClass:"w150",attrs:{size:"mini",value:"1",disabled:!e.isView}},e._l(e.STATISTICS_TYPE,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"权重占比:",prop:"like.likeWeight",rules:e.rules.weightRule}},[t("el-input",{staticClass:"w70",attrs:{size:"mini",type:"number",min:1,oninput:"if(value>100)value=100;else if(value<1)value=1",placeholder:"0-100"},model:{value:e.form.like.likeWeight,callback:function(t){e.$set(e.form.like,"likeWeight",t)},expression:"form.like.likeWeight"}}),e._v(" % ")],1)],1),t("el-row",[t("el-form-item",{attrs:{label:"业务类型:",rules:e.rules.bussinessTypeRule}},[t("el-select",{staticClass:"w150",attrs:{size:"mini",value:"2",disabled:!e.isView}},e._l(e.STATISTICS_TYPE,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"权重占比:",prop:"like.previewWeight",rules:e.rules.weightRule}},[t("el-input",{staticClass:"w70",attrs:{size:"mini",type:"number",min:1,oninput:"if(value>100)value=100;else if(value<1)value=1",placeholder:"0-100"},model:{value:e.form.like.previewWeight,callback:function(t){e.$set(e.form.like,"previewWeight",t)},expression:"form.like.previewWeight"}}),e._v(" % ")],1)],1)],1)]),t("section",[t("header",[e._v("话术评价：")]),t("div",{staticClass:"rule-content"},[t("div",{staticClass:"title"},[e._v("权重配置：")]),t("el-form-item",{attrs:{label:"业务类型:"}},[t("el-select",{staticClass:"w150",attrs:{size:"mini",value:"1",disabled:!e.isView}},[t("el-option",{attrs:{label:"评价",value:"1"}})],1)],1),t("el-form-item",{attrs:{label:"权重占比:",prop:"evaluate.evaluateWeight",rules:e.rules.weightRule}},[t("el-input",{staticClass:"w70",attrs:{size:"mini",type:"number",min:1,oninput:"if(value>100)value=100;else if(value<1)value=1",placeholder:"0-100"},model:{value:e.form.evaluate.evaluateWeight,callback:function(t){e.$set(e.form.evaluate,"evaluateWeight",t)},expression:"form.evaluate.evaluateWeight"}}),e._v(" % ")],1),t("span",{staticStyle:{display:"none"}},[e._v(e._s(e.weightTotal))])],1)])])],1)},_=[],x=(a("14d9"),a("d9e2"),a("5a4a")),L=a("ec26"),S={components:{BaseDialog:g["a"]},props:{dialogVisible:{type:Boolean,default:!1},isView:{type:Boolean,default:!1}},watch:{dialogVisible(e){e?this.init():this.$nextTick(()=>{this.$refs["ruleForm"].clearValidate()})}},data(){return{loading:!1,submitLoading:!1,MAX_RULES_LENGTH:10,CONTENT_TYPE:JSON.parse(JSON.stringify(l["a"])),REFERENCING_NUMBER:JSON.parse(JSON.stringify(l["e"])),MARKETING_EFFECT:JSON.parse(JSON.stringify(l["d"])),WORD_TYPE:l["j"],STATISTICS_TYPE:JSON.parse(JSON.stringify(l["h"])),VALUE_RANGE:l["i"],form:{contentType:{rules:l["a"].map(e=>({uuid:Object(L["a"])(),bussinessType:e.value,score:"",weight:""}))},referenceTimes:{rules:[{uuid:Object(L["a"])(),bussinessType:"",valueRange:"",value1:"",value2:"",score:""}],referenceTimesWeight:""},marketingEffect:{rules:[{uuid:Object(L["a"])(),bussinessType:"",valueRange:"",value1:"",value2:"",score:""}],contactRateWeight:"",handleRateWeight:""},like:{rules:[{uuid:Object(L["a"])(),bussinessType:"",valueRange:"",value1:"",value2:"",score:""}],likeWeight:"",previewWeight:""},evaluate:{evaluateWeight:""}},rules:{bussinessTypeRule:[{required:!0,message:"请选择业务类型",trigger:"change"}],valueRangeRule:[{required:!0,message:"请选择取数范围",trigger:"change"}],valueRule:[{required:!0,message:"请输入数值",trigger:"blur"}],scoreRule:[{required:!0,message:"请输入得分",trigger:"blur"}],weightRule:[{required:!0,message:"请输入权重占比",trigger:"blur"}],statisticsTypeRule:[{required:!0,message:"请选择统计类型",trigger:"change"}]}}},computed:{title(){return this.isView?"话术评估规则说明":"话术评估规则配置"},weightTotal(){const{referenceTimes:{referenceTimesWeight:e},marketingEffect:{contactRateWeight:t},marketingEffect:{handleRateWeight:a},like:{likeWeight:i},like:{previewWeight:s},evaluate:{evaluateWeight:l}}=this.form,r=Number(e)+Number(t)+Number(a)+Number(i)+Number(s)+Number(l);return r>100&&this.$message.warning("4个模块权重占比累计总和不能超过100%"),r}},methods:{close(){this.$emit("update:dialogVisible",!1)},async init(){try{var e,t;this.loading=!0;const s=await Object(r["a"])();if(null==s.referenceTimes||null==s.marketingEffect||null==s.like||null==s.evaluate)return;this.form=s;for(const e in this.form){var a,i;"evaluate"!==e&&0===(null===(a=this.form[e].rules)||void 0===a?void 0:a.length)&&(this.form[e].rules=[],this.form[e].rules.push({uuid:Object(L["a"])(),bussinessType:"",valueRange:"",value1:"",value2:"",score:""})),"contentType"===e&&0===(null===(i=this.form[e].rules)||void 0===i?void 0:i.length)&&(this.form[e].rules=l["a"].map(e=>({uuid:Object(L["a"])(),bussinessType:e.value,score:"",weight:""})))}this.form.contentType&&null!==(e=this.form.contentType)&&void 0!==e&&e.rules&&0!==(null===(t=this.form.contentType)||void 0===t||null===(t=t.rules)||void 0===t?void 0:t.length)||(this.$set(this.form,"contentType",{}),this.$set(this.form.contentType,"rules",[]),this.form["contentType"].rules=l["a"].map(e=>({uuid:Object(L["a"])(),bussinessType:e.value,score:"",weight:""})))}catch(s){}finally{this.loading=!1}},reset(){this.$nextTick(()=>{this.$refs["ruleForm"].clearValidate()})},validateValueRange(e,t,a){const i=this.form.referenceTimes.rules,s=[];let l="",r=0;for(let o=0;o<i.length;o++){const e=i[o];if("between"===e.valueRange){if(""===e.value1||""===e.value2)return a(new Error("请输入引用次数"))}else if(""===e.value1)return a(new Error("请输入引用次数"));"between"===e.valueRange?(l=`a>${e.value1} && a<${e.value2}`,r=e.value2>r?e.value2:r):(l=`a${e.valueRange}${e.value1}`,r=e.value1>r?e.value1:r),s.push(l)}const n=Object(x["a"])(+r+1,s);!0===n?a():a(new Error(n))},changeBussinessType(e){if("referenceTimes"===e){if(this.form.referenceTimes.rules.length<this.MAX_RULES_LENGTH)return;const e=this.form.referenceTimes.rules.map(e=>e.bussinessType);for(let t=0;t<this.REFERENCING_NUMBER.length;t++)e.filter(e=>e===this.REFERENCING_NUMBER[t].value).length===this.MAX_RULES_LENGTH?this.$set(this.REFERENCING_NUMBER[t],"disabled",!0):this.$set(this.REFERENCING_NUMBER[t],"disabled",!1)}else if("marketingEffect"===e){if(this.form.marketingEffect.rules.length<this.MAX_RULES_LENGTH)return;const e=this.form.marketingEffect.rules.map(e=>e.bussinessType);for(let t=0;t<this.MARKETING_EFFECT.length;t++)e.filter(e=>e===this.MARKETING_EFFECT[t].value).length===this.MAX_RULES_LENGTH?this.$set(this.MARKETING_EFFECT[t],"disabled",!0):this.$set(this.MARKETING_EFFECT[t],"disabled",!1)}else if("like"===e){if(this.form.like.rules.length<this.MAX_RULES_LENGTH)return;const e=this.form.like.rules.map(e=>e.bussinessType);for(let t=0;t<this.STATISTICS_TYPE.length;t++)e.filter(e=>e===this.STATISTICS_TYPE[t].value).length===this.MAX_RULES_LENGTH?this.$set(this.STATISTICS_TYPE[t],"disabled",!0):this.$set(this.STATISTICS_TYPE[t],"disabled",!1)}},addRule(e){const t=this.form[e].rules;switch(e){case"referenceTimes":if(t.length===l["e"].length*this.MAX_RULES_LENGTH)return this.$message.warning("每个业务类型最多可配置10条规则");case"marketingEffect":if(t.length===l["d"].length*this.MAX_RULES_LENGTH)return this.$message.warning("每个业务类型最多可配置10条规则");case"like":if(t.length===l["h"].length*this.MAX_RULES_LENGTH)return void this.$message.warning("每个业务类型最多可配置10条规则")}t.push({uuid:Object(L["a"])(),bussinessType:"",valueRange:"",value1:"",value2:"",score:""})},removeRule(e,t){const a=this.form[e].rules;a.splice(t,1)},validateBetween(){function e(e){for(let t=0;t<e.length;t++){const a=e[t];if("between"===a.valueRange&&Number(a.value1)>Number(a.value2)){const e=a.value1;a.value1=a.value2,a.value2=e}}}e(this.form.referenceTimes.rules),e(this.form.marketingEffect.rules),e(this.form.like.rules)},submit(){this.$refs.ruleForm.validate(async e=>{if(e){if(100!==this.weightTotal)return this.$message.warning("4个模块的权重累和应为100%，当前权重累和为"+this.weightTotal+"%");this.validateBetween();try{this.submitLoading=!0;const e=await Object(n["i"])(o["a"].saveTermEval,this.form);if("string"===typeof e)return this.$message.error(e);this.$message({type:"success",message:"保存成功",duration:1e3}),this.$emit("update:dialogVisible",!1)}catch(t){}finally{this.submitLoading=!1}}})}}},I=S,R=(a("0657"),Object(C["a"])(I,w,_,!1,null,"b2859788",null)),N=R.exports,E=function(){var e=this,t=e._self._c;return t("BaseDialog",{attrs:{title:e.title,visible:e.dialogVisible,width:"1000px",top:"5vh","confirm-button-text":"保 存","confirm-loading":e.saveLoading},on:{confirm:e.save,close:e.close}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"word-info"},[t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"95px"}},[t("section",[t("header",[e._v("基础信息")]),t("main",[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"话术名称：",prop:"scriptName"}},[t("el-input",{attrs:{placeholder:"请输入话术名称"},model:{value:e.form.scriptName,callback:function(t){e.$set(e.form,"scriptName",t)},expression:"form.scriptName"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"产品：",prop:"planId"}},[t("div",{staticClass:"select-btn",class:{gray:!!e.form.planId,disabled:e.isPersonal},attrs:{title:e.form.planName},on:{click:e.openPlanDialog}},[e.selectPlanList.length?t("span",{staticClass:"multiple"},e._l(e.selectPlanList,(function(a){return t("span",{key:a.planId},[e._v(" "+e._s(a.planName)+" ")])})),0):t("span",[e._v("请选择产品")])])])],1)],1),t("el-row",[t("el-form-item",{attrs:{label:"应用渠道：",prop:"channelId"}},[t("el-select",{attrs:{filterable:"",placeholder:"请选择应用渠道",disabled:e.isPersonal},on:{change:e.saveChannel},model:{value:e.form.channelId,callback:function(t){e.$set(e.form,"channelId",t)},expression:"form.channelId"}},e._l(e.channelListCopy,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-row",[t("el-form-item",{attrs:{label:"运营位：",prop:"adivId"}},[t("el-select",{attrs:{placeholder:"请选择运营位",disabled:e.isPersonal},on:{change:e.saveAdiv},model:{value:e.form.adivId,callback:function(t){e.$set(e.form,"adivId",t)},expression:"form.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1)],1),t("el-row",[t("el-form-item",{attrs:{label:"话术类型：",prop:"scriptType"}},[t("el-radio-group",{attrs:{disabled:!0},on:{change:e.saveScriptType},model:{value:e.form.scriptType,callback:function(t){e.$set(e.form,"scriptType",t)},expression:"form.scriptType"}},e._l(e.WORD_TYPE,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value}},[e._v(e._s(a.label))])})),1)],1)],1),2==e.form.scriptType?t("el-row",[t("el-form-item",{attrs:{label:"应用地市：",prop:"cityId"}},[t("el-select",{attrs:{placeholder:"请选择应用地市"},on:{change:e.saveCityName},model:{value:e.form.cityId,callback:function(t){e.$set(e.form,"cityId",t)},expression:"form.cityId"}},e._l(e.cityListCopy,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1):e._e(),t("el-row",[t("el-form-item",{attrs:{label:"内容类型：",prop:"contentType"}},[t("el-select",{attrs:{placeholder:"请选择内容类型",disabled:e.isPersonal||!e.form.adivId},on:{change:e.saveContentType},model:{value:e.form.contentType,callback:function(t){e.$set(e.form,"contentType",t)},expression:"form.contentType"}},e._l(e.currentChannelContentType,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1)]),t("section",[t("header",[e._v("话术内容")]),t("el-button",{staticClass:"content-preview",attrs:{type:"primary"},on:{click:e.openViewDialog}},[e._v("话术内容预览")]),e.showMarketingWords?t("MarketingWords",{model:{value:e.form.marketingWords,callback:function(t){e.$set(e.form,"marketingWords",t)},expression:"form.marketingWords"}}):e._e()],1)])],1),t("PlanDialog",{attrs:{dialogVisible:e.planVisible,planList:e.selectPlanList},on:{"update:dialogVisible":function(t){e.planVisible=t},"update:dialog-visible":function(t){e.planVisible=t},"select-change":e.selectPlan}}),t("ScriptContentDialog",{attrs:{dialogVisible:e.viewVisible,"marketing-words":e.form.marketingWords||[]},on:{"update:dialogVisible":function(t){e.viewVisible=t},"update:dialog-visible":function(t){e.viewVisible=t}}})],1)},A=[],$=a("5e05"),D=function(){var e=this,t=e._self._c;return t("BaseDialog",{attrs:{title:"选择产品",visible:e.dialogVisible,top:"8vh",width:"75%","confirm-button-text":"关 闭","show-cancel-button":!1},on:{confirm:e.close,close:e.close}},[t("PlanTable",{attrs:{multiple:!0,planList:e.planList},on:{select:e.selectProduct}})],1)},V=[],B=a("7b5c"),O={components:{BaseDialog:g["a"],PlanTable:B["a"]},props:{dialogVisible:{type:Boolean,default:!1},planList:{type:Array,default:()=>[]}},data(){return{loading:!1}},methods:{close(){this.$emit("update:dialogVisible",!1)},selectProduct(e){this.$emit("select-change",e)}}},q=O,P=(a("ae01"),Object(C["a"])(q,D,V,!1,null,"452134aa",null)),j=P.exports,F=a("79a2"),U=a("2102"),W=function(){var e=this,t=e._self._c;return t("BaseDialog",{attrs:{title:"话术内容预览",visible:e.dialogVisible,width:"1000px",top:"8vh","confirm-button-text":"关闭","show-cancel-button":!1},on:{confirm:e.close,close:e.close}},[t("MarketingWordsPreview",{attrs:{"marketing-words":e.marketingWords}})],1)},M=[],z={components:{BaseDialog:g["a"],MarketingWordsPreview:U["a"]},props:{dialogVisible:{type:Boolean,default:!1},marketingWords:{type:Array,default:()=>[]}},methods:{close(){this.$emit("update:dialogVisible",!1)}}},G=z,Y=Object(C["a"])(G,W,M,!1,null,"094b01cb",null),K=Y.exports,H={components:{BaseDialog:g["a"],PlanDialog:j,MarketingWords:F["a"],MarketingWordsPreview:U["a"],ScriptContentDialog:K},props:{dialogVisible:{type:Boolean,default:!1},channelList:{type:Array,default:()=>[]},cityList:{type:Array,default:()=>[]},id:{type:String|Number,default:""},isPersonal:{type:Boolean,default:!1}},watch:{dialogVisible(e){e?this.id&&this.getScriptInfo():this.clearForm()},"form.scriptType"(e){"1"==e&&this.id&&(this.form.cityId="",this.form.cityName="")}},computed:{title(){return this.id?this.isPersonal?"新增个性化话术":"编辑话术":"新增话术"},channelListCopy(){return this.channelList.slice(1)},cityListCopy(){return this.cityList.slice(1)}},data(){return{WORD_TYPE:l["j"],CONTENT_TYPE:l["a"],loading:!1,saveLoading:!1,planVisible:!1,viewVisible:!1,selectPlanList:[],channelContentTypeObj:{},adivContentTypeObj:{},adivList:[],currentChannelContentType:[],rules:{scriptName:[{required:!0,message:"请输入话术名称",trigger:"blur"},{max:50,message:"请最多输入50字",trigger:"blur"}],planId:[{required:!0,message:"请选择产品",trigger:"change"}],channelId:[{required:!0,message:"请选择应用渠道",trigger:"change"}],adivId:[{required:!0,message:"请选择运营位",trigger:"change"}],scriptType:[{required:!0,message:"请选择话术类型",trigger:"change"}],cityId:[{required:!0,message:"请选择应用地市",trigger:"change"}],contentType:[{required:!0,message:"请选择内容类型",trigger:"change"}],linkUrl:[{required:!0,message:"请输入链接地址",trigger:"blur"}]},form:{scriptId:"",scriptName:"",planId:"",planName:"",channelId:"",channelName:"",adivId:"",adivName:"",scriptType:"1",scriptTypeStr:"标准话术",cityId:"",cityName:"",contentType:"",contentTypeStr:"",marketingWords:[{typeId:"2",typeName:"推荐用语",content:"",uploadType:"",uploadFileUrl:"",uploadFileName:"",linkUrl:"",list:[]}]},showMarketingWords:!0}},methods:{close(){this.$emit("update:dialogVisible",!1)},clearForm(){this.$refs.form.resetFields(),this.selectPlanList=[];for(let e in this.form)this.form[e]="";this.form.scriptType="1",this.form.scriptTypeStr="标准话术",this.showMarketingWords=!1,this.form.marketingWords=[{typeId:"3",typeName:"推荐用语",content:"",uploadType:"",uploadFileUrl:"",uploadFileName:"",linkUrl:"",list:[]}],this.$nextTick(()=>{this.showMarketingWords=!0})},async getChannelContentType(e){try{let t=await Object(n["i"])(o["a"].queryChannelContentType,this.channelListCopy.map(e=>e.value));t=t.flat();for(let e of this.channelListCopy){const a=t.filter(t=>t.channelId==e.value),i=[];a.forEach(e=>{const t=this.CONTENT_TYPE.find(t=>t.value==e.contentType);t&&i.push(JSON.parse(JSON.stringify(t))),e.adivId&&this.$set(this.adivContentTypeObj,e.adivId,[...this.adivContentTypeObj[e.adivId]||[],t])}),this.$set(this.channelContentTypeObj,e.value,i)}e&&this.$set(this.form,"marketingWords",e)}catch(t){}},openPlanDialog(){this.planVisible=!0},selectPlan(e){this.selectPlanList=e,this.form.planId=e.map(e=>e.planId).join(","),this.form.planName=e.map(e=>e.planName).join(",")},saveChannel(e){let t=this.channelListCopy.find(t=>t.value===e);this.form.channelName=null===t||void 0===t?void 0:t.label,this.getAdivList(e),this.saveContentType(""),this.form.adivId="",this.form.adivName=""},async getAdivList(e){this.adivList=[];try{const t=await Object(n["i"])($["a"].common.queryAdivInfo,{channelId:e});this.adivList=t}catch(t){}},saveAdiv(e){const t=this.adivList.find(t=>t.adivId===e);this.form.adivName=null===t||void 0===t?void 0:t.adivName,this.setChannelContentType(this.form.channelId)},async setChannelContentType(e,t=!0,a){const i=this.channelListCopy.find(t=>t.value===e);this.form.channelName=null===i||void 0===i?void 0:i.label,this.currentChannelContentType=this.adivContentTypeObj[this.form.adivId],t&&this.saveContentType("")},saveScriptType(e){var t;this.form.scriptTypeStr=null===(t=this.WORD_TYPE.find(t=>t.value===e))||void 0===t?void 0:t.label},saveCityName(e){let t=this.cityListCopy.find(t=>t.value===e);this.form.cityName=null===t||void 0===t?void 0:t.label},saveContentType(e){if(!e)return this.form.contentType="",this.form.contentTypeStr="",this.showMarketingWords=!1,this.form.marketingWords=[],void this.$nextTick(()=>{this.showMarketingWords=!0});const t=this.currentChannelContentType.find(t=>t.value===e);this.form.contentTypeStr=t.label,this.showMarketingWords=!1,this.$set(this.form,"marketingWords",t.marketingWords),this.$nextTick(()=>{this.showMarketingWords=!0})},openViewDialog(){this.viewVisible=!0},delay(e=100){return new Promise(t=>{setTimeout(()=>{t()},e)})},save(){this.$refs.form.validate(async e=>{if(e&&(this.form.contentType<3&&await this.delay(),Object(x["e"])(this.form)))try{this.saveLoading=!0;const e=Object(x["d"])(this.form);e.scriptStatus="0",e.score=null,this.isPersonal&&(e.parentId=this.form.parentId||this.id,e.scriptId=""),"iframe"===sessionStorage.getItem("loginType")?e.createType="2":e.createType="0";const t=await Object(n["i"])(o["a"].saveScript,e);t.length?(this.$message.success("保存成功"),this.$emit("refresh"),this.$nextTick(()=>{this.close()})):this.$message.error(res.message)}catch(t){}finally{this.saveLoading=!1}})},async getScriptInfo(){try{this.loading=!0,this.showMarketingWords=!1;const e=await Object(r["b"])(this.id);this.form=Object(x["c"])(e),this.selectPlanList.push({planId:this.form.planId,planName:this.form.planName}),this.form.adivId&&this.getAdivList(this.form.channelId),this.setChannelContentType(this.form.channelId,!1,this.form.marketingWords),this.isPersonal&&(this.form.scriptType="2",this.form.scriptTypeStr="个性化话术")}catch(e){}finally{this.loading=!1,this.$nextTick(()=>{this.showMarketingWords=!0})}}},created(){this.getChannelContentType()}},J=H,X=(a("2d61"),Object(C["a"])(J,E,A,!1,null,"41359816",null)),Q=X.exports,Z=a("1bd8"),ee=function(){var e=this,t=e._self._c;return t("BaseDialog",{attrs:{title:"提交审批",visible:e.dialogVisible,width:"450px","confirm-button-text":"确 认","confirm-loading":e.submitLoading},on:{confirm:e.submit,close:e.close}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"nextNodesApproverForm",attrs:{"label-width":"110px"}},e._l(e.nextNodesList,(function(a,i){return t("el-form-item",{key:i,attrs:{label:a.node.nodeName+"：",rules:[{required:!0,message:"请选择审批人",trigger:"change"}]}},[t("el-select",{attrs:{placeholder:"请选择审批人"},model:{value:e.approverUserList[i],callback:function(t){e.$set(e.approverUserList,i,t)},expression:"approverUserList[index]"}},e._l(a.approverUser,(function(e,a){return t("el-option",{key:a,attrs:{label:e.userName,value:e.userId}})})),1)],1)})),1)],1)},te=[],ae=a("72ae"),ie={components:{BaseDialog:g["a"]},props:{dialogVisible:{type:Boolean,default:!1},id:{type:String|Number,default:""}},watch:{dialogVisible(e){e&&0===this.nextNodesList.length&&this.getNextApproverList()}},data(){return{loading:!1,submitLoading:!1,getSource:null,submitSource:null,nextNodesList:[],approverUserList:[],approveParams:{approvalType:"TERM",berv:0,nodeId:"",businessId:"",nextNodesApprover:[]}}},methods:{close(){this.loading&&this.getSource.cancel(),this.submitLoading&&this.submitSource.cancel(),this.$emit("update:dialogVisible",!1)},async getNextApproverList(e=!1){this.loading&&this.getSource.cancel(),this.getSource=this.$CancelToken.source();try{this.loading=!0,this.approverUserList=[];const e=await Object(n["i"])(ae["a"].ecapi.getApproveConfig+"TERM"),t={approvalType:"TERM",processId:e.processId,berv:e.berv,nodeId:"",instanceId:null,triggerParm:{}},a=await Object(n["i"])(ae["a"].ecapi.getNodeApprover,t,this.getSource.token,this.$retryDelay);this.nextNodesList=a.nextNodesApprover,this.approveParams.berv=e.berv,this.approveParams.nodeId=a.nodeId,this.approveParams.businessId=this.id,this.approveParams.processId=e.processId}catch(a){var t;null!==(t=a.message)&&void 0!==t&&t.includes("timeout")&&!0!==e&&this.getNextApproverList(!0)}finally{this.loading=!1}},async submit(){if(0===this.approverUserList.length||this.approverUserList.length!==this.nextNodesList.length)return this.$message.error("请选择审批人");const e=[];this.nextNodesList.forEach((t,a)=>{let i=this.approverUserList[a];const s=[];t.approverUser.map(e=>{e.userId===i&&s.push(e)}),e.push({approverUser:s,node:t.node})}),this.approveParams.nextNodesApprover=e,this.approveParams.businessId=this.id,this.submitLoading&&this.submitSource.cancel(),this.submitSource=this.$CancelToken.source();try{this.submitLoading=!0;await Object(n["i"])(o["a"].submitApprove,this.approveParams,this.submitSource.token,this.$retryDelay);this.$message.success("提交审批成功"),this.$emit("refresh"),this.$nextTick(()=>{this.close()})}catch(a){var t;null!==(t=a.message)&&void 0!==t&&t.includes("timeout")&&!0!==rePost&&this.submit(!0)}finally{this.submitLoading=!1}}}},se=ie,le=(a("a213"),Object(C["a"])(se,ee,te,!1,null,"3d1021e0",null)),re=le.exports,ne={name:"ScriptLibVue",components:{QueryFormCell:m["a"],EvaluateDialog:f["a"],ViewRuleDialog:k,EditRuleDialog:N,ScriptAddEditDialog:Q,ScriptViewDialog:Z["a"],SubmitDialog:re},computed:{isClearCurrentRow(){const e=!this.addEditVisible&&!this.viewVisible&&!this.evaluteVisible&&!this.submitVisible;return e&&setTimeout(()=>{this.currentRow={},this.isPersonal=!1},200),e}},data(){return{good:d.a,userId:window.sessionStorage.getItem("userId"),ruleConfigPermission:!1,loading:!1,source:null,exportLoading:!1,planKey:"",scriptKey:"",contentKey:"",defaultSizeForm:{radioModel:["","","","",""]},queryFormList:[{disabled:!1,label:"话术类型",values:[{label:"不限",value:""},...l["j"]],isDate:!1},{disabled:!1,label:"应用地市",values:[{label:"不限",value:""}],isDate:!1},{label:"内容类型",values:[{label:"不限",value:""},...l["a"]],isDate:!1},{label:"应用渠道",values:[{label:"不限",value:""},...l["f"]],isDate:!1},{label:"优秀话术",values:[{label:"不限",value:""},...l["c"]],isDate:!1}],query:{current:1,size:10,cityId:"",channelId:"",scriptType:"",contentType:"",excellentTerm:"",planKey:"",scriptKey:"",contentKey:"",orderBy:"",orderColumn:""},tableData:[],total:0,columnList:[{label:"话术编码",prop:"scriptId",sortable:!0,align:"left"},{label:"话术名称",prop:"scriptName",align:"left"},{label:"产品编码/名称",prop:"planProp"},{label:"话术类型",prop:"scriptTypeName"},{label:"应用渠道",prop:"channelName",align:"left"},{label:"内容类型",prop:"contentTypeName",align:"left"},{label:"创建时间",prop:"createTime"},{label:"创建人",prop:"createUserName"}],currentRow:{},isPersonal:!1,addEditVisible:!1,viewVisible:!1,evaluteVisible:!1,isViewRule:!1,viewRuleVisible:!1,editRuleVisible:!1,submitVisible:!1}},methods:{async getCityList(){try{const e=await Object(n["i"])(c["a"].blackList.queryAllCitys);this.$set(this.queryFormList[1],"values",[{label:"不限",value:""},...e.map(e=>({label:e.cityName,value:e.cityId}))])}catch(e){}},async getChannelList(){try{this.$set(this.queryFormList[3],"values",[{label:"不限",value:""},...l["f"]])}catch(e){}},queryForm({index:e,value:t}){switch(e){case 0:this.query.scriptType=t;break;case 1:this.query.cityId=t;break;case 2:this.query.contentType=t;break;case 3:this.query.channelId=t;break;case 4:this.query.excellentTerm=t;break}this.search()},search(){this.query.planKey=this.planKey,this.query.scriptKey=this.scriptKey,this.query.contentKey=this.contentKey,this.query.current=1,this.getTableData()},async getTableData(){this.loading&&this.source.cancel("取消上次请求"),this.source=this.$CancelToken.source();try{this.loading=!0;const{records:e,total:t}=await Object(n["i"])(o["a"].getScriptListInfo,this.query,this.source.token);this.tableData=this.configTableData(e||[]),this.total=t}catch(e){this.tableData=[]}finally{this.loading=!1,this.$refs.table.store&&(this.$refs.table.store.states.lazyTreeNodeMap={})}},configTableData(e){return e.map(e=>{var t,a;let i=`\n\t\t\t\t\t\t${e.YXYY_SCORE}(营销引用次数)*${e.referenceTimesWeight}% +\n\t\t\t\t\t\t${e.HDYX_SCORE}(营销接触率)*${e.contactRateWeight}% +\n\t\t\t\t\t\t${e.HDBL_SCORE}(营销办理率)*${e.handleRateWeight}% +\n\t\t\t\t\t\t${e.PREVIEW_SCORE}(话术预览)*${e.previewWeight}% +\n\t\t\t\t\t\t${e.CLICK_SCORE}(话术点赞)*${e.likeWeight}% +\n\t\t\t\t\t\t${e.EVAL_SCORE}(话术评价)*${e.evaluateWeight}% =\n\t\t\t\t\t\t${e.score}分\n\t\t\t\t\t`;return{...e,scoreExplain:i,planProp:`${e.planId} ${e.planName}`,scriptTypeName:null===(t=l["j"].find(t=>t.value==e.scriptType))||void 0===t?void 0:t.label,contentTypeName:null===(a=l["a"].find(t=>t.value==e.contentType))||void 0===a?void 0:a.label,statusName:l["g"].get(+e.scriptStatus),hasChildren:"1"===this.query.scriptType}})},transformCase(e){return e.replace(/([A-Z])/g,"_$1").toUpperCase()},sortTable({prop:e,order:t}){t?(this.query.orderColumn=e.replace(/([A-Z])/g,"_$1").toUpperCase(),this.query.orderBy="ascending"===t?"ASC":"DESC"):(this.query.orderColumn="",this.query.orderBy=""),this.query.current=1,this.getTableData()},async loadChildData(e,t,a){try{const t=await Object(n["i"])(o["a"].getScriptName+"?scriptId="+e.scriptId),i=t.map(e=>({...e,planProp:`${e.planId}/${e.planName}`,scriptTypeName:l["j"].find(t=>t.value==e.scriptType).label,contentTypeName:l["a"].find(t=>t.value==e.contentType).label,statusName:l["g"].get(+e.scriptStatus),hasChildren:!1}));a(i)}catch(i){a([])}},async getOpinion(e){if(!e.opinion&&!e.opLoading)try{this.$set(e,"opLoading",!0);const t=await Object(n["i"])(o["a"].qryApproveRejectOpinion,{id:e.scriptId});this.$set(e,"opinion",t)}catch(t){this.$set(e,"opinion","")}finally{this.$set(e,"opLoading",!1)}},handleSizeChange(e){this.query.current=1,this.query.size=e,this.getTableData()},handleCurrentChange(e){this.query.current=e,this.getTableData()},handleAdd(){this.addEditVisible=!0},openViewRuleDialog(){this.isViewRule=!0,this.editRuleVisible=!0},openEditRuleDialog(){this.isViewRule=!1,this.editRuleVisible=!0},async exportScript(){try{this.exportLoading=!0;const{data:e}=await Object(n["b"])(o["a"].exportScript,this.query);Object(u["a"])(e,"话术列表.xls")}catch(e){}finally{this.exportLoading=!1}},async getConfigRulePermission(){try{const e=await Object(n["g"])(o["a"].getConfigRulePermission);!0===e&&(this.ruleConfigPermission=!0)}catch(e){}},handleEvalute(e){if(e.evaluate)return this.$message.warning("该话术今日已评价");this.currentRow=e,this.evaluteVisible=!0},handleView(e){this.currentRow=e,this.viewVisible=!0},handlePersonal(e){this.currentRow=e,this.isPersonal=!0,this.addEditVisible=!0},handleEdit(e){this.currentRow=e,this.addEditVisible=!0},submit(e){this.currentRow=e,this.submitVisible=!0},async like(e){if(e.click)return this.$message.warning("该话术今日已点赞");try{this.$set(e,"likeLoading",!0);const t=await Object(r["c"])(e.scriptId);this.$set(e,"click",!0),this.$message.success(t.message)}catch(t){}finally{this.$set(e,"likeLoading",!1)}},async deleteData(e){try{await Object(n["i"])(o["a"].delScript+"?scriptId="+e.scriptId),this.$message.success("删除成功"),this.getTableData()}catch(t){}}},created(){this.getCityList(),this.getTableData(),this.getConfigRulePermission()},mounted(){"ScriptLibInner"===this.$route.name&&(this.$refs.scriptLibRef.style.marginBottom="40px")}},oe=ne,ce=(a("a8d9"),a("0e5d"),Object(C["a"])(oe,i,s,!1,null,"3b0b57de",null));t["default"]=ce.exports},"798c":function(e,t,a){},"79a2":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("main",{staticClass:"script-main-content"},e._l(e.scriptList,(function(a,i){return t("el-tabs",{key:a.typeName,staticClass:"top-level-tabs"},[t("el-tab-pane",{attrs:{label:a.typeName}},[a.list&&a.list.length?[t("el-tabs",{attrs:{type:"card"},model:{value:e.richTextActive,callback:function(t){e.richTextActive=t},expression:"richTextActive"}},e._l(a.list,(function(s,l){return t("el-tab-pane",{attrs:{label:s.name,name:i+"-"+l}},[a.isRich?t("Editor",{attrs:{placeholder:"请输入"+s.name},model:{value:s.content,callback:function(t){e.$set(s,"content",t)},expression:"subItem.content"}}):t("el-input",{attrs:{type:"textarea",placeholder:"请输入"+s.name,autosize:{minRows:6,maxRows:10}},model:{value:s.content,callback:function(t){e.$set(s,"content",t)},expression:"subItem.content"}})],1)})),1)]:[t("el-tabs",{attrs:{type:"card"}},[t("el-tab-pane",{attrs:{label:a.typeName}},[a.uploadType?[t("Upload",{attrs:{type:"1"==a.uploadType?"image":"2"==a.uploadType?"video":"3"==a.uploadType?"audio":"image",action:"/mkt-term-svc/api/uploadScriptMaterial"},model:{value:e.scriptList[i],callback:function(t){e.$set(e.scriptList,i,t)},expression:"scriptList[i]"}}),t("el-form-item",{staticClass:"el-form-item-link-url",attrs:{label:"跳转链接：",rules:[{required:!0,message:"请输入链接地址",trigger:"blur"}]}},[t("el-input",{attrs:{placeholder:"请输入链接地址"},model:{value:a.linkUrl,callback:function(t){e.$set(a,"linkUrl",t)},expression:"item.linkUrl"}})],1)]:t("el-input",{attrs:{type:"textarea",autosize:{minRows:5,maxRows:8},placeholder:"请输入"+a.typeName},model:{value:a.content,callback:function(t){e.$set(a,"content",t)},expression:"item.content"}})],2)],1)]],2)],1)})),1)},s=[],l=a("ceb0"),r=a("eae4"),n={components:{Editor:l["a"],Upload:r["a"]},model:{prop:"value",event:"change"},props:{value:{type:Array,default:()=>[]}},watch:{scriptList:{handler(e){this.$emit("change",e)},deep:!0}},data(){return{scriptList:[{typeId:"2",typeName:"推荐用语",content:"",uploadType:"",uploadFileUrl:"",uploadFileName:"",list:[]}],richTextActive:"0-0"}},methods:{},created(){this.value&&this.value.length&&(this.scriptList=JSON.parse(JSON.stringify(this.value)))}},o=n,c=(a("1c07"),a("2877")),u=Object(c["a"])(o,i,s,!1,null,"d31d9c80",null);t["a"]=u.exports},"89ff":function(e,t,a){"use strict";t["a"]={bigSrceenConfig:{queryFrontSecondScreens:"/plan-svc/mcd/front/secondScreen/queryFrontSecondScreens",updateFrontSecondScreens:"/plan-svc/mcd/front/secondScreen/updateFrontSecondScreens"},blackList:{deleBlackList:"/plan-svc/customer/black/list/deleBlackList",downloadImpOrDelBlacklistTemplate:"/plan-svc/customer/black/list/downloadImpOrDelBlacklistTemplate",impOrDelBlacklistFile:"/plan-svc/customer/black/list/impOrDelBlacklistFile",queryBlackList:"/plan-svc/customer/black/list/queryBlackList",queryAllCitys:"/plan-svc/customer/black/list/queryAllCitys",createOrUpdate:"/plan-svc/mcd-hmh5-blacklist-task/createOrUpdate",delete:"/plan-svc/mcd-hmh5-blacklist-task/delete",listTask:"/plan-svc/mcd-hmh5-blacklist-task/listTask",getTaskDetailByTaskId:"/plan-svc/mcd-hmh5-blacklist-task/getTaskDetailByTaskId",submitBlacklist:"/plan-svc/mcd-hmh5-blacklist-task/submitBlacklist",getBlacklistApprover:"/plan-svc/mcd-hmh5-blacklist-task/getBlacklistApprover",approveBlacklistRecord:"/plan-svc/mcd-hmh5-blacklist-task/approveBlacklistRecord"},careRelation:{queryChannelByCityAndCounty:"/plan-svc/mcd/front/guardList/queryChannelByCityAndCounty",exportGuardUserList:"/plan-svc/mcd/front/guardList/exportGuardUserList",queryGuardUserList:"/plan-svc/mcd/front/guardList/queryGuardUserList"},messageTemplate:{approveSmsTemplateRecord:"/plan-svc/sms/template/approveSmsTemplateRecord",delCareSmsTemplate:"/plan-svc/sms/template/delCareSmsTemplate",deleteTemplateLabel:"/plan-svc/sms/template/deleteTemplateLabel",getCareSmsTemplate:"/plan-svc/sms/template/getCareSmsTemplate",getCareSmsTemplateApprover:"/plan-svc/sms/template/getCareSmsTemplateApprover",getCareSmsTemplateDetail:"/plan-svc/sms/template/getCareSmsTemplateDetail",getCustGroupVars:"/plan-svc/sms/template/getCustGroupVars",getLabelListDaiwei:"/plan-svc/sms/template/getLabelListDaiwei",getRelaLabels:"/plan-svc/sms/template/getRelaLabels",saveCareSmsTemplate:"/plan-svc/sms/template/saveCareSmsTemplate",saveOrUpdateRela:"/plan-svc/sms/template/saveOrUpdateRela",subCareSmsTemplateApprove:"/plan-svc/sms/template/subCareSmsTemplateApprove"},labelConfig:{mcdCustomLabelDefGet:"/plan-svc/mcdCustomLabelDef",mcdCustomLabelDefPut:"/plan-svc/mcdCustomLabelDef",commitProcess:"/plan-svc/mcdCustomLabelDef/commitProcess",getNodeApprover:"/plan-svc/mcdCustomLabelDef/getNodeApprover",modifySelfDefinedLabelConf:"/plan-svc/mcdCustomLabelDef/modifySelfDefinedLabelConf",selectSelfDefinedLabelConf:"/plan-svc/mcdCustomLabelDef/selectSelfDefinedLabelConf",selectSelfDefinedLabelConfDetail:"/plan-svc/mcdCustomLabelDef/selectSelfDefinedLabelConfDetail",mcdCustomLabelDef:"/plan-svc/mcdCustomLabelDef"},warningConfig:{mcdAppAlarmInfoGet:"/plan-svc/mcdAppAlarmInfo",mcdAppAlarmInfoPost:"/plan-svc/mcdAppAlarmInfo",mcdAppAlarmInfoPut:"/plan-svc/mcdAppAlarmInfo",mcdAppAlarmInfoDelete:"/plan-svc/mcdAppAlarmInfo",batchImportAutoClearAlarm:"/plan-svc/mcdAppAlarmInfo/batchImportAutoClearAlarm",commitProcess:"/plan-svc/mcdAppAlarmInfo/commitProcess",getNodeApprover:"/plan-svc/mcdAppAlarmInfo/getNodeApprover",queryDataSourceList:"/plan-svc/mcdAppAlarmInfo/queryDataSourceList",queryDataTableList:"/plan-svc/mcdAppAlarmInfo/queryDataTableList",querySourceTable:"/plan-svc/mcdAppAlarmInfo/querySourceTable",selectAlarmDetailById:"/plan-svc/mcdAppAlarmInfo/selectAlarmDetailById",selectAlarmType:"/plan-svc/mcdAppAlarmInfo/selectAlarmType",terminateAlarm:"/plan-svc/mcdAppAlarmInfo/terminateAlarm",queryHasRole:"/plan-svc/mcdAppAlarmInfo/queryHasRole",updateAlarmThreshold:"/plan-svc/mcdAppAlarmInfo/updateAlarmThreshold",queryAllCitys:"/plan-svc/mcdAppAlarmInfo/queryAllCitys"},customerCommunicationUseCondition:{exportCampsegHandleDetail:"/plan-svc/action/jx/onlinelChannel/exportCampsegHandleDetail",exportCampsegHandleSummary:"/plan-svc/action/jx/onlinelChannel/exportCampsegHandleSummary",exportChannelUsageList:"/plan-svc/action/jx/onlinelChannel/exportChannelUsageList",exportCityUsageList:"/plan-svc/action/jx/onlinelChannel/exportCityUsageList",exportCountyUsageList:"/plan-svc/action/jx/onlinelChannel/exportCountyUsageList",exportGridUsageList:"/plan-svc/action/jx/onlinelChannel/exportGridUsageList",exportOppoCampCityHandle:"/plan-svc/action/jx/onlinelChannel/exportOppoCampCityHandle",queryCampsegHandleDetail:"/plan-svc/action/jx/onlinelChannel/queryCampsegHandleDetail",queryCampsegHandleSummary:"/plan-svc/action/jx/onlinelChannel/queryCampsegHandleSummary",queryChannelUsageList:"/plan-svc/action/jx/onlinelChannel/queryChannelUsageList",queryCityUsageList:"/plan-svc/action/jx/onlinelChannel/queryCityUsageList",queryCountyUsageList:"/plan-svc/action/jx/onlinelChannel/queryCountyUsageList",queryGridUsageList:"/plan-svc/action/jx/onlinelChannel/queryGridUsageList",queryOppoCampCityHandle:"/plan-svc/action/jx/onlinelChannel/queryOppoCampCityHandle"},customerContactMaintainCondition:{reportSmsMessage:"/plan-svc/reportSmsMessage",export:"/plan-svc/reportSmsMessage/export"},customerCommunicationWarningCondition:{reportYjCityDetailNew:"/plan-svc/reportYjCityDetailNew",reportYjCityDetailNewExport:"/plan-svc/reportYjCityDetailNew/export",reportYjCountyDetailNew:"/plan-svc/reportYjCountyDetailNew",reportYjCountyDetailNewExport:"/plan-svc/reportYjCountyDetailNew/export",reportYjDetailInfo:"/plan-svc/reportYjDetailInfo",reportYjDetailInfoExport:"/plan-svc/reportYjDetailInfo/export",reportYjGridDetailNew:"/plan-svc/reportYjGridDetailNew",reportYjGridDetailNewExport:"/plan-svc/reportYjGridDetailNew/export",reportYjStaffDetailNew:"/plan-svc/reportYjStaffDetailNew",reportYjStaffDetailNewExport:"/plan-svc/reportYjStaffDetailNew/export"},jobNoQuery:{queryFrontStafferList:"/plan-svc/mcd/front/staffer/queryFrontStafferList"},problemFeedback:{addNewReply:"/plan-svc/mcdFeedbackQa/addNewReply",addNewReplyPicture:"/plan-svc/mcdFeedbackQa/addNewReplyPicture",downloadImage:"/plan-svc/mcdFeedbackQa/downloadImage",getAllRepliesByBusinessId:"/plan-svc/mcdFeedbackQa/getAllRepliesByBusinessId",getRecentlyReplyFeedback:"/plan-svc/mcdFeedbackQa/getRecentlyReplyFeedback",mcdManagerFeedback:"/plan-svc/mcdManagerFeedback"},proxyCustomerLabel:{mcdFrontCareSmsLabelGet:"/plan-svc/mcdFrontCareSmsLabel",mcdFrontCareSmsLabelPost:"/plan-svc/mcdFrontCareSmsLabel",mcdFrontCareSmsLabelPut:"/plan-svc/mcdFrontCareSmsLabel",mcdFrontCareSmsLabelDelete:"/plan-svc/mcdFrontCareSmsLabel"},noticeBoard:{mcdBulletinBoardGet:"/plan-svc/mcdBulletinBoard",mcdBulletinBoardPost:"/plan-svc/mcdBulletinBoard",mcdBulletinBoardPut:"/plan-svc/mcdBulletinBoard",mcdBulletinBoardDelete:"/plan-svc/mcdBulletinBoard",deleteImage:"/plan-svc/mcdBulletinBoard/deleteImage",downloadImage:"/plan-svc/mcdBulletinBoard/downloadImage",modifyBulletinStatus:"/plan-svc/mcdBulletinBoard/modifyBulletinStatus",uploadBulletinPictures:"/plan-svc/mcdBulletinBoard/uploadBulletinPictures"},mainPackageConfig:{queryFrontMainOffers:"/plan-svc/mcd/front/mainOfferInfo/queryFrontMainOffers",deleteMainOfferInfo:"/plan-svc/mcd/front/mainOfferInfo/deleteMainOfferInfo",getMainOfferInfoDetail:"/plan-svc/mcd/front/mainOfferInfo/getMainOfferInfoDetail",saveOrUpdateMainOffer:"/plan-svc/mcd/front/mainOfferInfo/saveOrUpdateMainOffer",updateMainOfferInfoStatus:"/plan-svc/mcd/front/mainOfferInfo/updateMainOfferInfoStatus"},keyMonitoring:{queryFrontKeyMonitors:"/plan-svc/mcd/front/keyMonitor/queryFrontKeyMonitors"}}},"996d":function(e,t,a){},"9d33":function(e,t,a){},a213:function(e,t,a){"use strict";a("16c5")},a8d9:function(e,t,a){"use strict";a("ea98")},ae01:function(e,t,a){"use strict";a("2937")},b62e:function(e,t,a){"use strict";a("bb6e")},bb6e:function(e,t,a){},c0ec:function(e,t,a){"use strict";a("17e3")},d383:function(e,t,a){},d4f7:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAPVJREFUOE+lk8ENgkAQRf+ECkzWO1YAHYCVKGXsSTxtGWolaAdQgd7ZxArMmI+uIZhIkDmxmb/vDzszgpkhY/dT15YK2Qj0VNtlOdT/BKSuzRWyE0SF4lE11qwmAvwW0JjOifPaWPNl+LOCxPmrIFrTVfE4NNZ03/34AFJHtxAaKyQT4FRbc2ROAb7DnoraLs9B2QGCAMANQA7gLIj2tV3wHPJZzzlnZcy/AW0JyI1uifMVnfouw7LZGZpQ8xcgcf4gwIWGMwCvX/wX0HVnDuAzE5MreHcsa6wp+LiTAKm7xxyofpcCgDNfjS0W52S4VKPbOAZ9Av0TtRGHhvvtAAAAAElFTkSuQmCC"},d6bd:function(e,t,a){"use strict";a("9d33")},ea45:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("el-dialog",{class:{"title-center":e.titleCenter},attrs:{title:e.title,visible:void 0===e.value?e.visible:e.value,width:e.width,top:e.top,"append-to-body":"","show-close":!1,"close-on-click-modal":!1,"destroy-on-close":e.destroyOnClose},on:{"update:visible":function(t){void 0===e.value?e.visible:e.value=t}}},[t("i",{staticClass:"el-icon-close",on:{click:e.close}}),e._t("default"),t("div",{style:{textAlign:e.footerPosition},attrs:{slot:"footer"},slot:"footer"},[e.showCancelButton?t("el-button",{on:{click:e.close}},[e._v(e._s(e.cancelButtonText))]):e._e(),e._t("footerBtn"),t("el-button",{attrs:{type:"primary",loading:e.confirmLoading},on:{click:e.confirm}},[e._v(e._s(e.confirmButtonText))])],2)],2)},s=[],l={model:{prop:"value",event:"change"},props:{value:{type:void 0|Boolean},visible:{type:void 0|Boolean},titleCenter:{type:Boolean,default:!1},title:{type:String,required:!0},width:{type:String,default:"50%"},top:{type:void 0|String,default:void 0},confirmLoading:{type:Boolean,default:!1},confirmButtonText:{type:String,default:"确 认"},cancelButtonText:{type:String,default:"取 消"},showCancelButton:{type:Boolean,default:!0},footerPosition:{type:String,default:"center"},destroyOnClose:{type:Boolean,default:!0}},methods:{close(){void 0===this.value?this.$emit("close"):this.$emit("change",!1)},confirm(){this.$emit("confirm")}}},r=l,n=(a("b62e"),a("2877")),o=Object(n["a"])(r,i,s,!1,null,"1be2cb38",null);t["a"]=o.exports},ea98:function(e,t,a){},eae4:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("transition-group",{attrs:{name:"top-from"}},[e.fileInfo.uploadFileUrl||e.isView?t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],key:"2",staticClass:"file-container"},[e.isView?e._e():t("i",{staticClass:"el-icon-close",on:{click:e.removeFile}}),t("div",{staticClass:"file-info"},[t("el-row",[t("span",[e._v("名称：")]),t("span",{staticClass:"text"},[e._v(e._s(e.fileInfo.uploadFileName))])]),t("el-row",[t("span",[e._v("尺寸：")]),t("span",[e._v(e._s(e.fileInfo.fileSize))])])],1),t("div",{staticClass:"file-view"},["image"===e.type?t("el-image",{attrs:{src:e.fileInfo.fileSrc,"preview-src-list":[e.fileInfo.fileSrc],fit:"fill"}}):e._e()],1)]):t("div",{key:"1",staticClass:"script-upload"},[t("el-upload",{attrs:{action:"/",accept:e.typeInfo.accept,multiple:e.multiple,"show-file-list":!1,"before-upload":e.beforeUpload,"http-request":e.uploadFile}},[t("div",{staticClass:"upload-content"},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v("点击上传"+e._s(e.typeInfo.typeName))]),t("div",{staticClass:"el-upload__info"},[e._v(e._s(e.typeInfo.tip))])])]),e.showProgress?[t("el-progress",{staticClass:"upload-progress",attrs:{percentage:e.progress,"stroke-width":2,status:e.uploadStatus,"text-inside":""}}),t("span",[e._v(e._s(e.progress+"%"))])]:e._e()],2)])},s=[],l=(a("88a7"),a("271a"),a("5494"),a("0fea")),r=a("d39c"),n={model:{prop:"fileObj",event:"change"},props:{isView:{type:Boolean,default:!1},type:{type:String,validator(e){return-1!==["image","video","audio"].indexOf(e)},default:"image"},action:{type:String,default:"/mkt-term-svc/api/uploadScriptMaterial"},multiple:{type:Boolean,default:!1},fileObj:{type:Object,default:()=>{}}},computed:{typeInfo(){switch(this.type){case"image":return{accept:"image/*",typeName:"图片",size:10485760,tip:"文件大小不能超过10M，支持jpg、jpeg、png格式"};case"video":return{accept:"video/*",typeName:"视频",size:104857600,tip:"文件大小不能超过100M，支持mp4、avi、rmvb格式"};case"audio":return{accept:"audio/*",typeName:"音频",size:10485760,tip:"文件大小不能超过10M，支持mp3、wav格式"}}}},data(){return{loading:!1,fileInfo:{uploadFileName:"",uploadFileUrl:"",fileSrc:"",fileSize:""},showProgress:!1,progress:0,uploadStatus:null}},methods:{handleFile(e){if("image"===this.type){const t=new Image;t.src=window.URL.createObjectURL(e),t.onload=()=>{this.fileInfo.fileSize=`${t.width} × ${t.height}`,this.fileInfo.uploadFileName=e.name,this.fileInfo.fileSrc=window.URL.createObjectURL(e)}}if("video"===this.type||"audio"===this.type){this.fileInfo.uploadFileName=e.name,this.fileInfo.fileSrc=window.URL.createObjectURL(e);const t=document.createElement(this.type);t.preload="metadata",t.onloadedmetadata=()=>{window.URL.revokeObjectURL(t.src),this.fileInfo.fileSize=Math.floor(t.duration)+"s"}}},beforeUpload(e){if(e.size>this.typeInfo.size)return this.$message.error(`${this.typeInfo.typeName}大小不能超过${this.typeInfo.size/1024/1024}M, 请重新选择${this.typeInfo.typeName}`),!1;this.handleFile(e)},async uploadFile(e){try{this.showProgress=!0,this.progress=0,this.uploadStatus=null;const t=new FormData;t.append("file",e.file);const{resourceUrl:a}=await Object(l["j"])(this.action,t,this.uploadProgressEvent);this.fileInfo.uploadFileUrl=a;let i={...this.fileInfo};delete i.fileSrc,this.$emit("change",i),this.showProgress=!1,this.progress=0}catch(t){this.uploadStatus="exception",setTimeout(()=>{this.showProgress=!1},1e3)}},uploadProgressEvent(e){this.progress=Math.floor(100*e.loaded/e.total)},removeFile(){this.fileInfo.uploadFileUrl="",this.fileInfo.uploadFileName="",this.fileInfo.fileSrc="",this.fileInfo.fileSize="",this.$emit("change",this.fileInfo)},async setFileInfo(){try{this.loading=!0;const{data:e}=await Object(l["b"])(r["a"].seapi.downloadChanPromptFile,{fileUrlAndName:this.fileInfo.uploadFileUrl}),t=new Blob([e],{type:e.type});this.fileInfo.fileSrc=URL.createObjectURL(t);const a=new File([t],this.fileInfo.uploadFileName||this.fileInfo.uploadFileName||"",{type:e.type});this.handleFile(a)}catch(e){}finally{this.loading=!1}}},created(){this.fileInfo={...this.fileInfo,...this.fileObj},this.fileInfo.uploadFileUrl&&this.setFileInfo()}},o=n,c=(a("f9b4"),a("2877")),u=Object(c["a"])(o,i,s,!1,null,"73835c26",null);t["a"]=u.exports},f9b4:function(e,t,a){"use strict";a("75c8")}}]);