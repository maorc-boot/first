(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1bd1ca02"],{"006c":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{attrs:{title:"链接库",visible:e.dialogVisible,width:"800px",modal:!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("div",{staticClass:"tags"},[t("p",[e._v("已选链接：")]),t("div",e._l(e.tagsList,(function(a){return t("el-tag",{key:a.name,attrs:{closable:"",type:"success"},on:{close:function(t){return e.handleClose(a)}}},[e._v(" "+e._s(a.name)+" ")])})),1)]),t("el-form",{ref:"queryForm",attrs:{model:e.queryForm}},[t("el-row",[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"链接编号：","label-width":"100px"}},[t("el-input",{attrs:{placeholder:"请输入链接编号"},model:{value:e.queryForm.chainedCode,callback:function(t){e.$set(e.queryForm,"chainedCode",t)},expression:"queryForm.chainedCode"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"链接名称：","label-width":"100px"}},[t("el-input",{attrs:{placeholder:"请输入链接名称"},model:{value:e.queryForm.chainName,callback:function(t){e.$set(e.queryForm,"chainName",t)},expression:"queryForm.chainName"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"链接地址：","label-width":"100px"}},[t("el-input",{attrs:{placeholder:"请输入链接地址"},model:{value:e.queryForm.chainDress,callback:function(t){e.$set(e.queryForm,"chainDress",t)},expression:"queryForm.chainDress"}})],1)],1)],1),t("div",{staticStyle:{marginLeft:"81%"}},[t("el-button",{attrs:{type:"primary"},on:{click:e.searchList}},[e._v("查询")]),t("el-button",{attrs:{icon:"el-icon-refresh"}},[e._v("重置")])],1)],1),t("el-table",{staticClass:"table",staticStyle:{width:"100%"},attrs:{data:e.chainedData}},[t("el-table-column",{attrs:{prop:"index",label:"序号"}}),t("el-table-column",{attrs:{prop:"date",label:"链接编号"}}),t("el-table-column",{attrs:{prop:"date",label:"链接名称"}}),t("el-table-column",{attrs:{prop:"date",label:"说明"}}),t("el-table-column",{attrs:{prop:"date",label:"关联产品ID"}}),t("el-table-column",{attrs:{prop:"date",label:"关联产品名称"}}),t("el-table-column",{attrs:{prop:"name",label:"关联活动"}}),t("el-table-column",{attrs:{prop:"address",label:"\t创建时间"}}),t("el-table-column",{attrs:{prop:"address",label:"\t创建人"}}),t("el-table-column",{attrs:{prop:"address",label:"\t操作",fixed:"right",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-link",{staticClass:"text-sm mr-16",attrs:{type:"primary",underline:!0},on:{click:function(t){return e.addItem(a.row)}}},[e._v("引用 ")]),t("el-link",{staticClass:"text-sm mr-16",attrs:{type:"primary",underline:!0},on:{click:function(t){return e.copyItem(a.row)}}},[e._v("复制 ")])]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{"current-page":e.queryForm.current,"page-size":e.queryForm.size,layout:"total, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("确 定")])],1)],1)],1)},r=[],l=a("0fea"),s=a("5e05"),o={props:[],data(){return{dialogVisible:!1,tagsList:[],queryForm:{chainedCode:"",chainName:"",chainDress:"",current:1,size:5},total:1,chainedData:[{date:"2016-05-02",name:"王小虎",address:"上海市普陀区金沙江路 1518 弄"}]}},created(){},methods:{async getChainedList(e){await Object(l["i"])(s["a"].common.getSmsContentTemplateList,e)},searchList(){this.getChainedList(this.queryForm)},showDialog(e){this.dialogVisible=e},handleCurrentChange(e){this.queryForm.current=e,this.getChainedList(this.queryForm)},handleSizeChange(e){this.queryForm.size=e,this.getChainedList(this.queryForm)},copyItem(e){},addItem(e){this.$set(this.tagsList,0,e)},handleClose(e){this.tagsList.splice(this.tagsList.indexOf(e),1)}}},n=o,c=(a("d1a4"),a("2877")),m=Object(c["a"])(n,i,r,!1,null,"66ea7576",null);t["a"]=m.exports},"00b8":function(e,t,a){"use strict";function i(e){return e.map(e=>`<div><header style="font-size:15px;font-weight:600;color:#2f87ec;">【${e.name}】</header><div style="margin:0 0 5px 8px">${e.content}</div></div>`).join("")}function r(e,t){const a=t.channelId,r=e.contentType,l=e.marketingWords;if("804"===a||"808"===a)"5"==r?(t.columnExt2=l[0].content,t.columnExt5=l[1].content):"6"==r?t.columnExt5=l[0].content:"7"==r?t.columnExt2=l[0].content:"1"==r?(t.columnExt2=i(l[0].list),t.columnExt5=l[1].content):"2"==r?t.columnExt2=i(l[0].list):"3"==r?(t.columnExt2=i(l[0].list),t.columnExt5=l[1].content):"4"==r&&(t.columnExt2=i(l[0].list));else if("809"===a)"5"==r?(t.columnExt2=l[0].content,t.columnExt3=l[1].content):"6"==r?t.columnExt3=l[0].content:"7"==r&&(t.columnExt2=l[0].content);else if("906"===a)"7"===r?t.marketingWords=l[0].content:r<5&&(t.marketingWords=i(l[0].list));else if("924"===a)if("7"==r)"9241"===t.adivInfo.adivId?t.columnExt7=l[0].content:t.EXEC_CONTENT=l[0].content;else if("8"===r)t.columnExt4=l[0].uploadFileUrl||"",t.columnExt6=l[0].linkUrl||"";else if("9"===r){const e=l.find(e=>"1"==e.uploadType),a=l.find(e=>"1"!=e.uploadType);t.columnExt4=e.uploadFileUrl||"",t.columnExt6=e.linkUrl||"",t.columnExt7=a.content}return t}function l(e,t){const a=e.channelId,i=t.contentType,r=t.marketingWords;if("804"===a||"808"===a)"5"==i?(r[0].content=e.columnExt2,r[1].content=e.columnExt5):"6"==i?r=e.columnExt5:"7"==i&&(r[0].content=e.columnExt2);else if("809"===a)"5"==i?(r[0].content=e.columnExt2,r[1].content=e.columnExt3):"6"==i?r=e.columnExt3:"7"==i&&(r[0].content=e.columnExt2);else if("906"===a)"7"==i&&(r[0].content=e.marketingWords);else if("924"===a)if("7"==i)r[0].content=e.EXEC_CONTENT||e.columnExt7;else if("8"==i){var l;r[0].uploadFileUrl=e.columnExt4,r[0].uploadFileName=null===(l=e.columnExt4)||void 0===l?void 0:l.split("/").pop(),r[0].linkUrl=e.columnExt6}else if("9"==i){var s;const t=r.find(e=>"1"==e.uploadType),a=r.find(e=>"1"!=e.uploadType);t.uploadFileUrl=e.columnExt4,t.uploadFileName=null===(s=e.columnExt4)||void 0===s?void 0:s.split("/").pop(),t.linkUrl=e.columnExt6,a.content=e.columnExt7}return t}a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return l}))},"0188":function(e,t,a){"use strict";a("9a05")},"0298":function(e,t,a){},"0853":function(e,t,a){},"08cc":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mailTable-layer",class:e.showByRow?"fs12":""},[t("div",{staticClass:"mailTable",style:e.styleObject},e._l(e.rowCount,(function(a,i){return t("el-row",{key:i},[e.isAarray(a)?t("el-row",{staticClass:"ArrayMailTable"},e._l(a,(function(a,i){return t("el-col",{key:i,staticClass:"ArrayMailTable-row",attrs:{span:12}},[t("el-col",{staticClass:"key",attrs:{span:8}},[e._v(e._s(a.key))]),t("el-col",{staticClass:"value",attrs:{span:16}},[e._v(e._s(e.DetailsFrom[a.value]))])],1)})),1):t("el-row",[t("el-col",{staticClass:"ArrayMailTable",attrs:{span:24}},[t("el-col",{staticClass:"key",attrs:{span:4}},[e._v(e._s(a.key))]),t("el-col",{staticClass:"value1",attrs:{span:20}},[e._v(e._s(e.DetailsFrom[a.value]))])],1)],1)],1)})),1)])},r=[],l=(a("14d9"),{data(){return{styleObject:{},s_showByRow:!0}},props:["tableData","tableStyle","showByRow","DetailsFrom"],computed:{isAarray:function(){return e=>Array.isArray(e)},rowCount:function(){let e=[],t=[...this.tableData];for(let a=0;a<t.length;a++){let i=[];t[a].iscolspan||(i.push(t[a]),a+1<t.length&&!t[a+1].iscolspan&&(i.push(t[a+1]),a++)),0!==i.length?(i.length<2&&i.push([]),e.push(i)):e.push(t[a])}return e}},created(){this.styleObject=this.tableStyle,void 0!==this.showByRow&&(this.s_showByRow=this.showByRow)}}),s=l,o=(a("5976"),a("2877")),n=Object(o["a"])(s,i,r,!1,null,"2becbdfc",null);t["a"]=n.exports},"0918":function(e,t,a){},"0924":function(e,t,a){"use strict";a("9011")},"0ad5":function(e,t,a){"use strict";a("8b53")},"0b16":function(e,t,a){"use strict";var i=a("1985");function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var l=/^([a-z0-9.+-]+:)/i,s=/:[0-9]*$/,o=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,n=["<",">",'"',"`"," ","\r","\n","\t"],c=["{","}","|","\\","^","`"].concat(n),m=["'"].concat(c),u=["%","/","?",";","#"].concat(m),d=["/","?","#"],h=255,p=/^[+a-z0-9A-Z_-]{0,63}$/,v=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,C={javascript:!0,"javascript:":!0},b={javascript:!0,"javascript:":!0},f={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},g=a("4328");function _(e,t,a){if(e&&"object"===typeof e&&e instanceof r)return e;var i=new r;return i.parse(e,t,a),i}function x(e){return"string"===typeof e&&(e=_(e)),e instanceof r?e.format():r.prototype.format.call(e)}function E(e,t){return _(e,!1,!0).resolve(t)}function y(e,t){return e?_(e,!1,!0).resolveObject(t):t}r.prototype.parse=function(e,t,a){if("string"!==typeof e)throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e.indexOf("?"),s=-1!==r&&r<e.indexOf("#")?"?":"#",n=e.split(s),c=/\\/g;n[0]=n[0].replace(c,"/"),e=n.join(s);var _=e;if(_=_.trim(),!a&&1===e.split("#").length){var x=o.exec(_);if(x)return this.path=_,this.href=_,this.pathname=x[1],x[2]?(this.search=x[2],this.query=t?g.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var E=l.exec(_);if(E){E=E[0];var y=E.toLowerCase();this.protocol=y,_=_.substr(E.length)}if(a||E||_.match(/^\/\/[^@/]+@[^@/]+/)){var F="//"===_.substr(0,2);!F||E&&b[E]||(_=_.substr(2),this.slashes=!0)}if(!b[E]&&(F||E&&!f[E])){for(var I,D,w=-1,k=0;k<d.length;k++){var N=_.indexOf(d[k]);-1!==N&&(-1===w||N<w)&&(w=N)}D=-1===w?_.lastIndexOf("@"):_.lastIndexOf("@",w),-1!==D&&(I=_.slice(0,D),_=_.slice(D+1),this.auth=decodeURIComponent(I)),w=-1;for(k=0;k<u.length;k++){N=_.indexOf(u[k]);-1!==N&&(-1===w||N<w)&&(w=N)}-1===w&&(w=_.length),this.host=_.slice(0,w),_=_.slice(w),this.parseHost(),this.hostname=this.hostname||"";var S="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!S)for(var L=this.hostname.split(/\./),T=(k=0,L.length);k<T;k++){var O=L[k];if(O&&!O.match(p)){for(var P="",$=0,M=O.length;$<M;$++)O.charCodeAt($)>127?P+="x":P+=O[$];if(!P.match(p)){var A=L.slice(0,k),j=L.slice(k+1),q=O.match(v);q&&(A.push(q[1]),j.unshift(q[2])),j.length&&(_="/"+j.join(".")+_),this.hostname=A.join(".");break}}}this.hostname.length>h?this.hostname="":this.hostname=this.hostname.toLowerCase(),S||(this.hostname=i.toASCII(this.hostname));var R=this.port?":"+this.port:"",U=this.hostname||"";this.host=U+R,this.href+=this.host,S&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==_[0]&&(_="/"+_))}if(!C[y])for(k=0,T=m.length;k<T;k++){var V=m[k];if(-1!==_.indexOf(V)){var B=encodeURIComponent(V);B===V&&(B=escape(V)),_=_.split(V).join(B)}}var W=_.indexOf("#");-1!==W&&(this.hash=_.substr(W),_=_.slice(0,W));var G=_.indexOf("?");if(-1!==G?(this.search=_.substr(G),this.query=_.substr(G+1),t&&(this.query=g.parse(this.query)),_=_.slice(0,G)):t&&(this.search="",this.query={}),_&&(this.pathname=_),f[y]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){R=this.pathname||"";var K=this.search||"";this.path=R+K}return this.href=this.format(),this},r.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",a=this.pathname||"",i=this.hash||"",r=!1,l="";this.host?r=e+this.host:this.hostname&&(r=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&"object"===typeof this.query&&Object.keys(this.query).length&&(l=g.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var s=this.search||l&&"?"+l||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||f[t])&&!1!==r?(r="//"+(r||""),a&&"/"!==a.charAt(0)&&(a="/"+a)):r||(r=""),i&&"#"!==i.charAt(0)&&(i="#"+i),s&&"?"!==s.charAt(0)&&(s="?"+s),a=a.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})),s=s.replace("#","%23"),t+r+a+s+i},r.prototype.resolve=function(e){return this.resolveObject(_(e,!1,!0)).format()},r.prototype.resolveObject=function(e){if("string"===typeof e){var t=new r;t.parse(e,!1,!0),e=t}for(var a=new r,i=Object.keys(this),l=0;l<i.length;l++){var s=i[l];a[s]=this[s]}if(a.hash=e.hash,""===e.href)return a.href=a.format(),a;if(e.slashes&&!e.protocol){for(var o=Object.keys(e),n=0;n<o.length;n++){var c=o[n];"protocol"!==c&&(a[c]=e[c])}return f[a.protocol]&&a.hostname&&!a.pathname&&(a.pathname="/",a.path=a.pathname),a.href=a.format(),a}if(e.protocol&&e.protocol!==a.protocol){if(!f[e.protocol]){for(var m=Object.keys(e),u=0;u<m.length;u++){var d=m[u];a[d]=e[d]}return a.href=a.format(),a}if(a.protocol=e.protocol,e.host||b[e.protocol])a.pathname=e.pathname;else{var h=(e.pathname||"").split("/");while(h.length&&!(e.host=h.shift()));e.host||(e.host=""),e.hostname||(e.hostname=""),""!==h[0]&&h.unshift(""),h.length<2&&h.unshift(""),a.pathname=h.join("/")}if(a.search=e.search,a.query=e.query,a.host=e.host||"",a.auth=e.auth,a.hostname=e.hostname||e.host,a.port=e.port,a.pathname||a.search){var p=a.pathname||"",v=a.search||"";a.path=p+v}return a.slashes=a.slashes||e.slashes,a.href=a.format(),a}var C=a.pathname&&"/"===a.pathname.charAt(0),g=e.host||e.pathname&&"/"===e.pathname.charAt(0),_=g||C||a.host&&e.pathname,x=_,E=a.pathname&&a.pathname.split("/")||[],y=(h=e.pathname&&e.pathname.split("/")||[],a.protocol&&!f[a.protocol]);if(y&&(a.hostname="",a.port=null,a.host&&(""===E[0]?E[0]=a.host:E.unshift(a.host)),a.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===h[0]?h[0]=e.host:h.unshift(e.host)),e.host=null),_=_&&(""===h[0]||""===E[0])),g)a.host=e.host||""===e.host?e.host:a.host,a.hostname=e.hostname||""===e.hostname?e.hostname:a.hostname,a.search=e.search,a.query=e.query,E=h;else if(h.length)E||(E=[]),E.pop(),E=E.concat(h),a.search=e.search,a.query=e.query;else if(null!=e.search){if(y){a.host=E.shift(),a.hostname=a.host;var F=!!(a.host&&a.host.indexOf("@")>0)&&a.host.split("@");F&&(a.auth=F.shift(),a.hostname=F.shift(),a.host=a.hostname)}return a.search=e.search,a.query=e.query,null===a.pathname&&null===a.search||(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.href=a.format(),a}if(!E.length)return a.pathname=null,a.search?a.path="/"+a.search:a.path=null,a.href=a.format(),a;for(var I=E.slice(-1)[0],D=(a.host||e.host||E.length>1)&&("."===I||".."===I)||""===I,w=0,k=E.length;k>=0;k--)I=E[k],"."===I?E.splice(k,1):".."===I?(E.splice(k,1),w++):w&&(E.splice(k,1),w--);if(!_&&!x)for(;w--;w)E.unshift("..");!_||""===E[0]||E[0]&&"/"===E[0].charAt(0)||E.unshift(""),D&&"/"!==E.join("/").substr(-1)&&E.push("");var N=""===E[0]||E[0]&&"/"===E[0].charAt(0);if(y){a.hostname=N?"":E.length?E.shift():"",a.host=a.hostname;F=!!(a.host&&a.host.indexOf("@")>0)&&a.host.split("@");F&&(a.auth=F.shift(),a.hostname=F.shift(),a.host=a.hostname)}return _=_||a.host&&E.length,_&&!N&&E.unshift(""),E.length>0?a.pathname=E.join("/"):(a.pathname=null,a.path=null),null===a.pathname&&null===a.search||(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.auth=e.auth||a.auth,a.slashes=a.slashes||e.slashes,a.href=a.format(),a},r.prototype.parseHost=function(){var e=this.host,t=s.exec(e);t&&(t=t[0],":"!==t&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)},t.parse=_,t.resolve=E,t.resolveObject=y,t.format=x,t.Url=r},"0d29":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("Tips",{attrs:{id:e.id},on:{getChannelDetail:e.getChannelDetail}}),t("el-form",{ref:"CrmFrom",staticStyle:{width:"100%"},attrs:{"label-width":"145px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-form-item",{attrs:{label:"推送方式：",prop:"columnExt1"}},[t("el-radio-group",{model:{value:e.CrmFrom.columnExt1,callback:function(t){e.$set(e.CrmFrom,"columnExt1",t)},expression:"CrmFrom.columnExt1"}},[t("el-radio",{attrs:{label:"1",disabled:!e.CrmFrom.channelFlag}},[e._v("全量推送")]),t("el-radio",{attrs:{label:"0",disabled:!e.CrmFrom.channelFlag}},[e._v("偏好推送")])],1)],1),t("div",{staticClass:"header"},[t("el-form-item",{attrs:{label:"活动类型：",prop:"columnExt2"}},[t("el-select",{attrs:{placeholder:"请选择活动类型"},on:{change:e.changeAid},model:{value:e.CrmFrom.columnExt2,callback:function(t){e.$set(e.CrmFrom,"columnExt2",t)},expression:"CrmFrom.columnExt2"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"标准化素材：",prop:"columnExt20"}},[t("div",{staticClass:"select-material",on:{click:function(t){return e.selectMaterial(!0)}}},[e._v(e._s(e.CrmFrom.materialName||"请选择"))])])],1)],1),t("el-form-item",{attrs:{label:"客户群规则：",prop:"columnExt3"}},[t("el-input",{attrs:{type:"textarea",maxlength:"500","show-word-limit":"",rows:8,placeholder:"您还可以输入500个字"},model:{value:e.CrmFrom.columnExt3,callback:function(t){e.$set(e.CrmFrom,"columnExt3",t)},expression:"CrmFrom.columnExt3"}})],1),e.showExt18?t("el-form-item",{attrs:{label:"智能话术："}},[t("el-checkbox",{on:{change:()=>e.CrmFrom.columnExt18=e.checkColumnExt18?"1":"0"},model:{value:e.checkColumnExt18,callback:function(t){e.checkColumnExt18=t},expression:"checkColumnExt18"}},[e._v("启用")]),e.checkColumnExt18?t("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt18,callback:function(t){e.$set(e.CrmFrom,"columnExt18",t)},expression:"CrmFrom.columnExt18"}},[t("el-radio",{attrs:{label:"1"}},[e._v("省端模型")]),t("el-radio",{attrs:{label:"2"}},[e._v("一级IOP模型")])],1):e._e()],1):e._e(),t("el-form-item",{attrs:{label:"营销用语：",prop:"marketingWords"}},[t("el-input",{attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},model:{value:e.CrmFrom.marketingWords,callback:function(t){e.$set(e.CrmFrom,"marketingWords",t)},expression:"CrmFrom.marketingWords"}})],1)],1),t("materialList",{ref:"material",attrs:{channelId:e.id,adivId:e.CrmFrom.adivInfo.adivId},on:{addMaterial:e.addMaterial}})],1)},r=[],l=a("0fea"),s=a("5e05"),o=a("b893"),n=a("f1ce"),c=a("5ed5");a("0b16");const m=s["a"].common.getSysEnum,u=s["a"].common.queryAdivInfo,d=s["a"].common.queryHallInfo;var h={props:["channelNewData","id"],components:{materialList:n["a"],Tips:c["a"]},data(){return{CrmFrom:{adivInfo:{},channelId:"",channelName:"",attributionInfo:{},standard:"",CustomerRules:"",marketingWords:"",policy:"",activityType:"",columnExt1:"1",columnExt2:"",columnExt3:"",columnExt18:"0",columnExt20:""},showExt18:!1,checkColumnExt18:!1,CrmFromRules:{activityType:[{required:!0,message:"请选择活动类型",trigger:"blur"}],columnExt1:[{required:!0,message:"请选择推送方式",trigger:"blur"}],columnExt2:[{required:!0,message:"请选择活动类型",trigger:"blur"}],standard:[{required:!0,message:"请选择标准化素材",trigger:"change"}],CustomerRules:[{required:!0,message:"请输入客户群规则",trigger:"blur"}],marketingWords:[{required:!0,message:"请输入营销话术",trigger:"blur"}],policy:[{required:!0,message:"请输入活动政策",trigger:"change"}],adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},timeIdList:[],adivList:[],attributionList:[]}},watch:{channelNewData:{handler(){this.CrmFrom=Object(o["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.checkColumnExt18=this.CrmFrom.columnExt18>0},deep:!0}},mounted(){this.getOptionData(),this.CrmFrom=Object(o["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.checkColumnExt18=this.CrmFrom.columnExt18>0},methods:{getChannelDetail(e){1==e.smartScript&&(this.showExt18=!0)},async getOptionData(){await Object(l["i"])(m,{enumType:"iop_time_id"}).then(e=>{this.timeIdList=e}),await Object(l["i"])(u,{channelId:this.id}).then(e=>{this.adivList=e}),await Object(l["i"])(d,{}).then(e=>{this.attributionList=e})},changeAid(e){var t="";this.adivList.forEach(a=>{e===a.adivId&&(t=a.adivName)}),this.CrmFrom.adivInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,adivName:t})},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e},selectMaterial(e){this.$refs["material"].getMaterialList(),this.$refs["material"].showDialog(e)},addMaterial(e){this.CrmFrom={...this.CrmFrom,columnExt20:e.materialId,materialName:e.materialName}}},created(){}},p=h,v=(a("aabc"),a("2877")),C=Object(v["a"])(p,i,r,!1,null,"59c0a972",null);t["a"]=C.exports},"0dd9":function(e,t,a){"use strict";a("1cb6")},"0ed7":function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"c",(function(){return s})),a.d(t,"a",(function(){return o}));var i=a("0fea"),r=a("cdbb");async function l(e){return Object(i["i"])(r["a"].getScriptPreview+"?scriptId="+e)}async function s(e){return Object(i["i"])(r["a"].clickScript+"?scriptId="+e)}async function o(){const e=await Object(i["g"])(r["a"].getTermRule);return e}},"0ef1":function(e,t,a){"use strict";a("409c")},1059:function(e,t,a){},1173:function(e,t,a){},"121a":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"productContent"},[t("span",[e._v(e._s(e.DetailForm.PLAN_NAME||""))])]),e._m(0),t("vertical-table",{attrs:{tableData:e.tableData,DetailsFrom:e.DetailForm,tableStyle:{width:"100%"}}})],1)},r=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"tableTitle"},[t("h3",[e._v("基础信息")])])}],l=a("08cc"),s=a("0fea"),o=a("d370"),n={props:{planId:{type:String,default:()=>""}},components:{VerticalTable:l["a"]},data(){return{tableData:[{key:"单产品编码：",value:"planId"},{key:"单产品名称：",value:"planName"},{key:"生效时间：",value:"planStartDate"},{key:"失效时间：",value:"planEndDate"},{key:"状态：",value:"status"},{key:"产品类型：",value:"planSrvType"},{key:"资费：",value:"productCharges"},{key:"商品类型：",value:"offerType"},{key:"产商品类型：",value:"itemType"},{key:"产品业务分类：",value:"prodClassBusi"},{key:"描述：",value:"planDesc",iscolspan:!0},{key:"推荐用语：",value:"planComment",iscolspan:!0}],AdaptiveChannel:[],DetailForm:{}}},mounted(){this.getqueryDetail()},methods:{async getqueryDetail(){await Object(s["i"])(o["a"].mpapi.queryDetail,{planId:this.planId}).then(e=>{e.planName=e.planName.length>=15?e.planName.slice(0,12)+"...":e.planName,this.DetailForm=e})}}},c=n,m=(a("1cce"),a("2877")),u=Object(m["a"])(c,i,r,!1,null,"5bea6e90",null);t["a"]=u.exports},"12ed":function(e,t,a){"use strict";a("526e")},1326:function(e,t,a){},"138c":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"CrmFrom",attrs:{"label-width":"110px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-form-item",{attrs:{label:"运营位：",prop:"adivId"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},model:{value:e.CrmFrom.adivId,callback:function(t){e.$set(e.CrmFrom,"adivId",t)},expression:"CrmFrom.adivId"}},e._l(e.timeIdList,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),t("el-form-item",{attrs:{label:"外呼类型：",prop:"outCallType"}},[t("el-select",{attrs:{placeholder:"请选择外呼类型"},model:{value:e.CrmFrom.outCallType,callback:function(t){e.$set(e.CrmFrom,"outCallType",t)},expression:"CrmFrom.outCallType"}},e._l(e.callTypeList,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),t("el-form-item",{attrs:{label:"推荐用语：",prop:"markingTerm"}},[t("el-input",{attrs:{type:"textarea",maxlength:"500","show-word-limit":""},model:{value:e.CrmFrom.markingTerm,callback:function(t){e.$set(e.CrmFrom,"markingTerm",t)},expression:"CrmFrom.markingTerm"}})],1),t("el-form-item",{attrs:{label:"时机选择："}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.CrmFrom.timeId,callback:function(t){e.$set(e.CrmFrom,"timeId",t)},expression:"CrmFrom.timeId"}},e._l(e.timeIdList,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),t("el-form-item",{attrs:{label:"时间描述："}},[t("el-input",{attrs:{type:"textarea",maxlength:"240","show-word-limit":""},model:{value:e.CrmFrom.timeDistindes,callback:function(t){e.$set(e.CrmFrom,"timeDistindes",t)},expression:"CrmFrom.timeDistindes"}})],1),t("el-form-item",[t("el-button",{on:{click:e.SubInstall}},[e._v("保存当前设置")])],1)],1)],1)},r=[],l=a("0fea"),s=a("5e05");const o=s["a"].common.getSysEnum,n=s["a"].common.queryAdivInfo;var c={props:["channelId"],data(){return{CrmFrom:{},CrmFromRules:{adivId:[{required:!0,message:"请选择运营位",trigger:"blur,change"}],outCallType:[{required:!0,message:"请选择外呼类型",trigger:"blur,change"}],markingTerm:[{required:!0,message:"请输入推荐用语",trigger:"blur"}]},callTypeList:[],timeIdList:[],adivList:[]}},mounted(){this.getOptionData()},methods:{getOptionData(){Object(l["i"])(o,{enumType:"iop_time_id"}).then(e=>{this.timeIdList=e}),Object(l["i"])(o,{enumType:"E_610_OUT_CALL_TYPE"}).then(e=>{this.callTypeList=e}),Object(l["i"])(n,{channelId:this.channelId}).then(e=>{this.adivList=e})},SubInstall(){this.$refs.CrmFrom.validate(e=>{})}}},m=c,u=a("2877"),d=Object(u["a"])(m,i,r,!1,null,"f977bdd4",null);t["a"]=d.exports},"13d5":function(e,t,a){"use strict";var i=a("23e7"),r=a("d58f").left,l=a("a640"),s=a("2d00"),o=a("605d"),n=!o&&s>79&&s<83,c=n||!l("reduce");i({target:"Array",proto:!0,forced:c},{reduce:function(e){var t=arguments.length;return r(this,e,t,t>1?arguments[1]:void 0)}})},"14ea":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("Tips",{attrs:{id:e.id},on:{getChannelDetail:e.getChannelDetail}}),t("el-form",{ref:"CrmFrom",staticStyle:{width:"100%"},attrs:{"label-width":"145px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"推送方式：",prop:"columnExt1"}},[t("el-radio-group",{model:{value:e.CrmFrom.columnExt1,callback:function(t){e.$set(e.CrmFrom,"columnExt1",t)},expression:"CrmFrom.columnExt1"}},[t("el-radio",{attrs:{label:"1",disabled:!e.CrmFrom.channelFlag}},[e._v("全量推送")]),t("el-radio",{attrs:{label:"0",disabled:!e.CrmFrom.channelFlag}},[e._v("偏好推送")])],1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"标准化素材：",prop:"columnExt20"}},[t("div",{staticClass:"select-material",on:{click:function(t){return e.selectMaterial(!0)}}},[e._v(e._s(e.CrmFrom.materialName||"请选择"))])])],1),e.showExt18?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"智能话术："}},[t("el-checkbox",{on:{change:()=>e.CrmFrom.columnExt18=e.checkColumnExt18?"1":"0"},model:{value:e.checkColumnExt18,callback:function(t){e.checkColumnExt18=t},expression:"checkColumnExt18"}},[e._v("启用")]),e.checkColumnExt18?t("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt18,callback:function(t){e.$set(e.CrmFrom,"columnExt18",t)},expression:"CrmFrom.columnExt18"}},[t("el-radio",{attrs:{label:"1"}},[e._v("省端模型")]),t("el-radio",{attrs:{label:"2"}},[e._v("一级IOP模型")])],1):e._e()],1)],1):e._e(),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"营销用语：",prop:"EXEC_CONTENT"}},[t("el-input",{attrs:{id:"smsDetail",type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},model:{value:e.CrmFrom.EXEC_CONTENT,callback:function(t){e.$set(e.CrmFrom,"EXEC_CONTENT",t)},expression:"CrmFrom.EXEC_CONTENT"}})],1)],1),t("el-col",{attrs:{span:24}},[1==e.custgroupSource?t("el-form-item",{attrs:{label:"营销用语替换变量："}},[t("DNAReplaceVar",{on:{getVar:e.getContent}})],1):t("el-form-item",{attrs:{label:"营销用语替换变量：","label-width":"148px"}},e._l(e.replaceVar,(function(a){return t("el-tag",{key:a.id,attrs:{type:"info"},on:{click:function(t){return e.getContent(a.attrCol)}}},[e._v(e._s(a.attrColName))])})),1)],1)],1)],1),t("materialList",{ref:"material",attrs:{adivId:e.CrmFrom.adivInfo.adivId,channelId:e.id},on:{addMaterial:e.addMaterial}})],1)},r=[],l=a("0fea"),s=a("5e05"),o=a("f1ce"),n=a("5ed5"),c=a("6501");a("0b16");s["a"].common.getSysEnum;const m=s["a"].common.queryAdivInfo;s["a"].common.queryHallInfo;var u={props:["channelNewData","id","deleteSub"],components:{materialList:o["a"],Tips:n["a"],DNAReplaceVar:c["a"]},data(){return{CrmFrom:{adivInfo:{},channelId:"",channelName:"",attributionInfo:{},columnExt1:"1",standard:"",CustomerRules:"",marketingWords:"",columnExt2:"",columnExt3:"",columnExt4:"",columnExt18:"0",EXEC_CONTENT:"",IF_HAVE_VAR:"0"},showExt18:!1,checkColumnExt18:!1,CrmFromRules:{columnExt1:[{required:!0,message:"请选择推送方式",trigger:"blur"}],marketingWords:[{required:!0,message:"请输入营销话术",trigger:"blur"}],EXEC_CONTENT:[{required:!0,message:"请输入营销用语",trigger:"blur"}],columnExt4:[{required:!0,message:"请选择任务类型",trigger:"blur"}],adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},timeIdList:[],adivList:[],attributionList:[],replaceVar:[]}},watch:{channelNewData:{handler(){this.CrmFrom=JSON.parse(JSON.stringify(this.channelNewData)),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.checkColumnExt18=this.CrmFrom.columnExt18>0},deep:!0},CrmFrom:{handler(e,t){},deep:!0},deleteSub(){},SMS_CONTENT(e){if(e){const t=/\$[a-zA-Z0-9_\u4e00-\u9fa5]+\$/g,a=e.match(t);a&&a.length>0?this.CrmFrom.IF_HAVE_VAR="1":this.CrmFrom.IF_HAVE_VAR="0"}else this.CrmFrom.IF_HAVE_VAR="0"}},computed:{SMS_CONTENT(){return this.CrmFrom.EXEC_CONTENT},custgroupSource(){return this.$store.state.extendData.custgroupSource}},mounted(){this.getOptionData(),this.listCustAttr(),this.CrmFrom=JSON.parse(JSON.stringify(this.channelNewData)),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.checkColumnExt18=this.CrmFrom.columnExt18>0},methods:{getChannelDetail(e){1==e.smartScript&&(this.showExt18=!0)},async getOptionData(){await Object(l["i"])(m,{channelId:this.id}).then(e=>{this.adivList=e})},changeAid(e){var t="";this.adivList.forEach(a=>{e===a.adivId&&(t=a.adivName)}),this.CrmFrom.adivInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,adivName:t})},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t||("906"===this.id||"922"===this.id)&&this.CrmFrom.marketingWords&&this.CrmFrom.adivInfo.adivId?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e},async listCustAttr(){var e;const t=null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.customGroupId;await Object(l["i"])(s["a"].common.listCustAttr+"?custGroupId="+t).then(e=>{this.replaceVar=e})},getContent(e){let t="$"+e+"$";e=t,this.ShortMsgContent=e;const a=document.querySelector("#smsDetail");if(a.selectionStart||0===a.selectionStart){var i=a.selectionStart,r=a.selectionEnd;this.CrmFrom={...this.CrmFrom,EXEC_CONTENT:a.value.substring(0,i)+e+a.value.substring(r,a.value.length)},this.$nextTick(),a.focus(),a.setSelectionRange(r+e.length,r+e.length)}else this.CrmFrom.EXEC_CONTENT+=e},selectMaterial(e){this.$refs["material"].showDialog(e)},addMaterial(e){this.CrmFrom={...this.CrmFrom,columnExt20:e.materialId,materialName:e.materialName}}},created(){}},d=u,h=(a("b953"),a("2877")),p=Object(h["a"])(d,i,r,!1,null,"aeeb524e",null);t["a"]=p.exports},1501:function(e,t,a){},1567:function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("14d9"),core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__),vuex__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("2f62"),_config_ChannelJs_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("3c7a"),_Components_MpDialog_vue__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("b132"),_Components_SelectButton_vue__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("9b26"),_CrmOperationDesk_vue__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("68e8"),_MarketingCall_vue__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("138c"),_levelCall_vue__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("4cb2"),_remind_vue__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("3390"),_colorPlat_vue__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("7940"),_ShortMessage_vue__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("c88b"),_GroupHand_vue__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("2486"),_SparkAlliance_vue__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("df4d"),_SMS_vue__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("6401"),_tinyOffice_vue__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("3719"),_WX_vue__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("a3cc"),_IOPInternet_vue__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("9747"),_CustomerService_vue__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("4db8"),_DefaultItem_vue__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("7112"),_801_vue__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("9c4a"),_932_vue__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("5ac7"),_958_vue__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("43fd"),_964_vue__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("b605"),_960_vue__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__("4b54"),_910_vue__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__("ecb5"),_802_vue__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__("87ac"),_809_vue__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__("e404"),_808_vue__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__("9547"),_931_vue__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__("14ea"),_957_vue__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__("2ad0"),_924_vue__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__("7ec3"),_926_vue__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__("eafd"),_916_vue__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__("9101"),_933_vue__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__("9dc5"),_811_vue__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__("d83e"),_810_vue__WEBPACK_IMPORTED_MODULE_35__=__webpack_require__("317a"),_968_vue__WEBPACK_IMPORTED_MODULE_36__=__webpack_require__("f04e"),_967_vue__WEBPACK_IMPORTED_MODULE_37__=__webpack_require__("521b"),_969_vue__WEBPACK_IMPORTED_MODULE_38__=__webpack_require__("523c"),_970_vue__WEBPACK_IMPORTED_MODULE_39__=__webpack_require__("4a44"),_components_MarketingHistory_vue__WEBPACK_IMPORTED_MODULE_40__=__webpack_require__("5565"),_components_VerificationChannelDialog_vue__WEBPACK_IMPORTED_MODULE_41__=__webpack_require__("2014"),_804_vue__WEBPACK_IMPORTED_MODULE_42__=__webpack_require__("20d5"),_805_vue__WEBPACK_IMPORTED_MODULE_43__=__webpack_require__("0d29"),_906_vue__WEBPACK_IMPORTED_MODULE_44__=__webpack_require__("76a4"),_922_vue__WEBPACK_IMPORTED_MODULE_45__=__webpack_require__("a5b3"),_MutiplePositionComponent_vue__WEBPACK_IMPORTED_MODULE_46__=__webpack_require__("e8e4"),_config_MpNode_js__WEBPACK_IMPORTED_MODULE_47__=__webpack_require__("eced"),_api_manage__WEBPACK_IMPORTED_MODULE_48__=__webpack_require__("0fea"),_api_SeApi__WEBPACK_IMPORTED_MODULE_49__=__webpack_require__("d39c"),_api_channelApi__WEBPACK_IMPORTED_MODULE_50__=__webpack_require__("31b1");__webpack_exports__["a"]={components:{VerificationChannelDialog:_components_VerificationChannelDialog_vue__WEBPACK_IMPORTED_MODULE_41__["a"],MarketingHistory:_components_MarketingHistory_vue__WEBPACK_IMPORTED_MODULE_40__["a"],MutiplePositionComponent:_MutiplePositionComponent_vue__WEBPACK_IMPORTED_MODULE_46__["a"],MpDialog:_Components_MpDialog_vue__WEBPACK_IMPORTED_MODULE_3__["a"],SelectButton:_Components_SelectButton_vue__WEBPACK_IMPORTED_MODULE_4__["a"],CrmOperationDesk:_CrmOperationDesk_vue__WEBPACK_IMPORTED_MODULE_5__["a"],MarketingCall:_MarketingCall_vue__WEBPACK_IMPORTED_MODULE_6__["a"],levelCall:_levelCall_vue__WEBPACK_IMPORTED_MODULE_7__["a"],remind:_remind_vue__WEBPACK_IMPORTED_MODULE_8__["a"],colorPlat:_colorPlat_vue__WEBPACK_IMPORTED_MODULE_9__["a"],ShortMessage:_ShortMessage_vue__WEBPACK_IMPORTED_MODULE_10__["a"],GroupHand:_GroupHand_vue__WEBPACK_IMPORTED_MODULE_11__["a"],SparkAlliance:_SparkAlliance_vue__WEBPACK_IMPORTED_MODULE_12__["a"],SMS:_SMS_vue__WEBPACK_IMPORTED_MODULE_13__["a"],tinyOffice:_tinyOffice_vue__WEBPACK_IMPORTED_MODULE_14__["a"],WX:_WX_vue__WEBPACK_IMPORTED_MODULE_15__["a"],IOPInternet:_IOPInternet_vue__WEBPACK_IMPORTED_MODULE_16__["a"],CustomerService:_CustomerService_vue__WEBPACK_IMPORTED_MODULE_17__["a"],DefaultItem:_DefaultItem_vue__WEBPACK_IMPORTED_MODULE_18__["a"],Incoming:_804_vue__WEBPACK_IMPORTED_MODULE_42__["a"],ProductApp:_805_vue__WEBPACK_IMPORTED_MODULE_43__["a"],ServiceHall:_906_vue__WEBPACK_IMPORTED_MODULE_44__["a"],WillBuyApp:_922_vue__WEBPACK_IMPORTED_MODULE_45__["a"],ContentSMS:_801_vue__WEBPACK_IMPORTED_MODULE_19__["a"],MobileVideo:_932_vue__WEBPACK_IMPORTED_MODULE_20__["a"],PushNotification:_958_vue__WEBPACK_IMPORTED_MODULE_21__["a"],FiveCloudCard:_964_vue__WEBPACK_IMPORTED_MODULE_22__["a"],FiveMessage:_960_vue__WEBPACK_IMPORTED_MODULE_23__["a"],MessageEntrainment:_910_vue__WEBPACK_IMPORTED_MODULE_24__["a"],IVRsales:_957_vue__WEBPACK_IMPORTED_MODULE_29__["a"],OutboundMarking:_802_vue__WEBPACK_IMPORTED_MODULE_25__["a"],CustomerPass:_809_vue__WEBPACK_IMPORTED_MODULE_26__["a"],GridPass:_808_vue__WEBPACK_IMPORTED_MODULE_27__["a"],Linestore:_931_vue__WEBPACK_IMPORTED_MODULE_28__["a"],BelieveWithMe:_924_vue__WEBPACK_IMPORTED_MODULE_30__["a"],FindOneLevel:_926_vue__WEBPACK_IMPORTED_MODULE_31__["a"],MiguChannel:_916_vue__WEBPACK_IMPORTED_MODULE_32__["a"],EnterpriseWeChat:_933_vue__WEBPACK_IMPORTED_MODULE_33__["a"],OutboundForEight:_811_vue__WEBPACK_IMPORTED_MODULE_34__["a"],shortOffice:_810_vue__WEBPACK_IMPORTED_MODULE_35__["a"],GuangDianTong:_968_vue__WEBPACK_IMPORTED_MODULE_36__["a"],GovernmentEnterprise:_969_vue__WEBPACK_IMPORTED_MODULE_38__["a"],ChinaMobileApp:_967_vue__WEBPACK_IMPORTED_MODULE_37__["a"],Zhuangweisuixiao:_970_vue__WEBPACK_IMPORTED_MODULE_39__["a"]},data(){return{visible:!1,channelDetail:!1,deleteFlag:!1,filteValue:[],SelectBuList:[],editableTabsValue:"",channelFlag:null,editableTabsInfo:{},editableTabs:[],CRMFrom:{},currentView:[],channelData:[],tabState:!1,tableData:[{1:"0.00%",2:"0.00%",3:"0.00%",4:"0.00%",5:"0.00%",6:"0.00%"}],columns:[{key:"1",label:"微厅"},{key:"2",label:"集团手厅"},{key:"3",label:"掌上生产(MOP)"},{key:"4",label:"CRM前台营业厅"},{key:"5",label:"客服"},{key:"6",label:"其他"}],tableTitle:["渠道"],custimerList:[],subTitle:["数量（万）","占比"],channelDetails:{},likeList:[],deleteSub:"",buttonType:!1,showAddAdiv:!1,addBtnDisabled:!1,adivList:[],showHistoryFlag:!1,historyData:[],maskLoading:!1,showVerificationDialog:!1}},watch:{editableTabsValue(e){const t=["906","922","962","966","961","963","965"];t.includes(e.toString())?this.showAddAdiv=!0:this.showAddAdiv=!1}},computed:{...Object(vuex__WEBPACK_IMPORTED_MODULE_1__["b"])("MarkPl",["getNodeData","getCurrentList","getNode","getCurrentPerAllList"]),processData(){return this.$store.state.MarkPl.ProcessData},CurrentNode(){return this.$store.state.MarkPl.CurrentNode},SceneNodeData:function(){return this.$store.state.MarkPl.SceneNodeData},showHistoryBtn(){return this.showHistoryFlag=!1,this.editableTabs&&this.editableTabs.length>0},verificatonParmas(){var e;let t=this.editableTabs.map(e=>e.channelId).join(","),a=null===(e=this.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj.map(e=>e.customGroupId))||void 0===e?void 0:e.join(",");return{channelIds:t,custgroupId:a}},isWave(){return"3"==this.$store.state.MarkPl.ProcessData.example_type}},created(){},mounted(){},methods:{async getChannelByCust(e){var t;let a=null===(t=this.SceneNodeData[0][1])||void 0===t||null===(t=t.NodeObj[0])||void 0===t?void 0:t.customGroupId;if("JX0000000001"!==a)this.SelectBuList=e;else try{var i;let t=await Object(_api_manage__WEBPACK_IMPORTED_MODULE_48__["i"])(_api_SeApi__WEBPACK_IMPORTED_MODULE_49__["a"].seapi.getSysDics,{dicKeys:["NO_CUST_CHANNELS"]});const a=(null===(i=t[0])||void 0===i?void 0:i.split(","))||[];this.SelectBuList=e.filter(e=>a.includes(e.channelId))}catch(r){}},getChannelList(){Object(_api_manage__WEBPACK_IMPORTED_MODULE_48__["i"])(_api_SeApi__WEBPACK_IMPORTED_MODULE_49__["a"].seapi.getOnlineChannelsByUser,{onlineStatus:"1"}).then(async e=>{await this.getChannelByCust(e),await this.getCustomerLike();let t=[];for(let i in this.getNodeData)t.push(this.getNodeData[i]);if(1==t.length){const e=["906","922","962","966","961","963","965"];t.forEach(t=>{e.includes(t.channelId.toString())&&(this.showAddAdiv=!0)})}if(t.length>1){this.adivList=[];let e=[],a=[];const i=["906","922","962","966","961","963","965"];t.forEach(a=>{if(i.includes(a.channelId.toString())){this.showAddAdiv=!0;let i=t.filter(e=>e.channelId===a.channelId);i=JSON.parse(JSON.stringify(i));let r=t.findIndex(e=>e.channelId===a.channelId);this.adivList[r]=i,e.push(i)}});for(let r=0;r<t.length;r++)-1===a.findIndex(e=>e.channelId===t[r].channelId)&&a.push(t[r]);t=a}if(this.filteValue=t.filter(e=>"808"===e.channelId||"906"===e.channelId||"922"===e.channelId).map(e=>e.channelId),t.length>0){this.editableTabs=t;let e=this.editableTabs[0];this.SelectBuList.forEach(e=>{this.editableTabs.forEach(t=>{t.channelId===e.channelId&&(e.checked=!0)})}),t.map(e=>{this.currentView.push(Object(_config_ChannelJs_js__WEBPACK_IMPORTED_MODULE_2__["a"])(e.channelId))}),this.SelectBuList=JSON.parse(JSON.stringify(this.SelectBuList)),this.editableTabsValue=e.channelId}for(let i=0;i<this.editableTabs.length;i++){let e=this.editableTabs[i];var a;if(e.channelFlag=this.likeList.some(t=>t.channelId==e.channelId),!e.channelFlag)e.columnExt1=(null===(a=e.channelConf)||void 0===a||null===(a=a.channelExtConf)||void 0===a?void 0:a.columnExt1)||"1"}this.$forceUpdate()})},async getCustomerLike(){try{const e=this.SceneNodeData[0][1].NodeObj.map(e=>e.customGroupId).join(","),t=await Object(_api_manage__WEBPACK_IMPORTED_MODULE_48__["i"])(_api_SeApi__WEBPACK_IMPORTED_MODULE_49__["a"].seapi.customerLike+`?custgroupId=${e}&preLevel=1`);this.likeList=t;const a=t.map(e=>({userNum:Number(String(e.userNum/1e4).replace(/^(.*\..{4}).*$/,"$1")),userRatio:Number(String(100*e.userRatio).replace(/^(.*\..{2}).*$/,"$1"))+"%"}));let i=a.map(e=>{let t=[];for(let a in e)t.push(e[a]);return t});return t.forEach(e=>this.tableTitle.push(e.channelName)),0==i.length&&(i=[[]]),this.custimerList=i[0].map((e,t)=>[this.subTitle[t],...i.map(e=>e[t])]),this.likeList}catch(e){}},showMpDialog(){this.visible=!0,this.getChannelList()},saveChannelData(e,t){var a=this.editableTabs.map(t=>t.channelId===e.channelId?e:t);this.editableTabs=a,t&&t.forEach(e=>{let t=a.filter(t=>t.channelId==e.channelId);t.length>0?a.push(e):t.some(t=>t.adivInfo.adivId==e.adivInfo.adivId)||a.push(e)}),this.editableTabs=[...new Set(this.editableTabs)];let i=[];for(let l=this.editableTabs.length-1;l>=0;l--)for(let e=0;e<this.editableTabs.length;e++)if(l!==e&&this.editableTabs[l].channelId===this.editableTabs[e].channelId&&this.editableTabs[l].adivInfo.adivId===this.editableTabs[e].adivInfo.adivId){let t=l>e?l:e,a=l>e?e:l;i.push([t,a])}let r=[...new Set(i)];if(r.length){for(let e=this.editableTabs.length-1;e>=0;e--)r.some(t=>t[0]===e)&&this.editableTabs.splice(e,1,null);this.editableTabs=this.editableTabs.filter(e=>null!==e)}},CurrentSettings(e=!0){if(void 0===this.$refs["Component"+this.editableTabsValue])return!0;if(["808","906","922"].includes(this.editableTabsValue)){if(this.buttonType){if(this.deleteFlag)return this.$refs["Component"+this.editableTabsValue][0].SubInstall(e);{let t=[];if(0===this.filteValue.length)return this.$refs["Component"+this.editableTabsValue][0].SubInstall(e);this.filteValue.forEach(a=>{t.push(this.$refs["Component"+a][0].SubInstall(e))});const a=t.every(e=>!0===e);return a}}if(this.deleteFlag)return!0;{let t=[];if(0===this.filteValue.length)return this.$refs["Component"+this.editableTabsValue][0].SubInstall(e);this.filteValue.forEach(a=>{t.push(this.$refs["Component"+a][0].SubInstall(e))});const a=t.some(e=>1==e);return a}}return this.$refs["Component"+this.editableTabsValue][0].SubInstall(e)},async saveChannel(){let e=[];for(let i=0;i<this.editableTabs.length;i++){let t=this.$refs["Component"+this.editableTabs[i].channelId][0].SubInstall(!1);"[object Promise]"===Object.prototype.toString.call(t)&&(t=await t),e.push(t)}const t=e.every(e=>!0===e);if(t){this.maskLoading=!0;try{const e=await this.$refs.VerificationChannelDialog.getTableData();if(e.length)return this.showVerificationDialog=!0,void(this.maskLoading=!1)}catch(a){return}finally{this.maskLoading=!1}this.maskLoading=!0,this.ChannelSubmit()}else this.$alert("请先完善渠道配置项信息!","添加节点失败",{confirmButtonText:"确定",customClass:"errorPrompt"})},closeVerificationChannelDialog(e){this.showVerificationDialog=!1,e&&this.ChannelSubmit()},async ChannelSubmit(){for(let e=0;e<this.editableTabs.length;e++)this.$refs["Component"+this.editableTabs[e].channelId][0].SubInstall(!0);setTimeout(()=>{this.$nextTick(()=>{this.buttonType=!0,this.deleteSub="sub";let e=this.editableTabs.map(e=>e.channelName);for(let r of this.editableTabs){var t;if(r.channelConf.updateCycle=+r.UPDATE_CYCLE||r.channelConf.updateCycle,r.channelConf.wavesChannelPid=null,r.channelConf.wavesRuleId=null,void 0!==this.getNode.wavesRule||0!==this.getNodeData.length)r.channelConf.wavesChannelPid=this.getNode.wavePid||this.getNodeData[0].channelConf.wavesChannelPid,r.channelConf.wavesRuleId=this.getNode.wavesRule||this.getNodeData[0].channelConf.wavesRuleId,r.channelConf.wavesNoDesc=this.getNode.wavesDesc||(null===(t=this.getNodeData[0])||void 0===t||null===(t=t.channelConf)||void 0===t?void 0:t.wavesNoDesc)||""}const a={NewData:e,mutual:[],homologous:[],fuse:[],channelData:e};this.$store.commit("MarkPl/fnUpdateActiveNodeList",a),this.$store.commit("MarkPl/fuUpdateSceneNodeData",this.editableTabs),this.visible=!1,this.DialogClose();var i=JSON.parse(JSON.stringify(this.$store.state.MarkPl.ActiveNodeList));if(("3"===this.processData.example_type||"4"===this.processData.example_type)&&this.verificationNodeList(i,this.CurrentNode)<=3){if(this.SceneNodeData.length>1)return;this.$confirm("是否继续生成下级波次？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.Wavegeneration(!0)}).catch(()=>{this.Wavegeneration(!1)})}})},100)},Wavegeneration(e){var t=JSON.parse(JSON.stringify(this.$store.state.MarkPl.ActiveNodeList)),a=JSON.parse(JSON.stringify(this.$store.state.MarkPl.SceneNodeData));t=this.RecursionUpdateNodeList(t,this.CurrentNode,e),this.$store.commit("MarkPl/fnActiveNodeList",[...t]);var i=this.updateData(a,this.CurrentNode,e);this.$store.commit("MarkPl/fnSceneNodeData",[...i])},updateData(e,t,a){return e.map((i,r)=>{i.map(i=>{if(i.id===t.id){var l=e[r].filter(e=>"5"!==e.cId);a&&l.push({id:this.newCharacter.id,cId:this.newCharacter.cId,assembly:this.newCharacter.assembly,NodeObj:[]}),e[r]=l}})}),e},RecursionUpdateNodeList(NodeList,CurrentNode,isCancel){for(let index=0;index<NodeList.length;index++){for(let i=0;i<NodeList[index].group.length;i++)if(CurrentNode.id===NodeList[index].group[i].id){var newCharacter=eval("([5])"),newNodeList=NodeList[index].group.filter(e=>"5"!==e.cId),_this$editableTabs$0$;if(isCancel)this.newCharacter=Object(_config_MpNode_js__WEBPACK_IMPORTED_MODULE_47__["i"])(newCharacter),this.newCharacter.wavePid=this.editableTabs[0].channelId+"-"+((null===(_this$editableTabs$0$=this.editableTabs[0].adivInfo)||void 0===_this$editableTabs$0$?void 0:_this$editableTabs$0$.adivId)||this.editableTabs[0].channelId+"1"),newNodeList.push(this.newCharacter);return NodeList[index].group=newNodeList,NodeList[index].children=[],NodeList}null!==NodeList[index].children&&0!==NodeList[index].children.length&&this.RecursionUpdateNodeList(NodeList[index].children,CurrentNode,isCancel)}return NodeList},verificationNodeList(e,t,a=1){for(let i=0;i<e.length;i++){for(let r=0;r<e[i].group.length;r++)if(t.id===e[i].group[r].id)return a;if(null!==e[i].children&&0!==e[i].children.length)return this.RecursionUpdateNodeList(e[i].children,t,++a)}return a},DialogClose(){this.$emit("DialogClose")},TabClick(e){if(this.buttonType=!1,this.tabState){const t=["906","922","962","966","961","963","965"];if(t.includes(e.name)){const t=e.$children[0];this.addBtnDisabled=t.positionList.length===t.adivList.length}}},beforeLeave(){return this.tabState=!1,void 0===this.$refs["Component"+this.editableTabsValue]||0===this.$refs["Component"+this.editableTabsValue].length||(this.CurrentSettings(!1)?(this.tabState=!0,!0):(this.$message.error("请先完成当前渠道配置项信息"),!1))},addTab(e){this.deleteFlag=!1;const t=this.likeList.some(t=>t.channelId===e.channelId),a=["808","906","922"],i=this.editableTabs.some(e=>{let t=e.channelId;return a.includes(t)}),r=this.editableTabs.some(t=>e.channelId===t.channelId);if(!this.processData.isCheckboxChannel){let t=e.channelId;this.editableTabs=[{channelId:e.channelId,channelName:e.channelName,adivInfo:{},channelConf:{}}],this.editableTabsValue=t,this.editableTabsInfo=e,this.currentView=[Object(_config_ChannelJs_js__WEBPACK_IMPORTED_MODULE_2__["a"])(t)];const a=["801","964","960"];a.includes(e.channelId.toString())&&this.remindTip(e),this.checkChannelTabs();const i=["906","922","962","966","961","963","965"];return void(i.includes(e.channelId.toString())&&(this.showAddAdiv=!0))}if(!this.CurrentSettings(!1)){this.$message.error("请先完成当前渠道配置项信息"),e.channelId!==this.editableTabsValue&&!1===r&&(e.checked=!1);let t=e.channelId;return void(a.includes(t)&&a.includes(e.channelId)&&a.forEach(e=>{this.editableTabs.some(t=>t.channelId===e)||this.$refs["Selectbutton"].Unhighlight(e)}))}let l=this.editableTabs.filter(t=>t.channelId===e.channelId);if(l.length>0)return void(a.includes(e.channelId)&&a.forEach(e=>{this.editableTabs.some(t=>t.channelId===e)||this.$refs["Selectbutton"].Unhighlight(e)}));let s=e.channelId;if(a.includes(s))if(i)this.editableTabs.push({channelId:e.channelId,channelName:e.channelName,adivInfo:{},channelConf:{},channelFlag:t}),this.editableTabsValue=s,this.editableTabsInfo=e,this.currentView.push(Object(_config_ChannelJs_js__WEBPACK_IMPORTED_MODULE_2__["a"])(s)),a.forEach(e=>{this.editableTabs.some(t=>t.channelId===e)||this.$refs["Selectbutton"].Unhighlight(e)});else{let t=[];this.SelectBuList.forEach(e=>{"808"!==e.channelId&&"906"!==e.channelId&&"922"!==e.channelId||t.push(e)}),t=t.map(e=>(this.likeList.some(t=>e.channelId===t.channelId)?e.channelFlag=!0:e.channelFlag=!1,e)),t.forEach(e=>{this.editableTabs.push({channelId:e.channelId,channelName:e.channelName,adivInfo:{},channelConf:{},channelFlag:e.channelFlag}),this.currentView.push(Object(_config_ChannelJs_js__WEBPACK_IMPORTED_MODULE_2__["a"])(e.channelId))}),this.filteValue=t.map(e=>e.channelId),this.editableTabsValue=s,this.editableTabsInfo=e}else this.editableTabs.push({channelId:e.channelId,channelName:e.channelName,adivInfo:{},channelConf:{},channelFlag:t}),this.editableTabsValue=s,this.editableTabsInfo=e,this.currentView.push(Object(_config_ChannelJs_js__WEBPACK_IMPORTED_MODULE_2__["a"])(s));this.checkChannelTabs();const o=["801","964","960"];o.includes(e.channelId.toString())&&this.remindTip(e);const n=["906","922","962","966","961","963","965"];n.includes(e.channelId.toString())&&(this.showAddAdiv=!0)},async remindTip(e){var t;let a=null===(t=this.SceneNodeData[0][1])||void 0===t?void 0:t.NodeObj[0],i=null===a||void 0===a?void 0:a.customNum,r=null===a||void 0===a?void 0:a.updateCycle,l=1===r?"未完成部分将在次日继续推送。":"未完成部分将不再推送，次日按更新客群推送。";try{const t=await Object(_api_manage__WEBPACK_IMPORTED_MODULE_48__["i"])(_api_channelApi__WEBPACK_IMPORTED_MODULE_50__["a"].channel.queryChannelExecInfo,{channelId:e.channelId});if(t.execCapacity=t.execCapacity||0,t.execNum=t.execNum||0,t.noExecNum=t.noExecNum||0,i<=t.execCapacity-t.execNum-t.noExecNum)return;this.$message({message:`该触点当前待推送信息 ${t.noExecNum} 条，\n                        当日该触点实际还能支撑推送约 ${t.execCapacity-t.execNum} 条，\n                        如增加本策略推送任务，今日可能无法完成推送，${l}`,type:"warning",customClass:"message-remind",duration:5e3,offset:60,showClose:!0})}catch{}},showHistory(){this.historyData=[],this.showHistoryFlag=!0;for(let e=0;e<this.editableTabs.length;e++){let t={id:this.editableTabs[e].channelId,title:this.editableTabs[e].channelName,titleStyle:{color:"#2f87ec"},loading:!0,yAxis:{name:"活动数",data:[0,0,0,0,0,0]},xAxis:{name:"营销成功率",labelRotate:!0,data:["0%","(0, 20%]","(20%, 40%]","(40%, 60%]","(60%, 80%]","(80%, 100%]"]},itemClickEvent:!1};this.historyData.push(t),t.loading=!0,Object(_api_manage__WEBPACK_IMPORTED_MODULE_48__["i"])(_api_channelApi__WEBPACK_IMPORTED_MODULE_50__["a"].channel.chanAndPlanMarketingHistory,{channelId:this.editableTabs[e].channelId,planName:this.$store.state.MarkPl.ActiveNodeList[0].group[0].content}).then(e=>{for(let a of e){let e=parseInt(100*a.successRate),i=a.campsegNum+"."+e;this.$set(t.yAxis.data,Number(a.successLevel),i)}}).finally(()=>{t.loading=!1})}},closeHistoryBar(){this.showHistoryFlag=!1},removeTab(e){this.deleteSub="delete";let t=this.editableTabs;this.deleteFlag=!0;let a=this.editableTabsValue;a===e&&t.forEach((i,r)=>{if(i.channelId===e){let e=t[r+1]||t[r-1];e&&(a=e.channelId)}}),"808"!==e&&"906"!==e&&"922"!==e||(this.filteValue=this.filteValue.filter(t=>t!==e)),this.editableTabs=t.filter(t=>t.channelId!==e),this.currentView=this.editableTabs.map(e=>Object(_config_ChannelJs_js__WEBPACK_IMPORTED_MODULE_2__["a"])(e.channelId)),0===this.editableTabs.length&&(a="0"),this.editableTabsValue=a,this.$refs["Selectbutton"].Unhighlight(e)},addPosition(){this.$refs["Component"+this.editableTabsValue][0].addPosition()},closeDetail(){this.channelDetail=!1},async openDetail(e){await Object(_api_manage__WEBPACK_IMPORTED_MODULE_48__["i"])(_api_SeApi__WEBPACK_IMPORTED_MODULE_49__["a"].seapi.channelDetail,{channelId:e.channelId}).then(e=>{this.channelDetails=e,this.channelDetail=!0})},checkChannelTabs(){this.$nextTick(()=>{var e;let t=[];if(void 0!=(null===(e=this.$refs["Selectbutton"])||void 0===e?void 0:e.selectList)){for(let e=0;e<this.editableTabs.length;e++)for(let a of this.$refs["Selectbutton"].selectList)a.channelId==this.editableTabs[e].channelId&&t.push(a);for(let e of t){let t=this.$refs["Selectbutton"].selectList.findIndex(t=>t.channelId==e.channelId);this.$set(this.$refs["Selectbutton"].selectList,t,{...e,checked:!0})}this.$forceUpdate()}})}}}},"16f7":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"channelBaseDialog"},[t("mp-dialog",{attrs:{title:"策略基本信息配置",visible:e.visible,width:"700px",IsAscertain:!1},on:{"update:visible":function(t){e.visible=t},DialogClose:e.DialogClose}},[e.visible?t("div",{attrs:{slot:"Dialogcontent"},slot:"Dialogcontent"},[t("el-form",{ref:"baseFrom",staticClass:"base-form",attrs:{"label-width":"110px",model:e.baseFrom,rules:e.baseFromRules}},[t("el-form-item",{attrs:{label:"策略名称:",prop:"campsegName"}},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],model:{value:e.baseFrom.campsegName,callback:function(t){e.$set(e.baseFrom,"campsegName",t)},expression:"baseFrom.campsegName"}})],1),t("el-form-item",{attrs:{label:"投放周期:",prop:"dateList"}},[t("el-date-picker",{staticStyle:{width:"330px"},attrs:{type:"daterange","value-format":"yyyy-MM-dd HH:mm:ss",format:"yyyy-MM-dd","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},model:{value:e.baseFrom.dateList,callback:function(t){e.$set(e.baseFrom,"dateList",t)},expression:"baseFrom.dateList"}})],1),t("el-form-item",{attrs:{label:"策略描述:",prop:"campsegDesc"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.baseFrom.campsegDesc,callback:function(t){e.$set(e.baseFrom,"campsegDesc",t)},expression:"baseFrom.campsegDesc"}})],1),t("el-form-item",{attrs:{label:"专题:"}},[t("el-select",{staticStyle:{width:"230px"},attrs:{placeholder:"请选择专题"},model:{value:e.baseFrom.topicId,callback:function(t){e.$set(e.baseFrom,"topicId",t)},expression:"baseFrom.topicId"}},e._l(e.topOption,(function(e){return t("el-option",{key:e.topicId,attrs:{label:e.topicName,value:e.topicId}})})),1)],1),t("el-form-item",{attrs:{label:"营销模板:"}},[t("el-select",{staticStyle:{width:"230px"},attrs:{placeholder:"请选择营销模板"},on:{change:e.changeTemplate},model:{value:e.baseFrom.activityTemplateId,callback:function(t){e.$set(e.baseFrom,"activityTemplateId",t)},expression:"baseFrom.activityTemplateId"}},e._l(e.iopTempOption,(function(e){return t("el-option",{key:e.activityTemplateid,attrs:{label:e.activityName,value:e.activityTemplateid}})})),1)],1),t("el-form-item",{attrs:{label:"营销类型:",prop:"activityType"}},[e.baseFrom.activityTemplateId?e._e():t("el-select",{staticStyle:{width:"230px"},attrs:{placeholder:"请选择营销类型"},model:{value:e.baseFrom.activityType,callback:function(t){e.$set(e.baseFrom,"activityType",t)},expression:"baseFrom.activityType"}},e._l(e.typeOption,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1),e.baseFrom.activityTemplateId?t("el-select",{staticStyle:{width:"230px"},attrs:{placeholder:"请选择营销类型",disabled:""},model:{value:e.baseFrom.activityType,callback:function(t){e.$set(e.baseFrom,"activityType",t)},expression:"baseFrom.activityType"}},e._l(e.typeOption,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1):e._e()],1),t("el-form-item",{attrs:{label:"营销活动目标:",prop:"activityObjective"}},[e.baseFrom.activityTemplateId?e._e():t("el-select",{staticStyle:{width:"230px"},attrs:{placeholder:"请选择营销活动目标"},model:{value:e.baseFrom.activityObjective,callback:function(t){e.$set(e.baseFrom,"activityObjective",t)},expression:"baseFrom.activityObjective"}},e._l(e.targetOption,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),t("el-form-item",{attrs:{label:"策略流程数量:"}},[t("el-select",{staticStyle:{width:"230px"},attrs:{placeholder:"渠道流程"},on:{change:e.ChangeProcessNum},model:{value:e.baseFrom.processNum,callback:function(t){e.$set(e.baseFrom,"processNum",t)},expression:"baseFrom.processNum"}},[t("el-option",{attrs:{label:"全部",value:1}}),t("el-option",{attrs:{label:"多个",value:2}})],1)],1),1!==e.baseFrom.processNum?t("el-form-item",{attrs:{label:""}},[t("div",[t("el-table",{staticStyle:{width:"100%"},attrs:{"header-cell-style":{"border-bottom":"solid 1px #d2d3da"},data:e.processNumList}},[t("el-table-column",{attrs:{label:"操作",width:"50px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-checkbox",{model:{value:a.row.checked,callback:function(t){e.$set(a.row,"checked",t)},expression:"scope.row.checked"}})]}}],null,!1,4084092715)}),t("el-table-column",{attrs:{align:"center",prop:"name[0]",label:"产品","show-overflow-tooltip":!0}}),t("el-table-column",{attrs:{align:"center","show-overflow-tooltip":!0,prop:"name[1]",label:"客户群"}}),t("el-table-column",{attrs:{align:"center","show-overflow-tooltip":!0,prop:"name[2]",label:"渠道"}}),t("el-table-column",{attrs:{align:"center","show-overflow-tooltip":!0,prop:"name[3]",label:"运营位"}})],1)],1)]):e._e(),e._l(e.nextNodesList.nextNodesApprover,(function(a,i){return t("el-form-item",{key:i,attrs:{label:a.node.nodeName,rules:{required:!0,message:"审批人不能为空",trigger:"blur"},prop:"nextNodesList["+i+"].value"}},[t("el-select",{staticStyle:{width:"230px"},attrs:{placeholder:"请选择",multiple:null!==a.processVersionNum},on:{change:e.clone},model:{value:e.baseFrom.nextNodesList[i].value,callback:function(t){e.$set(e.baseFrom.nextNodesList[i],"value",t)},expression:"baseFrom.nextNodesList[index].value"}},e._l(a.approverUser,(function(e,a){return t("el-option",{key:a,attrs:{label:e.userName,value:e.userId}})})),1)],1)}))],2),t("div",{staticStyle:{"text-align":"center"}},[t("el-button",{attrs:{type:"success",size:"medium"},on:{click:e.sumbit}},[e._v(e._s(1===e.isSubmit?"提交审批":"保存草稿"))])],1)],1):e._e()])],1)},r=[],l=(a("14d9"),a("f9ae")),s=a("0fea"),o=a("b132"),n=a("f3ba"),c=a("2f62"),m=a("eced"),u=a("31b1"),d=a("5e05"),h=a("d370");const p=d["a"].common.getSysEnum,v=(n["a"].home.getDicValueByKey,u["a"].channel.getNextApprovers,u["a"].channel.queryTopics,u["a"].channel.queryIopTemplate,u["a"].channel.saveChannel,u["a"].channel.getTemplateData);var C={name:"channelBaseDialog",components:{MpDialog:o["a"]},props:{baseCampInfo:{type:Object,default:()=>({})},childrenSchemes:{type:Array,default:()=>[]}},data(){return{visible:!1,SceneNodeData:[],typeOption:[],checked:"",targetOption:[],baseFrom:{campsegName:"",dateList:[],processNum:1},baseFromRules:{campsegName:[{required:!0,message:"请输入策略名称",trigger:"blur"}],dateList:[{required:!0,message:"请选择投放周期",trigger:"blur"}],campsegDesc:[{required:!0,message:"请输入策略描述",trigger:"blur"}],activityType:[{required:!0,message:"请选择营销类型",trigger:"blur"}],activityObjective:[{required:!0,message:"请选择营销目标",trigger:"blur"}]},ProcessItemList:[],iopTempOption:[],topOption:[],approverList:[],approveUserId:{},campInfoBO:{},processNumList:[],nextNodesList:{},TemplateData:{},ApproverUser:[],isSubmit:"",pickerOptions:{disabledDate(e){return e.getTime()<Date.now()-864e5}}}},computed:{...Object(c["b"])("MarkPl",["getNodeDataId","getNodeFirstChannelData","getNodeDataIdObj"]),ActiveNodeList:function(){return this.$store.state.MarkPl.ActiveNodeList},processData(){return this.$store.state.MarkPl.ProcessData}},created(){},mounted(){},methods:{clone(){this.baseFrom=Object.assign({},this.baseFrom)},getTemlate(){if("approveFlowId"in this.baseFrom&&null!==this.baseFrom.approveFlowId){var e={approveFlowId:this.baseFrom.approveFlowId};this.getNextApprovers(e)}else Object(s["i"])(v).then(e=>{this.TemplateData=e,this.getNextApprovers(e)})},async getNextApprovers(e){var t=this.getNodeFirstChannelData("3"),a=this.getNodeDataIdObj(t.id),i=[];a.map(e=>{i.push(e.channelId)});var r={berv:e.berv,instanceId:e.approveFlowId,nodeId:"",processId:e.processId,triggerParm:{channelId:i.join(",")}};await Object(s["i"])(u["a"].channel.getNextApprovers,r).then(e=>{this.baseFrom.nextNodesList=[],e.nextNodesApprover.map(e=>{var t;this.baseFrom.nextNodesList.push({value:(null===(t=e.approverUser[0])||void 0===t?void 0:t.userId)||""})}),this.nextNodesList=e})},getOptionData(){this.SceneNodeData=this.$store.state.MarkPl.SceneNodeData,Object(s["i"])(p,{enumType:"activity_type"}).then(e=>{this.typeOption=e}),Object(s["i"])(p,{enumType:"activity_objective"}).then(e=>{this.targetOption=e}),this.processNumList=Object(m["g"])(this.SceneNodeData),"{}"!==JSON.stringify(this.baseCampInfo)?(this.baseFrom={...this.baseFrom,...this.baseCampInfo},this.baseFrom.dateList=[this.baseCampInfo.startDate,this.baseCampInfo.endDate],this.childrenSchemes.length!==this.processNumList.length&&(this.baseFrom.processNum=2),this.childrenSchemes.map(e=>{this.processNumList.map(t=>{e.data.join(",")===t.data.join(",")&&(t.checked=!0,t.campsegId=e.campsegId)})})):this.intiCampInfo()},ChangeProcessNum(){this.baseFrom.processNum=JSON.parse(JSON.stringify(this.baseFrom.processNum))},intiCampInfo(){var e=new Date(+new Date+288e5).toJSON().substr(0,19).replace("T"," ");this.baseFrom.campsegName="营销策略"+e},changeAppId(){this.approverList.forEach(e=>{(this.baseFrom.approveId=e.userId)&&(this.approveUserId.userId=e.userId,this.approveUserId.userName=e.userName)})},changeTemplate(){this.iopTempOption.forEach(e=>{(this.baseFrom.activityTemplateid=e.activityTemplateid)&&(this.baseFrom.activityType=e.activityType,this.baseFrom.activityObjective=e.activityObjective)})},save(){},DialogClose(){this.$emit("DialogClose")},sumbit:Object(l["a"])((function(){this.$refs.baseFrom.validate(async e=>{if(e){var t=JSON.parse(JSON.stringify(this.baseFrom));t.startDate=this.baseFrom.dateList[0],t.endDate=this.timeSet(this.baseFrom.dateList[1]);var a=JSON.parse(JSON.stringify(this.ActiveNodeList));t.tacticsMap=JSON.stringify(Object(m["l"])(a));var i={};if(1===this.isSubmit){var r=[];this.nextNodesList.nextNodesApprover.filter((e,t)=>{var a=this.baseFrom.nextNodesList[t],i=[];e.approverUser.map(e=>{Array.isArray(a.value)?a.value.map(t=>{t===e.userId&&i.push(e)}):a.value===e.userId&&i.push(e)}),r.push({approverUser:i,node:e.node})}),i={nodeId:this.nextNodesList.nodeId,processId:this.nextNodesList.processId,berv:this.nextNodesList.berv,submitStatus:1,instanceId:this.baseFrom.approveFlowId,nextNodesApprover:r}}var l=Object(m["k"])(this.SceneNodeData),o=[];if(1===this.baseFrom.processNum)n=this.processNumList;else var n=this.processNumList.filter(e=>e.checked);n.map(e=>{o.push({data:e.data,wavePid:e.wavePid,wavesRuleId:e.wavesRuleId})});var c={baseCampInfo:t,approveUserId:i,campSchemes:l,childrenSchemes:o,type:this.processData.example_type,isSubmit:this.isSubmit};if("4"===this.processData.example_type)this.$emit("save",c);else{var u=["策划保存草稿成功","策划提交审批成功"];try{const e=await Object(s["i"])(h["a"].mpapi.tacticsCreateSave,c);if("ERROR"===(null===e||void 0===e?void 0:e.status))return this.$alert(e.message,"操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"});this.$alert(u[this.isSubmit],"操作成功",{confirmButtonText:"确定",customClass:"successPrompt",callback:e=>{this.$router.push({path:"/MarketingPlanning/MarketingMP"})}})}catch(d){}}}})})),showMpDialog(e){this.$forceUpdate();for(let t=0;t<this.ActiveNodeList.length;t++)for(let e=0;e<this.ActiveNodeList[t].length;e++)if(""===this.ActiveNodeList[t][e].content)return void this.$alert("请完善节点信息！","配置失败",{confirmButtonText:"确定",customClass:"errorPrompt"});this.isSubmit=e,this.getOptionData(),1===this.isSubmit&&this.getTemlate(),this.visible=!0},timeSet(e){var t,a=e.replace(/-/g,"/"),i=new Date(a),r=i.getFullYear()+"-",l=(i.getMonth()+1<10?"0"+(i.getMonth()+1):i.getMonth()+1)+"-",s=(i.getDate()<10?"0"+i.getDate():i.getDate())+"  ",o="23:",n="59:",c=59;return t=r+l+s+o+n+c,t}}},b=C,f=(a("e6f1"),a("2877")),g=Object(f["a"])(b,i,r,!1,null,"e5e1ed92",null);t["a"]=g.exports},"17e3":function(e,t,a){},"180b":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{attrs:{title:"物料列表",visible:e.dialogVisible,width:"60%","append-to-body":""},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("div",[t("el-input",{staticStyle:{width:"30%"},attrs:{placeholder:"请输入搜索内容"}},[t("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},slot:"suffix"})])],1),t("el-table",{staticStyle:{width:"100%"}},[t("el-table-column",{staticStyle:{width:"30%"},attrs:{label:"物料编码"}}),t("el-table-column",{staticStyle:{width:"30%"},attrs:{label:"物料名称"}}),t("el-table-column",{staticStyle:{width:"30%"},attrs:{label:"目标地址"}})],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("确 定")])],1)],1)],1)},r=[],l={name:"GroupHandDialog",data(){return{dialogVisible:!0}},methods:{}},s=l,o=a("2877"),n=Object(o["a"])(s,i,r,!1,null,null,null);t["a"]=n.exports},1985:function(e,t,a){(function(e,i){var r;/*! https://mths.be/punycode v1.4.1 by @mathias */(function(l){t&&t.nodeType,e&&e.nodeType;var s="object"==typeof i&&i;s.global!==s&&s.window!==s&&s.self;var o,n=2147483647,c=36,m=1,u=26,d=38,h=700,p=72,v=128,C="-",b=/^xn--/,f=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,_={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=c-m,E=Math.floor,y=String.fromCharCode;function F(e){throw new RangeError(_[e])}function I(e,t){var a=e.length,i=[];while(a--)i[a]=t(e[a]);return i}function D(e,t){var a=e.split("@"),i="";a.length>1&&(i=a[0]+"@",e=a[1]),e=e.replace(g,".");var r=e.split("."),l=I(r,t).join(".");return i+l}function w(e){var t,a,i=[],r=0,l=e.length;while(r<l)t=e.charCodeAt(r++),t>=55296&&t<=56319&&r<l?(a=e.charCodeAt(r++),56320==(64512&a)?i.push(((1023&t)<<10)+(1023&a)+65536):(i.push(t),r--)):i.push(t);return i}function k(e){return I(e,(function(e){var t="";return e>65535&&(e-=65536,t+=y(e>>>10&1023|55296),e=56320|1023&e),t+=y(e),t})).join("")}function N(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:c}function S(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function L(e,t,a){var i=0;for(e=a?E(e/h):e>>1,e+=E(e/t);e>x*u>>1;i+=c)e=E(e/x);return E(i+(x+1)*e/(e+d))}function T(e){var t,a,i,r,l,s,o,d,h,b,f=[],g=e.length,_=0,x=v,y=p;for(a=e.lastIndexOf(C),a<0&&(a=0),i=0;i<a;++i)e.charCodeAt(i)>=128&&F("not-basic"),f.push(e.charCodeAt(i));for(r=a>0?a+1:0;r<g;){for(l=_,s=1,o=c;;o+=c){if(r>=g&&F("invalid-input"),d=N(e.charCodeAt(r++)),(d>=c||d>E((n-_)/s))&&F("overflow"),_+=d*s,h=o<=y?m:o>=y+u?u:o-y,d<h)break;b=c-h,s>E(n/b)&&F("overflow"),s*=b}t=f.length+1,y=L(_-l,t,0==l),E(_/t)>n-x&&F("overflow"),x+=E(_/t),_%=t,f.splice(_++,0,x)}return k(f)}function O(e){var t,a,i,r,l,s,o,d,h,b,f,g,_,x,I,D=[];for(e=w(e),g=e.length,t=v,a=0,l=p,s=0;s<g;++s)f=e[s],f<128&&D.push(y(f));i=r=D.length,r&&D.push(C);while(i<g){for(o=n,s=0;s<g;++s)f=e[s],f>=t&&f<o&&(o=f);for(_=i+1,o-t>E((n-a)/_)&&F("overflow"),a+=(o-t)*_,t=o,s=0;s<g;++s)if(f=e[s],f<t&&++a>n&&F("overflow"),f==t){for(d=a,h=c;;h+=c){if(b=h<=l?m:h>=l+u?u:h-l,d<b)break;I=d-b,x=c-b,D.push(y(S(b+I%x,0))),d=E(I/x)}D.push(y(S(d,0))),l=L(a,_,i==r),a=0,++i}++a,++t}return D.join("")}function P(e){return D(e,(function(e){return b.test(e)?T(e.slice(4).toLowerCase()):e}))}function $(e){return D(e,(function(e){return f.test(e)?"xn--"+O(e):e}))}o={version:"1.4.1",ucs2:{decode:w,encode:k},decode:T,encode:O,toASCII:$,toUnicode:P},r=function(){return o}.call(t,a,t,e),void 0===r||(e.exports=r)})()}).call(this,a("62e4")(e),a("c8ba"))},"1a65":function(e,t,a){},"1bd8":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("BaseDialog",{attrs:{title:"话术预览",visible:e.dialogVisible,width:"1000px",top:"5vh","confirm-button-text":"关 闭","show-cancel-button":!1},on:{confirm:e.close,close:e.close},scopedSlots:e._u([e.enableEvaluate&&e.form.scriptId?{key:"footerBtn",fn:function(){return[t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.evaluteVisible=!0}}},[e._v("评价")]),t("el-button",{attrs:{type:"warning",loading:e.likeLoading},on:{click:e.like}},[e._v("点赞")])]},proxy:!0}:null],null,!0)},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"label-width":"120px"}},[t("el-form-item",{attrs:{label:"话术名称："}},[e._v(" "+e._s(e.form.scriptName)+" ")]),t("el-form-item",{attrs:{label:"产品编码/名称："}},[e.form.planId?t("span",[e._v(" "+e._s(e.form.planId+" "+e.form.planName)+" ")]):e._e()]),t("el-form-item",{attrs:{label:"话术类型："}},[e._v(" "+e._s(e.form.scriptTypeName)+" ")]),t("el-form-item",{attrs:{label:"应用渠道："}},[e._v(" "+e._s(e.form.channelName)+" ")]),t("el-form-item",{attrs:{label:"运营位："}},[e._v(" "+e._s(e.form.adivName)+" ")]),"2"===e.form.scriptType?t("el-form-item",{attrs:{label:"应用地市："}},[e._v(" "+e._s(e.form.cityName)+" ")]):e._e(),t("el-form-item",{attrs:{label:"内容类型："}},[e._v(" "+e._s(e.form.contentTypeName)+" ")]),t("el-form-item",{attrs:{label:"话术内容："}},[t("MarketingWordsPreview",{attrs:{marketingWords:e.form.marketingWords||[]}})],1)],1),e.enableEvaluate?t("EvaluateDialog",{attrs:{currentRow:e.form,dialogVisible:e.evaluteVisible},on:{"update:dialogVisible":function(t){e.evaluteVisible=t},"update:dialog-visible":function(t){e.evaluteVisible=t}}}):e._e()],1)},r=[],l=a("ea45"),s=a("2102"),o=a("571b"),n=a("0ed7"),c=a("5a4a"),m=a("ac7c"),u={components:{BaseDialog:l["a"],MarketingWordsPreview:s["a"],EvaluateDialog:o["a"]},props:{dialogVisible:{type:Boolean,default:!1},id:{type:String|Number,default:""},enableEvaluate:{type:Boolean,default:!1}},watch:{dialogVisible(e){e?this.getScriptInfo():this.$nextTick(()=>{this.form={}})}},data(){return{loading:!1,form:{},evaluteVisible:!1,likeLoading:!1}},methods:{async getScriptInfo(){try{var e,t;this.loading=!0;const a=await Object(n["b"])(this.id);a.contentTypeName=null===(e=m["a"].find(e=>e.value==a.contentType))||void 0===e?void 0:e.label,a.scriptTypeName=null===(t=m["j"].find(e=>e.value==a.scriptType))||void 0===t?void 0:t.label,this.form=Object(c["c"])(a)}catch(a){this.form={}}finally{this.loading=!1}},async like(){try{this.likeLoading=!0;const e=await Object(n["c"])(this.form.scriptId);this.$message.success(e.message)}catch(e){}finally{this.likeLoading=!1}},close(){this.$emit("update:dialogVisible",!1)}}},d=u,h=(a("c0ec"),a("2877")),p=Object(h["a"])(d,i,r,!1,null,"836eb7b0",null);t["a"]=p.exports},"1c07":function(e,t,a){"use strict";a("77fd")},"1cb6":function(e,t,a){},"1cce":function(e,t,a){"use strict";a("7d49")},"1ffb":function(e,t,a){"use strict";a("9286")},2014:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"提示",visible:e.dialogVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("div",{staticClass:"tip"},[e._v("所选客群与渠道已存在执行中的活动，是否继续创建该活动？")]),t("br"),t("div",{staticClass:"info"},[e._v("正在执行中的活动信息如下：")]),t("el-table",{attrs:{data:e.tableData,stripe:""}},[t("el-table-column",{attrs:{label:"活动名称",prop:"campsegName","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"活动编号",prop:"campsegId","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-link",{on:{click:function(t){return e.gotoCamp(a.row.campsegRootId,a.row.campsegId)}}},[e._v(e._s(a.row.campsegId))])]}}])}),t("el-table-column",{attrs:{label:"渠道名称",prop:"channelName"}}),t("el-table-column",{attrs:{label:"创建人",prop:"createUserName"}})],1),t("el-pagination",{attrs:{"current-page":e.query.current,"page-size":e.query.size,"pager-count":5,layout:"total, prev, pager, next",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){return e.$emit("close",!1)}}},[e._v("否")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$emit("close",!0)}}},[e._v("是")])],1)],1)},r=[],l=a("0fea"),s=a("d370"),o={name:"VerificationChannelDialog",props:{dialogVisible:{type:Boolean,default:!1},table:{type:Array,default:()=>[]},parmas:{type:Object,default:()=>{}}},data(){return{query:{current:1,size:5},total:0,tableData:[]}},methods:{async getTableData(){const{records:e,total:t}=await Object(l["i"])(s["a"].mpapi.queryHisCamp,{...this.query,...this.parmas});return this.tableData=e,this.total=t,e},handleSizeChange(e){this.query.current=1,this.query.size=e,this.getTableData()},handleCurrentChange(e){this.query.current=e,this.getTableData()},gotoCamp(e,t){let a=e||t,i={campsegRootId:a};e&&(i.campsegId=t);const r=this.$router.resolve({path:"/MarketingPlanning/MarketingDetails",query:i});window.open(r.href,"_blank")}}},n=o,c=(a("4c98"),a("2877")),m=Object(c["a"])(n,i,r,!1,null,"47699934",null);t["a"]=m.exports},"20d5":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("Tips",{attrs:{id:e.id},on:{getChannelDetail:e.getChannelDetail}}),t("el-form",{ref:"CrmFrom",staticStyle:{width:"100%"},attrs:{"label-width":"135px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-form-item",{attrs:{label:"推送方式：",prop:"columnExt1"}},[t("el-radio-group",{model:{value:e.CrmFrom.columnExt1,callback:function(t){e.$set(e.CrmFrom,"columnExt1",t)},expression:"CrmFrom.columnExt1"}},[t("el-radio",{attrs:{label:"1",disabled:!e.CrmFrom.channelFlag}},[e._v("全量推送")]),t("el-radio",{attrs:{label:"0",disabled:!e.CrmFrom.channelFlag}},[e._v("偏好推送")])],1)],1),t("div",{staticClass:"header"},[t("el-form-item",{attrs:{label:"运营位：",prop:"adivInfo.adivId"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:e.changeAid},model:{value:e.CrmFrom.adivInfo.adivId,callback:function(t){e.$set(e.CrmFrom.adivInfo,"adivId",t)},expression:"CrmFrom.adivInfo.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1)],1),e.CrmFrom.adivInfo.adivId?t("UseScript",{ref:"useScript",attrs:{"label-width":"135px","channel-id":e.channelNewData.channelId,"channel-name":e.channelNewData.channelName,"script-id":e.CrmFrom.columnExt19,CrmFrom:e.CrmFrom},on:{change:e.changeScript}}):e._e(),e.showExt18?t("el-form-item",{attrs:{label:"智能话术："}},[t("el-checkbox",{on:{change:()=>e.CrmFrom.columnExt18=e.checkColumnExt18?"1":"0"},model:{value:e.checkColumnExt18,callback:function(t){e.checkColumnExt18=t},expression:"checkColumnExt18"}},[e._v("启用")]),e.checkColumnExt18?t("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt18,callback:function(t){e.$set(e.CrmFrom,"columnExt18",t)},expression:"CrmFrom.columnExt18"}},[t("el-radio",{attrs:{label:"1"}},[e._v("省端模型")]),t("el-radio",{attrs:{label:"2"}},[e._v("一级IOP模型")])],1):e._e()],1):e._e(),t("el-form-item",{attrs:{label:"营销用语：",prop:"columnExt2"}},[e.isStrArr?t("Face2FaceWords",{attrs:{marketingWords:e.CrmFrom.columnExt2}}):t("el-input",{ref:"wording",attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},on:{input:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt2,callback:function(t){e.$set(e.CrmFrom,"columnExt2",t)},expression:"CrmFrom.columnExt2"}})],1),t("el-form-item",{attrs:{label:"短信模板：",prop:"columnExt5"}},[t("el-input",{attrs:{maxlength:"300",type:"textarea","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},on:{input:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt5,callback:function(t){e.$set(e.CrmFrom,"columnExt5",t)},expression:"CrmFrom.columnExt5"}})],1),t("el-form-item",{attrs:{label:"客户群规则描述：",prop:"columnExt3"}},[t("el-input",{attrs:{type:"textarea",maxlength:"500","show-word-limit":"",rows:8,placeholder:"您还可以输入500个字"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleTextareaKeydown.apply(null,arguments)}},model:{value:e.CrmFrom.columnExt3,callback:function(t){e.$set(e.CrmFrom,"columnExt3",t)},expression:"CrmFrom.columnExt3"}})],1),e._e(),t("el-form-item",{attrs:{label:"活动政策：",prop:"columnExt4"}},[t("el-input",{attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleTextareaKeydown.apply(null,arguments)}},model:{value:e.CrmFrom.columnExt4,callback:function(t){e.$set(e.CrmFrom,"columnExt4",t)},expression:"CrmFrom.columnExt4"}})],1)],1)],1)},r=[],l=a("0fea"),s=a("5e05"),o=a("b893"),n=a("00b8"),c=a("f1ce"),m=a("5ed5"),u=a("98d2"),d=a("cd74");const h=s["a"].common.getSysEnum,p=s["a"].common.queryAdivInfo,v=s["a"].common.queryHallInfo;var C={props:["channelNewData","id"],components:{materialList:c["a"],Tips:m["a"],UseScript:u["a"],Face2FaceWords:d["a"]},data(){return{CrmFrom:{isOneKey:null,adivInfo:{},channelConf:{},channelId:"",channelName:"",attributionInfo:{},standard:"",CustomerRules:"",marketingWords:"",policy:"",shortInfo:"",columnExt1:"",columnExt3:"",columnExt2:"",columnExt4:"",columnExt5:"",columnExt18:"0",columnExt19:"",columnExt20:""},CrmFromRules:{isOneKey:[{required:!0,message:"是否一键办理",trigger:"change"}],columnExt1:[{required:!0,message:"请选择推送方式",trigger:"blur"}],standard:[{required:!1,message:"请选择标准化素材",trigger:"blur"}],columnExt3:[{required:!0,message:"请输入客户群规则",trigger:"blur"}],columnExt2:[{required:!0,message:"请输入营销话术",trigger:"blur"}],columnExt4:[{required:!0,message:"请输入活动政策",trigger:"blur"}],columnExt5:[{required:!0,message:"请输入短信模板",trigger:"blur"}],adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},showExt18:!1,checkColumnExt18:!1,timeIdList:[],adivList:[],attributionList:[],labelConfig:{variable:[{name:"可呼时段",value:"${1234561}"},{name:"可呼时段2",value:"${123456}3"},{name:"可呼时段3",value:"${123456}4"},{name:"可呼时段4",value:"${123456}5"},{name:"可呼时段5",value:"${14r3456}5"}],touchPoint:[{name:"可呼时段",value:"${123456}5"},{name:"可呼时段g",value:"${123456}r"},{name:"可呼时段b",value:"${123456}g"},{name:"可呼时段t",value:"${123456}b"}]},lableProp:"variable",isStrArr:!1}},watch:{channelNewData:{handler(){if(this.CrmFrom=Object(o["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.CrmFrom.columnExt19&&this.CrmFrom.columnExt2)try{this.isStrArr=this.CrmFrom.columnExt2.includes("</header>")}catch(e){}this.checkColumnExt18=this.CrmFrom.columnExt18>0},deep:!0}},created(){if(this.getOptionData(),this.CrmFrom=Object(o["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"columnExt2",this.CrmFrom.columnExt2||""),this.CrmFrom.columnExt19&&this.CrmFrom.columnExt2)try{this.isStrArr=this.CrmFrom.columnExt2.includes("</header>")}catch(e){}this.checkColumnExt18=this.CrmFrom.columnExt18>0},methods:{getChannelDetail(e){1==e.smartScript&&(this.showExt18=!0)},async getOptionData(){await Object(l["i"])(h,{enumType:"iop_time_id"}).then(e=>{this.timeIdList=e}),await Object(l["i"])(p,{channelId:this.id}).then(e=>{this.adivList=e}),await Object(l["i"])(v,{}).then(e=>{this.attributionList=e})},changeAid(e){const t=this.adivList.find(t=>t.adivId===e);this.$set(this.CrmFrom,"adivInfo",{adivId:(null===t||void 0===t?void 0:t.adivId)||"",adivName:(null===t||void 0===t?void 0:t.adivName)||""}),this.isStrArr=!1,this.CrmFrom.columnExt19="",this.CrmFrom.columnExt2="",this.CrmFrom.columnExt5="",this.$refs.useScript&&this.$nextTick(()=>{this.$refs.useScript.getScriptList()})},changeAttribution(e){var t="";this.attributionList.forEach(a=>{e===a.adivId&&(t=a.attributionName)}),this.CrmFrom.attributionInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,attributionName:t})},changeTime(){this.timeIdList.forEach(e=>{e.enumKey===this.CrmFrom.timeId&&(this.CrmFrom.timeName=e.enumValue)})},async SubInstall(){const e=!0;let t=!0;return this.$refs.CrmFrom.validate(a=>{a&&e?(this.$emit("saveChannelData",this.CrmFrom),t=!0):t=!1}),t},selectMaterial(e){this.$refs["material"].getMaterialList(),this.$refs["material"].showDialog(e)},addMaterial(e){this.CrmFrom={...this.CrmFrom,columnExt20:e.materialId,materialName:e.materialName}},addWord(e){void 0===this.CrmFrom.columnExt2&&(this.CrmFrom.columnExt2=""),this.CrmFrom.columnExt2+=e,this.$forceUpdate(),this.$refs.wording.$el.querySelector(".el-textarea__inner").focus()},handleTextareaKeydown(){let e=arguments[0];if("Enter"===e.key||"Enter"===e.code||13==e.keyCode)return e.returnValue=!1,!1},changeScript(e){if(this.CrmFrom.columnExt19=e.scriptId,!e.scriptId&&this.isStrArr)return this.$set(this.CrmFrom,"columnExt2",""),this.$set(this.CrmFrom,"columnExt5",""),void(this.isStrArr=!1);this.isStrArr=!1,e.contentType<5&&(this.isStrArr=!0),this.CrmFrom=Object(n["a"])(e,this.CrmFrom),this.$forceUpdate()}}},b=C,f=(a("854d"),a("2877")),g=Object(f["a"])(b,i,r,!1,null,"c04112ae",null);t["a"]=g.exports},2102:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"script-container"},[t("el-form",e._l(e.marketingWords,(function(a,i){var r;return t("el-form-item",{key:i,attrs:{label:e.marketingWords.length>1?a.typeName+"：":"","label-width":e.marketingWords.length>1?"100px":"10px"}},[a.list&&a.list.length?e._l(a.list,(function(a){return t("div",{key:a.name},[t("header",[e._v("【"+e._s(a.name)+"】")]),t("div",{domProps:{innerHTML:e._s(a.content)}})])})):e._e(),a.uploadType||null!==(r=a.list)&&void 0!==r&&r.length?e._e():t("span",[e._v(e._s(a.content))]),a.uploadType?[t("Upload",{attrs:{"is-view":!0,type:"1"==a.uploadType?"image":"2"==a.uploadType?"video":"3"==a.uploadType?"audio":"image"},model:{value:e.marketingWords[i],callback:function(t){e.$set(e.marketingWords,i,t)},expression:"marketingWords[i]"}}),t("div",{staticClass:"link"},[t("span",[e._v("跳转链接：")]),t("el-link",{attrs:{underline:!1,href:a.linkUrl,target:"_blank"}},[e._v(e._s(a.linkUrl))])],1)]:e._e()],2)})),1)],1)},r=[],l=a("eae4"),s={components:{Upload:l["a"]},props:{marketingWords:{type:Array,default:()=>[]}}},o=s,n=(a("327a"),a("2877")),c=Object(n["a"])(o,i,r,!1,null,"4a48a557",null);t["a"]=c.exports},"226f":function(e,t,a){},2486:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"CrmFrom",attrs:{"label-width":"100px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-form-item",{attrs:{label:"运营位：",prop:"adivId"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:e.changeAid},model:{value:e.CrmFrom.adivId,callback:function(t){e.$set(e.CrmFrom,"adivId",t)},expression:"CrmFrom.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1),t("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"物料：",prop:"material"}},[t("el-input",{staticStyle:{width:"60%"},on:{focus:e.preMaterial},model:{value:e.CrmFrom.material,callback:function(t){e.$set(e.CrmFrom,"material",t)},expression:"CrmFrom.material"}}),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:e.preview}},[e._v(" 预览 ")])],1),t("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"产品价格",prop:"proPrice"}},[t("el-input",{staticStyle:{width:"60%"},model:{value:e.CrmFrom.proPrice,callback:function(t){e.$set(e.CrmFrom,"proPrice",t)},expression:"CrmFrom.proPrice"}})],1),t("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"URL链接：",prop:"urlLink"}},[t("el-input",{staticStyle:{width:"60%"},model:{value:e.CrmFrom.urlLink,callback:function(t){e.$set(e.CrmFrom,"urlLink",t)},expression:"CrmFrom.urlLink"}})],1),t("el-form-item",{attrs:{label:"优先级：",prop:"priorityOrder"}},[t("div",{staticClass:"block"},[t("el-slider",{attrs:{"show-input":""},model:{value:e.CrmFrom.priorityOrder,callback:function(t){e.$set(e.CrmFrom,"priorityOrder",t)},expression:"CrmFrom.priorityOrder"}})],1)]),t("el-form-item",{attrs:{label:"时机选择："}},[t("el-select",{attrs:{placeholder:"请选择"},on:{click:e.changeTime},model:{value:e.CrmFrom.timeId,callback:function(t){e.$set(e.CrmFrom,"timeId",t)},expression:"CrmFrom.timeId"}},e._l(e.timeIdList,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),t("el-form-item",{attrs:{label:"时机描述："}},[t("el-input",{attrs:{type:"textarea",maxlength:"240","show-word-limit":""},model:{value:e.CrmFrom.timeDistindes,callback:function(t){e.$set(e.CrmFrom,"timeDistindes",t)},expression:"CrmFrom.timeDistindes"}})],1),t("el-form-item",[t("el-button",{on:{click:e.SubInstall}},[e._v("保存当前设置")])],1)],1),!0===e.gHandIsShow?t("group-hand-dialog"):e._e()],1)},r=[],l=a("0fea"),s=a("5e05"),o=a("180b");const n=s["a"].common.getSysEnum,c=s["a"].common.queryAdivInfo;var m={props:["channelId","channelData"],components:{GroupHandDialog:o["a"]},data(){return{CrmFrom:{adivId:null,material:null,proPrice:null,urlLink:null,priorityOrder:null,timeId:null,timeDistindes:null},CrmFromRules:{adivId:[{required:!0,message:"请选择运营位",trigger:"blur,change"}],material:[{required:!0,message:"请选择物料",trigger:"blur"}],urlLink:[{required:!0,message:"请输入URL链接",trigger:"blur"}]},timeIdList:[],adivList:[],gHandIsShow:!1}},mounted(){var e;this.CrmFrom=null!==(e=this.channelData)&&void 0!==e?e:this.CrmFrom,this.getOptionData()},methods:{getOptionData(){Object(l["i"])(c,{channelId:this.channelId}).then(e=>{this.adivList=e}),Object(l["i"])(n,{enumType:"iop_time_id"}).then(e=>{this.timeIdList=e})},changeAid(){this.adivList.forEach(e=>{(this.CrmFrom.adivId=e.adivId)&&(this.CrmFrom.adivName=e.adivName)})},changeTime(){this.timeIdList.forEach(e=>{e.enumKey===this.CrmFrom.timeId&&(this.CrmFrom.timeName=e.enumValue)})},preMaterial(){this.gHandIsShow=!this.gHandIsShow},preview(){this.$alert("没有可预览的材料",{confirmButtonText:"确定"})},SubInstall(){this.$refs.CrmFrom.validate(e=>{e&&this.$emit("saveChannelData",this.CrmFrom)})}}},u=m,d=a("2877"),h=Object(d["a"])(u,i,r,!1,null,"9ee5996c",null);t["a"]=h.exports},"28e0":function(e,t,a){"use strict";a("464a")},"297b":function(e,t,a){"use strict";a("4b36")},"2ad0":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("Tips",{attrs:{id:e.id},on:{getChannelDetail:e.getChannelDetail}}),t("div",{staticStyle:{display:"flex","justify-content":"end"}}),t("el-form",{ref:"CrmFrom",staticStyle:{width:"100%"},attrs:{"label-width":"150px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"推送方式：",prop:"columnExt1"}},[t("el-radio-group",{model:{value:e.CrmFrom.columnExt1,callback:function(t){e.$set(e.CrmFrom,"columnExt1",t)},expression:"CrmFrom.columnExt1"}},[t("el-radio",{attrs:{label:"1",disabled:!e.CrmFrom.channelFlag}},[e._v("全量推送")]),t("el-radio",{attrs:{label:"0",disabled:!e.CrmFrom.channelFlag}},[e._v("偏好推送")])],1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"运营位：",prop:"adivInfo.adivId"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:e.changeAid},model:{value:e.CrmFrom.adivInfo.adivId,callback:function(t){e.$set(e.CrmFrom.adivInfo,"adivId",t)},expression:"CrmFrom.adivInfo.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"标准化素材：",prop:"columnExt20"}},[t("div",{staticClass:"select-material",on:{click:function(t){return e.selectMaterial(!0)}}},[e._v(e._s(e.CrmFrom.materialName||"请选择"))])])],1),"9572"===e.CrmFrom.adivInfo.adivId?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"项目层级二：",prop:"columnExt6"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:e.changeProjectLevel2},model:{value:e.CrmFrom.columnExt6,callback:function(t){e.$set(e.CrmFrom,"columnExt6",t)},expression:"CrmFrom.columnExt6"}},e._l(e.projectLevel2,(function(e){return t("el-option",{key:e.id,attrs:{label:e.levelValue,value:e.id}})})),1)],1)],1):e._e(),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"营销类型：",prop:"saleType"}},[t("el-select",{attrs:{placeholder:"请选择营销类型",disabled:"9572"===e.CrmFrom.adivInfo.adivId},on:{change:e.changeSaleType},model:{value:e.CrmFrom.saleType,callback:function(t){e.$set(e.CrmFrom,"saleType",t)},expression:"CrmFrom.saleType"}},e._l(e.saleList,(function(a){return t("el-option",{key:a.value,attrs:{label:a.label,value:a.value,disabled:("10086JXVR1101IVR102"===e.CrmFrom.adivInfo.adivId||"10086JXVR1101IVR101"===e.CrmFrom.adivInfo.adivId)&&"1"===a.value}})})),1)],1)],1),"9572"===e.CrmFrom.adivInfo.adivId?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"项目层级三：",prop:"columnExt7"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:e.changeProjectLevel3},model:{value:e.CrmFrom.columnExt7,callback:function(t){e.$set(e.CrmFrom,"columnExt7",t)},expression:"CrmFrom.columnExt7"}},e._l(e.projectLevel3,(function(e){return t("el-option",{key:e.id,attrs:{label:e.levelValue,value:e.id}})})),1)],1)],1):e._e(),"1"===e.CrmFrom.saleType?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"复杂事件场景：",prop:"CEP_EVENT_ID"}},[t("div",[t("div",{staticStyle:{display:"flex","justify-content":"space-between","max-width":"375px"}},[t("div",{staticClass:"add-botton"},[t("span",{on:{click:function(t){return e.openSceneDilog(!0)}}},[e._v(e._s(e.CrmFrom.sceneParams.eventName||"添加"))]),t("i",{directives:[{name:"show",rawName:"v-show",value:e.CrmFrom.sceneParams.eventName,expression:"CrmFrom.sceneParams.eventName"}],staticClass:"el-icon-close",on:{click:e.removeEvent}})]),t("el-checkbox",{model:{value:e.CrmFrom.checked,callback:function(t){e.$set(e.CrmFrom,"checked",t)},expression:"CrmFrom.checked"}},[e._v("取消推荐规则设置")])],1),"JX0000000001"===e.customGroupId?t("div",{staticStyle:{color:"red","font-size":"12px"}},[e._v("该活动没有限定客群，触发事件即发送，请慎重选择事件！")]):e._e(),e.CrmFrom.checked?t("div",{staticClass:"select"},[t("div",{staticClass:"setRules"},[t("p",[e._v("已选择事件："+e._s(e.CrmFrom.sceneParams.eventName))])]),t("div",[t("span",[e._v("取消推荐时间：")]),t("el-select",{attrs:{placeholder:"请选择执行端口",size:"mini"},model:{value:e.CrmFrom.columnExt4,callback:function(t){e.$set(e.CrmFrom,"columnExt4",t)},expression:"CrmFrom.columnExt4"}},e._l(e.columnExt4List,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]):e._e()])])],1):e._e(),"9572"===e.CrmFrom.adivInfo.adivId?[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"营销(服务)目标客户及提取规则：",prop:"columnExt10"}},[t("el-input",{attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},model:{value:e.CrmFrom.columnExt10,callback:function(t){e.$set(e.CrmFrom,"columnExt10",t)},expression:"CrmFrom.columnExt10"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"任务描述及要求：",prop:"columnExt11","label-width":"148px"}},[t("el-input",{attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},model:{value:e.CrmFrom.columnExt11,callback:function(t){e.$set(e.CrmFrom,"columnExt11",t)},expression:"CrmFrom.columnExt11"}})],1)],1)]:e._e(),e.showExt18?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"智能话术："}},[t("el-checkbox",{on:{change:()=>e.CrmFrom.columnExt18=e.checkColumnExt18?"1":"0"},model:{value:e.checkColumnExt18,callback:function(t){e.checkColumnExt18=t},expression:"checkColumnExt18"}},[e._v("启用")]),e.checkColumnExt18?t("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt18,callback:function(t){e.$set(e.CrmFrom,"columnExt18",t)},expression:"CrmFrom.columnExt18"}},[t("el-radio",{attrs:{label:"1"}},[e._v("省端模型")]),t("el-radio",{attrs:{label:"2"}},[e._v("一级IOP模型")])],1):e._e()],1)],1):e._e(),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"营销话术：",prop:"columnExt2"}},[t("el-input",{attrs:{id:"smsDetail",type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},model:{value:e.CrmFrom.columnExt2,callback:function(t){e.$set(e.CrmFrom,"columnExt2",t)},expression:"CrmFrom.columnExt2"}})],1)],1),t("el-col",{attrs:{span:24}},[1==e.custgroupSource?t("el-form-item",{attrs:{label:"营销用语替换变量："}},[t("DNAReplaceVar",{on:{getVar:e.getContent}})],1):t("el-form-item",{attrs:{label:"营销话术变量："}},e._l(e.replaceVar,(function(a){return t("el-tag",{key:a.id,attrs:{type:"info"},on:{click:function(t){return e.getContent(a.attrCol)}}},[e._v(e._s(a.attrColName))])})),1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"IVR营销音：",prop:"columnExt5"}},[t("el-input",{attrs:{id:"smsDetail2",type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},model:{value:e.CrmFrom.columnExt5,callback:function(t){e.$set(e.CrmFrom,"columnExt5",t)},expression:"CrmFrom.columnExt5"}})],1)],1),t("el-col",{attrs:{span:24}},[1==e.custgroupSource?t("el-form-item",{attrs:{label:"IVR营销音变量："}},[t("DNAReplaceVar",{on:{getVar:e.getContent2}})],1):t("el-form-item",{attrs:{label:"IVR营销音变量："}},e._l(e.replaceVar,(function(a){return t("el-tag",{key:a.id,attrs:{type:"info"},on:{click:function(t){return e.getContent2(a.attrCol)}}},[e._v(e._s(a.attrColName))])})),1)],1),1!=e.custgroupSource?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"发送周期：",prop:"UPDATE_CYCLE"}},[t("div",{staticStyle:{display:"flex",width:"100px"}},[t("el-tag",{attrs:{type:"1"===e.CrmFrom.UPDATE_CYCLE?"":"info"},on:{click:function(t){return e.getTags("1")}}},[e._v("一次性")]),1!==e.updateCycle?t("el-tag",{staticStyle:{"margin-left":"10px"},attrs:{type:"0"===e.CrmFrom.UPDATE_CYCLE?"":"info"},on:{click:function(t){return e.getTags("0")}}},[e._v("周期性")]):e._e()],1)])],1):e._e(),1!==e.updateCycle&&0==e.CrmFrom.UPDATE_CYCLE||1==e.custgroupSource?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"频次配置：",prop:e.CrmFrom.FREQUENCY?"num":"FREQUENCY"}},[t("div",{staticStyle:{display:"flex"}},[t("el-select",{attrs:{placeholder:"请选择天数"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.FREQUENCY,callback:function(t){e.$set(e.CrmFrom,"FREQUENCY",t)},expression:"CrmFrom.FREQUENCY"}},e._l(e.dateList,(function(e){return t("el-option",{key:e.cycleId,attrs:{label:e.cycleName,value:e.cycle}})})),1),t("el-input",{staticStyle:{width:"100px",margin:"0px 20px"},attrs:{type:"text",rows:8,placeholder:""},on:{input:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.num,callback:function(t){e.$set(e.CrmFrom,"num",t)},expression:"CrmFrom.num"}}),e._v("次 ")],1)])],1):e._e()],2)],1),t("ShortMessageList",{ref:"messageList",attrs:{tableData:e.tableData,cols:e.cols,channelId:e.id},on:{getSmsContentTemplateList:e.getSmsContentTemplateList,addShortMessage:e.addShortMessage}}),t("ChainedDialog",{ref:"chainedDialog"}),t("ComplexScene",{ref:"SceneDialog",on:{addScene:e.addScene}}),t("materialList",{ref:"material",attrs:{channelId:e.id,adivId:e.CrmFrom.adivInfo.adivId},on:{addMaterial:e.addMaterial}})],1)},r=[],l=a("0fea"),s=a("5e05"),o=(a("0b16"),a("c3eb")),n=a("006c"),c=a("aedd"),m=a("b893"),u=a("f1ce"),d=a("5ed5"),h=a("6501");const p=s["a"].common.getSysEnum,v=s["a"].common.queryAdivInfo,C=s["a"].common.queryHallInfo;var b={props:["channelNewData","id","deleteSub"],components:{ShortMessageList:o["a"],ChainedDialog:n["a"],ComplexScene:c["a"],materialList:u["a"],Tips:d["a"],DNAReplaceVar:h["a"]},data(){return{CrmFrom:{adivInfo:{},channelId:"",channelName:"",attributionInfo:{},columnExt1:"1",columnExt2:"",columnExt3:"0",columnExt4:"7",columnExt5:"",columnExt6:"",columnExt7:"",columnExt8:"",columnExt9:"",columnExt10:"",columnExt11:"",columnExt12:"",columnExt13:"",columnExt14:"",columnExt15:"",columnExt18:"",columnExt19:"",columnExt20:"",standard:"",CustomerRules:"",marketingWords:"",UPDATE_CYCLE:"",FREQUENCY:"",num:"",CEP_EVENT_ID:"",CEP_SCENE_NAME:"",IF_HAVE_VAR:"0",showScene:!1,checked:Boolean,saleType:""},showExt18:!1,checkColumnExt18:!1,CrmFromRules:{columnExt1:[{required:!0,message:"请选择推送方式",trigger:"blur"}],saleType:[{required:!0,message:"请选择营销类型",trigger:"change"}],marketingWords:[{required:!0,message:"请输入营销话术",trigger:"blur"}],CEP_EVENT_ID:[{required:!0,message:"请选择发送周期",trigger:"blur"}],UPDATE_CYCLE:[{required:!0,message:"请选择发送周期",trigger:"change"}],FREQUENCY:[{required:!0,message:"请选择频次配置",trigger:"blur"}],num:[{required:!0,message:"请填写次数",trigger:"blur"}],columnExt2:[{required:!0,message:"请输入营销话术",trigger:"blur"}],columnExt5:[{required:!0,message:"请输入IVR营销音",trigger:"blur"}],columnExt6:[{required:!0,message:"请选择项目层级二",trigger:"blur"}],columnExt7:[{required:!0,message:"请选择项目层级三",trigger:"blur"}],columnExt10:[{required:!0,message:"请输入营销(服务)目标客群提取规则",trigger:"blur"}],columnExt11:[{required:!0,message:"请输入任务描述及要求",trigger:"blur"}],adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},timeIdList:[],adivList:[],attributionList:[],tableData:[],cols:[{label:"模板编号",props:"id"},{label:"模板内容",props:"content"}],dateList:[],sceneParams:{eventName:""},replaceVar:[],columnExt4List:[{label:"1天",value:"1"},{label:"2天",value:"2"},{label:"3天",value:"3"},{label:"4天",value:"4"},{label:"5天",value:"5"},{label:"6天",value:"6"},{label:"7天",value:"7"}],saleList:[{label:"实时营销",value:"1"},{label:"批量营销",value:"2"}],projectLevel2:[],projectLevel3:[]}},computed:{updateCycle(){var e;return null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.updateCycle},customGroupId(){var e;return null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.customGroupId},custgroupSource(){return this.$store.state.extendData.custgroupSource},SMS_CONTENT(){return this.CrmFrom.columnExt2},columnExt5(){return this.CrmFrom.columnExt5},checked(){return this.CrmFrom.checked},saleTypes(){return this.CrmFrom.saleType},custgroupSource(){return this.$store.state.extendData.custgroupSource}},watch:{channelNewData:{handler(){this.CrmFrom=Object(m["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"columnExt4",this.CrmFrom.columnExt4||"7"),this.$set(this.CrmFrom,"sceneParams",this.CrmFrom.sceneParams||{eventName:""}),"9572"===this.CrmFrom.adivInfo.adivId&&(this.getProjectLevelList(this.CrmFrom.adivInfo.adivId,2),this.getProjectLevelList(this.CrmFrom.columnExt6,3)),this.checkColumnExt18=this.CrmFrom.columnExt18>0},deep:!0},deleteSub(){},checked(e){this.CrmFrom=e?{...this.CrmFrom,columnExt3:"1"}:{...this.CrmFrom,columnExt3:"0"}},SMS_CONTENT(e){let t=e+this.columnExt5;const a=/\$[a-zA-Z0-9_\u4e00-\u9fa5]+\$/g,i=t.match(a);i&&i.length>0?this.CrmFrom.IF_HAVE_VAR="1":this.CrmFrom.IF_HAVE_VAR="0"},columnExt5(e){let t=e+this.SMS_CONTENT;const a=/\$[a-zA-Z0-9_\u4e00-\u9fa5]+\$/g,i=t.match(a);i&&i.length>0?this.CrmFrom.IF_HAVE_VAR="1":this.CrmFrom.IF_HAVE_VAR="0"},saleTypes(e){"2"===e&&(this.CrmFrom={...this.CrmFrom,CEP_SCENE_NAME:"",CEP_EVENT_ID:"",sceneParams:{eventName:""},checked:!1})}},created(){this.getOptionData(),this.getDateList(),this.listCustAttr(),this.CrmFrom=Object(m["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"columnExt4",this.CrmFrom.columnExt4||"7"),this.$set(this.CrmFrom,"sceneParams",this.CrmFrom.sceneParams||{eventName:""}),"9572"===this.CrmFrom.adivInfo.adivId&&(this.getProjectLevelList(this.CrmFrom.adivInfo.adivId,2),this.getProjectLevelList(this.CrmFrom.columnExt6,3)),this.checkColumnExt18=this.CrmFrom.columnExt18>0},methods:{getChannelDetail(e){1==e.smartScript&&(this.showExt18=!0)},async getOptionData(){await Object(l["i"])(p,{enumType:"iop_time_id"}).then(e=>{this.timeIdList=e}),await Object(l["i"])(v,{channelId:this.id}).then(e=>{this.adivList=e}),await Object(l["i"])(C,{}).then(e=>{this.attributionList=e})},changeAid(e){const t=this.adivList.find(t=>t.adivId===e)||{adivId:"",adivName:""};this.CrmFrom.adivInfo={adivId:t.adivId,adivName:t.adivName},"9572"===e?(this.getProjectLevelList(e,2),this.$set(this.CrmFrom,"saleType","1"),this.CrmFrom.columnExt6="",this.CrmFrom.columnExt7="",this.CrmFrom.columnExt8="",this.CrmFrom.columnExt9="",this.CrmFrom.columnExt12="",this.CrmFrom.columnExt13="",this.CrmFrom.columnExt14="",this.CrmFrom.columnExt15=""):(this.$set(this.CrmFrom,"saleType",""),this.CrmFrom.columnExt6="",this.CrmFrom.columnExt7="",this.CrmFrom.columnExt8="",this.CrmFrom.columnExt9="",this.CrmFrom.columnExt10="",this.CrmFrom.columnExt11="",this.CrmFrom.columnExt12="",this.CrmFrom.columnExt13="",this.CrmFrom.columnExt14="",this.CrmFrom.columnExt15=""),this.$forceUpdate()},async getProjectLevelList(e,t=2){const a={parentId:e,levelType:2===t?"iop_projectLevel2_id":"iop_projectLevel3_actual_id"};try{const e=await Object(l["i"])(s["a"].common.getProject,a);2===t?this.projectLevel2=e:this.projectLevel3=e}catch(i){}},changeProjectLevel2(e){const t=this.projectLevel2.find(t=>t.id===e)||{id:"",levelValue:"",levelKey:""};this.CrmFrom.columnExt8=t.levelValue,this.getProjectLevelList(t.id,3),this.CrmFrom.columnExt14=t.levelKey,this.CrmFrom.columnExt7="",this.CrmFrom.columnExt9="",this.CrmFrom.columnExt12="",this.CrmFrom.columnExt13="",this.CrmFrom.columnExt15=""},changeProjectLevel3(e){const t=this.projectLevel3.find(t=>t.id===e)||{id:"",levelValue:""};this.CrmFrom.columnExt9=t.levelValue,this.CrmFrom.columnExt12=t.taskTypeId,this.CrmFrom.columnExt13=t.taskTypeName,this.CrmFrom.columnExt15=t.levelKey},changeSaleType(e){this.$set(this.CrmFrom,"saleType",e),this.removeEvent(),this.CrmFrom.checked=!1},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t||("906"===this.id||"922"===this.id)&&this.CrmFrom.marketingWords&&this.CrmFrom.adivInfo.adivId?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e},openDilog(e){this.$refs["messageList"].showDialog(e)},addShortMessage(e){this.CrmFrom={...this.CrmFrom,marketingWords:e.row.content}},async getSmsContentTemplateList(e){await Object(l["i"])(s["a"].common.getSmsContentTemplateList,e).then(e=>{e.width=570,this.tableData=e})},openChainedDilog(e){this.$refs["chainedDialog"].showDialog(e)},openSceneDilog(e){this.$refs["SceneDialog"].showDialog(e)},addScene(e){this.CrmFrom={...this.CrmFrom,CEP_EVENT_ID:e.eventId,CEP_SCENE_NAME:e.eventName,sceneParams:e}},removeEvent(){this.CrmFrom.sceneParams={eventName:""},this.CrmFrom.CEP_EVENT_ID="",this.CrmFrom.CEP_SCENE_NAME=""},getTags(e){this.CrmFrom={...this.CrmFrom,UPDATE_CYCLE:e},0==e&&(this.CrmFrom.FREQUENCY=null,this.CrmFrom.num=""),this.$forceUpdate()},async getDateList(){await Object(l["i"])(s["a"].common.getDateList).then(e=>{this.dateList=e})},async listCustAttr(){var e;const t=null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.customGroupId;await Object(l["i"])(s["a"].common.listCustAttr+"?custGroupId="+t).then(e=>{this.replaceVar=e})},getContent(e){let t="$"+e+"$";e=t,this.ShortMsgContent=e;const a=document.querySelector("#smsDetail");if(a.selectionStart||0===a.selectionStart){var i=a.selectionStart,r=a.selectionEnd;this.CrmFrom={...this.CrmFrom,columnExt2:a.value.substring(0,i)+e+a.value.substring(r,a.value.length)},this.$nextTick(),a.focus(),a.setSelectionRange(r+e.length,r+e.length)}else this.CrmFrom.columnExt2+=e},getContent2(e){let t="$"+e+"$";e=t,this.ShortMsgContent=e;const a=document.querySelector("#smsDetail2");if(a.selectionStart||0===a.selectionStart){var i=a.selectionStart,r=a.selectionEnd;this.CrmFrom={...this.CrmFrom,columnExt5:a.value.substring(0,i)+e+a.value.substring(r,a.value.length)},this.$nextTick(),a.focus(),a.setSelectionRange(r+e.length,r+e.length)}else this.CrmFrom.columnExt5+=e},selectMaterial(e){this.$refs["material"].getMaterialList(),this.$refs["material"].showDialog(e)},addMaterial(e){this.CrmFrom={...this.CrmFrom,columnExt20:e.materialId,materialName:e.materialName}}}},f=b,g=(a("2e11"),a("2877")),_=Object(g["a"])(f,i,r,!1,null,"6031f131",null);t["a"]=_.exports},"2adc":function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("14d9"),core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__),_Components_ActiveNode__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("649d"),_config_MpNode_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("eced"),_channelBaseDialog_vue__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("16f7"),_ChoChannel_ChannelDialog_vue__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("6706"),_ChoCustomer_customerDialog_vue__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("5c12"),_ChoMultiwave_MultiwaveDialog_vue__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("c675"),_ChoProduct_ProductDialog__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("7ede"),_strategyInfo_vue__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("c144"),_newChannelBaseDialog_vue__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("b2cc");__webpack_exports__["a"]={props:{MultiwaveList:{type:Object,default:()=>[]},CampInfo:{type:Object,default:()=>({})}},data(){return{Componentstate:{productDialog:!1,customerDialog:!1,channelDialog:!1,multiwaveDdialog:!1},chBaseDdialog:!1,baseCampInfo:{},childrenSchemes:[],componentKey:1,drawer:!1,newBaseDialog:!1,approveInfo:!1,newActiveNodeList:[]}},mounted(){this.$store.commit("MarkPl/fnActiveNodeList",[]),this.$store.commit("MarkPl/fnSceneNodeData",[]),this.ActiveNodeCase(),this.newActiveNodeList=this.ActiveNodeList},computed:{ActiveNodeList:function(){return this.$store.state.MarkPl.ActiveNodeList},SceneNodeData:function(){return this.$store.state.MarkPl.SceneNodeData}},watch:{ActiveNodeList(e,t){this.newActiveNodeList=this.ActiveNodeList},newActiveNodeList:{handler(e,t){},deep:!0}},methods:{nodeSave(e){this.componentKey++,this.approveInfo=e,this.$nextTick().then(()=>{this.DialogClose(),this.stratgeClose(!0)})},ActiveNodeCase(){if("campId"in this.$route.query){this.baseCampInfo=this.CampInfo.baseCampInfo,this.childrenSchemes=this.CampInfo.childrenSchemes;let pChannle=this.CampInfo.campSchemes[0].channels[0],wavePid="",multiwaveDataList=[],waveDesc=[];if(pChannle.channelConf.wavesNo||pChannle.channelConf.wavesNoDesc){var _pChannle$adivInfo;wavePid=pChannle.channelConf.wavesChannelPid||pChannle.channelId+"-"+((null===(_pChannle$adivInfo=pChannle.adivInfo)||void 0===_pChannle$adivInfo?void 0:_pChannle$adivInfo.adivId)||pChannle.channelId+"1");let e=JSON.parse(JSON.stringify(this.CampInfo.campSchemes));e.shift(),e.forEach(e=>{let t=e.channels[0];multiwaveDataList.push(t.channelConf.wavesRuleId||null),waveDesc.push(t.channelConf.wavesNoDesc)})}this.$store.commit("MarkPl/fnActiveNodeList",Object(_config_MpNode_js__WEBPACK_IMPORTED_MODULE_2__["j"])(eval(""+this.baseCampInfo.tacticsMap),wavePid,multiwaveDataList,waveDesc));let campSchemes=this.CampInfo.campSchemes;for(let e=0;e<campSchemes.length;e++){var _this$CampInfo$planEx,_this$CampInfo$planEx2,_this$CampInfo$planEx3,_campSchemes$i$channe;campSchemes[e].product=this.CampInfo.campSchemes[e].product.map(e=>({...e,flag:"product"})),null===(_this$CampInfo$planEx=this.CampInfo.planExtInfoList[e])||void 0===_this$CampInfo$planEx||null===(_this$CampInfo$planEx=_this$CampInfo$planEx.campExclusivePlan)||void 0===_this$CampInfo$planEx||_this$CampInfo$planEx.forEach(t=>{campSchemes[e].product.push({...t,flag:"mutual"})}),null===(_this$CampInfo$planEx2=this.CampInfo.planExtInfoList[e])||void 0===_this$CampInfo$planEx2||null===(_this$CampInfo$planEx2=_this$CampInfo$planEx2.campFusionPlans)||void 0===_this$CampInfo$planEx2||_this$CampInfo$planEx2.forEach(t=>{campSchemes[e].product.push({...t,flag:"fuse"})}),null===(_this$CampInfo$planEx3=this.CampInfo.planExtInfoList[e])||void 0===_this$CampInfo$planEx3||null===(_this$CampInfo$planEx3=_this$CampInfo$planEx3.campSeriesPlan)||void 0===_this$CampInfo$planEx3||_this$CampInfo$planEx3.forEach(t=>{campSchemes[e].product.push({...t,flag:"homologous"})}),campSchemes[e].channels[0].marketingWords=(null===(_campSchemes$i$channe=campSchemes[e].channels[0].channelConf)||void 0===_campSchemes$i$channe?void 0:_campSchemes$i$channe.execContent)||"",campSchemes[e].customer[0].customerFlag=!0}var activeNodeList=Object(_config_MpNode_js__WEBPACK_IMPORTED_MODULE_2__["b"])(this.ActiveNodeList,campSchemes);this.$store.commit("MarkPl/fnSceneNodeData",activeNodeList)}else this.$store.commit("MarkPl/fnActiveNodeList",Object(_config_MpNode_js__WEBPACK_IMPORTED_MODULE_2__["j"])(eval("("+this.MultiwaveList.new_example_content+")"))),this.$store.commit("MarkPl/fnSceneNodeData",Object(_config_MpNode_js__WEBPACK_IMPORTED_MODULE_2__["e"])(this.ActiveNodeList))},NodeClick(e){if(this.SceneNodeData[0][1].NodeObj.length||"3"!==e.cId)if(this.SceneNodeData[0][0].NodeObj.length||"2"!==e.cId){this.$store.commit("MarkPl/fnCurrentNode",e);let t=Object(_config_MpNode_js__WEBPACK_IMPORTED_MODULE_2__["c"])(this.ActiveNodeList,e);if(t)return void this.$alert(`请先${t.label}！`,"配置失败",{confirmButtonText:"确定",customClass:"errorPrompt"});this.Componentstate[e.assembly]=!0,this.$nextTick().then(()=>{this.$refs[e.assembly].showMpDialog()})}else this.$alert("请先选择产品！","配置失败",{confirmButtonText:"确定",customClass:"errorPrompt"});else this.$alert("请先选择客户群！","配置失败",{confirmButtonText:"确定",customClass:"errorPrompt"})},DialogClose(){const e=this.ActiveNodeList.map(e=>{let t=e.group.map(e=>({...e,checked:""!==e.content}));return{...e,group:t}});this.$set(this.newActiveNodeList,0,e[0]);var t=this.$store.state.MarkPl.CurrentNode;this.Componentstate[t.assembly]=!1;let a=!(!t.wavePid&&!t.wavesRule);if(t.cId<3&&!a){const e=this.ActiveNodeList[0].group[t.cId-0];this.NodeClick(e)}},stratgeClose(e){this.componentKey++,this.newBaseDialog=e,this.$nextTick().then(()=>{this.$refs.newBaseDdialog.showMpDialog()})},DialogClosebase(){this.chBaseDdialog=!1},newDialogCloseBase(){this.newBaseDialog=!1},initialization(e){this.NormalEcho(e.campSchemes)},NormalEcho(e){var t=Object.assign([],this.ActiveNodeList),a=Object.assign([],this.$store.state.MarkPl.SceneNodeData);t.map((t,i)=>{t.map((t,r)=>{switch(t.assembly){case"productDialog":t.content=Object(_config_MpNode_js__WEBPACK_IMPORTED_MODULE_2__["h"])(this.processName(e[r].product,"planName")),a[i][r].NodeObj=e[r].product;break;case"customerDialog":t.content=Object(_config_MpNode_js__WEBPACK_IMPORTED_MODULE_2__["h"])(this.processName(e[r].customer,"customGroupName")),a[i][r].NodeObj=e[r].customer;break;case"channelDialog":t.content=Object(_config_MpNode_js__WEBPACK_IMPORTED_MODULE_2__["h"])(this.processName(e[r].channels,"channelName")),a[i][r].NodeObj=e[r].channels;break}})})},processName(e,t){return e.map(e=>e[t])}},components:{ProductDialog:_ChoProduct_ProductDialog__WEBPACK_IMPORTED_MODULE_7__["a"],CustomerDialog:_ChoCustomer_customerDialog_vue__WEBPACK_IMPORTED_MODULE_5__["a"],ChannelDialog:_ChoChannel_ChannelDialog_vue__WEBPACK_IMPORTED_MODULE_4__["a"],MultiwaveDialog:_ChoMultiwave_MultiwaveDialog_vue__WEBPACK_IMPORTED_MODULE_6__["a"],ActiveNode:_Components_ActiveNode__WEBPACK_IMPORTED_MODULE_1__["a"],ChannelBaseDialog:_channelBaseDialog_vue__WEBPACK_IMPORTED_MODULE_3__["a"],StrategyInfo:_strategyInfo_vue__WEBPACK_IMPORTED_MODULE_8__["a"],newChannelBaseDialog:_newChannelBaseDialog_vue__WEBPACK_IMPORTED_MODULE_9__["a"]}}},"2d81":function(e,t,a){},"2e11":function(e,t,a){"use strict";a("6141")},"2ec7":function(e,t,a){"use strict";a("6034")},3074:function(e,t,a){"use strict";a("39dd")},3175:function(e,t,a){},"317a":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("Tips",{attrs:{id:e.id},on:{getChannelDetail:e.getChannelDetail}}),t("el-form",{ref:"CrmFrom",attrs:{"label-width":"150px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-form-item",{attrs:{label:"推送方式：",prop:"columnExt1"}},[t("el-radio-group",{model:{value:e.CrmFrom.columnExt1,callback:function(t){e.$set(e.CrmFrom,"columnExt1",t)},expression:"CrmFrom.columnExt1"}},[t("el-radio",{attrs:{label:"1",disabled:!e.CrmFrom.channelFlag}},[e._v("全量推送")]),t("el-radio",{attrs:{label:"0",disabled:!e.CrmFrom.channelFlag}},[e._v("偏好推送")])],1)],1),e.showExt18?t("el-form-item",{attrs:{label:"智能话术："}},[t("el-checkbox",{on:{change:()=>e.CrmFrom.columnExt18=e.checkColumnExt18?"1":"0"},model:{value:e.checkColumnExt18,callback:function(t){e.checkColumnExt18=t},expression:"checkColumnExt18"}},[e._v("启用")]),e.checkColumnExt18?t("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt18,callback:function(t){e.$set(e.CrmFrom,"columnExt18",t)},expression:"CrmFrom.columnExt18"}},[t("el-radio",{attrs:{label:"1"}},[e._v("省端模型")]),t("el-radio",{attrs:{label:"2"}},[e._v("一级IOP模型")])],1):e._e()],1):e._e(),t("el-form-item",{attrs:{label:"推荐用语：",prop:"EXEC_CONTENT"}},[t("el-input",{attrs:{type:"textarea",rows:4,maxlength:"500","show-word-limit":""},model:{value:e.CrmFrom.EXEC_CONTENT,callback:function(t){e.$set(e.CrmFrom,"EXEC_CONTENT",t)},expression:"CrmFrom.EXEC_CONTENT"}})],1)],1)],1)},r=[],l=a("0fea"),s=a("5e05"),o=a("b893"),n=(a("57d8"),a("9044"),a("5ed5"));const c=s["a"].common.getSysEnum;var m={components:{Tips:n["a"]},props:["channelNewData","id"],data(){return{CrmFrom:{adivInfo:{adivId:"8101"},channelConf:{},channelId:"",channelName:"",EXEC_CONTENT:"",columnExt18:"0"},showExt18:!1,checkColumnExt18:!1,CrmFromRules:{adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},EXEC_CONTENT:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],priorityOrder:[{required:!0,message:"请输入优先等级",trigger:"blur"}],ceshi:[{required:!0,message:"请输入优先等级",trigger:"blur"}]}},timeIdList:[],adivList:[],isadivInfo:!1}},watch:{channelNewData:{handler(){this.CrmFrom=Object(o["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.checkColumnExt18=this.CrmFrom.columnExt18>0,this.CrmFrom.adivInfo.adivId="8101",this.isadivInfo=!0},deep:!0}},mounted(){this.getOptionData(),this.CrmFrom=Object(o["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.checkColumnExt18=this.CrmFrom.columnExt18>0,this.CrmFrom.adivInfo.adivId="8101",this.isadivInfo=!0},methods:{getChannelDetail(e){1==e.smartScript&&(this.showExt18=!0)},async getOptionData(){await Object(l["i"])(c,{enumType:"iop_time_id"}).then(e=>{this.timeIdList=e})},getConfiguration(e){1!==e.zt&&(this.CrmFrom.channelConf={priorityOrder:0,channelExtConf:{}}),this.$refs.configurationSheet.lookSchedulingInfo(e.configid)},changeAid(e){var t="";this.adivList.forEach(a=>{e===a.adivId&&(t=a.adivName)}),this.CrmFrom.adivInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,adivName:t})},changeTime(){this.timeIdList.forEach(e=>{e.enumKey===this.CrmFrom.timeId&&(this.CrmFrom.timeName=e.enumValue)})},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e},configGsheet(e){this.CrmFrom.channelConf.channelExtConf=Object.assign(this.CrmFrom.channelConf.channelExtConf,e),this.CrmFrom=JSON.parse(JSON.stringify(this.CrmFrom))}},created(){}},u=m,d=a("2877"),h=Object(d["a"])(u,i,r,!1,null,"0e15928f",null);t["a"]=h.exports},3193:function(e,t,a){},"31b1":function(e,t,a){"use strict";const i="/plan-svc/api/action",r="/plan-svc/action",l="/approve-svc/",s="/element-svc/";t["a"]={channel:{queryIopTemplate:i+"/tactics/tacticsCreate/queryIopTemplate",queryTopics:i+"/topic/queryTopics",getTemplateData:l+"jx/cmpApprovalProcessConf/getApproveConfig",getApproveConfig:l+"cmpApprovalProcessConf/getApproveConfig",getNextApprovers:l+"jx/cmpApproveProcessInstance/getNodeApprover",saveChannel:i+"/tactics/tacticsCreate/save",deleteCustom:i+"/custgroup/custGroupManager/deleteCustom",getMoreMyCustom:i+"/custgroup/custGroupManager/getMoreMyCustom",viewCustGroupDetail:i+"/custgroup/custGroupManager/viewCustGroupDetail",queryMmsTemplates:r+"/mmsTemplates/queryMmsTemplates",deleteMmsTemplateLists:r+"/mmsTemplates/createTactics/deleteMmsTemplateLists",updateMmsTemplate:r+"/mmsTemplates/updateMmsTemplate",smsContentBatchDel:i+"/smsTemplates/smsContentBatchDel",smsContentDel:i+"/smsTemplates/smsContentDel",smsContentEdit:i+"/smsTemplates/smsContentEdit",smsContentSaveOrUpdate:i+"/smsTemplates/smsContentSaveOrUpdate",smsTemplateOffline:i+"/smsTemplates/smsTemplateOffline",smsTemplates:i+"/smsTemplates/smsTemplates",smsTemplateSaveOrUpdate:i+"/smsTemplates/smsTemplateSaveOrUpdate",delPlanExclusivity:s+"mcd-plan-exclusivity/delPlanExclusivity",exportPlanExcluTemplate:s+"mcd-plan-exclusivity/exportPlanExcluTemplate",getPlanExclusivityInfo:s+"mcd-plan-exclusivity/getPlanExclusivityInfo",getPlanExclusivityList:s+"mcd-plan-exclusivity/getPlanExclusivityList",queryPlanDefList:s+"mcd-plan-exclusivity/queryPlanDefList",queryPlanExclusivity:s+"mcd-plan-exclusivity/queryPlanExclusivity",saveOrUpdatePlanExclusivity:s+"mcd-plan-exclusivity/saveOrUpdatePlanExclusivity",savePlanExclusivity:s+"mcd-plan-exclusivity/savePlanExclusivity",updatePlanExclusivity:s+"mcd-plan-exclusivity/updatePlanExclusivity",uploadPlanExcluFile:s+"mcd-plan-exclusivity/uploadPlanExcluFile",approveRecord:s+"api/mcdDimMaterialApprove/jx/approveRecord",getMaterialApprover:s+"api/mcdDimMaterialApprove/jx/getMaterialApprover",commitProcess:"/approve-svc/cmpApproveProcessInstance/commitProcess",subMaterialApprove:s+"api/mcdDimMaterialApprove/jx/subMaterialApprove",queryCommunicationUsers:"/plan-svc/api/channelMaterial/jx/queryCommunicationUsers",queryCommunicationTask:"/approve-svc/jx/cmpApproveProcessInstance/queryCommunicationTask",addCommunicationTask:"/approve-svc/jx/cmpApproveProcessInstance/addCommunicationTask",addCommunicationTaskBatch:"/approve-svc/jx/cmpApproveProcessInstance/addCommunicationTaskBatch",communicationAppTask:"/approve-svc/jx/cmpApproveProcessInstance/communicationAppTask",queryChannelExecInfo:"/plan-svc/mcd/camp/channelExec/queryChannelExecInfo",queryChannelExecList:"/plan-svc/mcd/camp/channelExec/queryChannelExecList",deleteChannelPrompt:"/plan-svc/mcd/chan/prompt/deleteChannelPrompt",queryChannelPrompt:"/plan-svc/mcd/chan/prompt/queryChannelPrompt",saveOrUpdateChannelPrompt:"/plan-svc/mcd/chan/prompt/saveOrUpdateChannelPrompt",uploaChanPromptFile:"/plan-svc/mcd/chan/prompt/uploaChanPromptFile",chanAndPlanMarketingHistory:"/plan-svc/mcd/marketing/history/chanAndPlanMarketingHistory",custContactNumMarketingHistory:"/plan-svc/mcd/marketing/history/custContactNumMarketingHistory",custSuccessRateMarketingHistory:"/plan-svc/mcd/marketing/history/custSuccessRateMarketingHistory",planMarketingHistory:"/plan-svc/mcd/marketing/history/planMarketingHistory",caculateContactUserNum:"/pec-timing/mcd/user/contact/caculateContactUserNum",caculateOrderUserNum:"/pec-timing/mcd/user/contact/caculateOrderUserNum",queryCampScene:"/plan-svc/api/action/tactics/tacticsCreate/jx/queryCampScene"}}},"327a":function(e,t,a){"use strict";a("0918")},"32ec":function(e,t,a){},3390:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("Tips",{attrs:{id:e.channelId},on:{getChannelDetail:e.getChannelDetail}}),t("el-form",{ref:"CrmFrom",attrs:{"label-width":"110px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-form-item",{attrs:{label:"运营位：",prop:"adivId"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:e.changeAid},model:{value:e.CrmFrom.adivId,callback:function(t){e.$set(e.CrmFrom,"adivId",t)},expression:"CrmFrom.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1),t("el-form-item",{attrs:{label:"复杂事件场景："}},[t("el-button",{staticClass:"ml-10",attrs:{type:"primary"},on:{click:e.addCepClick}},[e._v("添加")])],1),e.showExt18?t("el-form-item",{attrs:{label:"智能话术："}},[t("el-checkbox",{on:{change:()=>e.CrmFrom.columnExt18=e.checkColumnExt18?"1":"0"},model:{value:e.checkColumnExt18,callback:function(t){e.checkColumnExt18=t},expression:"checkColumnExt18"}},[e._v("启用")]),e.checkColumnExt18?t("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt18,callback:function(t){e.$set(e.CrmFrom,"columnExt18",t)},expression:"CrmFrom.columnExt18"}},[t("el-radio",{attrs:{label:"1"}},[e._v("省端模型")]),t("el-radio",{attrs:{label:"2"}},[e._v("一级IOP模型")])],1):e._e()],1):e._e(),t("el-form-item",{attrs:{label:"推荐用语：",prop:"execContent"}},[t("el-input",{attrs:{type:"textarea",maxlength:"500","show-word-limit":""},model:{value:e.CrmFrom.execContent,callback:function(t){e.$set(e.CrmFrom,"execContent",t)},expression:"CrmFrom.execContent"}})],1),t("el-form-item",[t("el-button",{on:{click:e.SubInstall}},[e._v("保存当前设置")])],1)],1)],1)},r=[],l=a("0fea"),s=a("5e05"),o=a("5ed5"),n=a("f3ba");const c=s["a"].common.queryAdivInfo,m=s["a"].common.queryMaterialByChannel,u=n["a"].home.getDicValueByKey;var d={props:["channelId"],components:{Tips:o["a"]},data(){return{CrmFrom:{adivId:"",adivName:"",materialId:"",materialName:"",execContent:"",columnExt18:"0"},showExt18:!1,checkColumnExt18:!1,CrmFromRules:{adivId:[{required:!0,message:"请选择运营位",trigger:"blur,change"}],materialId:[{required:!0,message:"请选择素材",trigger:"blur,change"}],execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}]},matList:[],timeIdList:[],adivList:[]}},mounted(){this.getOptionData(),this.checkColumnExt18=this.CrmFrom.columnExt18>0},methods:{getChannelDetail(e){1==e.smartScript&&(this.showExt18=!0)},getOptionData(){Object(l["i"])(c,{channelId:this.channelId}).then(e=>{this.adivList=e})},addCepClick(){Object(l["i"])(u,{key:"MCD_CEP_EVENT_URL"}).then(e=>{})},changeAid(){this.adivList.forEach(e=>{(this.CrmFrom.adivId=e.adivId)&&(this.CrmFrom.adivName=e.adivName)});let e="0",t={channelId:this.channelId,materialType:e,positionId:this.CrmFrom.adivId};Object(l["i"])(m,t).then(e=>{this.matList=e})},SubInstall(){this.$refs.CrmFrom.validate(e=>{})}}},h=d,p=a("2877"),v=Object(p["a"])(h,i,r,!1,null,"8d418fd6",null);t["a"]=v.exports},3719:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"CrmFrom",attrs:{"label-width":"130px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-form-item",{attrs:{label:"运营位：",prop:"adivInfo.adivId"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:e.changeAid},model:{value:e.CrmFrom.adivInfo.adivId,callback:function(t){e.$set(e.CrmFrom.adivInfo,"adivId",t)},expression:"CrmFrom.adivInfo.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1),t("el-form-item",{attrs:{label:"推荐用语：",prop:"channelConf.execContent"}},[t("el-input",{attrs:{type:"textarea",maxlength:"500","show-word-limit":""},model:{value:e.CrmFrom.channelConf.execContent,callback:function(t){e.$set(e.CrmFrom.channelConf,"execContent",t)},expression:"CrmFrom.channelConf.execContent"}})],1),t("el-form-item",{attrs:{label:"时机选择："}},[t("el-select",{attrs:{placeholder:"请选择"},on:{click:e.changeTime},model:{value:e.CrmFrom.channelConf.timeId,callback:function(t){e.$set(e.CrmFrom.channelConf,"timeId",t)},expression:"CrmFrom.channelConf.timeId"}},e._l(e.timeIdList,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),t("el-form-item",{attrs:{label:"时机描述："}},[t("el-input",{attrs:{type:"textarea",maxlength:"240","show-word-limit":""},model:{value:e.CrmFrom.channelConf.timeDistindes,callback:function(t){e.$set(e.CrmFrom.channelConf,"timeDistindes",t)},expression:"CrmFrom.channelConf.timeDistindes"}})],1)],1)],1)},r=[],l=a("0fea"),s=a("5e05");const o=s["a"].common.getSysEnum,n=s["a"].common.queryAdivInfo,c=s["a"].common.queryHallInfo;var m={props:["channelNewData"],data(){return{CrmFrom:{adivInfo:{},channelConf:{},channelId:"",channelName:"",attributionInfo:{}},CrmFromRules:{adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},timeIdList:[],adivList:[],attributionList:[]}},mounted(){this.getOptionData(),this.CrmFrom=JSON.parse(JSON.stringify(this.channelNewData))},methods:{async getOptionData(){await Object(l["i"])(o,{enumType:"iop_time_id"}).then(e=>{this.timeIdList=e}),await Object(l["i"])(n,{channelId:this.CrmFrom.channelId}).then(e=>{this.adivList=e}),await Object(l["i"])(c,{}).then(e=>{this.attributionList=e})},changeAid(e){var t="";this.adivList.forEach(a=>{e===a.adivId&&(t=a.adivName)}),this.CrmFrom.adivInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,adivName:t})},changeAttribution(e){var t="";this.attributionList.forEach(a=>{e===a.adivId&&(t=a.attributionName)}),this.CrmFrom.attributionInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,attributionName:t})},changeTime(){this.timeIdList.forEach(e=>{e.enumKey===this.CrmFrom.timeId&&(this.CrmFrom.timeName=e.enumValue)})},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e}},created(){}},u=m,d=a("2877"),h=Object(d["a"])(u,i,r,!1,null,"45b23a1c",null);t["a"]=h.exports},"39d6":function(e,t,a){},"39dd":function(e,t,a){},"3a17":function(e,t,a){},"3aeb":function(e,t,a){"use strict";a("f7b7")},"3b91":function(e,t,a){},"3c7a":function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));const i=[{id:"804",components:"Incoming"},{id:"805",components:"ProductApp"},{id:"906",components:"MutiplePositionComponent"},{id:"922",components:"MutiplePositionComponent"},{id:"961",components:"MutiplePositionComponent"},{id:"963",components:"MutiplePositionComponent"},{id:"965",components:"MutiplePositionComponent"},{id:"966",components:"MutiplePositionComponent"},{id:"962",components:"MutiplePositionComponent"},{id:"901",components:"ContentSMS"},{id:"932",components:"MobileVideo"},{id:"957",components:"IVRsales"},{id:"958",components:"PushNotification"},{id:"964",components:"FiveCloudCard"},{id:"960",components:"FiveMessage"},{id:"801",components:"ContentSMS"},{id:"910",components:"MessageEntrainment"},{id:"802",components:"OutboundMarking"},{id:"809",components:"CustomerPass"},{id:"808",components:"GridPass"},{id:"931",components:"Linestore"},{id:"924",components:"BelieveWithMe"},{id:"926",components:"FindOneLevel"},{id:"916",components:"MiguChannel"},{id:"917",components:"MiguChannel"},{id:"919",components:"MiguChannel"},{id:"920",components:"MiguChannel"},{id:"933",components:"EnterpriseWeChat"},{id:"811",components:"OutboundForEight"},{id:"810",components:"shortOffice"},{id:"968",components:"GuangDianTong"},{id:"969",components:"GovernmentEnterprise"},{id:"967",components:"ChinaMobileApp"},{id:"970",components:"Zhuangweisuixiao"}],r={id:"0",components:"DefaultItem"};function l(e){const t=i.find(t=>t.id===e);return void 0!==t?t.components:r.components}},"3d00":function(e,t,a){"use strict";a("9192")},"3d40":function(e,t,a){},"3dd3":function(e,t,a){"use strict";a("3d40")},"3f74":function(e,t,a){},"409c":function(e,t,a){},"40ca":function(e,t,a){"use strict";a("8eb2")},4239:function(e,t,a){"use strict";a("e0bf")},"43fd":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("Tips",{attrs:{id:e.id},on:{getChannelDetail:e.getChannelDetail}}),t("div",{staticStyle:{display:"flex","justify-content":"end"}}),t("Tips",{attrs:{id:e.id}}),t("el-form",{ref:"CrmFrom",staticStyle:{width:"100%"},attrs:{"label-width":"150px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"推送方式：",prop:"columnExt1"}},[t("el-radio-group",{model:{value:e.CrmFrom.columnExt1,callback:function(t){e.$set(e.CrmFrom,"columnExt1",t)},expression:"CrmFrom.columnExt1"}},[t("el-radio",{attrs:{label:"1",disabled:!e.CrmFrom.channelFlag}},[e._v("全量推送")]),t("el-radio",{attrs:{label:"0",disabled:!e.CrmFrom.channelFlag}},[e._v("偏好推送")])],1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"运营位：",prop:"adivInfo.adivId"}},[t("el-select",{attrs:{placeholder:"请选择短信类型"},on:{change:e.changeAid},model:{value:e.CrmFrom.adivInfo.adivId,callback:function(t){e.$set(e.CrmFrom.adivInfo,"adivId",t)},expression:"CrmFrom.adivInfo.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"标准化素材：",prop:"columnExt20"}},[t("div",{staticClass:"select-material",on:{click:function(t){return e.selectMaterial(!0)}}},[e._v(e._s(e.CrmFrom.materialName||"请选择"))])])],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"消息模板编号前缀：",prop:"columnExt5"}},[t("el-select",{attrs:{placeholder:"请消息模板编号前缀"},model:{value:e.CrmFrom.columnExt5,callback:function(t){e.$set(e.CrmFrom,"columnExt5",t)},expression:"CrmFrom.columnExt5"}},e._l(e.columnExt5List,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"实时事件类型：",prop:"columnExt6"}},[t("el-select",{attrs:{placeholder:"请选择实时事件类型"},model:{value:e.CrmFrom.columnExt6,callback:function(t){e.$set(e.CrmFrom,"columnExt6",t)},expression:"CrmFrom.columnExt6"}},e._l(e.columnExt6List,(function(e){return t("el-option",{key:e.enumId,attrs:{label:e.enumValue,value:e.enumId}})})),1)],1)],1),e.showScene?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"复杂事件场景：",prop:"CEP_EVENT_ID"}},[t("div",[t("div",{staticStyle:{display:"flex","justify-content":"space-between","max-width":"375px"}},[t("div",{staticClass:"add-botton"},[t("span",{on:{click:function(t){return e.openSceneDilog(!0)}}},[e._v(e._s(e.CrmFrom.sceneParams.eventName||"添加"))]),t("i",{directives:[{name:"show",rawName:"v-show",value:e.CrmFrom.sceneParams.eventName,expression:"CrmFrom.sceneParams.eventName"}],staticClass:"el-icon-close",on:{click:e.removeEvent}})]),t("el-checkbox",{model:{value:e.CrmFrom.checked,callback:function(t){e.$set(e.CrmFrom,"checked",t)},expression:"CrmFrom.checked"}},[e._v("取消推荐规则设置")])],1),"JX0000000001"===e.customGroupId?t("div",{staticStyle:{color:"red","font-size":"12px"}},[e._v("该活动没有限定客群，触发事件即发送，请慎重选择事件！")]):e._e(),e.CrmFrom.checked?t("div",{staticClass:"select"},[t("div",{staticClass:"setRules"},[t("p",[e._v("已选择事件："+e._s(e.CrmFrom.sceneParams.eventName))])]),t("div",[t("span",[e._v("取消推荐时间：")]),t("el-select",{attrs:{placeholder:"请选择执行端口",size:"mini"},model:{value:e.CrmFrom.columnExt4,callback:function(t){e.$set(e.CrmFrom,"columnExt4",t)},expression:"CrmFrom.columnExt4"}},e._l(e.columnExt4List,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]):e._e()])])],1):e._e(),e.showExt18?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"智能话术："}},[t("el-checkbox",{on:{change:()=>e.CrmFrom.columnExt18=e.checkColumnExt18?"1":"0"},model:{value:e.checkColumnExt18,callback:function(t){e.checkColumnExt18=t},expression:"checkColumnExt18"}},[e._v("启用")]),e.checkColumnExt18?t("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt18,callback:function(t){e.$set(e.CrmFrom,"columnExt18",t)},expression:"CrmFrom.columnExt18"}},[t("el-radio",{attrs:{label:"1"}},[e._v("省端模型")]),t("el-radio",{attrs:{label:"2"}},[e._v("一级IOP模型")])],1):e._e()],1)],1):e._e(),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"营销话术：",prop:"columnExt2","label-width":"148px"}},[t("el-input",{directives:[{name:"forbidChars",rawName:"v-forbidChars"}],attrs:{id:"smsDetail",type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},model:{value:e.CrmFrom.columnExt2,callback:function(t){e.$set(e.CrmFrom,"columnExt2",t)},expression:"CrmFrom.columnExt2"}})],1)],1),t("el-col",{attrs:{span:24}},[1==e.custgroupSource?t("el-form-item",{attrs:{label:"营销用语替换变量："}},[t("DNAReplaceVar",{on:{getVar:e.getContent}})],1):t("el-form-item",{attrs:{label:"营销用语替换变量："}},e._l(e.replaceVar,(function(a){return t("el-tag",{key:a.id,attrs:{type:"info"},on:{click:function(t){return e.getContent(a.attrCol)}}},[e._v(e._s(a.attrColName))])})),1)],1),1!=e.custgroupSource?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"发送周期：",prop:"UPDATE_CYCLE"}},[t("div",{staticStyle:{display:"flex",width:"100px"}},[t("el-tag",{attrs:{type:"1"===e.CrmFrom.UPDATE_CYCLE?"":"info"},on:{click:function(t){return e.getTags("1")}}},[e._v("一次性")]),1!==e.updateCycle?t("el-tag",{staticStyle:{"margin-left":"10px"},attrs:{type:"0"===e.CrmFrom.UPDATE_CYCLE?"":"info"},on:{click:function(t){return e.getTags("0")}}},[e._v("周期性")]):e._e()],1)])],1):e._e(),1!==e.updateCycle&&0==e.CrmFrom.UPDATE_CYCLE||1==e.custgroupSource?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"频次配置：",prop:e.CrmFrom.FREQUENCY?"num":"FREQUENCY"}},[t("div",{staticStyle:{display:"flex"}},[t("el-select",{attrs:{placeholder:"请选择天数"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.FREQUENCY,callback:function(t){e.$set(e.CrmFrom,"FREQUENCY",t)},expression:"CrmFrom.FREQUENCY"}},e._l(e.dateList,(function(e){return t("el-option",{key:e.cycleId,attrs:{label:e.cycleName,value:e.cycle}})})),1),t("el-input",{staticStyle:{width:"100px",margin:"0px 20px"},attrs:{type:"text",rows:8,placeholder:""},on:{input:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.num,callback:function(t){e.$set(e.CrmFrom,"num",t)},expression:"CrmFrom.num"}}),e._v("次 ")],1)])],1):e._e()],1)],1),t("ComplexScene",{ref:"SceneDialog",on:{addScene:e.addScene}}),t("materialList",{ref:"material",attrs:{channelId:e.id,adivId:e.CrmFrom.adivInfo.adivId},on:{addMaterial:e.addMaterial}})],1)},r=[],l=a("0fea"),s=a("5e05"),o=(a("0b16"),a("aedd")),n=a("b893"),c=a("f1ce"),m=a("5ed5"),u=a("6501");const d=s["a"].common.getSysEnum,h=s["a"].common.queryAdivInfo,p=s["a"].common.queryHallInfo;var v={props:["channelNewData","id","deleteSub"],components:{ComplexScene:o["a"],materialList:c["a"],Tips:m["a"],DNAReplaceVar:u["a"]},data(){return{CrmFrom:{adivInfo:{},channelId:"",channelName:"",attributionInfo:{},columnExt1:"1",standard:"",CustomerRules:"",marketingWords:"",UPDATE_CYCLE:"",IF_HAVE_VAR:"0",SMS_CONTENT:"",CEP_EVENT_ID:"",columnExt2:"",columnExt4:"7",columnExt6:"",columnExt5:"",columnExt18:"0",sceneParams:{eventName:""},checked:Boolean,columnExt20:""},showExt18:!1,checkColumnExt18:!1,CrmFromRules:{columnExt1:[{required:!0,message:"请选择推送方式",trigger:"blur"}],marketingWords:[{required:!0,message:"请输入营销话术",trigger:"blur"}],UPDATE_CYCLE:[{required:!0,message:"请选择发送周期",trigger:"blur"}],FREQUENCY:[{required:!0,message:"请选择频次配置",trigger:"blur"}],num:[{required:!0,message:"请填写次数",trigger:"blur"}],columnExt5:[{required:!0,message:"请选择模板消息前缀",trigger:"blur"}],columnExt6:[{required:!0,message:"请选择实时事件类型",trigger:"blur"}],columnExt2:[{required:!0,message:"请输入营销话术",trigger:"blur"}],CEP_EVENT_ID:[{required:!0,message:"请输入选择复杂事件场景",trigger:"change"}],adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},timeIdList:[],adivList:[],attributionList:[],dateList:[],showScene:!0,ShortMsgContent:"",sceneParams:{eventName:""},replaceVar:[],columnExt4List:[{label:"1天",value:"1"},{label:"2天",value:"2"},{label:"3天",value:"3"},{label:"4天",value:"4"},{label:"5天",value:"5"},{label:"6天",value:"6"},{label:"7天",value:"7"}],columnExt6List:[],columnExt5List:[{label:"iop公共模板前缀",value:"80001"}],toolTopContent:"IOP免打扰时间段为21:00-8:00,在此期间将不会主动推送营销信息给客户。周期性客群如当天任务没有发送完成,将不会在第二天发送,第二天直接使用更新后客群发送。"}},computed:{updateCycle(){var e;return null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.updateCycle},customGroupId(){var e;return null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.customGroupId},custgroupSource(){return this.$store.state.extendData.custgroupSource},SMS_CONTENT(){return this.CrmFrom.columnExt2},checked(){return this.CrmFrom.checked}},watch:{channelNewData:{handler(){this.CrmFrom=Object(n["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"columnExt4",this.CrmFrom.columnExt4||"7"),this.$set(this.CrmFrom,"sceneParams",this.CrmFrom.sceneParams||{eventName:""}),this.checkColumnExt18=this.CrmFrom.columnExt18>0},deep:!0},CrmFrom:{handler(e,t){},deep:!0},deleteSub(){},checked(e){this.CrmFrom=e?{...this.CrmFrom,columnExt3:"1"}:{...this.CrmFrom,columnExt3:"0"}},SMS_CONTENT(e){if(e){const t=/\$[a-zA-Z0-9_\u4e00-\u9fa5]+\$/g,a=e.match(t);a&&a.length>0?this.CrmFrom.IF_HAVE_VAR="1":this.CrmFrom.IF_HAVE_VAR="0"}else this.CrmFrom.IF_HAVE_VAR="0"}},mounted(){this.getOptionData(),this.listCustAttr(),this.getDateList(),this.getSysEnum(),this.CrmFrom=Object(n["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"columnExt4",this.CrmFrom.columnExt4||"7"),this.$set(this.CrmFrom,"sceneParams",this.CrmFrom.sceneParams||{eventName:""}),this.checkColumnExt18=this.CrmFrom.columnExt18>0},methods:{getChannelDetail(e){1==e.smartScript&&(this.showExt18=!0)},async getOptionData(){await Object(l["i"])(d,{enumType:"iop_time_id"}).then(e=>{this.timeIdList=e}),await Object(l["i"])(h,{channelId:this.id}).then(e=>{this.adivList=e}),await Object(l["i"])(p,{}).then(e=>{this.attributionList=e})},changeAid(e){var t="";this.adivList.forEach(a=>{e===a.adivId&&(t=a.adivName)}),this.CrmFrom.adivInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,adivName:t})},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t||("906"===this.id||"922"===this.id)&&this.CrmFrom.marketingWords&&this.CrmFrom.adivInfo.adivId?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e},openSceneDilog(e){this.$refs["SceneDialog"].showDialog(e)},addScene(e){this.CrmFrom={...this.CrmFrom,CEP_EVENT_ID:e.eventId,CEP_SCENE_NAME:e.eventName,sceneParams:e}},removeEvent(){this.CrmFrom.sceneParams={eventName:""},this.CrmFrom.CEP_EVENT_ID="",this.CrmFrom.CEP_SCENE_NAME=""},async listCustAttr(){var e;const t=null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.customGroupId;await Object(l["i"])(s["a"].common.listCustAttr+"?custGroupId="+t).then(e=>{this.replaceVar=e})},getContent(e){let t="$"+e+"$";e=t,this.ShortMsgContent=e;const a=document.querySelector("#smsDetail");if(a.selectionStart||0===a.selectionStart){var i=a.selectionStart,r=a.selectionEnd;this.CrmFrom={...this.CrmFrom,columnExt2:a.value.substring(0,i)+e+a.value.substring(r,a.value.length)},this.$nextTick(),a.focus(),a.setSelectionRange(r+e.length,r+e.length)}else this.CrmFrom.columnExt2+=e},getTags(e){this.CrmFrom={...this.CrmFrom,UPDATE_CYCLE:e},0==e&&(this.CrmFrom.FREQUENCY=null,this.CrmFrom.num=""),this.$forceUpdate()},async getDateList(){await Object(l["i"])(s["a"].common.getDateList).then(e=>{this.dateList=e})},async getSysEnum(){await Object(l["i"])(s["a"].common.getSysEnum,{enumType:"event_type_958"}).then(e=>{this.columnExt6List=e})},selectMaterial(e){this.$refs["material"].getMaterialList(),this.$refs["material"].showDialog(e)},addMaterial(e){this.CrmFrom={...this.CrmFrom,columnExt20:e.materialId,materialName:e.materialName}}},created(){}},C=v,b=(a("89b7"),a("2877")),f=Object(b["a"])(C,i,r,!1,null,"629a3bed",null);t["a"]=f.exports},"464a":function(e,t,a){},4873:function(e,t,a){},4880:function(e,t,a){"use strict";a("9a5b")},"492d":function(e,t,a){"use strict";a("ab51")},"4a44":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("el-form",{ref:"CrmFrom",attrs:{"label-width":"145px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("Tips",{attrs:{id:e.id},on:{getChannelDetail:e.getChannelDetail}}),t("el-form-item",{attrs:{label:"推送方式：",prop:"columnExt1"}},[t("el-radio-group",{model:{value:e.CrmFrom.columnExt1,callback:function(t){e.$set(e.CrmFrom,"columnExt1",t)},expression:"CrmFrom.columnExt1"}},[t("el-radio",{attrs:{label:"1",disabled:!e.CrmFrom.channelFlag}},[e._v("全量推送")]),t("el-radio",{attrs:{label:"0",disabled:!e.CrmFrom.channelFlag}},[e._v("偏好推送")])],1)],1),e.showExt18?t("el-form-item",{attrs:{label:"智能话术："}},[t("el-checkbox",{on:{change:()=>e.CrmFrom.columnExt18=e.checkColumnExt18?"1":"0"},model:{value:e.checkColumnExt18,callback:function(t){e.checkColumnExt18=t},expression:"checkColumnExt18"}},[e._v("启用")]),e.checkColumnExt18?t("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt18,callback:function(t){e.$set(e.CrmFrom,"columnExt18",t)},expression:"CrmFrom.columnExt18"}},[t("el-radio",{attrs:{label:"1"}},[e._v("省端模型")]),t("el-radio",{attrs:{label:"2"}},[e._v("一级IOP模型")])],1):e._e()],1):e._e(),t("el-form-item",{attrs:{label:"推荐用语：",prop:"marketingWords"}},[t("el-input",{attrs:{type:"textarea",rows:5,maxlength:"500","show-word-limit":"",placeholder:"请输入推荐用语"},model:{value:e.CrmFrom.marketingWords,callback:function(t){e.$set(e.CrmFrom,"marketingWords",t)},expression:"CrmFrom.marketingWords"}})],1)],1)},r=[],l=a("b893"),s=a("5ed5"),o={props:["channelNewData","id"],components:{Tips:s["a"]},data(){return{CrmFrom:{columnExt1:"1",columnExt18:"0",marketingWords:""},showExt18:!1,checkColumnExt18:!1,CrmFromRules:{columnExt1:[{required:!0,message:"请选择推送方式",trigger:"blur"}],marketingWords:[{required:!0,message:"请输入推荐用语",trigger:"blur"}]},adivList:[]}},watch:{channelNewData:{handler(){this.CrmFrom=Object(l["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.checkColumnExt18=this.CrmFrom.columnExt18>0},deep:!0}},methods:{getChannelDetail(e){1==e.smartScript&&(this.showExt18=!0)},SubInstall(){let e=!0;return this.$refs.CrmFrom.validate(t=>{t?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e}},created(){this.CrmFrom=Object(l["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.checkColumnExt18=this.CrmFrom.columnExt18>0}},n=o,c=a("2877"),m=Object(c["a"])(n,i,r,!1,null,"22e46086",null);t["a"]=m.exports},"4a7d":function(e,t,a){},"4b36":function(e,t,a){},"4b54":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("Tips",{attrs:{id:e.id}}),t("el-form",{ref:"CrmFrom",staticStyle:{width:"100%"},attrs:{"label-width":"145px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"推送方式：",prop:"columnExt1"}},[t("el-radio-group",{model:{value:e.CrmFrom.columnExt1,callback:function(t){e.$set(e.CrmFrom,"columnExt1",t)},expression:"CrmFrom.columnExt1"}},[t("el-radio",{attrs:{label:"1",disabled:!e.CrmFrom.channelFlag}},[e._v("全量推送")]),t("el-radio",{attrs:{label:"0",disabled:!e.CrmFrom.channelFlag}},[e._v("偏好推送")])],1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"应用号：",prop:"columnExt2"}},[t("el-select",{attrs:{placeholder:"请选择应用号"},on:{change:e.changeApplication},model:{value:e.CrmFrom.columnExt2,callback:function(t){e.$set(e.CrmFrom,"columnExt2",t)},expression:"CrmFrom.columnExt2"}},e._l(e.applicationList,(function(e){return t("el-option",{key:e.applicationId,attrs:{label:e.applicationName,value:e.applicationName}})})),1)],1)],1),t("el-col",{attrs:{span:4}},[t("el-form-item",{attrs:{"label-width":"100px"}},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.platformList()}}},[e._v("模板列表")])],1)],1),e.CrmFrom.columnExt5?[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"模板编号：",prop:"columnExt5","label-width":"148px"}},[t("el-input",{attrs:{type:"text","show-word-limit":"",placeholder:"请输入模板ID",disabled:""},model:{value:e.CrmFrom.columnExt5,callback:function(t){e.$set(e.CrmFrom,"columnExt5",t)},expression:"CrmFrom.columnExt5"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"模板名称：",prop:"columnExt6","label-width":"148px"}},[t("el-input",{attrs:{type:"text","show-word-limit":"",placeholder:"请输入模板ID",disabled:""},model:{value:e.CrmFrom.columnExt6,callback:function(t){e.$set(e.CrmFrom,"columnExt6",t)},expression:"CrmFrom.columnExt6"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"模板内容：",prop:"columnExt7","label-width":"148px"}},[1===e.CrmFrom.templateObj.contentType||4===e.CrmFrom.templateObj.contentType?t("el-input",{attrs:{type:"text","show-word-limit":"",placeholder:"请输入模板ID",disabled:""},model:{value:e.CrmFrom.columnExt7,callback:function(t){e.$set(e.CrmFrom,"columnExt7",t)},expression:"CrmFrom.columnExt7"}}):t("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{src:e.CrmFrom.columnExt7,"preview-src-list":[e.CrmFrom.columnExt7],fit:"contain"}})],1)],1)]:e._e(),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"营销类型：",prop:"saleType"}},[t("el-select",{attrs:{placeholder:"请选择短信类型",disabled:e.CrmFrom.saleTypeFlag},model:{value:e.CrmFrom.saleType,callback:function(t){e.$set(e.CrmFrom,"saleType",t)},expression:"CrmFrom.saleType"}},e._l(e.saleTypeList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("p",{staticStyle:{"font-size":"12px",color:"red"}},[e._v("注：交互动态模板类型暂不支持批量营销!")])],1)],1),e.showScene?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"复杂事件场景：",prop:"CEP_EVENT_ID"}},[t("div",[t("div",{staticStyle:{display:"flex","justify-content":"space-between","max-width":"375px"}},[t("div",{staticClass:"add-botton"},[t("span",{on:{click:function(t){return e.openSceneDilog(!0)}}},[e._v(e._s(e.CrmFrom.sceneParams.eventName||"添加"))]),t("i",{directives:[{name:"show",rawName:"v-show",value:e.CrmFrom.sceneParams.eventName,expression:"CrmFrom.sceneParams.eventName"}],staticClass:"el-icon-close",on:{click:e.removeEvent}})]),t("el-checkbox",{model:{value:e.CrmFrom.checked,callback:function(t){e.$set(e.CrmFrom,"checked",t)},expression:"CrmFrom.checked"}},[e._v("取消推荐规则设置")])],1),"JX0000000001"===e.customGroupId?t("div",{staticStyle:{color:"red","font-size":"12px"}},[e._v("该活动没有限定客群，触发事件即发送，请慎重选择事件！")]):e._e(),e.CrmFrom.checked?t("div",{staticClass:"select"},[t("div",{staticClass:"setRules"},[t("p",[e._v("已选择事件："+e._s(e.CrmFrom.sceneParams.eventName))])]),t("div",[t("span",[e._v("取消推荐时间：")]),t("el-select",{attrs:{placeholder:"请选择取消推荐时间",size:"mini"},model:{value:e.CrmFrom.columnExt4,callback:function(t){e.$set(e.CrmFrom,"columnExt4",t)},expression:"CrmFrom.columnExt4"}},e._l(e.columnExt4List,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]):e._e()])])],1):e._e(),1!==e.updateCycle?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"频次配置：",prop:e.CrmFrom.FREQUENCY?"FREQUENCY":"num"}},[t("div",{staticStyle:{display:"flex"}},[t("el-select",{attrs:{placeholder:"请选择天数"},model:{value:e.CrmFrom.FREQUENCY,callback:function(t){e.$set(e.CrmFrom,"FREQUENCY",t)},expression:"CrmFrom.FREQUENCY"}},e._l(e.dateList,(function(e){return t("el-option",{key:e.cycleId,attrs:{label:e.cycleName,value:e.cycle}})})),1),t("el-input",{staticStyle:{width:"100px",margin:"0px 20px"},attrs:{type:"text",rows:8,placeholder:""},model:{value:e.CrmFrom.num,callback:function(t){e.$set(e.CrmFrom,"num",t)},expression:"CrmFrom.num"}}),e._v("次 ")],1)])],1):e._e(),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"回落类型：",prop:"columnExt9"}},[t("el-radio",{attrs:{label:"-1"},model:{value:e.CrmFrom.columnExt9,callback:function(t){e.$set(e.CrmFrom,"columnExt9",t)},expression:"CrmFrom.columnExt9"}},[e._v("无回落")]),e._l(e.CrmFrom.radioList,(function(a){return t("el-radio",{key:a.key,attrs:{label:a.key},model:{value:e.CrmFrom.columnExt9,callback:function(t){e.$set(e.CrmFrom,"columnExt9",t)},expression:"CrmFrom.columnExt9"}},[e._v(e._s(a.fallBackType))])}))],2)],1)],2)],1),t("ComplexScene",{ref:"SceneDialog",on:{addScene:e.addScene}}),t("el-dialog",{staticClass:"my-tem-dialog",attrs:{title:"模板列表",visible:e.dialogTableVisible,modal:!1,width:"1015px",top:"8vh"},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[t("div",{staticClass:"selech-panel"},[t("el-form",{ref:"queryForm",staticStyle:{display:"flex","flex-wrap":"wrap"},attrs:{model:e.queryForm,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"模板类型：","label-width":"120px"}},[t("el-select",{staticStyle:{width:"187px"},attrs:{placeholder:"请选择"},model:{value:e.queryForm.templateType,callback:function(t){e.$set(e.queryForm,"templateType",t)},expression:"queryForm.templateType"}},e._l(e.templateTypeList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"模板内容类型：","label-width":"120px"}},[t("el-select",{staticStyle:{width:"187px"},attrs:{placeholder:"请选择"},model:{value:e.queryForm.contentType,callback:function(t){e.$set(e.queryForm,"contentType",t)},expression:"queryForm.contentType"}},e._l(e.contentTypeList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"审核结果：","label-width":"120px"}},[t("el-select",{staticStyle:{width:"187px"},attrs:{placeholder:"请选择"},model:{value:e.queryForm.result,callback:function(t){e.$set(e.queryForm,"result",t)},expression:"queryForm.result"}},e._l(e.resultList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("div",{staticStyle:{"margin-left":"800px"}},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.platformList()}}},[e._v("查询")]),t("el-button",{attrs:{icon:"el-icon-refresh"},on:{click:e.resetQueryForm}},[e._v("重置")])],1)],1)],1),t("label-screen",{attrs:{title:"已选模板",ismutex:!1,isPulldown:!1,Label:e.Label,Default:e.LabelDefault},on:{close:e.handleClose}}),t("el-table",{staticClass:"customTable",attrs:{data:e.gridData}},[t("el-table-column",{attrs:{type:"index",prop:"index",label:"序号",width:"45",align:"center"}}),t("el-table-column",{attrs:{property:"templateID",label:"模板编号",width:"90"}}),t("el-table-column",{attrs:{property:"templateTypeChn",label:"模板类型",width:"70",align:"center"}}),t("el-table-column",{attrs:{property:"contentTypeChn",label:"内容类型",width:"70",align:"center"}}),t("el-table-column",{attrs:{property:"templateName",label:"模板名称",width:"120","header-align":"center"}}),t("el-table-column",{attrs:{label:"模板内容",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[1===a.row.contentType||4===a.row.contentType?t("span",[e._v(e._s(a.row.contents))]):t("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{src:a.row.contents,"preview-src-list":[a.row.contents],fit:"contain"}})]}}])}),t("el-table-column",{attrs:{property:"createTime",label:"创建时间",width:"90",align:"center"}}),t("el-table-column",{attrs:{property:"until",label:"有效期",width:"90",align:"center"}}),t("el-table-column",{attrs:{property:"statusChn",label:"状态",align:"center"}}),t("el-table-column",{attrs:{property:"resultChn",label:"审核结果",align:"center"}}),t("el-table-column",{attrs:{property:"address",label:"操作",width:"60"},scopedSlots:e._u([{key:"default",fn:function(a){return[e.isPast(a.row.until)?t("span",{staticStyle:{color:"#bbb"}},[e._v("失效")]):t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.choose(a.row)}}},[e._v("选择")])]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{"current-page":e.queryForm.pageNum,layout:"total, prev, pager, next, jumper",total:e.Total},on:{"current-change":e.handleCurrentChange}})],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogTableVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.sureChoose()}}},[e._v("确 定")])],1)],1)],1)},r=[],l=a("0fea"),s=a("5e05"),o=a("b893"),n=a("aedd"),c=a("7b5a"),m=a("5ed5");s["a"].common.getSysEnum,s["a"].common.queryAdivInfo,s["a"].common.queryHallInfo;const u=s["a"].common.getApplication;var d={props:["channelNewData","id","deleteSub"],components:{ComplexScene:n["a"],LabelScreen:c["a"],Tips:m["a"]},data(){return{CrmFrom:{adivInfo:{adivId:""},channelId:"",channelName:"",attributionInfo:{},columnExt1:"1",columnExt2:"",columnExt3:"",columnExt4:"7",columnExt5:"",columnExt6:"",columnExt7:"",columnExt8:"",columnExt9:"-1",columnExt10:"",standard:"",CustomerRules:"",marketingWords:"",FREQUENCY:"",num:"",CEP_EVENT_ID:"",CEP_SCENE_NAME:"",saleType:"2",sceneParams:{eventName:""},checked:!1,templateObj:{templateType:""},radioList:[],saleTypeFlag:!1},CrmFromRules:{columnExt1:[{required:!0,message:"请选择推送方式",trigger:"blur"}],columnExt9:[{required:!0,message:"请选择回落类型",trigger:"blur"}],marketingWords:[{required:!0,message:"请输入营销话术",trigger:"blur"}],CEP_EVENT_ID:[{required:!0,message:"请选择复杂事件场景",trigger:"blur"}],FREQUENCY:[{required:!0,message:"请选择频次配置",trigger:"blur"}],num:[{required:!0,message:"请填写次数",trigger:"blur"}],adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},timeIdList:[],adivList:[],attributionList:[],showScene:!1,sceneParams:{eventName:""},dateList:[],applicationList:[],dialogTableVisible:!1,gridData:[],templateParams:{},queryForm:{templateType:"",contentType:"",result:"",pageNum:1,pageSize:10},templateTypeList:[{label:"全部",value:""},{label:"静态",value:1},{label:"交互动态",value:2},{label:"主动动态",value:3},{label:"空白",value:4}],contentTypeList:[{label:"全部",value:""},{label:"文本",value:1},{label:"多媒体",value:2},{label:"卡片",value:3},{label:"组合",value:4}],resultList:[{label:"全部",value:""},{label:"未提交审核",value:-1},{label:"审核通过",value:0},{label:"审核不通过",value:1},{label:"审核中",value:999}],Total:0,templateObj:{},LabelDefault:{id:"templateId",value:"templateName"},Label:[],saleTypeList:[{label:"实时营销",value:"1"},{label:"批量营销",value:"2"}],columnExt4List:[{label:"1天",value:"1"},{label:"2天",value:"2"},{label:"3天",value:"3"},{label:"4天",value:"4"},{label:"5天",value:"5"},{label:"6天",value:"6"},{label:"7天",value:"7"}]}},computed:{updateCycle(){var e;return null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.updateCycle},customGroupId(){var e;return null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.customGroupId},changeSaleType(){return this.CrmFrom.saleType},checked(){return this.CrmFrom.checked}},watch:{channelNewData:{handler(){this.CrmFrom=Object(o["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.CrmFrom.columnExt1||"1"),this.$set(this.CrmFrom,"columnExt4",this.CrmFrom.columnExt4||"7"),this.$set(this.CrmFrom,"columnExt9",this.CrmFrom.columnExt9||"-1"),this.$set(this.CrmFrom,"sceneParams",this.CrmFrom.sceneParams||{eventName:""}),this.$set(this.CrmFrom,"templateObj",this.CrmFrom.templateObj||{templateType:""})},deep:!0},deleteSub(){},checked(e){this.CrmFrom=e?{...this.CrmFrom,columnExt3:"1"}:{...this.CrmFrom,columnExt3:"0"}},changeSaleType(e){this.removeEvent(),this.CrmFrom.checked=!1,"1"===e?(this.showScene=!0,this.CrmFrom.adivInfo.adivId="9601"):(this.showScene=!1,this.CrmFrom.adivInfo.adivId="9602",this.CrmFrom.columnExt3=null,this.CrmFrom.columnExt4=null,this.CrmFrom={...this.CrmFrom,CEP_EVENT_ID:"",CEP_SCENE_NAME:"",sceneParams:{},checked:!1})}},mounted(){if(this.getOptionData(),this.getDateList(),this.getApplicationNum(),this.CrmFrom=Object(o["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.CrmFrom.columnExt1||"1"),this.$set(this.CrmFrom,"columnExt4",this.CrmFrom.columnExt4||"7"),this.$set(this.CrmFrom,"columnExt9",this.CrmFrom.columnExt9||"-1"),this.$set(this.CrmFrom,"sceneParams",this.CrmFrom.sceneParams||{eventName:""}),this.$set(this.CrmFrom,"templateObj",this.CrmFrom.templateObj||{templateType:""}),this.CrmFrom.columnExt9>-1){let e=[{fallBackType:"文本回落",key:"0"},{fallBackType:"视频回落",key:"1"},{fallBackType:"短小2.0回落",key:"2"}];this.$set(this.CrmFrom,"radioList",[e[this.CrmFrom.columnExt9]])}},methods:{async getOptionData(){},changeApplication(e){const t=this.applicationList.filter(t=>t.applicationName===e);this.templateParams=t[0],this.CrmFrom.columnExt5="",this.CrmFrom.columnExt6="",this.CrmFrom.columnExt7="",this.CrmFrom.columnExt8="",this.$forceUpdate()},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t?this.CrmFrom.columnExt5?(this.$emit("saveChannelData",this.CrmFrom),e=!0):(this.$message.error("请选择模板后提交"),e=!1):("906"===this.id||"922"===this.id)&&this.CrmFrom.marketingWords&&this.CrmFrom.adivInfo.adivId?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e},openSceneDilog(e){this.$refs["SceneDialog"].showDialog(e)},addScene(e){this.CrmFrom={...this.CrmFrom,CEP_EVENT_ID:e.eventId,CEP_SCENE_NAME:e.eventName,sceneParams:e}},removeEvent(){this.CrmFrom.sceneParams={eventName:""},this.CrmFrom.CEP_EVENT_ID="",this.CrmFrom.CEP_SCENE_NAME=""},async getDateList(){await Object(l["i"])(s["a"].common.getDateList).then(e=>{e.forEach(e=>{e.cycle=e.cycle+""}),this.dateList=e})},async getApplicationNum(){await Object(l["i"])(u,{channelId:this.id}).then(e=>{this.applicationList=e,this.CrmFrom.columnExt2=e[0].applicationName,this.templateParams={id:e[0].id,applicationId:e[0].applicationId,appSecret:e[0].appSecret}})},async platformList(){if(!this.templateParams.id)return void this.$message.error("请先选择应用号");this.dialogTableVisible=!0;const e={...this.queryForm,chatbotId:this.templateParams.id,appId:this.templateParams.applicationId,appSecret:this.templateParams.appSecret};await Object(l["i"])(s["a"].common.getPlaformList,e).then(e=>{null!==e.data&&(this.formatList(JSON.parse(e).list),this.Total=JSON.parse(e).total)})},resetQueryForm(){this.queryForm={...this.queryForm,templateType:"",contentType:"",result:""},this.platformList()},handleCurrentChange(e){this.queryForm.pageNum=e,this.platformList()},choose(e){this.CrmFrom.templateObj=e,this.Label=[{templateId:e.templateID,templateName:e.templateName}]},sureChoose(){if(0===this.Label.length)return this.dialogTableVisible=!1;let e=[];if(Object.prototype.hasOwnProperty.call(this.CrmFrom.templateObj,"aimSmsTemplate")){var t=this.CrmFrom.templateObj.aimSmsTemplate;Object.prototype.hasOwnProperty.call(t,"state")&&"1"===t.state&&(e=[{fallBackType:"短小2.0回落",key:"2"}])}Object.prototype.hasOwnProperty.call(this.CrmFrom.templateObj,"smsTemplate")&&(e=[{fallBackType:"文本回落",key:"0"}]),Object.prototype.hasOwnProperty.call(this.CrmFrom.templateObj,"mmsTemplate")&&(e=[{fallBackType:"视频回落",key:"1"}]),this.CrmFrom.radioList=e,this.CrmFrom={...this.CrmFrom,columnExt5:this.CrmFrom.templateObj.templateID,columnExt6:this.CrmFrom.templateObj.templateName,columnExt7:this.CrmFrom.templateObj.contents,columnExt8:this.CrmFrom.templateObj.templateType,saleType:1!==this.CrmFrom.templateObj.templateType&&3!==this.CrmFrom.templateObj.templateType?"1":this.CrmFrom.saleType,saleTypeFlag:1!==this.CrmFrom.templateObj.templateType&&3!==this.CrmFrom.templateObj.templateType},this.dialogTableVisible=!1},formatList(e){const t="https://rcs.10086.cn/5g-csp/csp-manage";this.gridData=e.map(e=>{if(1===e.templateType?e.templateTypeChn="静态":2===e.templateType?e.templateTypeChn="交互动态":3===e.templateType?e.templateTypeChn="主动动态":e.templateTypeChn="空白",1===e.contentType)e.contentTypeChn="文本",e.contents=e.bodyTextTemplate.contents[0].text;else if(2===e.contentType)e.contentTypeChn="多媒体",e.contents=t+e.bodyTextTemplate.contents[0].file.thumbInfo.url;else if(3===e.contentType){e.contentTypeChn="卡片";var a="generalPurposeCardCarousel",i=e.bodyTextTemplate.contents[0].message;for(var r in i)e.contents=r===a?t+e.bodyTextTemplate.contents[0].message.generalPurposeCardCarousel.content[0].media.thumbnailUrl:t+e.bodyTextTemplate.contents[0].message.generalPurposeCard.content.media.thumbnailUrl}else 4===e.contentType&&(e.contents=e.bodyTextTemplate.contents[0].text,e.contentTypeChn="组合");return-1===e.result?e.resultChn="未提交审核":0===e.result?e.resultChn="审核通过":1===e.result?e.resultChn="审核不通过":e.resultChn="审核中",1===e.status?e.statusChn="正常":2===e.status?e.statusChn="下线":3===e.status&&(e.statusChn="删除"),e})},handleClose(e){this.Label=this.Label.filter(t=>!(t.templateId===e.templateId))},isPast(e){let t=(new Date).getTime(),a=new Date(e).getTime();return a<t}}},h=d,p=(a("7779"),a("2877")),v=Object(p["a"])(h,i,r,!1,null,"324dd6a2",null);t["a"]=v.exports},"4c98":function(e,t,a){"use strict";a("726b")},"4cb2":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"CrmFrom",attrs:{"label-width":"110px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-form-item",{attrs:{label:"运营位：",prop:"adivId"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:e.changeAid},model:{value:e.CrmFrom.adivId,callback:function(t){e.$set(e.CrmFrom,"adivId",t)},expression:"CrmFrom.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1),t("el-form-item",{attrs:{label:"选择素材：",prop:"materialId"}},[t("el-select",{attrs:{placeholder:"请选择素材"},model:{value:e.CrmFrom.materialId,callback:function(t){e.$set(e.CrmFrom,"materialId",t)},expression:"CrmFrom.materialId"}},e._l(e.matList,(function(e){return t("el-option",{key:e.ID,attrs:{label:e.NAME,value:e.ID}})})),1),t("el-button",{staticClass:"ml-10",attrs:{type:"primary"},on:{click:e.showImage}},[e._v("预览")])],1),t("el-form-item",{attrs:{label:"推荐用语：",prop:"execContent"}},[t("el-input",{attrs:{type:"textarea",maxlength:"500","show-word-limit":""},model:{value:e.CrmFrom.execContent,callback:function(t){e.$set(e.CrmFrom,"execContent",t)},expression:"CrmFrom.execContent"}})],1),t("el-form-item",[t("el-button",{on:{click:e.SubInstall}},[e._v("保存当前设置")])],1)],1)],1)},r=[],l=a("0fea"),s=a("5e05");const o=s["a"].common.queryAdivInfo,n=s["a"].common.queryMaterialByChannel,c=s["a"].common.queryMaterialById;var m={props:["channelId"],data(){return{CrmFrom:{},CrmFromRules:{adivId:[{required:!0,message:"请选择运营位",trigger:"blur,change"}],materialId:[{required:!0,message:"请选择素材",trigger:"blur,change"}],execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}]},matList:[],timeIdList:[],adivList:[]}},mounted(){this.getOptionData()},methods:{getOptionData(){Object(l["i"])(o,{channelId:this.channelId}).then(e=>{this.adivList=e})},changeAid(){this.adivList.forEach(e=>{(this.CrmFrom.adivId=e.adivId)&&(this.CrmFrom.adivName=e.adivName)});let e="0",t={channelId:this.channelId,materialType:e,positionId:this.CrmFrom.adivId};Object(l["i"])(n,t).then(e=>{this.matList=e})},showImage(){Object(l["i"])(c,{materialId:this.CrmFrom.materialId}).then(e=>{})},SubInstall(){this.$refs.CrmFrom.validate(e=>{})}}},u=m,d=a("2877"),h=Object(d["a"])(u,i,r,!1,null,"f4ec5a32",null);t["a"]=h.exports},"4cec":function(e,t,a){"use strict";a("e349")},"4db8":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"CrmFrom",attrs:{"label-width":"130px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-form-item",{attrs:{label:"运营位：",prop:"adivInfo.adivId"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:e.changeAid},model:{value:e.CrmFrom.adivInfo.adivId,callback:function(t){e.$set(e.CrmFrom.adivInfo,"adivId",t)},expression:"CrmFrom.adivInfo.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1),t("el-form-item",{attrs:{label:"推荐用语：",prop:"channelConf.execContent"}},[t("el-input",{attrs:{type:"textarea",maxlength:"500","show-word-limit":""},model:{value:e.CrmFrom.channelConf.execContent,callback:function(t){e.$set(e.CrmFrom.channelConf,"execContent",t)},expression:"CrmFrom.channelConf.execContent"}})],1),t("el-form-item",{attrs:{label:"是否一键办理：",prop:"isOneKey"}},[t("el-radio-group",{model:{value:e.CrmFrom.isOneKey,callback:function(t){e.$set(e.CrmFrom,"isOneKey",t)},expression:"CrmFrom.isOneKey"}},[t("el-radio",{attrs:{label:!0}},[e._v("一键办理")]),t("el-radio",{attrs:{label:!1}},[e._v("非一键办理")])],1)],1),t("el-form-item",{attrs:{label:"短信用语：",prop:"channelConf.smsContent"}},[t("el-input",{attrs:{type:"textarea",maxlength:"500","show-word-limit":""},model:{value:e.CrmFrom.channelConf.smsContent,callback:function(t){e.$set(e.CrmFrom.channelConf,"smsContent",t)},expression:"CrmFrom.channelConf.smsContent"}})],1),t("el-form-item",{attrs:{label:"产品办理URL：",prop:"channelConf.materialDisplayUrl"}},[t("el-input",{model:{value:e.CrmFrom.channelConf.materialDisplayUrl,callback:function(t){e.$set(e.CrmFrom.channelConf,"materialDisplayUrl",t)},expression:"CrmFrom.channelConf.materialDisplayUrl"}})],1),t("el-form-item",{attrs:{label:"时机选择："}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.changeTime},model:{value:e.CrmFrom.channelConf.timeId,callback:function(t){e.$set(e.CrmFrom.channelConf,"timeId",t)},expression:"CrmFrom.channelConf.timeId"}},e._l(e.timeIdList,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),t("el-form-item",{attrs:{label:"时机描述："}},[t("el-input",{attrs:{type:"textarea",maxlength:"240","show-word-limit":""},model:{value:e.CrmFrom.channelConf.timeDistindes,callback:function(t){e.$set(e.CrmFrom.channelConf,"timeDistindes",t)},expression:"CrmFrom.channelConf.timeDistindes"}})],1)],1)],1)},r=[],l=a("0fea"),s=a("5e05");const o=s["a"].common.getSysEnum,n=s["a"].common.queryAdivInfo,c=s["a"].common.queryHallInfo;var m={props:["channelNewData"],data(){return{CrmFrom:{isOneKey:null,adivInfo:{},channelConf:{},channelId:"",channelName:"",attributionInfo:{}},CrmFromRules:{isOneKey:[{required:!0,message:"是否一键办理",trigger:"change"}],adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},timeIdList:[],adivList:[],attributionList:[]}},mounted(){this.getOptionData(),this.CrmFrom=JSON.parse(JSON.stringify(this.channelNewData))},methods:{async getOptionData(){await Object(l["i"])(o,{enumType:"iop_time_id"}).then(e=>{this.timeIdList=e}),await Object(l["i"])(n,{channelId:this.CrmFrom.channelId}).then(e=>{this.adivList=e}),await Object(l["i"])(c,{}).then(e=>{this.attributionList=e})},changeAid(e){var t="";this.adivList.forEach(a=>{e===a.adivId&&(t=a.adivName)}),this.CrmFrom.adivInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,adivName:t})},changeAttribution(e){var t="";this.attributionList.forEach(a=>{e===a.adivId&&(t=a.attributionName)}),this.CrmFrom.attributionInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,attributionName:t})},changeTime(){this.timeIdList.forEach(e=>{e.enumKey===this.CrmFrom.timeId&&(this.CrmFrom.timeName=e.enumValue)})},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e}},created(){}},u=m,d=a("2877"),h=Object(d["a"])(u,i,r,!1,null,"2ef65636",null);t["a"]=h.exports},"4e3f":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"query-form-cell-wrap"},[t("el-form",{ref:"form",attrs:{model:e.sizeForm,"label-width":e.labelWidth,"label-position":e.labelPosition,size:"mini"}},e._l(e.list,(function(a,i){return t("el-form-item",{key:i+"list",class:{disabled:a.disabled},attrs:{"label-width":a.labelWidth||e.labelWidth,label:a.label+"："}},[Array.isArray(a.values)?t("div",{staticClass:"fe-d-flex"},[t("div",{staticClass:"radio-box"},[a.dateType?e._e():t("el-radio-group",{attrs:{size:"mini",disabled:a.disabled},on:{change:function(t){return e.radioChange(e.sizeForm.radioModel[i],i)}},model:{value:e.sizeForm.radioModel[i],callback:function(t){e.$set(e.sizeForm.radioModel,i,t)},expression:"sizeForm.radioModel[index]"}},e._l(a.values,(function(a,i){return t("el-radio-button",{key:i+"listValues",attrs:{label:a.value}},[e._v(e._s(a.label)+" ")])})),1)],1),t("div",{staticClass:"date-box"},["date"===a.dateType?t("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd",clearable:!1},on:{change:e.dateChange},model:{value:e.sizeForm.dateModel[i],callback:function(t){e.$set(e.sizeForm.dateModel,i,t)},expression:"sizeForm.dateModel[index]"}}):e._e(),"month"===a.dateType?t("el-date-picker",{attrs:{type:"month",placeholder:"选择月","value-format":"yyyy-MM",clearable:!1},on:{change:e.dateChange},model:{value:e.sizeForm.dateModel[i],callback:function(t){e.$set(e.sizeForm.dateModel,i,t)},expression:"sizeForm.dateModel[index]"}}):e._e(),"daterange"===a.dateType?t("el-date-picker",{attrs:{type:"daterange","value-format":"yyyy-MM-dd","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",clearable:!0},on:{change:e.dateChange},model:{value:e.sizeForm.dateModel[i],callback:function(t){e.$set(e.sizeForm.dateModel,i,t)},expression:"sizeForm.dateModel[index]"}}):e._e(),"datetimerange"===a.dateType?t("el-date-picker",{attrs:{type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",clearable:!1},on:{change:e.dateChange},model:{value:e.sizeForm.dateModel[i],callback:function(t){e.$set(e.sizeForm.dateModel,i,t)},expression:"sizeForm.dateModel[index]"}}):e._e()],1)]):t("div",{staticClass:"input-box"},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{placeholder:"请输入内容"},on:{change:e.inputChange},model:{value:e.sizeForm.radioModel[i],callback:function(t){e.$set(e.sizeForm.radioModel,i,t)},expression:"sizeForm.radioModel[index]"}})],1)])})),1)],1)},r=[],l={name:"QueryFormCell",props:{labelWidth:{type:String,default:()=>"82px"},labelPosition:{type:String,default:()=>"right"},defaultSizeForm:{type:Object,default:()=>({})},list:{type:Array,default:()=>[{label:"数据时间",values:[{label:"不限",value:"1"}],isDate:!0,dateType:"date"},{label:"接口类型",values:[{label:"不限",value:"不限"},{label:"文件接口",value:"文件接口"}],isDate:!1}]}},data(){return{sizeForm:{dateModel:["2021-05-08","",""],radioModel:["自定义","不限","不限","不限"]}}},watch:{defaultSizeForm:{handler:function(e){this.sizeForm=e},deep:!0,immediate:!0}},methods:{radioChange(e,t){this.sizeForm.dateModel&&this.$set(this.sizeForm.dateModel,t,"date"===this.list[t].dateType?"":["",""]),this.$emit("queryForm",{index:t,value:e,form:this.sizeForm})},dateChange(e){e?(this.$set(this.sizeForm.dateModel,0,e),this.$emit("queryForm",{value:e,form:this.sizeForm})):this.$emit("emptyFrom",this.sizeForm)},inputChange(e){e&&this.$emit("queryForm",{value:e,form:this.sizeForm})}}},s=l,o=(a("a28d"),a("2877")),n=Object(o["a"])(s,i,r,!1,null,null,null);t["a"]=n.exports},"51a5":function(e,t,a){"use strict";a("1059")},"521b":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("el-form",{ref:"CrmFrom",attrs:{"label-width":"145px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("Tips",{attrs:{id:e.id}}),t("el-form-item",{attrs:{label:"推送方式：",prop:"columnExt1"}},[t("el-radio-group",{model:{value:e.CrmFrom.columnExt1,callback:function(t){e.$set(e.CrmFrom,"columnExt1",t)},expression:"CrmFrom.columnExt1"}},[t("el-radio",{attrs:{label:"1",disabled:!e.CrmFrom.channelFlag}},[e._v("全量推送")]),t("el-radio",{attrs:{label:"0",disabled:!e.CrmFrom.channelFlag}},[e._v("偏好推送")])],1)],1),t("el-form-item",{attrs:{label:"运营位：",prop:"adivInfo.adivId"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:e.changeAdiv},model:{value:e.CrmFrom.adivInfo.adivId,callback:function(t){e.$set(e.CrmFrom.adivInfo,"adivId",t)},expression:"CrmFrom.adivInfo.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1)],1)},r=[],l=a("0fea"),s=a("5e05"),o=a("b893"),n=a("5ed5"),c={props:["channelNewData","id"],components:{Tips:n["a"]},data(){return{CrmFrom:{adivInfo:{adivId:"",adivName:""}},CrmFromRules:{adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]}},adivList:[]}},watch:{channelNewData:{handler(){this.CrmFrom=Object(o["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"adivInfo",this.CrmFrom.adivInfo||{adivId:"",adivName:""})},deep:!0}},methods:{getAdivList(){Object(l["i"])(s["a"].common.queryAdivInfo,{channelId:this.id}).then(e=>{this.adivList=e,this.adivList.length>0&&this.$set(this.CrmFrom,"adivInfo",this.adivList[0]||{adivId:"",adivName:""})})},changeAdiv(e){const t=this.adivList.find(t=>t.adivId===e);this.CrmFrom.adivInfo=t||{adivId:"",adivName:""}},SubInstall(){let e=!0;return this.$refs.CrmFrom.validate(t=>{t?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e}},created(){this.getAdivList(),this.CrmFrom=Object(o["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"adivInfo",this.CrmFrom.adivInfo||{adivId:"",adivName:""})}},m=c,u=a("2877"),d=Object(u["a"])(m,i,r,!1,null,"72603716",null);t["a"]=d.exports},"523c":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("el-form",{ref:"CrmFrom",attrs:{"label-width":"145px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("Tips",{attrs:{id:e.id},on:{getChannelDetail:e.getChannelDetail}}),t("el-form-item",{attrs:{label:"推送方式：",prop:"columnExt1"}},[t("el-radio-group",{model:{value:e.CrmFrom.columnExt1,callback:function(t){e.$set(e.CrmFrom,"columnExt1",t)},expression:"CrmFrom.columnExt1"}},[t("el-radio",{attrs:{label:"1",disabled:!e.CrmFrom.channelFlag}},[e._v("全量推送")]),t("el-radio",{attrs:{label:"0",disabled:!e.CrmFrom.channelFlag}},[e._v("偏好推送")])],1)],1),t("el-form-item",{attrs:{label:"运营位：",prop:"adivInfo.adivId"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:e.changeAdiv},model:{value:e.CrmFrom.adivInfo.adivId,callback:function(t){e.$set(e.CrmFrom.adivInfo,"adivId",t)},expression:"CrmFrom.adivInfo.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1),e.showExt18?t("el-form-item",{attrs:{label:"智能话术："}},[t("el-checkbox",{on:{change:()=>e.CrmFrom.columnExt18=e.checkColumnExt18?"1":"0"},model:{value:e.checkColumnExt18,callback:function(t){e.checkColumnExt18=t},expression:"checkColumnExt18"}},[e._v("启用")]),e.checkColumnExt18?t("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt18,callback:function(t){e.$set(e.CrmFrom,"columnExt18",t)},expression:"CrmFrom.columnExt18"}},[t("el-radio",{attrs:{label:"1"}},[e._v("省端模型")]),t("el-radio",{attrs:{label:"2"}},[e._v("一级IOP模型")])],1):e._e()],1):e._e(),t("el-form-item",{attrs:{label:"推荐用语：",prop:"channelConf.execContent"}},[t("el-input",{attrs:{type:"textarea",rows:5,maxlength:"500","show-word-limit":"",placeholder:"请输入推荐用语"},on:{input:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.channelConf.execContent,callback:function(t){e.$set(e.CrmFrom.channelConf,"execContent",t)},expression:"CrmFrom.channelConf.execContent"}})],1)],1)},r=[],l=a("0fea"),s=a("5e05"),o=a("b893"),n=a("5ed5"),c={props:["channelNewData","id"],components:{Tips:n["a"]},data(){return{CrmFrom:{adivInfo:{adivId:"",adivName:""},columnExt1:"1",columnExt18:"0",channelConf:{execContent:""}},showExt18:!1,checkColumnExt18:!1,CrmFromRules:{columnExt1:[{required:!0,message:"请选择推送方式",trigger:"blur"}],adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}]}},adivList:[]}},watch:{channelNewData:{handler(){this.CrmFrom=Object(o["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.checkColumnExt18=this.CrmFrom.columnExt18>0},deep:!0}},methods:{getChannelDetail(e){1==e.smartScript&&(this.showExt18=!0)},getAdivList(){Object(l["i"])(s["a"].common.queryAdivInfo,{channelId:this.id}).then(e=>{this.adivList=e})},changeAdiv(e){const t=this.adivList.find(t=>t.adivId===e);this.CrmFrom.adivInfo=t||{adivId:"",adivName:""}},SubInstall(){let e=!0;return this.$refs.CrmFrom.validate(t=>{t?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e}},created(){this.getAdivList(),this.CrmFrom=Object(o["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.checkColumnExt18=this.CrmFrom.columnExt18>0}},m=c,u=a("2877"),d=Object(u["a"])(m,i,r,!1,null,"111afee5",null);t["a"]=d.exports},"526e":function(e,t,a){},"52f7":function(e,t,a){},5310:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("el-select",{attrs:{multiple:"",size:e.size||void 0},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},e._l(e.sceneOptions,(function(a){return t("el-option-group",{key:a.label,attrs:{label:a.label}},e._l(a.data,(function(e){return t("el-option",{key:e.CAMP_BUSINESS_TYPE,attrs:{label:e.CAMP_BUSINESS_TYPE,value:e.CAMP_BUSINESS_TYPE,disabled:e.disabled}})})),1)})),1)},r=[],l=a("0fea"),s=a("31b1"),o={props:{baseForm:{type:Object,required:!0},size:{type:void 0|String,default:void 0},initialData:{type:Object,default:()=>({})}},data(){return{selected:[],sceneOptions:[{label:"存量",data:[]},{label:"产品",data:[]},{label:"其他",data:[]}],allSceneList:[]}},watch:{baseForm:{handler(e,t){var a;(null===e||void 0===e?void 0:e.campScene)!==(null===t||void 0===t?void 0:t.campScene)&&(this.selected=(null===(a=this.baseForm.campScene)||void 0===a?void 0:a.split(";"))||[],this.selected=this.selected.filter(e=>e))},deep:!0,immediate:!0},selected:{handler(e,t){if(0===this.allSceneList.length)return this.baseForm.campScene="",void this.$emit("change",this.baseForm.campScene);if(e.length===t.length)return;if(e.length<t.length){const a=t.find(t=>!e.includes(t)),i=this.allSceneList.find(e=>e.CAMP_BUSINESS_TYPE===a);return"其他"===i.type&&(this.allSceneList.forEach(e=>{e.disabled=!1}),this.$forceUpdate()),this.baseForm.campScene=this.selected.join(";"),void this.$emit("change",this.baseForm.campScene)}const a=e[e.length-1],i=this.allSceneList.find(e=>e.CAMP_BUSINESS_TYPE===a),r=this.selected.filter(e=>{const t=this.allSceneList.find(t=>t.CAMP_BUSINESS_TYPE===e);return t.type===i.type}),l=r.map(e=>this.allSceneList.find(t=>t.CAMP_BUSINESS_TYPE===e));switch(i.type){case"存量":if(r.length>1){const e=this.selected.filter(e=>{if(!r.includes(e))return!0;const t=l.find(t=>t.CAMP_BUSINESS_TYPE===e);return(null===t||void 0===t?void 0:t.CAMP_BUSINESS_TYPE)===a});this.selected=e}break;case"产品":if(r.length>1){const e=this.selected.filter(e=>{if(!r.includes(e))return!0;const t=l.find(t=>t.CAMP_BUSINESS_TYPE===e);return(null===t||void 0===t?void 0:t.CAMP_BUSINESS_TYPE)===a});this.selected=e}break;case"其他":this.selected.length>1&&(this.selected=[a]),this.allSceneList.forEach(e=>{"其他"!==e.type&&(e.disabled=!0)}),this.$forceUpdate();break}this.baseForm.campScene=this.selected.join(";"),this.$emit("change",this.baseForm.campScene)},deep:!0}},methods:{querySceneList(){Object(l["i"])(s["a"].channel.queryCampScene).then(e=>{this.sceneOptions.forEach(t=>{t.data=e[t.label]||[],t.data.forEach(e=>{e.type=t.label,e.disabled=!1}),this.allSceneList=this.allSceneList.concat(t.data)})})}},created(){0===Object.keys(this.initialData).length?this.querySceneList():this.sceneOptions.forEach(e=>{e.data=this.initialData[e.label]||[],e.data.forEach(t=>{t.type=e.label,t.disabled=!1}),this.allSceneList=this.allSceneList.concat(e.data)})}},n=o,c=a("2877"),m=Object(c["a"])(n,i,r,!1,null,"fa9c6be6",null);t["a"]=m.exports},"533d":function(e,t,a){"use strict";a("0298")},"53e3":function(e,t,a){},5414:function(e,t,a){e.exports=a.p+"img/pdf.8249fad0.png"},"546b":function(e,t,a){"use strict";a("3b91")},5565:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("section",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:()=>{},expression:"()=>{}"}]},[t("header",[e._v(e._s("product"==e.type?"选产品":"customer"===e.type?"选客群":"选渠道")+" / 营销历史 "),t("i",{staticClass:"el-icon-close",on:{click:e.close}})]),t("main",["channel"===e.type?t("h3",[e._v("所选产品渠道营销成功率 (近30天)")]):e._e(),e._l(e.barData,(function(a){return t("div",{directives:[{name:"loading",rawName:"v-loading",value:a.loading,expression:"item.loading"}],key:a.id,staticClass:"container",attrs:{"element-loading-background":"rgba(0, 0, 0, 0.3)"}},[t("div",{ref:"echartRef",refInFor:!0,staticClass:"echarts-container",class:["product"===e.type?"product-define":""]})])})),t("div",{ref:"mouseText"})],2)])},r=[],l=(a("14d9"),a("9169")),s={name:"MarketingHistory",directives:{Clickoutside:l["a"]},props:{type:{type:String,default:"product"},barData:{type:Array,default:()=>[{id:"",title:"",subTitle:"",loading:!1,yAxis:{name:"",data:[]},xAxis:{name:"",labelRotate:!0,data:[]},itemClickEvent:!1}]}},data(){return{loading:!0,echartsList:[]}},watch:{barData:{handler(e){this.$nextTick(()=>{for(let t=0;t<e.length;t++)this.echartsList[t]||(this.echartsList[t]=this.$echarts.init(this.$refs["echartRef"][t])),this.echartsList[t].setOption(this.getOption(e[t]));this.$forceUpdate()})},deep:!0}},methods:{getOption(e){return{grid:{left:"product"===this.type?65:50,right:50,containLabel:!0},title:{show:e.title,text:e.title,top:"channel"===this.type?"auto":10,bottom:"channel"===this.type?40:"auto",left:"center",textStyle:e.titleStyle||{}},yAxis:{name:e.yAxis.name,nameTextStyle:{padding:"product"===this.type?[0,65,-35,0]:[0,45,-32,0]},type:"value",axisLine:{show:!0,symbol:["none","arrow"],symbolOffset:[0,12]},axisLabel:{show:!1}},xAxis:{name:e.xAxis.name,namePosition:"end",nameTextStyle:{align:"right",verticalAlign:"top",padding:[10,-25,0,0]},type:"category",axisLine:{show:!0,symbol:["none","arrow"],symbolOffset:[0,12]},axisTick:{alignWithLabel:!0},axisLabel:{interval:0,fontSize:12,rotate:e.xAxis.labelRotate&&e.xAxis.data.length>1?25:0,formatter(e,t){return 0===t&&e.length>8?e.slice(0,8)+"..":(e.length>11&&(e=e.slice(0,11)+".."),e)}},data:e.xAxis.data,triggerEvent:e.itemClickEvent},series:[{data:e.yAxis.data,type:"bar",barWidth:"60%",color:"#59acec",label:{show:!0,position:"top",color:"#333",formatter:e=>{let t=e.value;if("product"!==this.type){if(t+="",t.includes(".")){let e=t.split(".")[0]||0,a=t.split(".")[1],i=a.length?(Number(a)/100).toFixed(2):0;return`${e}\n(${i}%)`}return 0}return"number"===typeof t||"number"===typeof parseFloat(t)?t+"%":"0%"}}}]}},clickBar(e){const t=this.$router.resolve({path:"/MarketingPlanning/MarketingMP",params:{tab:2,queryParams:JSON.stringify({keyWords:e.data.campsegName})}});window.open(t.href,"_blank")},mouseoverXaxis(e){let t=this.$refs.mouseText,a="position: absolute;z-index: 99999;color: #fff;font-size: 12px;padding: 5px;display: inline;border-radius: 4px;background-color: #303133;box-shadow: rgba(0, 0, 0, 0.3) 2px 2px 8px";t.style.cssText=a,t.innerHTML=e.value,t.style.display="block";let i=e.event.offsetX,r=e.event.offsetY;t.style.left=i+10+"px",t.style.top=r+10+"px"},resize(){for(let e=0;e<this.echartsList.length;e++)this.echartsList[e].resize()},close(){this.$emit("close")}},mounted(){this.$nextTick(()=>{for(let e=0;e<this.barData.length;e++){let t=this.$echarts.init(this.$refs["echartRef"][e]);this.echartsList.push(t),t.setOption(this.getOption(this.barData[e])),this.barData[e].itemClickEvent&&(t.on("click","series.bar",this.clickBar),t.on("mouseover","xAxis.category",this.mouseoverXaxis),t.on("mouseout","xAxis.category",()=>{this.$refs.mouseText.style.display="none"}))}})},beforeDestroy(){window.removeEventListener("resize",this.resize);for(let e=0;e<this.echartsList.length;e++)this.echartsList[e].dispose()}},o=s,n=(a("7f9a"),a("2877")),c=Object(n["a"])(o,i,r,!1,null,"06a71ad6",null);t["a"]=c.exports},"56b3":function(e,t,a){e.exports=a.p+"img/txt.3756ec5e.png"},"571b":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("BaseDialog",{attrs:{title:`话术评价【${e.currentRow.scriptName}】`,visible:e.dialogVisible,width:"500px",top:"25vh","confirm-button-text":"提 交","show-cancel-button":!1,"confirm-loading":e.loading},on:{confirm:e.submit,close:e.close}},[t("el-form",{ref:"ruleForm",attrs:{model:e.form}},e._l(e.form,(function(a,i){return t("el-form-item",{key:i,attrs:{label:e.keyMap.get(i),prop:i,rules:[{required:!0,validator:e.validate,trigger:"change"}]}},[t("el-rate",{attrs:{"show-text":"",max:5,colors:e.colors,texts:e.texts},model:{value:e.form[i],callback:function(t){e.$set(e.form,i,t)},expression:"form[key]"}})],1)})),1)],1)},r=[],l=(a("d9e2"),a("0fea")),s=a("cdbb"),o=a("ea45"),n={components:{BaseDialog:o["a"]},props:{dialogVisible:{type:Boolean,default:!1},currentRow:{type:Object,default:()=>({})}},watch:{dialogVisible(e){if(!e){this.$refs.ruleForm.clearValidate();for(const e in this.form)this.form.hasOwnProperty(e)&&(this.form[e]=null)}}},data(){return{loading:!1,keyMap:new Map([["syxStarNumber","实用性"],["tyxStarNumber","通用性"],["zqxStarNumber","准确性"]]),form:{syxStarNumber:null,tyxStarNumber:null,zqxStarNumber:null},colors:["#99A9BF","#67a6e7","#2F87EC"],texts:["很差","差","一般","满意","优秀"]}},methods:{validate(e,t,a){const i=this.keyMap.get(e.field);t<1?a(new Error(`请对${i}进行星级评价`)):a()},submit(){this.$refs.ruleForm.validate(async e=>{if(e)try{this.loading=!0;const e={...this.form,scriptId:this.currentRow.scriptId,scriptName:this.currentRow.scriptName};await Object(l["i"])(s["a"].getScriptAppraise,e);this.$message.success("评价成功"),this.$emit("refresh"),this.$nextTick(()=>{this.close()})}catch(t){}finally{this.loading=!1}})},close(){this.$emit("update:dialogVisible",!1)}}},c=n,m=(a("d6bd"),a("2877")),u=Object(m["a"])(c,i,r,!1,null,"3b927ad5",null);t["a"]=u.exports},"57d8":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",e._l(e.attrInfoList,(function(a){return t("el-form-item",{key:a.attrId,attrs:{label:a.attrName+"：",prop:0===a.isNullable?"channelConf.channelExtConf."+a.attrId:void 0,rules:0===a.isNullable?a.Rules:void 0}},[1===a.attrValueType?t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{maxlength:a.attrLength},model:{value:e.DataFrom[a.attrId],callback:function(t){e.$set(e.DataFrom,a.attrId,t)},expression:"DataFrom[item.attrId]"}}):e._e(),6===a.attrValueType?t("el-radio-group",{model:{value:e.DataFrom[a.attrId],callback:function(t){e.$set(e.DataFrom,a.attrId,t)},expression:"DataFrom[item.attrId]"}},e._l(a.dataSource,(function(a){return t("el-radio",{key:a.attrValueId,attrs:{label:a.attrValueId}},[e._v(e._s(a.attrValueName))])})),1):e._e(),7===a.attrValueType?t("el-checkbox-group",{model:{value:e.DataFrom[a.attrId],callback:function(t){e.$set(e.DataFrom,a.attrId,t)},expression:"DataFrom[item.attrId]"}},e._l(a.dataSource,(function(a){return t("el-checkbox",{key:a.attrValueId,attrs:{label:a.attrValueId}},[e._v(e._s(a.attrValueName))])})),1):e._e(),3===a.attrValueType?t("el-select",{attrs:{placeholder:"请选择"+a.attrName},model:{value:e.DataFrom[a.attrId],callback:function(t){e.$set(e.DataFrom,a.attrId,t)},expression:"DataFrom[item.attrId]"}},e._l(a.dataSource,(function(e){return t("el-option",{key:e.attrValueId,attrs:{label:e.attrValueName,value:e.attrValueId}})})),1):e._e(),4===a.attrValueType?t("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd"},model:{value:e.DataFrom[a.attrId],callback:function(t){e.$set(e.DataFrom,a.attrId,t)},expression:"DataFrom[item.attrId]"}}):e._e(),5===a.attrValueType?t("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.DataFrom[a.attrId],callback:function(t){e.$set(e.DataFrom,a.attrId,t)},expression:"DataFrom[item.attrId]"}}):e._e(),2===a.attrValueType?t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{type:"textarea",rows:4,"show-word-limit":"",maxlength:a.attrLength},model:{value:e.DataFrom[a.attrId],callback:function(t){e.$set(e.DataFrom,a.attrId,t)},expression:"DataFrom[item.attrId]"}}):e._e()],1)})),1)},r=[],l=(a("d9e2"),a("14d9"),a("a454")),s=a("0fea");const o=(e,t,a)=>{const i=/^[1-9]\d*$/;i.test(t)?a():a(new Error("请输入数字"))};var n={props:["CrmFrom"],data(){return{DataFrom:{},attrInfoList:[]}},mounted(){},methods:{async lookSchedulingInfo(e){this.attrInfoList=[],this.DataFrom={},void 0!==e&&""!==e&&void 0!==e&&"0"!==e&&await Object(s["i"])(l["a"].scheduling.lookSchedulingInfo,{id:e+""}).then(e=>{var t=[],a={};t=e.attrInfoList.map(async(e,t)=>{if(7===e.attrValueType?a[e.attrId]=this.CrmFrom[e.attrId]||[]:a[e.attrId]=this.CrmFrom[e.attrId]||"",null!==e.resoureUrl){var i=await Object(s["g"])(e.resoureUrl);e.dataSource=i,i.map(t=>{1===t.isDefaultValue&&(Array.isArray(a[e.attrId])?Array.isArray(this.CrmFrom[e.attrId])&&0===this.CrmFrom[e.attrId].length?a[e.attrId].push(t.attrValueId):a[e.attrId]=this.CrmFrom[e.attrId]:a[e.attrId]=this.CrmFrom[e.attrId]||t.attrValueId)})}return e.Rules=[],0===e.isNullable&&e.Rules.push({required:!0,message:e.attrName+"不能为空",trigger:"blur"}),1===e.attrFormat&&e.Rules.push({validator:o,trigger:"blur"}),e}),t.map(async e=>{await e.then(e=>{this.attrInfoList.push(e),this.attrInfoList=this.insertSort(this.attrInfoList)})}),this.DataFrom=Object.assign(a,this.DataFrom),this.$watch("DataFrom",e=>{this.$emit("configGsheet",e)},{deep:!0})})},insertSort(e){for(var t=e.length,a=1;a<t;a++){var i=e[a],r=a-1;while(r>=0&&e[r].serialNumber>i.serialNumber)e[r+1]=e[r],r--;e[r+1]=i}return e}}},c=n,m=a("2877"),u=Object(m["a"])(c,i,r,!1,null,"1ce56c84",null);t["a"]=u.exports},5976:function(e,t,a){"use strict";a("1173")},5985:function(e,t,a){"use strict";a("3175")},"5ac7":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("Tips",{attrs:{id:e.id},on:{getChannelDetail:e.getChannelDetail}}),e._e(),t("el-form",{ref:"CrmFrom",staticStyle:{width:"100%"},attrs:{"label-width":"145px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"推送方式：",prop:"columnExt1"}},[t("el-radio-group",{model:{value:e.CrmFrom.columnExt1,callback:function(t){e.$set(e.CrmFrom,"columnExt1",t)},expression:"CrmFrom.columnExt1"}},[t("el-radio",{attrs:{label:"1",disabled:!e.CrmFrom.channelFlag}},[e._v("全量推送")]),t("el-radio",{attrs:{label:"0",disabled:!e.CrmFrom.channelFlag}},[e._v("偏好推送")])],1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"运营位：",prop:"adivInfo.adivId"}},[t("el-select",{attrs:{placeholder:"请选择营销类型"},on:{change:e.changeAid},model:{value:e.CrmFrom.adivInfo.adivId,callback:function(t){e.$set(e.CrmFrom.adivInfo,"adivId",t)},expression:"CrmFrom.adivInfo.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1)],1),e.CrmFrom.showScene?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"复杂事件场景：",prop:"CEP_EVENT_ID"}},[t("div",[t("div",{staticStyle:{display:"flex","justify-content":"space-between","max-width":"375px"}},[t("div",{staticClass:"add-botton"},[t("span",{on:{click:function(t){return e.openSceneDilog(!0)}}},[e._v(e._s(e.CrmFrom.sceneParams.eventName||"添加"))]),t("i",{directives:[{name:"show",rawName:"v-show",value:e.CrmFrom.sceneParams.eventName,expression:"CrmFrom.sceneParams.eventName"}],staticClass:"el-icon-close",on:{click:e.removeEvent}})]),t("el-checkbox",{model:{value:e.CrmFrom.checked,callback:function(t){e.$set(e.CrmFrom,"checked",t)},expression:"CrmFrom.checked"}},[e._v("取消推荐规则设置")])],1),"JX0000000001"===e.customGroupId?t("div",{staticStyle:{color:"red","font-size":"12px"}},[e._v("该活动没有限定客群，触发事件即发送，请慎重选择事件！")]):e._e(),e.CrmFrom.checked?t("div",{staticClass:"select"},[t("div",{staticClass:"setRules"},[t("p",[e._v("已选择事件："+e._s(e.CrmFrom.sceneParams.eventName))])]),t("div",[t("span",[e._v("取消推荐时间：")]),t("el-select",{attrs:{placeholder:"请选择执行端口",size:"mini"},model:{value:e.CrmFrom.columnExt4,callback:function(t){e.$set(e.CrmFrom,"columnExt4",t)},expression:"CrmFrom.columnExt4"}},e._l(e.columnExt4List,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]):e._e()])])],1):e._e(),e.showExt18?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"智能话术："}},[t("el-checkbox",{on:{change:()=>e.CrmFrom.columnExt18=e.checkColumnExt18?"1":"0"},model:{value:e.checkColumnExt18,callback:function(t){e.checkColumnExt18=t},expression:"checkColumnExt18"}},[e._v("启用")]),e.checkColumnExt18?t("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt18,callback:function(t){e.$set(e.CrmFrom,"columnExt18",t)},expression:"CrmFrom.columnExt18"}},[t("el-radio",{attrs:{label:"1"}},[e._v("省端模型")]),t("el-radio",{attrs:{label:"2"}},[e._v("一级IOP模型")])],1):e._e()],1)],1):e._e(),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"彩信任务编号：",prop:"columnExt2","label-width":"148px"}},[t("el-input",{attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字",disabled:""},model:{value:e.CrmFrom.columnExt2,callback:function(t){e.$set(e.CrmFrom,"columnExt2",t)},expression:"CrmFrom.columnExt2"}}),t("div",{staticClass:"button"},[t("div",{staticClass:"sub-otton",on:{click:function(t){return e.openDilog(!0)}}},[e._v("视频彩信模板")])])],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"彩信任务主题：",prop:"columnExt3","label-width":"148px"}},[t("el-input",{attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字",disabled:""},model:{value:e.CrmFrom.columnExt3,callback:function(t){e.$set(e.CrmFrom,"columnExt3",t)},expression:"CrmFrom.columnExt3"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"彩信地址：",prop:"columnExt5","label-width":"148px"}},[t("el-input",{attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字",disabled:""},model:{value:e.CrmFrom.columnExt5,callback:function(t){e.$set(e.CrmFrom,"columnExt5",t)},expression:"CrmFrom.columnExt5"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"频次配置：",prop:e.CrmFrom.FREQUENCY?"FREQUENCY":"num"}},[t("div",{staticStyle:{display:"flex"}},[t("el-select",{attrs:{placeholder:"请选择天数"},model:{value:e.CrmFrom.FREQUENCY,callback:function(t){e.$set(e.CrmFrom,"FREQUENCY",t)},expression:"CrmFrom.FREQUENCY"}},e._l(e.dateList,(function(e){return t("el-option",{key:e.cycleId,attrs:{label:e.cycleName,value:e.cycle}})})),1),t("el-input",{staticStyle:{width:"100px",margin:"0px 20px"},attrs:{type:"text",rows:8,placeholder:""},model:{value:e.CrmFrom.num,callback:function(t){e.$set(e.CrmFrom,"num",t)},expression:"CrmFrom.num"}}),e._v("次 ")],1)])],1)],1)],1),t("ShortMessageList",{ref:"messageList",attrs:{tableData:e.tableData,cols:e.cols,channelId:e.id},on:{getSmsContentTemplateList:e.getSmsContentTemplateList,addShortMessage:e.addShortMessage}}),t("ComplexScene",{ref:"SceneDialog",on:{addScene:e.addScene}}),t("materialList",{ref:"material",attrs:{channelId:e.id,adivId:e.CrmFrom.adivInfo.adivId},on:{addMaterial:e.addMaterial}})],1)},r=[],l=a("0fea"),s=a("5e05"),o=(a("0b16"),a("c3eb")),n=a("b893"),c=a("aedd"),m=a("f1ce"),u=a("5ed5");const d=s["a"].common.getSysEnum,h=s["a"].common.queryAdivInfo,p=s["a"].common.queryHallInfo;var v={props:["channelNewData","id","deleteSub"],components:{ShortMessageList:o["a"],ComplexScene:c["a"],materialList:m["a"],Tips:u["a"]},data(){return{CrmFrom:{adivInfo:{},channelId:"",channelName:"",attributionInfo:{},columnExt1:"1",standard:"",CustomerRules:"",marketingWords:"",FREQUENCY:"",num:"",CEP_EVENT_ID:"",IF_HAVE_VAR:"",columnExt4:"7",columnExt18:"0",showScene:!1,sceneParams:{eventName:""},checked:Boolean},showExt18:!1,checkColumnExt18:!1,CrmFromRules:{columnExt1:[{required:!0,message:"请选择推送方式",trigger:"blur"}],marketingWords:[{required:!0,message:"请输入营销话术",trigger:"blur"}],FREQUENCY:[{required:!0,message:"请选择频次配置",trigger:"blur"}],CEP_EVENT_ID:[{required:!0,message:"请选择复杂场景事件",trigger:"blur"}],num:[{required:!0,message:"请填写次数",trigger:"blur"}],columnExt2:[{required:!0,message:"请输入彩信任务编号",trigger:"blur"}],columnExt3:[{required:!0,message:"请输入彩信任务主题",trigger:"blur"}],columnExt5:[{required:!0,message:"请输入彩信地址",trigger:"blur"}],adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},timeIdList:[],adivList:[],attributionList:[],tableData:[],cols:[{label:"彩信模板编号",props:"id"},{label:"彩信主题",props:"templateName"},{label:"彩信地址",props:"mmsAddress"}],dateList:"",sceneParams:{},columnExt4List:[{label:"1天",value:"1"},{label:"2天",value:"2"},{label:"3天",value:"3"},{label:"4天",value:"4"},{label:"5天",value:"5"},{label:"6天",value:"6"},{label:"7天",value:"7"}],toolTopContent:"IOP免打扰时间段为21:00-8:00,在此期间将不会主动推送营销信息给客户。周期性客群如当天任务没有发送完成,将不会在第二天发送,第二天直接使用更新后客群发送。"}},computed:{checked(){return this.CrmFrom.checked},customGroupId(){var e;return null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.customGroupId}},watch:{channelNewData:{handler(){this.CrmFrom=Object(n["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"columnExt4",this.CrmFrom.columnExt4||"7"),this.$set(this.CrmFrom,"sceneParams",this.CrmFrom.sceneParams||{eventName:""}),this.checkColumnExt18=this.CrmFrom.columnExt18>0},deep:!0},CrmFrom:{handler(e,t){},deep:!0},deleteSub(){},checked(e){this.CrmFrom={...this.CrmFrom}},SMS_CONTENT(e){e&&(this.CrmFrom={...this.CrmFrom,IF_HAVE_VAR:-1!==e.search(this.ShortMsgContent)?"1":"0"})}},mounted(){this.getOptionData(),this.getDateList(),this.CrmFrom=Object(n["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt4",this.CrmFrom.columnExt4||"7"),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"sceneParams",this.CrmFrom.sceneParams||{eventName:""}),this.checkColumnExt18=this.CrmFrom.columnExt18>0},methods:{getChannelDetail(e){1==e.smartScript&&(this.showExt18=!0)},async getOptionData(){await Object(l["i"])(d,{enumType:"iop_time_id"}).then(e=>{this.timeIdList=e}),await Object(l["i"])(h,{channelId:this.id}).then(e=>{this.adivList=e}),await Object(l["i"])(p,{}).then(e=>{this.attributionList=e})},changeAid(e){var t="";this.adivList.forEach(a=>{e===a.adivId&&(t=a.adivName)}),this.CrmFrom.adivInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,adivName:t}),this.CrmFrom.sceneParams={...this.CrmFrom.sceneParams},this.removeEvent(),this.CrmFrom.checked=!1,"9322"===e?this.CrmFrom.showScene=!0:(this.CrmFrom.showScene=!1,this.CrmFrom={...this.CrmFrom,showScene:!1,sceneParams:{eventName:""},CEP_EVENT_ID:"",CEP_SCENE_NAME:"",checked:!1})},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t||("906"===this.id||"922"===this.id)&&this.CrmFrom.marketingWords&&this.CrmFrom.adivInfo.adivId?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e},openDilog(e){this.$refs["messageList"].showDialog(e)},addShortMessage(e){this.CrmFrom={...this.CrmFrom,columnExt2:e.row.id,columnExt3:e.row.templateName,columnExt5:e.row.mmsAddress}},async getSmsContentTemplateList(e){const t={...e,pageSize:e.size,pageNum:e.current};await Object(l["i"])(s["a"].common.getMobileVideo,t).then(e=>{e.width=570,this.tableData={...e,records:e.result}})},openSceneDilog(e){this.$refs["SceneDialog"].showDialog(e)},addScene(e){this.CrmFrom={...this.CrmFrom,CEP_EVENT_ID:e.eventId,CEP_SCENE_NAME:e.eventName,sceneParams:e}},removeEvent(){this.CrmFrom.sceneParams={eventName:""},this.CrmFrom.CEP_EVENT_ID="",this.CrmFrom.CEP_SCENE_NAME=""},async getDateList(){await Object(l["i"])(s["a"].common.getDateList).then(e=>{this.dateList=e})},selectMaterial(e){this.$refs["material"].getMaterialList(),this.$refs["material"].showDialog(e)},addMaterial(e){this.CrmFrom={...this.CrmFrom,columnExt20:e.materialId,materialName:e.materialName}}},created(){}},C=v,b=(a("8c8d"),a("2877")),f=Object(b["a"])(C,i,r,!1,null,"5a28cdbb",null);t["a"]=f.exports},"5bcb":function(e,t,a){"use strict";a("32ec")},"5c12":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ProductDialog"},[t("mp-dialog",{attrs:{title:"选客户",visible:e.visible,width:"760px",IsAscertain:!1},on:{"update:visible":function(t){e.visible=t},DialogClose:e.DialogClose}},[t("div",{attrs:{slot:"Dialogcontent"},slot:"Dialogcontent"},[t("label-screen",{attrs:{title:"已选客户群",ismutex:!1,isPulldown:!1,Label:e.Label,Default:e.LabelDefault,showHistoryBtn:e.showHistoryBtn},on:{openHistory:e.showHistory,close:e.handleClose}}),e.hasPermission?t("div",{staticClass:"cust-source"},[t("el-radio-group",{attrs:{size:"mini"},on:{change:e.searchCustomerBaseList},model:{value:e.customerGroupSource,callback:function(t){e.customerGroupSource=t},expression:"customerGroupSource"}},e._l(e.custSourceList,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value,border:""}},[e._v(e._s(a.label))])})),1)],1):e._e(),t("div",{staticClass:"search_box",staticStyle:{width:"auto"}},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],staticClass:"input-search",attrs:{placeholder:0==e.customerGroupSource?"请输入客户群名称/编号":"请输入客户群名称"},model:{value:e.queryFrom.keyWords,callback:function(t){e.$set(e.queryFrom,"keyWords","string"===typeof t?t.trim():t)},expression:"queryFrom.keyWords"}},[t("i",{staticClass:"el-input__icon el-icon-search cursor-pointer",attrs:{slot:"suffix"},on:{click:e.searchCustomerBaseList},slot:"suffix"})])],1),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"Cust"},[t("div",{staticClass:"CustList"},e._l(e.CustomerBaseList,(function(a){return t("div",{key:a.customGroupId,staticClass:"Mt",on:{click:function(t){return e.CustomerClick(a)}}},[t("customer-list",{attrs:{Default:e.BaseDefault,CustomerData:a,isSelect:-1!==e.CustomerisSelect.indexOf(a.customGroupId)},on:{PushContent:e.PushContent}})],1)})),0)]),t("div",{staticClass:"pager"},[t("el-pagination",{attrs:{"current-page":e.pageData.currentPage,"page-size":e.pageData.pageSize,layout:"total, prev, pager, next, jumper",total:e.pageData.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("div",{staticClass:"Product-button"},[t("el-button",{attrs:{type:"success",size:"medium"},on:{click:e.CustomerSub}},[e._v("确定")])],1)],1)]),t("chocustomer-detail",{ref:"chocustomerDetail",attrs:{customerGroupSource:e.customerGroupSource}}),t("transition",{attrs:{name:"fade"}},[e.showHistoryFlag?t("div",{staticClass:"history-part"},[t("MarketingHistory",{attrs:{type:"customer","bar-data":e.historyList},on:{close:e.closeHistoryBar}})],1):e._e()])],1)},r=[],l=a("5565"),s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"customer",class:e.isSelect?"created":""},[t("div",{staticClass:"customer-flex"},[t("div",{staticClass:"title"},[t("span",[e._v(e._s(e.CustomerData[e.Default.title]))])]),t("div",{class:[3===e.CustomerData.updateCycle?"type":2===e.CustomerData.updateCycle?"updatetype2":1===e.CustomerData.updateCycle?"updatetype1":"",0==e.CustomerData.updateStatus?"outDate":""]},[e._v(" "+e._s(0==e.CustomerData.updateStatus?"离线":e.typeEumn[Number(e.CustomerData.updateCycle)-1])+" ")])]),t("div",{staticClass:"customer-flex line32"},[t("span",[e._v(" 客户规模："+e._s(e.CustomerData[e.Default.scale])+" ")])]),t("div",{staticClass:"customer-flex"},[t("div",[t("span",[e._v("创建人："+e._s(e.CustomerData[e.Default.founder]))])]),t("div",{staticClass:"PushContent",on:{click:function(t){return t.stopPropagation(),e.PushContent.apply(null,arguments)}}},[t("span",[e._v("详情>")])])])])},o=[],n={props:{isSelect:{type:Boolean,default:()=>!1},CustomerData:{type:Object,default:()=>({})},Default:{type:Object,default:()=>({id:"id",title:"title",scale:"scale",founder:"Founder",type:"type"})}},data(){return{typeEumn:["一次性","月","日"]}},methods:{PushContent(){this.$emit("PushContent",this.CustomerData)}}},c=n,m=(a("fa86"),a("2877")),u=Object(m["a"])(c,s,o,!1,null,"cfebf7f4",null),d=u.exports,h=a("7b5a"),p=a("b132"),v=function(){var e=this,t=e._self._c;return t("div",[t("mp-dialog",{attrs:{title:"客户群详情",visible:e.visible,width:"760px",IsAscertain:!1,isReturn:!0},on:{"update:visible":function(t){e.visible=t},"dialog-retrun":e.DialogRetrun}},[t("div",{attrs:{slot:"Dialogcontent"},slot:"Dialogcontent"},[t("div",[t("div",{staticClass:"productContent"},[t("span",[e._v(e._s(e.DetailsForm.CUSTOM_GROUP_NAME))])]),t("div",{staticClass:"tableTitle"},[t("h3",[e._v("基础信息")])]),t("vertical-table",{attrs:{tableData:e.tableData,DetailsFrom:e.DetailsForm,tableStyle:{width:"100%"}}})],1)])])],1)},C=[],b=a("08cc"),f=a("0fea"),g=a("d370"),_={components:{MpDialog:p["a"],VerticalTable:b["a"]},props:{customerGroupSource:{type:Number,default:0}},data(){return{visible:!1,tableData:[{key:"客户群编码：",value:"customGroupId"},{key:"客户群名称：",value:"customGroupName"},{key:"客户群描述：",value:"customGroupDesc",iscolspan:!0},{key:"客户群创建人：",value:"createUserId"},{key:"客户群周期：",value:"updateCycle"},{key:"客户群创建时间：",value:"createTime"},{key:"客户群失效日期：",value:"failTime"},{key:"客户群状态：",value:"customStatusId"},{key:"客户群接收日期：",value:"effectiveTime"},{key:"客户群规模：\t",value:"customNum"},{key:"有无带属性：",value:"hasCustomAttrs"},{key:"属性名称：",value:"customAttrs",iscolspan:!0}],DetailsForm:{},custGroupId:"",updateCycleName:["","一次性","月","日"]}},computed:{custgroupSource(){return this.$store.state.extendData.custgroupSource}},methods:{showMpDialog(e,t=0){this.custGroupId=e,this.visible=!0,this.viewCustGroupDetail(t)},async viewCustGroupDetail(e){let t=0==e?g["a"].mpapi.viewCustGroupDetailNew:g["a"].mpapi.viewCustGroupDetailDna;await Object(f["i"])(t,{custgroupId:this.custGroupId}).then(e=>{this.DetailsForm=e,1==this.customerGroupSource&&(this.DetailsForm.updateCycle=0),this.DetailsForm.updateCycle=this.updateCycleName[+this.DetailsForm.updateCycle||0],1==this.DetailsForm.customStatusId?this.DetailsForm.customStatusId="有效":this.DetailsForm.customStatusId="无效"})},DialogRetrun(){this.visible=!1}}},x=_,E=(a("a02f"),Object(m["a"])(x,v,C,!1,null,"ab532ad0",null)),y=E.exports,F=a("31b1"),I=a("d39c"),D=a("2f62"),w={name:"customerDialog",components:{MpDialog:p["a"],LabelScreen:h["a"],CustomerList:d,ChocustomerDetail:y,MarketingHistory:l["a"]},data(){return{visible:!1,customerGroupSource:0,custSourceList:[{label:"COC客户群",value:0},{label:"DNA客户群",value:1}],source:null,CustomerBaseList:[],BaseDefault:{id:"customGroupId",title:"customGroupName",scale:"customNum",founder:"createUserName",type:"custGroupUpdateCycle"},queryFrom:{keyWords:void 0,outCallUse:0},pageData:{currentPage:1,pageSize:12,total:0},Label:[],LabelDefault:{id:"customGroupId",value:"customGroupName"},CustomerisSelect:[],loading:!0,isMultiple:!1,showHistoryFlag:!1,historyList:[{id:"1111",title:"近30天客户接触次数",loading:!1,yAxis:{name:"客户数",data:[0,0,0,0,0,0]},xAxis:{name:"接触次数",labelRotate:!1,data:[0,1,2,3,4,"≥5"]},itemClickEvent:!1},{id:"2222",title:"近30天客户营销情况",loading:!1,yAxis:{name:"客户数",data:[0,0,0,0,0,0]},xAxis:{name:"营销成功率",labelRotate:!0,data:["0%","(0, 20%]","(20%, 40%]","(40%, 60%]","(60%, 80%]","(80%, 100%]"]},itemClickEvent:!1}]}},computed:{...Object(D["b"])("MarkPl",["getNodeData"]),baseInformation:function(){return this.$store.state.MarkPl.ProcessData},showHistoryBtn(){return this.showHistoryFlag=!1,this.Label.length>0},hasPermission(){const e=sessionStorage.getItem("roleIds").split(",");return e.includes("10839")}},created(){},mounted(){},methods:{searchCustomerBaseList(){this.pageData.currentPage=1,this.getCustomerBaseList()},async getCustomerBaseList(){this.loading&&this.source&&this.source.cancel("取消请求"),this.source=this.$CancelToken.source();try{this.loading=!0;let e=0==this.customerGroupSource?g["a"].mpapi.getMoreMyCustomNew:g["a"].mpapi.getMoreMyCustomDna;const{records:t,total:a}=await Object(f["i"])(e,{...this.queryFrom,current:this.pageData.currentPage,size:this.pageData.pageSize},this.source.token,this.$retryDelay);this.CustomerBaseList=t,this.pageData.total=a,1==this.customerGroupSource&&this.CustomerBaseList.forEach(e=>{e.updateCycle=0})}catch(e){e.message.includes("timeout")&&this.getCustomerBaseList()}finally{this.loading=!1}},handleSizeChange(e){this.pageData.pageSize=e,this.getCustomerBaseList()},handleCurrentChange(e){this.pageData.currentPage=e,this.getCustomerBaseList()},CustomerClick(e){if(0==e.updateStatus)return this.$alert("该客户群处于离线状态，请重新选择！","提示",{confirmButtonText:"确定",customClass:"errorPrompt",callback:e=>{}});this.CustomerisSelect=[e.customGroupId],this.customerFlag=!0,this.Label=[{...e,customerFlag:!0,customerGroupSource:this.customerGroupSource}]},handleClose(e){this.Label.splice(this.Label.indexOf(e),1),this.CustomerisSelect.splice(this.CustomerisSelect.indexOf(e.customGroupId),1)},showMpDialog(){this.isMultiple=this.baseInformation.isCheckboxCust,"[]"!==JSON.stringify(this.getNodeData)&&(this.Label=JSON.parse(JSON.stringify(this.getNodeData)),this.CustomerisSelect=this.Label.map(e=>e.customGroupId)),this.customerGroupSource=this.$store.state.extendData.custgroupSource||0,this.hasPermission||(this.customerGroupSource=0),this.getCustomerBaseList(),this.visible=!0},PushContent(e){this.$refs["chocustomerDetail"].showMpDialog(e.customGroupId,this.customerGroupSource)},CustomerSub(){if(this.Label.length>0){"JX0000000001"==this.Label[0].customGroupId&&Object(f["i"])(I["a"].seapi.getSysDics,{dicKeys:["NO_CUST_CHANNELS"]}).then(e=>{var t;const a=(null===(t=e[0])||void 0===t?void 0:t.split(","))||[];this.$store.commit("MarkPl/fnUpdateClearChannelDataByCustomer",a)});var e=this.Label.map(e=>e.customGroupName);const t={NewData:e,mutual:[],homologous:[],fuse:[]};let a;this.$store.commit("MarkPl/fnUpdateActiveNodeList",t),this.$store.commit("MarkPl/fuUpdateSceneNodeData",this.Label),a=this.Label[0].hasOwnProperty("customerGroupSource")?this.Label[0].customerGroupSource:this.baseCampInfo.hasOwnProperty("custgroupSource")?this.customerGroupSource||0:this.customerGroupSource,this.$store.commit("extendData/SET_CUSTGOUPSOURCE",a),this.visible=!1,this.$emit("DialogClose")}else this.$message.error("请选择客户群")},DialogClose(){this.$emit("DialogClose")},async showHistory(){let e=this.Label[0].customGroupId;this.historyList[0].loading=!1,this.historyList[0].yAxis.data=[0,0,0,0,0,0],this.historyList[1].loading=!1,this.historyList[1].yAxis.data=[0,0,0,0,0,0],this.showHistoryFlag=!0,this.$set(this.historyList[0],"loading",!0),Object(f["i"])(F["a"].channel.caculateContactUserNum,{custId:e}).then(e=>{for(let t of e){let e=parseInt(100*t.contactRate),a=t.contactNum+"."+e;this.$set(this.historyList[0].yAxis.data,Number(t.contactLevel),a)}}).catch(e=>{}).finally(()=>{this.$set(this.historyList[0],"loading",!1)}),this.$set(this.historyList[1],"loading",!0),Object(f["i"])(F["a"].channel.caculateOrderUserNum,{custId:e}).then(e=>{for(let t of e){let e=parseInt(100*t.successRate),a=t.custNum+"."+e;this.$set(this.historyList[1].yAxis.data,Number(t.successLevel),a)}}).catch(e=>{}).finally(()=>{this.$set(this.historyList[1],"loading",!1)})},closeHistoryBar(){this.showHistoryFlag=!1}}},k=w,N=(a("533d"),a("1ffb"),Object(m["a"])(k,i,r,!1,null,"b73a9282",null));t["a"]=N.exports},"5ed5":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return e.tip&&(e.tip.fileName||e.tip.promptWord)?t("div",{staticClass:"tips"},[t("el-popover",{attrs:{placement:"left-end",trigger:"click"}},[t("div",{staticClass:"tip-content--global"},[e.tip.promptWord?t("span",{staticClass:"text"},[e._v(e._s(e.tip.promptWord))]):e._e(),e.tip.fileName?t("div",{staticClass:"pic",attrs:{title:e.tip.fileName.length>11&&e.tip.fileName},on:{click:e.downloadFile}},[t("img",{attrs:{src:e.fileType,width:"30",height:"30",alt:""}}),t("span",[e._v(e._s(e.tip.fileName.length>11?e.tip.fileName.slice(0,8)+"...":e.tip.fileName))])]):e._e()]),t("i",{staticClass:"el-icon-warning-outline",attrs:{slot:"reference",title:"提示"},slot:"reference"})])],1):e._e()},r=[],l=(a("88a7"),a("271a"),a("5494"),a("0fea")),s=a("d39c"),o=a("fcff"),n=a.n(o),c=a("b1d3"),m=a.n(c),u=a("5414"),d=a.n(u),h=a("56b3"),p=a.n(h),v=a("f26a"),C=a.n(v),b={name:"Tips",props:["id"],data(){return{tip:null,fileType:m.a}},methods:{getFileType(e){const t=e.substring(e.lastIndexOf(".")+1);switch(t){case"xls":case"xlsx":return n.a;case"pdf":this.fileType=d.a;break;case"txt":return p.a;case"doc":case"docx":return C.a;default:return m.a}},async getTips(){try{const e=await Object(l["i"])(s["a"].seapi.queryDimChannelInfo,{channelId:this.id});this.$emit("getChannelDetail",e),this.tip=e,e.fileName&&(this.fileType=this.getFileType(e.fileName))}catch(e){}},async downloadFile(){try{const{data:e}=await Object(l["b"])(s["a"].seapi.downloadChanPromptFile,{fileUrlAndName:this.tip.fileUploadUrl}),t=new Blob([e],{type:e.type}),a=document.createElement("a");a.download=this.tip.fileName,a.style.display="none",a.href=URL.createObjectURL(t),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}catch(e){}}},created(){this.getTips()}},f=b,g=(a("7400"),a("2877")),_=Object(g["a"])(f,i,r,!1,null,"32ec1b4c",null);t["a"]=_.exports},6034:function(e,t,a){},"605d":function(e,t,a){"use strict";var i=a("da84"),r=a("c6b6");e.exports="process"===r(i.process)},6141:function(e,t,a){},6401:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"CrmFrom",attrs:{"label-width":"130px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-form-item",{attrs:{label:"端口号码：",prop:"adivId"}},[t("el-select",{attrs:{placeholder:"请选择端口号码"},on:{change:e.changeAid},model:{value:e.CrmFrom.adivId,callback:function(t){e.$set(e.CrmFrom,"adivId",t)},expression:"CrmFrom.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1),t("el-form-item",{attrs:{label:"短信类型：",prop:"adivId"}},[t("el-select",{attrs:{placeholder:"请选择短信类型"},on:{change:e.changeAid},model:{value:e.CrmFrom.adivId,callback:function(t){e.$set(e.CrmFrom,"adivId",t)},expression:"CrmFrom.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1),t("el-form-item",{attrs:{label:"短信用语：",prop:"channelConf.smsContent"}},[t("el-input",{attrs:{type:"textarea",maxlength:"500","show-word-limit":""},model:{value:e.CrmFrom.channelConf.smsContent,callback:function(t){e.$set(e.CrmFrom.channelConf,"smsContent",t)},expression:"CrmFrom.channelConf.smsContent"}})],1),t("el-form-item",{attrs:{label:"短信用语变量："}},[t("ul",{staticClass:"variableLabl"},e._l(e.variable,(function(a){return t("li",{key:a.label},[e._v(" "+e._s(a.name)+" ")])})),0)]),t("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"发送类型：",prop:"sendTypeDetail"}},[t("el-radio-group",{model:{value:e.CrmFrom.sendType,callback:function(t){e.$set(e.CrmFrom,"sendType",t)},expression:"CrmFrom.sendType"}},[t("el-radio-button",{attrs:{label:"0"}},[e._v("订制")]),t("el-radio-button",{attrs:{label:"1"}},[e._v("频次")])],1)],1),t("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"",prop:"sendTypeDetail"}},["0"===e.CrmFrom.sendType?t("div",{staticClass:"send-box"},[t("el-form-item",{staticStyle:{width:"100%"},attrs:{"label-width":"100px",label:"发送日期：",prop:"sendTime"}},[t("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.CrmFrom.sendTime,callback:function(t){e.$set(e.CrmFrom,"sendTime",t)},expression:"CrmFrom.sendTime"}}),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:e.preview}},[e._v("新增")])],1),t("el-form-item",{staticStyle:{width:"100%"},attrs:{"label-width":"100px",label:"日发送量：",prop:"daySend"}},[t("el-radio-group",{model:{value:e.CrmFrom.daySend,callback:function(t){e.$set(e.CrmFrom,"daySend",t)},expression:"CrmFrom.daySend"}},[t("el-radio",{attrs:{v:"",label:"0"}},[e._v("全部")]),t("el-radio",{attrs:{label:"1"}},[e._v("平均")])],1)],1)],1):e._e(),t("div",{staticClass:"send-box"},[t("el-form-item",{staticStyle:{width:"100%"},attrs:{"label-width":"160px",label:"免打扰日（周）：",prop:"daySend"}},[t("el-checkbox-group",{model:{value:e.CrmFrom.disturb,callback:function(t){e.$set(e.CrmFrom,"disturb",t)},expression:"CrmFrom.disturb"}},e._l(e.weekMap,(function(a,i){return t("el-checkbox",{key:i,attrs:{label:i}},[e._v(e._s(a))])})),1)],1),t("el-form-item",{staticStyle:{width:"100%"},attrs:{"label-width":"160px",label:"免打扰日（日历）：",prop:"sendTime"}},[t("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.CrmFrom.sendTime,callback:function(t){e.$set(e.CrmFrom,"sendTime",t)},expression:"CrmFrom.sendTime"}}),t("el-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary"},on:{click:e.preview}},[e._v("新增")])],1)],1)]),"1"===e.CrmFrom.sendType?t("el-form-item",{attrs:{label:"发送频次：",prop:"frequency"}},[t("div",{staticStyle:{display:"flex"}},[t("el-select",{staticStyle:{width:"50%"},attrs:{placeholder:"请选择发送频次"},on:{change:e.changeAid},model:{value:e.CrmFrom.frequency,callback:function(t){e.$set(e.CrmFrom,"frequency",t)},expression:"CrmFrom.frequency"}},e._l(e.frequencyList,(function(e,a){return t("el-option",{key:a,attrs:{label:e,value:a}})})),1),t("el-form-item",{staticStyle:{width:"100%","margin-left":"20px"},attrs:{label:"",prop:"frequencyNum",inline:!0}},[t("el-input",{staticStyle:{width:"30%"},model:{value:e.CrmFrom.frequencyNum,callback:function(t){e.$set(e.CrmFrom,"frequencyNum",t)},expression:"CrmFrom.frequencyNum"}})],1)],1)]):e._e(),t("el-form-item",{attrs:{label:"时机选择："}},[t("el-select",{attrs:{placeholder:"请选择"},on:{click:e.changeTime},model:{value:e.CrmFrom.timeId,callback:function(t){e.$set(e.CrmFrom,"timeId",t)},expression:"CrmFrom.timeId"}},e._l(e.timeIdList,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),t("el-form-item",{attrs:{label:"时机描述："}},[t("el-input",{attrs:{type:"textarea",maxlength:"240","show-word-limit":""},model:{value:e.CrmFrom.timeDistindes,callback:function(t){e.$set(e.CrmFrom,"timeDistindes",t)},expression:"CrmFrom.timeDistindes"}})],1),t("el-form-item",{attrs:{label:"免打扰时段为："}},[t("span",[e._v("21:10到23:59，00:00到9:30")])]),t("el-form-item",[t("el-button",{on:{click:e.SubInstall}},[e._v("保存当前设置")])],1)],1),!0===e.gHandIsShow?t("group-hand-dialog"):e._e()],1)},r=[],l=a("0fea"),s=a("5e05"),o=a("180b");const n=s["a"].common.getSysEnum,c=s["a"].common.queryAdivInfo;var m={props:["channelId","channelData"],components:{GroupHandDialog:o["a"]},data(){return{CrmFrom:{adivId:null,material:null,proPrice:null,urlLink:null,priorityOrder:null,timeId:null,timeDistindes:null,channelConf:{},sendType:"0",sendTime:null,disturb:[],frequency:0,frequencyNum:null},CrmFromRules:{adivId:[{required:!0,message:"请选择运营位",trigger:"blur,change"}],material:[{required:!0,message:"请选择物料",trigger:"blur"}],urlLink:[{required:!0,message:"请输入URL链接",trigger:"blur"}],sendTime:[{required:!0,message:"请输入发送日期",trigger:"blur"}],frequency:[{required:!0,message:"请选择频次",trigger:"blur"}],frequencyNum:[{required:!0,message:"请输入频次",trigger:"blur"}],channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},timeIdList:[],adivList:[],gHandIsShow:!1,variable:[{name:"APP名称",label:"$APP_NAME$"},{name:"内容热点",label:"$CONTENT_HOT_SPOT$"},{name:"内容标签",label:"$CONTENT_LABEL$"},{name:"内容主题",label:"$CONTENT_SUBJECT$"}],weekMap:["周一","周二","周三","周四","周五","周六","周日"],frequencyList:["多次","单次"]}},mounted(){var e;this.CrmFrom=null!==(e=this.channelData)&&void 0!==e?e:this.CrmFrom,this.getOptionData()},methods:{getOptionData(){Object(l["i"])(c,{channelId:this.channelId}).then(e=>{this.adivList=e}),Object(l["i"])(n,{enumType:"iop_time_id"}).then(e=>{this.timeIdList=e})},changeAid(){this.adivList.forEach(e=>{(this.CrmFrom.adivId=e.adivId)&&(this.CrmFrom.adivName=e.adivName)})},changeTime(){this.timeIdList.forEach(e=>{e.enumKey===this.CrmFrom.timeId&&(this.CrmFrom.timeName=e.enumValue)})},preMaterial(){this.gHandIsShow=!this.gHandIsShow},preview(){this.$alert("没有可预览的材料",{confirmButtonText:"确定"})},SubInstall(){this.$refs.CrmFrom.validate(e=>{e&&this.$emit("saveChannelData",this.CrmFrom)})}}},u=m,d=(a("d7d2"),a("2877")),h=Object(d["a"])(u,i,r,!1,null,"2b2b72aa",null);t["a"]=h.exports},"649d":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ActiveNode"},[t("div",{staticClass:"Active"},e._l(e.ActiveNode,(function(a,i){return t("div",{key:i},[t("ul",{key:i,ref:"lavender",refInFor:!0,staticClass:"lavender-box"},e._l(a.group,(function(i,r){return t("li",{key:r,class:`${e.Arrow(a,r)} ${i.className}`,attrs:{data:i.id+"-"+r},on:{click:function(t){return t.stopPropagation(),e.NodeClick(i,t)}}},[t("div",{staticClass:"lavender-header-after"}),t("div",{staticClass:"lavender-header"},[t("el-checkbox",{model:{value:i.checked,callback:function(t){e.$set(i,"checked",t)},expression:"data.checked"}},[t("span",[e._v(e._s(i.label))])]),t("i",{staticClass:"el-icon-more"})],1),t("div",{staticClass:"ArrowBottom"}),i.status?e._e():t("div",[t("div",{staticClass:"product-sub"},["选产品"===i.label?t("p",[e._v(" 主产品")]):e._e(),t("span",[e._v(e._s(e.filterData(i.content)))])]),"选产品"===i.label?[i.fuse?t("div",{staticClass:"product-sub"},[t("p",[e._v("融合产品")]),t("span",[e._v(e._s(i.fuse))])]):e._e(),i.homologous?t("div",{staticClass:"product-sub"},[t("p",[e._v("同系列产品")]),t("span",[e._v(e._s(i.homologous))])]):e._e(),i.mutual?t("div",{staticClass:"product-sub"},[t("p",[e._v("互斥产品")]),t("span",[e._v(e._s(i.mutual))])]):e._e()]:e._e()],2)])})),0),t("ActiveNode",{attrs:{ActiveNode:a.children},on:{"Node-click":e.ActiveNodeClick}})],1)})),0)])},r=[],l=(a("14d9"),{name:"ActiveNode",comments:{},props:{ActiveNode:{type:Array,default:()=>[]}},data(){return{checked:!1,maxLength:0,maxwidth:"0",params:""}},watch:{ActiveNode:function(e,t){this.recalculatePosition()}},computed:{Arrow(){return function(e,t){return t!==e.group.length-1?"arrow1":"arrow"+e.children.length}}},mounted(){var e=0;this.ActiveNode.map(t=>{e<t.length&&(e=t.length)}),this.maxLength=e,this.recalculatePosition()},methods:{NodeClick(e,t){t.stopPropagation(),e.checked=!e.checked,this.$emit("Node-click",e)},ActiveNodeClick(e){this.$emit("Node-click",e)},SkipProgress(e){"INPUT"!==e.target.tagName||e.stopPropagation()},recalculatePosition(){this.$nextTick().then(()=>{void 0!==this.$refs.lavender&&this.$refs.lavender.map(e=>{var t=e.nextSibling.cloneNode(!0),a=e.nextSibling,i=t.getElementsByClassName("ActiveNode");for(let c=i.length-1;c>=0;c--)i[c].remove();var r=[],l=a.getElementsByClassName("lavender-box"),s=t.getElementsByClassName("lavender-box");for(let c=l.length-1;c>=0;c--)for(let e=s.length-1;e>=0;e--)s[e].firstElementChild.attributes["data"].value===l[c].firstElementChild.attributes["data"].value&&r.push(l[c].firstElementChild);if(0!==r.length&&1!==r.length){var o=r[0].offsetWidth,n=r[r.length-1].offsetWidth;e.style.width=o+n+30*r.length+"px"}else 1===r.length&&(e.style.width="250px")})})},filterData(e){let t=e.includes(",")?",":" ";var a=e.split(t),i=[];for(let r=0;r<a.length;r++)-1===i.indexOf(a[r])&&i.push(a[r]);return i.join(" ")}},created(){}}),s=l,o=(a("4cec"),a("d9d6"),a("51a5"),a("2877")),n=Object(o["a"])(s,i,r,!1,null,"7ca5ec16",null);t["a"]=n.exports},6501:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"var-layout"},[e.allList.length>0?t("div",{staticClass:"filter"},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{size:"mini",placeholder:"请输入关键字",clearable:""},on:{clear:e.search,input:e.search,change:e.search},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search.apply(null,arguments)}},model:{value:e.keyWords,callback:function(t){e.keyWords="string"===typeof t?t.trim():t},expression:"keyWords"}})],1):e._e(),t("div",{staticClass:"tag"},e._l(e.varList,(function(a){return t("el-tag",{key:a.id,attrs:{type:"info"},on:{click:function(t){return e.emitVar(a.field,a)}}},[e._v(e._s(a.fieldName))])})),1)])},r=[],l={data(){return{keyWords:"",varList:[]}},computed:{allList(){const e=this.$store.getters["extendData/varList"]||[];return this.varList=[...e],e}},methods:{search(){this.varList=this.allList.filter(e=>e.fieldName.includes(this.keyWords))},emitVar(e,t){this.$emit("getVar",e,t)}},created(){0===this.allList.length&&this.$store.dispatch("extendData/getVarList")}},s=l,o=(a("9193"),a("2877")),n=Object(o["a"])(s,i,r,!1,null,"297edd9f",null);t["a"]=n.exports},"65e9":function(e,t,a){},"661d":function(e,t,a){"use strict";a("c126")},"66d1":function(e,t,a){},6706:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ProductDialog"},[e.showHistoryBtn?t("el-button",{staticClass:"hisBtn",attrs:{type:"primary"},on:{click:e.showHistory}},[e._v("历史营销")]):e._e(),t("mp-dialog",{attrs:{title:"选渠道",visible:e.visible,width:"760px",IsAscertain:!1},on:{"update:visible":function(t){e.visible=t},DialogClose:e.DialogClose}},[t("div",{attrs:{slot:"Dialogcontent"},slot:"Dialogcontent"},[t("div",{staticClass:"Product"},[t("div",{staticClass:"Channel"},[t("select-button",{ref:"Selectbutton",attrs:{SelectBuList:e.SelectBuList,ischeckbox:e.processData.isCheckboxChannel},on:{selectClick:e.addTab,openDetail:e.openDetail}})],1),t("div",{staticClass:"table"},[t("div",{staticClass:"table-title"},[e._v(" 该客户群"),t("span",{staticClass:"table-font"},[e._v(" 第一偏好渠道 ")]),e._v("分布： ")]),t("div",{staticClass:"table-contentr"},[t("el-table",{attrs:{border:"",data:e.custimerList,stripe:""}},e._l(e.tableTitle,(function(a,i){return t("el-table-column",{key:i,attrs:{label:a,align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",[e._v(" "+e._s(a.row[i])+" ")])]}}],null,!0)})})),1)],1)]),e.maskLoading?t("div",{staticClass:"placeholder"},[t("div",{staticClass:"mask"})]):e._e(),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.maskLoading,expression:"maskLoading"}],staticClass:"TabsCenter",attrs:{"element-loading-text":"正在校验保存中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)"}},[t("el-tabs",{attrs:{type:"card",closable:"","before-leave":e.beforeLeave},on:{"tab-remove":e.removeTab,"tab-click":e.TabClick},model:{value:e.editableTabsValue,callback:function(t){e.editableTabsValue=t},expression:"editableTabsValue"}},e._l(e.editableTabs,(function(a,i){return t("el-tab-pane",{key:a.channelId,attrs:{label:a.channelName,name:a.channelId}},[t("div",{staticClass:"TabPane"},[t(e.currentView[i],{ref:"Component"+a.channelId,refInFor:!0,tag:"component",attrs:{channelNewData:a,adivListCB:e.adivList,id:a.channelId,deleteSub:e.deleteSub},on:{saveChannelData:e.saveChannelData,beforeLeave:e.beforeLeave,disableAddAdivFn:t=>{e.addBtnDisabled=t}}})],1)])})),1)],1)]),e.editableTabs.length>0?t("div",{staticClass:"Product-button"},[e.showAddAdiv&&!e.isWave?t("el-button",{staticClass:"add-btn",attrs:{disabled:e.addBtnDisabled,size:"medium"},on:{click:e.addPosition}},[e._v("添加运营位")]):e._e(),t("el-button",{attrs:{type:"success",size:"medium"},on:{click:e.saveChannel}},[e._v("确定")])],1):e._e()])]),t("el-dialog",{attrs:{title:"渠道说明",visible:e.channelDetail,width:"50%","before-close":e.closeDetail},on:{"update:visible":function(t){e.channelDetail=t}}},[t("div",{staticClass:"channel-detail"},[t("div",[t("span",[e._v(" 渠道名称： ")]),t("span",[e._v(" "+e._s(e.channelDetails.channelName)+" ")])]),t("div",[t("span",[e._v(" 渠道负责人： ")]),t("span",[e._v(" "+e._s(e.channelDetails.managerName)+" ")])]),t("div",[t("span",[e._v(" 渠道渠道运营场景： ")]),t("span",[e._v(" "+e._s(e.channelDetails.operateScene)+" ")])]),t("div",{staticClass:"flow"},[t("span",[e._v(" 渠道审批流程： ")]),t("br"),t("img",{attrs:{src:e.channelDetails.approveProcessImgPath,alt:""}})]),t("div",[t("span",[e._v(" 渠道投放效果： ")]),t("img",{attrs:{src:e.channelDetails.demoImgPath,alt:""}})])])]),t("transition",{attrs:{name:"fade"}},[e.showHistoryFlag?t("div",{staticClass:"history-part"},[t("MarketingHistory",{attrs:{type:"channel","bar-data":e.historyData},on:{close:e.closeHistoryBar}})],1):e._e()]),t("VerificationChannelDialog",{ref:"VerificationChannelDialog",attrs:{dialogVisible:e.showVerificationDialog,parmas:e.verificatonParmas},on:{"update:dialogVisible":function(t){e.showVerificationDialog=t},"update:dialog-visible":function(t){e.showVerificationDialog=t},close:e.closeVerificationChannelDialog}})],1)},r=[],l=a("1567"),s=l["a"],o=(a("d600"),a("7b7a"),a("2877")),n=Object(o["a"])(s,i,r,!1,null,"71002f68",null);t["a"]=n.exports},"673f":function(e,t,a){"use strict";a("abba")},"68e8":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("Tips",{attrs:{id:e.id},on:{getChannelDetail:e.getChannelDetail}}),t("el-form",{ref:"CrmFrom",attrs:{"label-width":"130px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-form-item",{attrs:{label:"运营位：",prop:"adivInfo.adivId"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:e.changeAid},model:{value:e.CrmFrom.adivInfo.adivId,callback:function(t){e.$set(e.CrmFrom.adivInfo,"adivId",t)},expression:"CrmFrom.adivInfo.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1),t("el-form-item",{attrs:{label:"营业厅归属地：",prop:"adivInfo.adivId"}},[t("el-select",{attrs:{placeholder:"请选择营业厅归属地"},on:{change:e.changeAid},model:{value:e.CrmFrom.adivInfo.adivId,callback:function(t){e.$set(e.CrmFrom.adivInfo,"adivId",t)},expression:"CrmFrom.adivInfo.adivId"}},e._l(e.attributionList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1),e.showExt18?t("el-form-item",{attrs:{label:"智能话术："}},[t("el-checkbox",{on:{change:()=>e.CrmFrom.columnExt18=e.checkColumnExt18?"1":"0"},model:{value:e.checkColumnExt18,callback:function(t){e.checkColumnExt18=t},expression:"checkColumnExt18"}},[e._v("启用")]),e.checkColumnExt18?t("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt18,callback:function(t){e.$set(e.CrmFrom,"columnExt18",t)},expression:"CrmFrom.columnExt18"}},[t("el-radio",{attrs:{label:"1"}},[e._v("省端模型")]),t("el-radio",{attrs:{label:"2"}},[e._v("一级IOP模型")])],1):e._e()],1):e._e(),t("el-form-item",{attrs:{label:"推荐用语：",prop:"channelConf.execContent"}},[t("el-input",{attrs:{type:"textarea",maxlength:"500","show-word-limit":""},model:{value:e.CrmFrom.channelConf.execContent,callback:function(t){e.$set(e.CrmFrom.channelConf,"execContent",t)},expression:"CrmFrom.channelConf.execContent"}})],1),t("el-form-item",{attrs:{label:"短信用语：",prop:"channelConf.smsContent"}},[t("el-input",{attrs:{type:"textarea",maxlength:"500","show-word-limit":""},model:{value:e.CrmFrom.channelConf.smsContent,callback:function(t){e.$set(e.CrmFrom.channelConf,"smsContent",t)},expression:"CrmFrom.channelConf.smsContent"}})],1),t("el-form-item",{attrs:{label:"时机选择："}},[t("el-select",{attrs:{placeholder:"请选择"},on:{click:e.changeTime},model:{value:e.CrmFrom.channelConf.timeId,callback:function(t){e.$set(e.CrmFrom.channelConf,"timeId",t)},expression:"CrmFrom.channelConf.timeId"}},e._l(e.timeIdList,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),t("el-form-item",{attrs:{label:"时机描述："}},[t("el-input",{attrs:{type:"textarea",maxlength:"240","show-word-limit":""},model:{value:e.CrmFrom.channelConf.timeDistindes,callback:function(t){e.$set(e.CrmFrom.channelConf,"timeDistindes",t)},expression:"CrmFrom.channelConf.timeDistindes"}})],1)],1)],1)},r=[],l=a("0fea"),s=a("5e05"),o=a("5ed5");const n=s["a"].common.getSysEnum,c=s["a"].common.queryAdivInfo,m=s["a"].common.queryHallInfo;var u={props:["channelNewData"],components:{Tips:o["a"]},data(){return{CrmFrom:{adivInfo:{},channelConf:{},channelId:"",channelName:"",attributionInfo:{},columnExt18:"0"},showExt18:!1,checkColumnExt18:!1,CrmFromRules:{adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},timeIdList:[],adivList:[],attributionList:[]}},mounted(){this.getOptionData(),this.CrmFrom=JSON.parse(JSON.stringify(this.channelNewData)),this.checkColumnExt18=this.CrmFrom.columnExt18>0},methods:{getChannelDetail(e){1==e.smartScript&&(this.showExt18=!0)},async getOptionData(){await Object(l["i"])(n,{enumType:"iop_time_id"}).then(e=>{this.timeIdList=e}),await Object(l["i"])(c,{channelId:this.CrmFrom.channelId}).then(e=>{this.adivList=e}),await Object(l["i"])(m,{}).then(e=>{this.attributionList=e})},changeAid(e){var t="";this.adivList.forEach(a=>{e===a.adivId&&(t=a.adivName)}),this.CrmFrom.adivInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,adivName:t})},changeAttribution(e){var t="";this.attributionList.forEach(a=>{e===a.adivId&&(t=a.attributionName)}),this.CrmFrom.attributionInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,attributionName:t})},changeTime(){this.timeIdList.forEach(e=>{e.enumKey===this.CrmFrom.timeId&&(this.CrmFrom.timeName=e.enumValue)})},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e}},created(){}},d=u,h=a("2877"),p=Object(h["a"])(d,i,r,!1,null,"097f03b8",null);t["a"]=p.exports},7032:function(e,t,a){"use strict";a("ae3d")},7112:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("Tips",{attrs:{id:e.id},on:{getChannelDetail:e.getChannelDetail}}),t("el-form",{ref:"CrmFrom",attrs:{"label-width":"150px",model:e.CrmFrom,rules:e.CrmFromRules}},[e.isadivInfo?t("adivInfo",{attrs:{CrmFrom:e.CrmFrom.adivInfo,FromData:e.CrmFrom},on:{"update:CrmFrom":function(t){return e.$set(e.CrmFrom,"adivInfo",t)},"update:crm-from":function(t){return e.$set(e.CrmFrom,"adivInfo",t)},getConfiguration:e.getConfiguration}}):e._e(),t("el-form-item",{attrs:{label:"优先级：",prop:"channelConf.priorityOrder"}},[t("div",{staticClass:"block"},[t("el-slider",{attrs:{"show-input":""},model:{value:e.CrmFrom.channelConf.priorityOrder,callback:function(t){e.$set(e.CrmFrom.channelConf,"priorityOrder",t)},expression:"CrmFrom.channelConf.priorityOrder"}})],1)]),e.showExt18?t("el-form-item",{attrs:{label:"智能话术："}},[t("el-checkbox",{on:{change:()=>e.CrmFrom.columnExt18=e.checkColumnExt18?"1":"0"},model:{value:e.checkColumnExt18,callback:function(t){e.checkColumnExt18=t},expression:"checkColumnExt18"}},[e._v("启用")]),e.checkColumnExt18?t("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt18,callback:function(t){e.$set(e.CrmFrom,"columnExt18",t)},expression:"CrmFrom.columnExt18"}},[t("el-radio",{attrs:{label:"1"}},[e._v("省端模型")]),t("el-radio",{attrs:{label:"2"}},[e._v("一级IOP模型")])],1):e._e()],1):e._e(),t("el-form-item",{attrs:{label:"推荐用语：",prop:"channelConf.execContent"}},[t("el-input",{attrs:{type:"textarea",rows:4,maxlength:"500","show-word-limit":""},model:{value:e.CrmFrom.channelConf.execContent,callback:function(t){e.$set(e.CrmFrom.channelConf,"execContent",t)},expression:"CrmFrom.channelConf.execContent"}})],1),e.isadivInfo?t("configurationSheet",{ref:"configurationSheet",attrs:{CrmFrom:e.CrmFrom.channelConf.channelExtConf},on:{configGsheet:e.configGsheet,"update:CrmFrom":function(t){return e.$set(e.CrmFrom.channelConf,"channelExtConf",t)},"update:crm-from":function(t){return e.$set(e.CrmFrom.channelConf,"channelExtConf",t)}}}):e._e()],1)],1)},r=[],l=a("0fea"),s=a("5e05"),o=a("57d8"),n=a("9044"),c=a("5ed5");const m=s["a"].common.getSysEnum;var u={components:{configurationSheet:o["a"],adivInfo:n["a"],Tips:c["a"]},props:["channelNewData","id"],data(){return{CrmFrom:{adivInfo:{},channelConf:{},channelId:"",channelName:"",columnExt18:"0"},showExt18:!1,checkColumnExt18:!1,CrmFromRules:{adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],priorityOrder:[{required:!0,message:"请输入优先等级",trigger:"blur"}],ceshi:[{required:!0,message:"请输入优先等级",trigger:"blur"}]}},timeIdList:[],adivList:[],isadivInfo:!1}},mounted(){this.getOptionData(),this.CrmFrom=JSON.parse(JSON.stringify(this.channelNewData)),this.isadivInfo=!0,this.checkColumnExt18=this.CrmFrom.columnExt18>0},methods:{getChannelDetail(e){1==e.smartScript&&(this.showExt18=!0)},async getOptionData(){await Object(l["i"])(m,{enumType:"iop_time_id"}).then(e=>{this.timeIdList=e})},getConfiguration(e){1!==e.zt&&(this.CrmFrom.channelConf={priorityOrder:0,channelExtConf:{}}),this.$refs.configurationSheet.lookSchedulingInfo(e.configid)},changeAid(e){var t="";this.adivList.forEach(a=>{e===a.adivId&&(t=a.adivName)}),this.CrmFrom.adivInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,adivName:t})},changeTime(){this.timeIdList.forEach(e=>{e.enumKey===this.CrmFrom.timeId&&(this.CrmFrom.timeName=e.enumValue)})},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e},configGsheet(e){this.CrmFrom.channelConf.channelExtConf=Object.assign(this.CrmFrom.channelConf.channelExtConf,e),this.CrmFrom=JSON.parse(JSON.stringify(this.CrmFrom))}},created(){}},d=u,h=a("2877"),p=Object(h["a"])(d,i,r,!1,null,"207a2a98",null);t["a"]=p.exports},7248:function(e,t,a){"use strict";a("1326")},"726b":function(e,t,a){},7400:function(e,t,a){"use strict";a("39d6")},7550:function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("14d9"),core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__),_Components_ActiveNode__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("649d"),_config_MpNode_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("eced"),_channelBaseDialog_vue__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("16f7"),_ChoChannel_ChannelDialog_vue__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("6706"),_ChoCustomer_customerDialog_vue__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("5c12"),_ChoMultiwave_MultiwaveDialog_vue__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("c675"),_ChoProduct_ProductDialog__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("7ede"),_multiActivityDialog_vue__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("af75"),uuid__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("ec26"),getUId=()=>Object(uuid__WEBPACK_IMPORTED_MODULE_9__["a"])().split("-")[0];__webpack_exports__["a"]={props:{MultiwaveList:{type:Object,default:()=>[]},CampInfo:{type:Object,default:()=>({})}},data(){return{Componentstate:{productDialog:!1,customerDialog:!1,channelDialog:!1,multiwaveDdialog:!1},chBaseDdialog:!1,baseCampInfo:{},childrenSchemes:[],componentKey:1,activityDdialog:!1,editableTabs:[{id:"1",name:"子活动",data:null}],editableTabsValue:"1"}},mounted(){if(this.$store.commit("MarkPl/fnActiveNodeList",[]),this.$store.commit("MarkPl/fnSceneNodeData",[]),"{}"!==JSON.stringify(this.CampInfo)){var e=Object(_config_MpNode_js__WEBPACK_IMPORTED_MODULE_2__["f"])(this.CampInfo);this.editableTabs=[],this.editableTabs=e.map(e=>({id:getUId(),name:e.baseCampInfo.campsegName,data:e})),this.editableTabsValue=this.editableTabs[0].id,this.ActiveNodeCase(this.editableTabs[0].data)}else this.ActiveNodeCase(null)},computed:{ActiveNodeList:function(){return this.$store.state.MarkPl.ActiveNodeList}},methods:{multiactivity(e){this.activityDdialog=!0,this.$nextTick().then(()=>{this.$refs.activityDdialog.showMpDialog(e)})},save(e){this.editableTabs.forEach(t=>{t.id===this.editableTabsValue&&(t.data=e,t.name=e.baseCampInfo.campsegName)}),this.chBaseDdialog=!1},TabClick(){this.editableTabs.map(e=>{e.id===this.editableTabsValue&&this.ActiveNodeCase(e.data)})},beforeLeave(e,t){return!!this.CurrentSettings(t)||(this.$message.error("请先完成当前子活动信息"),!1)},CurrentSettings(e=this.editableTabsValue){var t="";return this.editableTabs.map(a=>{a.id===e&&(t=a.data)}),null!==t},addActivity(){if(this.CurrentSettings()){this.$store.commit("MarkPl/fnActiveNodeList",[]),this.$store.commit("MarkPl/fnSceneNodeData",[]);var e=getUId();this.editableTabs.push({id:e,name:"子活动",data:null}),this.editableTabsValue=e,this.ActiveNodeCase(null)}else this.$message.error("请先完成当前子活动信息")},removeTab(e){let t=this.editableTabs,a=this.editableTabsValue;a===e&&t.forEach((a,i)=>{if(a.id===e){let e=t[i+1]||t[i-1];e&&(this.editableTabsValue=e.id,this.ActiveNodeCase(e.data))}}),this.editableTabs=t.filter(t=>t.id!==e)},nodeSave(e){this.componentKey++,this.chBaseDdialog=!0,this.$nextTick().then(()=>{this.$refs.chBaseDdialog.showMpDialog(e)})},ActiveNodeCase(data){if(null===data)this.$store.commit("MarkPl/fnActiveNodeList",Object(_config_MpNode_js__WEBPACK_IMPORTED_MODULE_2__["j"])(eval("("+this.MultiwaveList.new_example_content+")"))),this.$store.commit("MarkPl/fnSceneNodeData",Object(_config_MpNode_js__WEBPACK_IMPORTED_MODULE_2__["e"])(this.ActiveNodeList));else{this.baseCampInfo=data.baseCampInfo,this.childrenSchemes=data.childrenSchemes,this.$store.commit("MarkPl/fnActiveNodeList",Object(_config_MpNode_js__WEBPACK_IMPORTED_MODULE_2__["j"])(eval(""+this.baseCampInfo.tacticsMap)));var activeNodeList=Object(_config_MpNode_js__WEBPACK_IMPORTED_MODULE_2__["b"])(this.ActiveNodeList,data.campSchemes);this.$store.commit("MarkPl/fnSceneNodeData",activeNodeList)}},NodeClick(e){this.$store.commit("MarkPl/fnCurrentNode",e);let t=Object(_config_MpNode_js__WEBPACK_IMPORTED_MODULE_2__["c"])(this.ActiveNodeList,e);t?this.$alert(`请先${t.label}！`,"配置失败",{confirmButtonText:"确定",customClass:"errorPrompt"}):(this.Componentstate[e.assembly]=!0,this.$nextTick().then(()=>{this.$refs[e.assembly].showMpDialog()}))},DialogClose(){var e=this.$store.state.MarkPl.CurrentNode;this.Componentstate[e.assembly]=!1},DialogClosebase(){this.chBaseDdialog=!1},initialization(e){this.NormalEcho(e.campSchemes)},NormalEcho(e){var t=Object.assign([],this.ActiveNodeList),a=Object.assign([],this.$store.state.MarkPl.SceneNodeData);t.map((t,i)=>{t.map((t,r)=>{switch(t.assembly){case"productDialog":t.content=Object(_config_MpNode_js__WEBPACK_IMPORTED_MODULE_2__["h"])(this.processName(e[r].product,"planName")),a[i][r].NodeObj=e[r].product;break;case"customerDialog":t.content=Object(_config_MpNode_js__WEBPACK_IMPORTED_MODULE_2__["h"])(this.processName(e[r].customer,"customGroupName")),a[i][r].NodeObj=e[r].customer;break;case"channelDialog":t.content=Object(_config_MpNode_js__WEBPACK_IMPORTED_MODULE_2__["h"])(this.processName(e[r].channels,"channelName")),a[i][r].NodeObj=e[r].channels;break}})})},processName(e,t){return e.map(e=>e[t])}},components:{ProductDialog:_ChoProduct_ProductDialog__WEBPACK_IMPORTED_MODULE_7__["a"],CustomerDialog:_ChoCustomer_customerDialog_vue__WEBPACK_IMPORTED_MODULE_5__["a"],ChannelDialog:_ChoChannel_ChannelDialog_vue__WEBPACK_IMPORTED_MODULE_4__["a"],MultiwaveDialog:_ChoMultiwave_MultiwaveDialog_vue__WEBPACK_IMPORTED_MODULE_6__["a"],ActiveNode:_Components_ActiveNode__WEBPACK_IMPORTED_MODULE_1__["a"],ChannelBaseDialog:_channelBaseDialog_vue__WEBPACK_IMPORTED_MODULE_3__["a"],multiActivityDialog:_multiActivityDialog_vue__WEBPACK_IMPORTED_MODULE_8__["a"]}}},"75c8":function(e,t,a){},"76a4":function(e,t,a){"use strict";var i=function(){var e,t=this,a=t._self._c;return a("div",{staticStyle:{width:"95%"}},[a("Tips",{attrs:{id:t.channelNewData.channelId},on:{getChannelDetail:t.getChannelDetail}}),a("el-form",{ref:"CrmFrom",staticStyle:{width:"100%"},attrs:{"label-width":"145px",model:t.CrmFrom,rules:t.CrmFromRules}},[t._e(),a("div",{staticClass:"header"},[a("el-form-item",{attrs:{label:"运营位：",prop:"adivInfo.adivId"}},[a("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:t.changeAid},model:{value:t.CrmFrom.adivInfo.adivId,callback:function(e){t.$set(t.CrmFrom.adivInfo,"adivId",e)},expression:"CrmFrom.adivInfo.adivId"}},t._l(t.colAdivInfo.adivList,(function(e){return a("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId,disabled:t.selectedAdivId.has(e.adivId)}})})),1)],1)],1),a("el-form-item",{attrs:{label:"场景：",prop:"columnExt6"}},[a("el-select",{attrs:{placeholder:"请选择场景"},on:{change:t.changeScene},model:{value:t.CrmFrom.columnExt6,callback:function(e){t.$set(t.CrmFrom,"columnExt6",e)},expression:"CrmFrom.columnExt6"}},t._l(t.activeList,(function(e){return a("el-option",{key:e.enumId,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),t.showExt18?a("el-form-item",{attrs:{label:"智能话术："}},[a("el-checkbox",{on:{change:()=>t.CrmFrom.columnExt18=t.checkColumnExt18?"1":"0"},model:{value:t.checkColumnExt18,callback:function(e){t.checkColumnExt18=e},expression:"checkColumnExt18"}},[t._v("启用")]),t.checkColumnExt18?a("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:function(e){return t.$forceUpdate()}},model:{value:t.CrmFrom.columnExt18,callback:function(e){t.$set(t.CrmFrom,"columnExt18",e)},expression:"CrmFrom.columnExt18"}},[a("el-radio",{attrs:{label:"1"}},[t._v("省端模型")]),a("el-radio",{attrs:{label:"2"}},[t._v("一级IOP模型")])],1):t._e()],1):t._e(),null!==(e=t.CrmFrom.adivInfo)&&void 0!==e&&e.adivId?a("UseScript",{ref:"useScript",attrs:{"label-width":"145px","channel-id":t.channelNewData.channelId,"channel-name":t.channelNewData.channelName,"script-id":t.CrmFrom.columnExt19,CrmFrom:t.CrmFrom},on:{change:t.changeScript}}):t._e(),a("el-form-item",{attrs:{label:"推荐营销用语：",prop:"marketingWords"}},[t.isStrArr?a("Face2FaceWords",{attrs:{marketingWords:t.CrmFrom.marketingWords}}):a("el-input",{attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},on:{input:function(e){return t.$forceUpdate()}},model:{value:t.CrmFrom.marketingWords,callback:function(e){t.$set(t.CrmFrom,"marketingWords",e)},expression:"CrmFrom.marketingWords"}})],1)],1)],1)},r=[],l=a("0fea"),s=a("5e05"),o=a("b893"),n=a("00b8"),c=a("f1ce"),m=a("98d2"),u=a("cd74"),d=a("5ed5");const h=s["a"].common.getSysEnum,p=(s["a"].common.queryAdivInfo,s["a"].common.queryHallInfo);var v={props:["channelNewData","id","deleteSub","columnExt1","colAdivInfo","selectedAdivId"],components:{materialList:c["a"],UseScript:m["a"],Face2FaceWords:u["a"],Tips:d["a"]},data(){return{CrmFrom:{adivInfo:{},sceneInfo:{},arrInfo:{},channelId:"",channelName:"",attributionInfo:{},standard:"",CustomerRules:"",marketingWords:void 0,scene:"",columnExt1:"",columnExt6:void 0,channelConf:{channelExtConf:{CampChannelExtReq:{columnExt1:""}}},columnExt18:"0",columnExt19:"",columnExt20:""},showExt18:!1,checkColumnExt18:!1,CrmFromRules:{columnExt1:[{required:!0,message:"请选择推送方式",trigger:"blur"}],marketingWords:[{required:!0,message:"请输入营销话术",trigger:"change"}],columnExt6:[{required:!0,message:"请选择场景",trigger:"change"}],adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},isStrArr:!1,timeIdList:[],attributionList:[],activeList:[]}},created(){if(this.getOptionData(),this.CrmFrom=Object(o["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.columnExt1),this.$set(this.CrmFrom,"marketingWords",this.CrmFrom.marketingWords||""),this.checkColumnExt18=this.CrmFrom.columnExt18>0,this.CrmFrom.columnExt19&&this.CrmFrom.marketingWords)try{this.isStrArr=this.CrmFrom.marketingWords.includes("</header>")}catch(e){}},watch:{columnExt1(e,t){this.CrmFrom.columnExt1=e}},methods:{getChannelDetail(e){1==e.smartScript&&(this.showExt18=!0)},async getOptionData(){await Object(l["i"])(h,{enumType:"jx_906_scene"}).then(e=>{this.activeList=e}),await Object(l["i"])(p,{}).then(e=>{this.attributionList=e})},changeScene(e){var t="";this.activeList.forEach(a=>{e===a.enumId&&(t=a.enumValue)}),this.CrmFrom.scene=e,this.CrmFrom.sceneInfo=Object.assign({},this.CrmFrom.sceneInfo,{enumId:e,enumValue:t})},changeAid(e){var t;const a=null===(t=this.colAdivInfo.adivList)||void 0===t?void 0:t.find(t=>t.adivId===e);this.$set(this.CrmFrom,"adivInfo",{adivId:(null===a||void 0===a?void 0:a.adivId)||"",adivName:(null===a||void 0===a?void 0:a.adivName)||""}),this.$emit("changeAdiv",e),this.isStrArr=!1,this.CrmFrom.columnExt19="",this.CrmFrom.marketingWords="",this.$refs.useScript&&this.$nextTick(()=>{this.$refs.useScript.getScriptList()})},SubInstall(e=!0){var t=!0;return this.$refs.CrmFrom.validate(a=>{a||("906"===this.id||"922"===this.id)&&this.CrmFrom.marketingWords&&this.CrmFrom.adivInfo.adivId?(e&&this.$emit("saveChannelData",this.colAdivInfo.id,this.CrmFrom),t=!0):t=!1}),t},selectMaterial(e){this.$refs["material"].getMaterialList(),this.$refs["material"].showDialog(e)},addMaterial(e){this.CrmFrom={...this.CrmFrom,columnExt20:e.materialId,materialName:e.materialName}},changeScript(e){if(this.CrmFrom.columnExt19=e.scriptId,!e.scriptId&&this.isStrArr)return this.$set(this.CrmFrom,"marketingWords",""),void(this.isStrArr=!1);this.isStrArr=!1,e.contentType<5&&(this.isStrArr=!0),this.CrmFrom=Object(n["a"])(e,this.CrmFrom),this.$forceUpdate()}}},C=v,b=(a("c691"),a("2877")),f=Object(b["a"])(C,i,r,!1,null,"4af847cc",null);t["a"]=f.exports},7779:function(e,t,a){"use strict";a("7b33")},"77fd":function(e,t,a){},7900:function(e,t,a){},7911:function(e,t,a){},7940:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"CrmFrom",attrs:{"label-width":"150px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-form-item",{attrs:{label:"运营位：",prop:"adivId"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:e.changeAid},model:{value:e.CrmFrom.adivId,callback:function(t){e.$set(e.CrmFrom,"adivId",t)},expression:"CrmFrom.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1),t("el-form-item",{attrs:{label:"发送类型：",prop:"sendType"}},[t("el-select",{attrs:{placeholder:"请选择发送类型"},model:{value:e.CrmFrom.sendType,callback:function(t){e.$set(e.CrmFrom,"sendType",t)},expression:"CrmFrom.sendType"}},e._l(e.typeList,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),t("el-form-item",{attrs:{label:"视频短信产品编码：",prop:"videoSmsPlanId"}},[t("el-input",{model:{value:e.CrmFrom.videoSmsPlanId,callback:function(t){e.$set(e.CrmFrom,"videoSmsPlanId",t)},expression:"CrmFrom.videoSmsPlanId"}})],1),t("el-form-item",{attrs:{label:"彩信编码：",prop:"mmsId"}},[t("el-input",{model:{value:e.CrmFrom.mmsId,callback:function(t){e.$set(e.CrmFrom,"mmsId",t)},expression:"CrmFrom.mmsId"}})],1),t("el-form-item",{attrs:{label:"推荐用语：",prop:"execContent"}},[t("el-input",{attrs:{type:"textarea",maxlength:"500","show-word-limit":""},model:{value:e.CrmFrom.execContent,callback:function(t){e.$set(e.CrmFrom,"execContent",t)},expression:"CrmFrom.execContent"}})],1),t("el-form-item",[t("el-button",{on:{click:e.SubInstall}},[e._v("保存当前设置")])],1)],1)],1)},r=[],l=a("0fea"),s=a("5e05");const o=s["a"].common.queryAdivInfo,n=s["a"].common.getSysEnum;var c={props:["channelId"],data(){return{CrmFrom:{},CrmFromRules:{adivId:[{required:!0,message:"请选择运营位",trigger:"blur,change"}],sendType:[{required:!0,message:"请选择发送类型",trigger:"blur,change"}],videoSmsPlanId:[{required:!0,message:"请填写视频短信产品编码",trigger:"blur"}],mmsId:[{required:!0,message:"请填写彩信编码",trigger:"blur"}],execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}]},matList:[],typeList:[],adivList:[]}},mounted(){this.getOptionData()},methods:{getOptionData(){Object(l["i"])(o,{channelId:this.channelId}).then(e=>{this.adivList=e}),Object(l["i"])(n,{enumType:"E_608_SEND_TYPEd"}).then(e=>{this.typeList=e})},changeAid(){this.adivList.forEach(e=>{(this.CrmFrom.adivId=e.adivId)&&(this.CrmFrom.adivName=e.adivName)})},SubInstall(){this.$refs.CrmFrom.validate(e=>{})}}},m=c,u=a("2877"),d=Object(u["a"])(m,i,r,!1,null,"0ed81ca1",null);t["a"]=d.exports},"79a2":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("main",{staticClass:"script-main-content"},e._l(e.scriptList,(function(a,i){return t("el-tabs",{key:a.typeName,staticClass:"top-level-tabs"},[t("el-tab-pane",{attrs:{label:a.typeName}},[a.list&&a.list.length?[t("el-tabs",{attrs:{type:"card"},model:{value:e.richTextActive,callback:function(t){e.richTextActive=t},expression:"richTextActive"}},e._l(a.list,(function(r,l){return t("el-tab-pane",{attrs:{label:r.name,name:i+"-"+l}},[a.isRich?t("Editor",{attrs:{placeholder:"请输入"+r.name},model:{value:r.content,callback:function(t){e.$set(r,"content",t)},expression:"subItem.content"}}):t("el-input",{attrs:{type:"textarea",placeholder:"请输入"+r.name,autosize:{minRows:6,maxRows:10}},model:{value:r.content,callback:function(t){e.$set(r,"content",t)},expression:"subItem.content"}})],1)})),1)]:[t("el-tabs",{attrs:{type:"card"}},[t("el-tab-pane",{attrs:{label:a.typeName}},[a.uploadType?[t("Upload",{attrs:{type:"1"==a.uploadType?"image":"2"==a.uploadType?"video":"3"==a.uploadType?"audio":"image",action:"/mkt-term-svc/api/uploadScriptMaterial"},model:{value:e.scriptList[i],callback:function(t){e.$set(e.scriptList,i,t)},expression:"scriptList[i]"}}),t("el-form-item",{staticClass:"el-form-item-link-url",attrs:{label:"跳转链接：",rules:[{required:!0,message:"请输入链接地址",trigger:"blur"}]}},[t("el-input",{attrs:{placeholder:"请输入链接地址"},model:{value:a.linkUrl,callback:function(t){e.$set(a,"linkUrl",t)},expression:"item.linkUrl"}})],1)]:t("el-input",{attrs:{type:"textarea",autosize:{minRows:5,maxRows:8},placeholder:"请输入"+a.typeName},model:{value:a.content,callback:function(t){e.$set(a,"content",t)},expression:"item.content"}})],2)],1)]],2)],1)})),1)},r=[],l=a("ceb0"),s=a("eae4"),o={components:{Editor:l["a"],Upload:s["a"]},model:{prop:"value",event:"change"},props:{value:{type:Array,default:()=>[]}},watch:{scriptList:{handler(e){this.$emit("change",e)},deep:!0}},data(){return{scriptList:[{typeId:"2",typeName:"推荐用语",content:"",uploadType:"",uploadFileUrl:"",uploadFileName:"",list:[]}],richTextActive:"0-0"}},methods:{},created(){this.value&&this.value.length&&(this.scriptList=JSON.parse(JSON.stringify(this.value)))}},n=o,c=(a("1c07"),a("2877")),m=Object(c["a"])(n,i,r,!1,null,"d31d9c80",null);t["a"]=m.exports},"7b33":function(e,t,a){},"7b5a":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"Selected"},[e._m(0),t("div",{staticClass:"title label"},[t("span",[e._v(e._s(e.title))])]),t("div",{staticClass:"label"},e._l(e.newLabel,(function(a){return t("el-tag",{key:a[e.Default.id],staticClass:"tag-success",attrs:{type:"success",closable:"","disable-transitions":""},on:{close:function(t){return e.handleClose(a)}}},[e._v(" "+e._s(a[e.Default.value])+" ")])})),1),e.showHistoryBtn?t("el-button",{staticStyle:{"margin-left":"auto"},attrs:{type:"primary"},on:{click:function(t){return e.$emit("openHistory")}}},[e._v(" 营销历史 ")]):e._e()],1)])},r=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"Selected-icon label"},[t("i",{staticClass:"iconfont icongonggongtubiao-huitiaoliangcedianzhui"})])}],l={props:{showHistoryBtn:{type:Boolean,default:()=>!1},Label:{type:Array,default:()=>[]},Default:{type:Object,default:()=>({id:"id",value:"value"})},isPulldown:{type:Boolean,default:()=>!0},ismutex:{type:Boolean,default:()=>!0},title:{type:String,default:()=>"已选产品"},labelFlag:{type:String,default:()=>"product"}},watch:{Label(e,t){0!==e.length?e[0].customerFlag?this.newLabel=this.Label:this.newLabel=e.filter(e=>(void 0===e.flag&&(e.flag=this.labelFlag),e.flag===this.flag)):this.newLabel=this.Label},labelFlag(e,t){this.flag=e,this.newLabel=this.Label.filter(t=>t.flag===e)}},mounted(){this.newLabel=this.Label.filter(e=>e.flag===this.flag)},data(){return{SetMeal:!1,flag:"product",newLabel:[]}},methods:{handleClose(e){this.$emit("close",e)}},created(){}},s=l,o=(a("0924"),a("c37e"),a("2877")),n=Object(o["a"])(s,i,r,!1,null,"88aeb586",null);t["a"]=n.exports},"7b7a":function(e,t,a){"use strict";a("cc70")},"7b98":function(e,t,a){"use strict";a("eb28")},"7d49":function(e,t,a){},"7ec3":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("Tips",{attrs:{id:e.id},on:{getChannelDetail:e.getChannelDetail}}),t("el-form",{ref:"CrmFrom",staticStyle:{width:"100%"},attrs:{"label-width":"150px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"推送方式：",prop:"columnExt1"}},[t("el-radio-group",{model:{value:e.CrmFrom.columnExt1,callback:function(t){e.$set(e.CrmFrom,"columnExt1",t)},expression:"CrmFrom.columnExt1"}},[t("el-radio",{attrs:{label:"1",disabled:!e.CrmFrom.channelFlag}},[e._v("全量推送")]),t("el-radio",{attrs:{label:"0",disabled:!e.CrmFrom.channelFlag}},[e._v("偏好推送")])],1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"运营位：",prop:"adivInfo.adivId"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:e.changeAid},model:{value:e.CrmFrom.adivInfo.adivId,callback:function(t){e.$set(e.CrmFrom.adivInfo,"adivId",t)},expression:"CrmFrom.adivInfo.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1)],1),e.showExt18?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"智能话术："}},[t("el-checkbox",{on:{change:()=>e.CrmFrom.columnExt18=e.checkColumnExt18?"1":"0"},model:{value:e.checkColumnExt18,callback:function(t){e.checkColumnExt18=t},expression:"checkColumnExt18"}},[e._v("启用")]),e.checkColumnExt18?t("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt18,callback:function(t){e.$set(e.CrmFrom,"columnExt18",t)},expression:"CrmFrom.columnExt18"}},[t("el-radio",{attrs:{label:"1"}},[e._v("省端模型")]),t("el-radio",{attrs:{label:"2"}},[e._v("一级IOP模型")])],1):e._e()],1)],1):e._e(),e.CrmFrom.adivInfo.adivId?t("el-col",{attrs:{span:24}},[t("UseScript",{ref:"useScript",attrs:{"label-width":"150px","channel-id":e.channelNewData.channelId,"channel-name":e.channelNewData.channelName,"script-id":e.CrmFrom.columnExt19,CrmFrom:e.CrmFrom},on:{change:e.changeScript}})],1):e._e(),"9241"!==e.CrmFrom.adivInfo.adivId?[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"营销用语：",prop:"EXEC_CONTENT"}},[t("el-input",{directives:[{name:"forbidChars",rawName:"v-forbidChars"}],attrs:{id:"smsDetail",type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},on:{input:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.EXEC_CONTENT,callback:function(t){e.$set(e.CrmFrom,"EXEC_CONTENT",t)},expression:"CrmFrom.EXEC_CONTENT"}})],1)],1),t("el-col",{attrs:{span:24}},[1==e.custgroupSource?t("el-form-item",{attrs:{label:"营销用语替换变量：","label-width":"148px"}},[t("DNAReplaceVar",{on:{getVar:e.getContent}})],1):t("el-form-item",{attrs:{label:"营销用语替换变量：","label-width":"148px"}},e._l(e.replaceVar,(function(a){return t("el-tag",{key:a.id,attrs:{type:"info"},on:{click:function(t){return e.getContent(a.attrCol)}}},[e._v(e._s(a.attrColName))])})),1)],1)]:e._e(),"9241"===e.CrmFrom.adivInfo.adivId?[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"需求类型：",prop:"columnExt2"}},[t("el-select",{attrs:{placeholder:"请选择需求类型"},model:{value:e.CrmFrom.columnExt2,callback:function(t){e.$set(e.CrmFrom,"columnExt2",t)},expression:"CrmFrom.columnExt2"}},e._l(e.requirement,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"客服文档：",prop:"columnExt3"}},[t("Upload",{attrs:{accept:".doc, .docx, .pdf",action:e.action,fileList:e.fileList,limit:1},on:{changeFile:e.changeFile}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"图片：",prop:"columnExt4"}},[t("Upload",{ref:"uploadImgRef",attrs:{accept:"image/*",tip:"只能上传png,jpg,jpeg文件，且不超过5M",action:e.action,fileList:e.imgList,limit:1,rules:{size:5242880}},on:{changeFile:e.changeImage}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"宣传文案：",prop:"columnExt7"}},[t("el-input",{directives:[{name:"forbidChars",rawName:"v-forbidChars"}],attrs:{type:"textarea",placeholder:"请输入宣传文案"},model:{value:e.CrmFrom.columnExt7,callback:function(t){e.$set(e.CrmFrom,"columnExt7",t)},expression:"CrmFrom.columnExt7"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"链接：",prop:"columnExt6"}},[t("el-input",{attrs:{placeholder:"请输入链接"},on:{input:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt6,callback:function(t){e.$set(e.CrmFrom,"columnExt6",t)},expression:"CrmFrom.columnExt6"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"承载渠道：",prop:"columnExt8"}},[t("el-checkbox-group",{on:{change:e.checkChange},model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},[t("el-checkbox",{attrs:{label:"和我信通讯模块"}}),t("el-checkbox",{attrs:{label:"微信营业厅"}}),t("el-checkbox",{attrs:{label:"江西移动官网（掌端）"}})],1)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"活动主题：",prop:"columnExt9"}},[t("el-input",{directives:[{name:"forbidChars",rawName:"v-forbidChars"}],attrs:{placeholder:"请输入活动主题"},model:{value:e.CrmFrom.columnExt9,callback:function(t){e.$set(e.CrmFrom,"columnExt9",t)},expression:"CrmFrom.columnExt9"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"目标用户提取口径：",prop:"columnExt10"}},[t("el-input",{directives:[{name:"forbidChars",rawName:"v-forbidChars"}],attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},model:{value:e.CrmFrom.columnExt10,callback:function(t){e.$set(e.CrmFrom,"columnExt10",t)},expression:"CrmFrom.columnExt10"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"备注：",prop:"columnExt11"}},[t("el-input",{directives:[{name:"forbidChars",rawName:"v-forbidChars"}],attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},model:{value:e.CrmFrom.columnExt11,callback:function(t){e.$set(e.CrmFrom,"columnExt11",t)},expression:"CrmFrom.columnExt11"}})],1)],1)]:e._e()],2)],1)],1)},r=[],l=a("0fea"),s=a("5e05"),o=a("0557"),n=a("f1ce"),c=a("5ed5"),m=a("98d2"),u=a("d443"),d=a("6501"),h=a("b893"),p=a("00b8");const v=s["a"].common.queryAdivInfo;var C={props:["channelNewData","id","deleteSub"],components:{materialList:n["a"],Tips:c["a"],UseScript:m["a"],Upload:u["a"],DNAReplaceVar:d["a"]},data(){return{CrmFrom:{adivInfo:{},channelId:"",channelName:"",attributionInfo:{},columnExt1:"1",standard:"",CustomerRules:"",IF_HAVE_VAR:"0",columnExt2:"",columnExt3:"",columnExt4:"",columnExt5:"",columnExt6:"",columnExt7:"",columnExt8:"",columnExt9:"",columnExt10:"",columnExt11:"",columnExt18:"0",columnExt19:"",columnExt20:"",materialName:"",EXEC_CONTENT:""},showExt18:!1,checkColumnExt18:!1,CrmFromRules:{EXEC_CONTENT:[{required:!0,message:"请输入营销用语",trigger:"blur"}],columnExt1:[{required:!0,message:"请选择推送方式",trigger:"blur"}],columnExt2:[{required:!0,message:"请选择需求类型",trigger:"blur"}],columnExt7:[{required:!0,message:"请输入宣传文案",trigger:"blur"}],columnExt8:[{required:!0,message:"请选择承载渠道",trigger:"blur"}],columnExt9:[{required:!0,message:"请输入活动主题",trigger:"blur"}],columnExt10:[{required:!0,message:"请输入目标用户提取口径",trigger:"blur"}],adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},timeIdList:[],adivList:[],attributionList:[],replaceVar:[],checkList:[],requirement:[{label:"业务办理",value:"1"},{label:"活动宣传",value:"2"}],fileList:[],imgList:[],ShortMsgContent:""}},watch:{channelNewData:{handler(){var e;this.CrmFrom=Object(h["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"EXEC_CONTENT",this.channelNewData.EXEC_CONTENT||""),this.$set(this.CrmFrom,"columnExt7",this.CrmFrom.columnExt7||(null===(e=this.CrmFrom.channelConf)||void 0===e||null===(e=e.channelExtConf)||void 0===e?void 0:e.columnExt7)||""),this.checkList=this.CrmFrom.columnExt8?this.CrmFrom.columnExt8.split(","):[],this.fileList=this.CrmFrom.columnExt3?[{fileName:this.getFileNameByUrl(this.CrmFrom.columnExt3),url:this.CrmFrom.columnExt3}]:[],this.imgList=this.CrmFrom.columnExt4?[{fileName:this.getFileNameByUrl(this.CrmFrom.columnExt4),url:this.CrmFrom.columnExt4}]:[],this.checkColumnExt18=this.CrmFrom.columnExt18>0},deep:!0},CrmFrom:{handler(e,t){},deep:!0},deleteSub(){},SMS_CONTENT(e){if(e){const t=/\$[a-zA-Z0-9_\u4e00-\u9fa5]+\$/g,a=e.match(t);a&&a.length>0?this.CrmFrom.IF_HAVE_VAR="1":this.CrmFrom.IF_HAVE_VAR="0"}else this.CrmFrom.IF_HAVE_VAR="0"}},computed:{header(){return window.sessionStorage.getItem("IOP_TOKEN")},action(){return o["a"].commonConfig.baseURL+"/plan-svc/api/action/tactics/tacticsCreate/jx/fileUpload"},SMS_CONTENT(){return this.CrmFrom.EXEC_CONTENT},custgroupSource(){return this.$store.state.extendData.custgroupSource}},created(){var e;this.getOptionData(),this.listCustAttr(),this.CrmFrom=Object(h["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"EXEC_CONTENT",this.CrmFrom.EXEC_CONTENT||""),this.$set(this.CrmFrom,"columnExt7",this.CrmFrom.columnExt7||(null===(e=this.CrmFrom.channelConf)||void 0===e||null===(e=e.channelExtConf)||void 0===e?void 0:e.columnExt7)||""),this.checkList=this.CrmFrom.columnExt8?this.CrmFrom.columnExt8.split(","):[],this.fileList=this.CrmFrom.columnExt3?[{fileName:this.getFileNameByUrl(this.CrmFrom.columnExt3),url:this.CrmFrom.columnExt3}]:[],this.imgList=this.CrmFrom.columnExt4?[{fileName:this.getFileNameByUrl(this.CrmFrom.columnExt4),url:this.CrmFrom.columnExt4}]:[],this.checkColumnExt18=this.CrmFrom.columnExt18>0},methods:{getChannelDetail(e){1==e.smartScript&&(this.showExt18=!0)},async getOptionData(){await Object(l["i"])(v,{channelId:this.id}).then(e=>{this.adivList=e})},changeAid(e){const t=this.adivList.find(t=>t.adivId===e);this.$set(this.CrmFrom,"adivInfo",{adivId:(null===t||void 0===t?void 0:t.adivId)||"",adivName:(null===t||void 0===t?void 0:t.adivName)||""}),this.CrmFrom.columnExt19="",this.$refs.useScript&&this.$nextTick(()=>{this.$refs.useScript.getScriptList()}),this.$forceUpdate()},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t||("906"===this.id||"922"===this.id)&&this.CrmFrom.marketingWords&&this.CrmFrom.adivInfo.adivId?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e},async listCustAttr(){var e;const t=null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.customGroupId;await Object(l["i"])(s["a"].common.listCustAttr+"?custGroupId="+t).then(e=>{this.replaceVar=e})},getContent(e){let t="$"+e+"$";e=t,this.CrmFrom.EXEC_CONTENT||(this.CrmFrom.EXEC_CONTENT=""),this.ShortMsgContent=e;const a=document.querySelector("#smsDetail");if(a.selectionStart||0===a.selectionStart){var i=a.selectionStart,r=a.selectionEnd;this.CrmFrom={...this.CrmFrom,EXEC_CONTENT:a.value.substring(0,i)+e+a.value.substring(r,a.value.length)},this.$nextTick(),a.focus(),a.setSelectionRange(r+e.length,r+e.length)}else this.CrmFrom.EXEC_CONTENT+=e},selectMaterial(e){this.$refs["material"].getMaterialList(),this.$refs["material"].showDialog(e)},checkChange(e,t){this.CrmFrom.columnExt8=e.join(",")},addMaterial(e){this.CrmFrom={...this.CrmFrom,columnExt20:e.materialId,materialName:e.materialName}},changeFile(e){e.length>0?this.CrmFrom.columnExt3=e[0].url:this.CrmFrom.columnExt3=""},changeImage(e){e.length>0?this.CrmFrom.columnExt4=e[0].url:this.CrmFrom.columnExt4=""},getFileNameByUrl(e){return e.split("/").pop()},changeScript(e){var t;(this.CrmFrom.columnExt19=e.scriptId,"8"==e.contentType||"9"==e.contentType)&&(null===(t=this.$refs.uploadImgRef)||void 0===t||t.clearFileList(),this.$nextTick(()=>{this.imgList=e.marketingWords[0].uploadFileUrl?[{fileName:e.marketingWords[0].uploadFileName,url:e.marketingWords[0].uploadFileUrl}]:[]}));this.CrmFrom=Object(p["a"])(e,this.CrmFrom),this.$forceUpdate()}}},b=C,f=(a("3d00"),a("2877")),g=Object(f["a"])(b,i,r,!1,null,"07846e72",null);t["a"]=g.exports},"7ede":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ProductDialog"},[t("mp-dialog",{attrs:{TabsNav:e.TabsNav,IsAscertain:!1,visible:e.visible},on:{"update:visible":function(t){e.visible=t},"tabs-click":e.TabsSwitch,DialogClose:e.DialogClose}},[t("div",{attrs:{slot:"Dialogcontent"},slot:"Dialogcontent"},[t("label-screen",{attrs:{Label:e.Label,Default:e.Default,labelFlag:e.labelFlag,showHistoryBtn:e.showHistoryBtn},on:{close:e.handleClose,openHistory:e.showHistory}}),"product"==e.Current?t("div",[t("div",{staticClass:"search"},[t("div",{staticClass:"search_box",staticStyle:{width:"auto"}},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],staticClass:"input-search",attrs:{placeholder:"请输入产品编号/名称"},model:{value:e.ConditionFrom.keyWords,callback:function(t){e.$set(e.ConditionFrom,"keyWords","string"===typeof t?t.trim():t)},expression:"ConditionFrom.keyWords"}},[t("i",{staticClass:"el-input__icon el-icon-search cursor-pointer",attrs:{slot:"suffix"},on:{click:e.getProductListByKeyword},slot:"suffix"})])],1),t("div",{staticClass:"screen",on:{click:function(t){e.ScreenLabelstate=!e.ScreenLabelstate}}},[t("span",[e._v("更多筛选")]),t("i",{staticClass:"el-icon-arrow-down"})])]),t("el-collapse-transition",[e.ScreenLabelstate?t("div",{staticClass:"ScreenLabel"},[t("div",{staticClass:"category"},[t("query-form-cell",{attrs:{list:e.QueryFormCell,defaultSizeForm:e.sizeForm,labelWidth:e.labelWidth},on:{queryForm:e.QuerySelect}})],1)]):e._e()]),t("div",[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"Mp-table",staticStyle:{width:"100%"},attrs:{data:e.tableData,height:"calc(100vh - 470px)"},on:{"row-click":e.AddProduct}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"45px"}}),t("el-table-column",{attrs:{prop:"date",label:"产品编号及名称","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticClass:"pointer",on:{click:function(t){return e.DetailsClick(a.row)}}},[t("p",{staticClass:"color2F8"},[e._v(" "+e._s(a.row.planName)+" ")]),t("p",{staticClass:"color2F8"},[e._v(" "+e._s(a.row.planId)+" ")])])]}}],null,!1,3115280878)}),t("el-table-column",{attrs:{label:"商品类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.offerType))]}}],null,!1,3652715293)}),t("el-table-column",{attrs:{label:"产商品类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.itemType))]}}],null,!1,2987961968)}),t("el-table-column",{attrs:{label:"产品业务分类",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.prodClassBusi))]}}],null,!1,1829056215)}),t("el-table-column",{attrs:{prop:"planStartDate",label:"生效时间",width:"140"}}),t("el-table-column",{attrs:{prop:"planEndDate",label:"失效时间",width:"140"}}),t("el-table-column",{attrs:{label:"操作",fixed:"right",width:"50px"}},[[t("el-button",{attrs:{type:"text",size:"small"}},[e._v("添加")])]],2)],1)],1),t("div",{staticClass:"pager"},[t("el-pagination",{attrs:{"current-page":e.pageData.currentPage,"page-sizes":e.pageData.pageSizeList,"page-size":e.pageData.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pageData.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1):e._e(),"fuse"==e.Current?t("div",[t("div",{staticClass:"search"},[t("div",{staticClass:"search_box",staticStyle:{width:"auto"}},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],staticClass:"input-search",attrs:{placeholder:"请输入内容编号/名称"},model:{value:e.ConditionFrom.keyWords,callback:function(t){e.$set(e.ConditionFrom,"keyWords","string"===typeof t?t.trim():t)},expression:"ConditionFrom.keyWords"}},[t("i",{staticClass:"el-input__icon el-icon-search cursor-pointer",attrs:{slot:"suffix"},on:{click:e.getProductListByKeyword},slot:"suffix"})])],1),t("div",{staticClass:"screen",on:{click:function(t){e.ScreenLabelstate=!e.ScreenLabelstate}}},[t("span",[e._v("更多筛选")]),t("i",{staticClass:"el-icon-arrow-down"})])]),t("el-collapse-transition",[e.ScreenLabelstate?t("div",{staticClass:"ScreenLabel"},[t("div",{staticClass:"category"},[t("query-form-cell",{attrs:{list:e.QueryFormCell,defaultSizeForm:e.sizeForm,labelWidth:e.labelWidth},on:{queryForm:e.QuerySelect}})],1)]):e._e()]),t("div",[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"Mp-table",staticStyle:{width:"100%"},attrs:{data:e.tableData,height:"calc(100vh - 470px)"},on:{"row-click":e.AddProduct}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"45px"}}),t("el-table-column",{attrs:{prop:"date",label:"产品编号及名称","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticClass:"pointer",on:{click:function(t){return e.DetailsClick(a.row)}}},[t("p",{staticClass:"color2F8"},[e._v(" "+e._s(a.row.planName)+" ")]),t("p",{staticClass:"color2F8"},[e._v(" "+e._s(a.row.planId)+" ")])])]}}],null,!1,3115280878)}),t("el-table-column",{attrs:{label:"商品类型",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.offerType))]}}],null,!1,3652715293)}),t("el-table-column",{attrs:{label:"产商品类型",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.itemType))]}}],null,!1,2987961968)}),t("el-table-column",{attrs:{label:"产品业务分类",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.prodClassBusi))]}}],null,!1,1829056215)}),t("el-table-column",{attrs:{prop:"planStartDate",label:"生效时间",width:"140"}}),t("el-table-column",{attrs:{prop:"planEndDate",label:"失效时间",width:"140"}}),t("el-table-column",{attrs:{label:"操作",fixed:"right",width:"50px"}},[[t("el-button",{attrs:{type:"text",size:"small"}},[e._v("添加")])]],2)],1)],1),t("div",{staticClass:"pager"},[t("el-pagination",{attrs:{"current-page":e.pageData.currentPage,"page-sizes":e.pageData.pageSizeList,"page-size":e.pageData.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pageData.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1):e._e(),"homologous"==e.Current?t("div",[t("div",{staticClass:"search"},[t("div",{staticClass:"search_box",staticStyle:{width:"auto"}},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],staticClass:"input-search",attrs:{placeholder:"请输入内容编号/名称"},model:{value:e.ConditionFrom.keyWords,callback:function(t){e.$set(e.ConditionFrom,"keyWords","string"===typeof t?t.trim():t)},expression:"ConditionFrom.keyWords"}},[t("i",{staticClass:"el-input__icon el-icon-search cursor-pointer",attrs:{slot:"suffix"},on:{click:e.getProductListByKeyword},slot:"suffix"})])],1),t("div",{staticClass:"screen",on:{click:function(t){e.ScreenLabelstate=!e.ScreenLabelstate}}},[t("span",[e._v("更多筛选")]),t("i",{staticClass:"el-icon-arrow-down"})])]),t("el-collapse-transition",[e.ScreenLabelstate?t("div",{staticClass:"ScreenLabel"},[t("div",{staticClass:"category"},[t("query-form-cell",{attrs:{list:e.QueryFormCell,defaultSizeForm:e.sizeForm,labelWidth:e.labelWidth},on:{queryForm:e.QuerySelect}})],1)]):e._e()]),t("div",[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"Mp-table",staticStyle:{width:"100%"},attrs:{data:e.tableData,height:"calc(100vh - 470px)"},on:{"row-click":e.AddProduct}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"45px"}}),t("el-table-column",{attrs:{prop:"date",label:"产品编号及名称","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticClass:"pointer",on:{click:function(t){return e.DetailsClick(a.row)}}},[t("p",{staticClass:"color2F8"},[e._v(" "+e._s(a.row.planName)+" ")]),t("p",{staticClass:"color2F8"},[e._v(" "+e._s(a.row.planId)+" ")])])]}}],null,!1,3115280878)}),t("el-table-column",{attrs:{label:"商品类型",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.offerType))]}}],null,!1,3652715293)}),t("el-table-column",{attrs:{label:"产商品类型",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.itemType))]}}],null,!1,2987961968)}),t("el-table-column",{attrs:{label:"产品业务分类",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.prodClassBusi))]}}],null,!1,1829056215)}),t("el-table-column",{attrs:{prop:"planStartDate",label:"生效时间",width:"140"}}),t("el-table-column",{attrs:{prop:"planEndDate",label:"失效时间",width:"140"}}),t("el-table-column",{attrs:{label:"操作",fixed:"right",width:"45px"}},[[t("el-button",{attrs:{type:"text",size:"small"}},[e._v("添加")])]],2)],1)],1),t("div",{staticClass:"pager"},[t("el-pagination",{attrs:{"current-page":e.pageData.currentPage,"page-sizes":e.pageData.pageSizeList,"page-size":e.pageData.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pageData.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1):e._e(),"mutual"==e.Current?t("div",[t("div",{staticClass:"search"},[t("div",{staticClass:"screen-mutual"},[t("el-checkbox",{staticStyle:{"line-height":"30px"},model:{value:e.allIn,callback:function(t){e.allIn=t},expression:"allIn"}},[e._v("全选")])],1),t("div",{staticClass:"screen-mutual",on:{click:function(t){return e.getMutual()}}},[t("span",[e._v("默认互斥产品")])])]),t("el-collapse-transition",[e.ScreenLabelstate?t("div",{staticClass:"ScreenLabel"},[t("div",{staticClass:"category"},[t("query-form-cell",{attrs:{list:e.QueryFormCell,defaultSizeForm:e.sizeForm,labelWidth:e.labelWidth},on:{queryForm:e.QuerySelect}})],1)]):e._e()]),t("div",[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.mutualTableData,height:"calc(100vh - 470px)"}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"45px"}}),t("el-table-column",{attrs:{prop:"planId",label:"产品编号",width:"150","show-overflow-tooltip":!0}}),t("el-table-column",{attrs:{prop:"planName",label:"产品名称"}})],1)],1),t("div",{staticClass:"pager"},[t("div",{staticStyle:{height:"30px"}})])],1):e._e(),"content"==e.Current?t("div",[t("div",{staticClass:"search_box",staticStyle:{width:"auto"}},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],staticClass:"input-search",attrs:{placeholder:"请输入内容编码/名称"},model:{value:e.ContentFrom.productName,callback:function(t){e.$set(e.ContentFrom,"productName","string"===typeof t?t.trim():t)},expression:"ContentFrom.productName"}},[t("i",{staticClass:"el-input__icon el-icon-search cursor-pointer",attrs:{slot:"suffix"},on:{click:e.queryDigitalProductContentsByKeyword},slot:"suffix"})])],1),t("div",[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.ContentData,height:"calc(100vh - 470px)"},on:{"row-click":e.AddProduct}},[t("el-table-column",{attrs:{type:"index",label:"序号"}}),t("el-table-column",{attrs:{prop:"date",label:"内容ID及名称"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticClass:"pointer",on:{click:function(t){return e.DetailsClickContent(a.row)}}},[t("p",{staticClass:"color2F8"},[e._v(" "+e._s(a.row.productName)+" ")]),t("p",{staticClass:"color2F8"},[e._v(" "+e._s(a.row.planId)+" ")])])]}}],null,!1,2142162847)}),t("el-table-column",{attrs:{prop:"productDesc",label:"营销内容"}}),t("el-table-column",{attrs:{label:"操作"}},[[t("el-button",{attrs:{type:"text",size:"small"}},[e._v("添加")]),t("el-radio",{attrs:{label:e.scope.row.productCode},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[e._v(e._s(""))])]],2)],1)],1),t("div",{staticClass:"pager"},[t("el-pagination",{attrs:{"current-page":e.pageData.currentPage,"page-sizes":e.pageData.pageSizeList,"page-size":e.pageData.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pageData.total},on:{"size-change":e.handleSizeChangeContent,"current-change":e.handleCurrentChangeContent}})],1)]):e._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:"productPackage"==e.Current,expression:"Current == 'productPackage'"}]},[t("div",{staticClass:"search"},[t("div",{staticClass:"search_box",staticStyle:{width:"auto"}},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],staticClass:"input-search",attrs:{placeholder:"请输入内容编码/名称"},model:{value:e.ConditionFrom.keyWords,callback:function(t){e.$set(e.ConditionFrom,"keyWords","string"===typeof t?t.trim():t)},expression:"ConditionFrom.keyWords"}},[t("i",{staticClass:"el-input__icon el-icon-search cursor-pointer",attrs:{slot:"suffix"},on:{click:e.getProductListByKeyword},slot:"suffix"})])],1),t("div",{staticClass:"screen",on:{click:function(t){e.ScreenLabelstate=!e.ScreenLabelstate}}},[t("span",[e._v("更多筛选")]),t("i",{staticClass:"el-icon-arrow-down"})])]),t("el-collapse-transition",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.ScreenLabelstate,expression:"ScreenLabelstate"}],staticClass:"ScreenLabel"},[t("div",{staticClass:"category"},[t("query-form-cell",{attrs:{list:e.QueryFormCell,defaultSizeForm:e.sizeForm},on:{queryForm:e.QuerySelect}})],1)])]),t("div",[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,height:"calc(100vh - 470px)"},on:{"row-click":e.AddProduct}},[t("el-table-column",{attrs:{type:"index",label:"序号"}}),t("el-table-column",{attrs:{prop:"date",label:"产品编号及名称"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticClass:"pointer",on:{click:function(t){return e.DetailsClick(a.row)}}},[t("p",{staticClass:"color2F8"},[e._v(" "+e._s(a.row.planName)+" ")]),t("p",{staticClass:"color2F8"},[e._v(" "+e._s(a.row.planId)+" ")])])]}}])}),t("el-table-column",{attrs:{prop:"typeName",label:"产品类别"}}),t("el-table-column",{attrs:{prop:"planSrvTypeName",label:"产品类型"}}),t("el-table-column",{attrs:{prop:"planStartdate",label:"生效时间"}}),t("el-table-column",{attrs:{prop:"planEnddate",label:"失效时间"}}),t("el-table-column",{attrs:{label:"操作",fixed:"right"}},[[t("el-button",{attrs:{type:"text",size:"small"}},[e._v("添加")])]],2)],1)],1),t("div",{staticClass:"pager"},[t("el-pagination",{attrs:{"current-page":e.pageData.currentPage,"page-sizes":e.pageData.pageSizeList,"page-size":e.pageData.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pageData.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),t("div",{staticClass:"Product-button"},[t("el-button",{attrs:{type:"success",size:"medium"},on:{click:e.ProductSub}},[e._v("确定")])],1)],1)]),t("MutualDialog",{attrs:{dialogTableVisible:e.mutualVisible,mutual:e.mutualList,label:e.mutualParams},on:{changeMutual:e.changeMutual}}),t("mp-dialog",{attrs:{title:"产品详情",isReturn:!0,isClose:!1,visible:e.ProductDetails,IsAscertain:!1},on:{"update:visible":function(t){e.ProductDetails=t},"dialog-retrun":e.DialogRetrun}},[t("div",{attrs:{slot:"Dialogcontent"},slot:"Dialogcontent"},[e.ProductDetails?t("product-content",{attrs:{planId:e.planId}}):e._e()],1)]),t("mp-dialog",{attrs:{title:"内容详情",isReturn:!0,isClose:!1,visible:e.ContentDetails,IsAscertain:!1},on:{"update:visible":function(t){e.ContentDetails=t},"dialog-retrun":e.DetailsContentRetrun}},[t("div",{attrs:{slot:"Dialogcontent"},slot:"Dialogcontent"},[e.ContentDetails?t("content-details",{attrs:{productCode:e.productCode}}):e._e()],1)]),t("transition",{attrs:{name:"fade"}},[e.showHistoryFlag?t("div",{staticClass:"history-part"},[t("MarketingHistory",{attrs:{type:"product","bar-data":[e.historyOption]},on:{close:e.closeHistoryBar}})],1):e._e()])],1)},r=[],l=(a("14d9"),a("13d5"),a("4e3f")),s=a("b132"),o=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"productContent"}),e._m(0),t("vertical-table",{attrs:{tableData:e.tableData,DetailsFrom:e.DetailForm,showByRow:!0,tableStyle:{width:"100%"}}})],1)},n=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"tableTitle"},[t("h3",[e._v("基础信息")])])}],c=a("0fea"),m=a("d370"),u=a("08cc"),d={props:{productCode:{type:String,default:()=>""}},components:{VerticalTable:u["a"]},data(){return{tableData:[{key:"场景名称：",value:"sceneName"},{key:"产品编码：",value:"productCode"},{key:"所属平台编码：",value:"platformCode"},{key:"产品名称：",value:"productName"},{key:"一级业务分类：",value:"firstBusinessClass"},{key:"二级业务分类：",value:"secondBusinessClass"},{key:"三级业务分类：",value:"thirdBusinessClass"},{key:"产品描述：",value:"productDesc"},{key:"产品类别：",value:"productType"},{key:"信息类别：",value:"informationType"},{key:"语种：",value:"language"},{key:"作者：",value:"author"},{key:"WAP方式：",value:"wapUrl",iscolspan:!0},{key:"WWW方式：",value:"wwwUrl",iscolspan:!0},{key:"客户端方式：",value:"clientUrl",iscolspan:!0},{key:"获取路径：",value:"url",iscolspan:!0},{key:"计费方式：",value:"billingMode"},{key:"计费值：",value:"billingValue"},{key:"适用范围：",value:"scope"},{key:"提供商标识：",value:"vendor"},{key:"发布时间：",value:"releaseTime"},{key:"更新时间：",value:"updateTime"},{key:"有效期：",value:"validPeriod"},{key:"发布状态：",vclientShortUrlalue:"releaseStatus"},{key:"适用操作系统：",value:"osType"},{key:"描述性标签：",value:"descriptiveLabel"},{key:"统计型标签：",value:"statisticalLabel"},{key:"精品分类：",value:"qualityClass"},{key:"限免生效时间：",value:"freeLimitStartTime"},{key:"限免失效时间：",value:"freeLimitEndTime"},{key:"推荐用语：",value:"recommendTerms",iscolspan:!0},{key:"推荐用语(热门视频):",value:"recommendTermsForVideo",iscolspan:!0},{key:"推荐用语(热门短视频):",value:"recommendTermsForSVideo",iscolspan:!0},{key:"热门综合前50名：",value:"top50Rank",iscolspan:!0},{key:"热门短视频前50名：",value:"top50RankForShortVideo",iscolspan:!0},{key:"WAPURL短地址：",value:"wapShortUrl",iscolspan:!0},{key:"客户端URL短地址：",value:"clientShortUrl",iscolspan:!0},{key:"WWWURL短地址：",value:"wwwShortUrl",iscolspan:!0}],DetailForm:{}}},created(){this.getqueryDetail()},methods:{async getqueryDetail(){await Object(c["i"])(m["a"].mpapi.queryConentDetailById,{productCode:this.productCode}).then(e=>{this.DetailForm=e})}}},h=d,p=(a("0ad5"),a("2877")),v=Object(p["a"])(h,o,n,!1,null,"508fdc4b",null),C=v.exports,b=a("7b5a"),f=a("121a"),g=a("31b1"),_=a("2f62"),x=a("ac7c"),E=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mutual-dialog"},[t("el-dialog",{attrs:{title:"默认互斥产品查看",visible:e.dialogTableVisible,"before-close":e.handleClose},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[t("div",{staticClass:"sub-title"},[e._v("主产品[ "+e._s(e.label.planId)+" ]默认互斥产品：")]),t("el-table",{attrs:{data:e.mutual,stripe:""}},[t("el-table-column",{attrs:{label:"序号",width:"150",type:"index",align:"center"}}),t("el-table-column",{attrs:{prop:"planId",label:"产品编号",width:"200",align:"center"}}),t("el-table-column",{attrs:{prop:"planName",label:"产品名称",align:"center"}})],1)],1)],1)},y=[],F={props:{dialogTableVisible:{type:Boolean,default(){return!1}},mutual:{type:Array,default(){return null}},label:{type:Object,default(){return null}}},data(){return{}},watch:{mutual(e,t){}},methods:{handleClose(){this.$emit("changeMutual")}}},I=F,D=(a("546b"),Object(p["a"])(I,E,y,!1,null,"0cbb3cea",null)),w=D.exports,k=a("5565"),N={components:{MpDialog:s["a"],LabelScreen:b["a"],ProductContent:f["a"],ContentDetails:C,QueryFormCell:l["a"],MutualDialog:w,MarketingHistory:k["a"]},data(){return{Current:"product",visible:!1,productSelectType:!1,TabsNav:{data:[{id:"1",label:"主产品",value:"product"},{id:"5",label:"融合产品",value:"fuse"},{id:"6",label:"同系列产品",value:"homologous"},{id:"7",label:"互斥产品",value:"mutual"}],default:"1"},labelWidth:"110px",Label:[],mutualLabel:[],tableData:[],mutualData:[],Default:{id:"planId",value:"planName"},QueryFormCell:[{label:"产品业务分类",values:[{label:"不限",value:""}],isDate:!1},{label:"产商品类型",values:[{label:"不限",value:""}],isDate:!1},{label:"商品类型",values:[{label:"不限",value:""}],isDate:!1}],sizeForm:{radioModel:["",""]},input:"",ContentData:[],radio:"",checkDataArr:[],checkIds:[],ConditionFrom:{channelId:"",isEliminateRule:"",keyWords:"",current:1,planIsOptimization:"",prodClassBusi:"",itemType:"",offerType:""},pageData:{currentPage:1,pageSize:10,pageSizeList:[10,20,30,40],total:0},ScreenLabelstate:!1,ProductDetails:!1,ContentDetails:!1,planId:"",productCode:"",loading:!1,ContenttotalSize:0,ContentFrom:{productName:"",productType:"",status:""},currentData:"",mutualVisible:!1,mutualList:[],mutualParams:{planId:""},labelFlag:"product",mutualTableData:[],allIn:!0,showHistoryFlag:!1,historyOption:{id:"1111",title:"所选主产品的转化率top5活动（近30天）",loading:!1,yAxis:{name:"营销成功率",data:[]},xAxis:{name:"活动名称",labelRotate:!0,data:[]},itemClickEvent:!0}}},watch:{allIn(e){if(e){let e=this.Label;const t=this.mutualTableData.map(e=>({planId:e.planId,planName:e.planName,flag:"mutual"}));t.forEach(t=>{e.push(t)}),this.Label=e}else this.Label=this.Label.filter(e=>"mutual"!==e.flag)}},computed:{...Object(_["b"])("MarkPl",["getNodeData","getNode"]),channelData(){let e=0;const t=this.$store.state.MarkPl.SceneNodeData;for(let i=0;i<t.length;i++){let a=t[i].findIndex(e=>e.id===this.getNode.id);if(-1!==a){e=i;break}}const a=t[e].find(e=>"channelDialog"===e.assembly)||{NodeObj:[]};return a.NodeObj},baseInformation:function(){return this.$store.state.MarkPl.ProcessData},showHistoryBtn(){return this.showHistoryFlag=!1,"product"===this.Current&&this.Label.length>0}},created(){if("{}"!==JSON.stringify(this.getNodeData))for(let e in this.getNodeData)this.Label.push(this.getNodeData[e]);this.Label.length>1&&(this.productSelectType=!0),this.getProductList(),this.queryDigitalProductContents(),this.queryPlanTypes()},methods:{changeMutual(){this.mutualVisible=!1},async getMutual(){const e=this.Label.filter(e=>"product"===e.flag);0===e.length?this.$message.error("请先选择主产品"):await Object(c["i"])(m["a"].mpapi.getmutualList,{planId:e[0].planId,sourceType:1}).then(e=>{this.mutualList=e.planExcluList,this.mutualParams=this.Label[0],this.mutualVisible=!0})},queryPlanTypes(){Object(c["g"])(m["a"].mpapi.querylistEnumValue,{labelKey:"PROD_CLASS_BUSI"}).then(e=>{e.map(e=>{this.QueryFormCell[0].values.push({label:e.labelValue,value:e.labelValue})})}),Object(c["g"])(m["a"].mpapi.querylistEnumValue,{labelKey:"OFFER_TYPE"}).then(e=>{e.map(e=>{this.QueryFormCell[2].values.push({label:e.labelValue,value:e.labelValue})})}),Object(c["g"])(m["a"].mpapi.querylistEnumValue,{labelKey:"ITEM_TYPE"}).then(e=>{e.map(e=>{this.QueryFormCell[1].values.push({label:e.labelValue,value:e.labelValue})})})},getProductList(e=!1){this.loading=!0,Object(c["i"])(m["a"].mpapi.queryTableList,{...this.ConditionFrom,current:this.pageData.currentPage,size:this.pageData.pageSize},void 0,this.$retryDelay).then(e=>{this.tableData=e.records,this.pageData.total=e.total,this.loading=!1}).catch(t=>{var a;null!==(a=t.message)&&void 0!==a&&a.includes("timeout")&&!0!==e&&this.getProductList(!0)}).finally(()=>{this.loading=!1})},getProductListByKeyword(){this.pageData.currentPage=1,this.getProductList()},async queryDigitalProductContents(){this.loading=!0,await Object(c["i"])(m["a"].mpapi.queryDigitalProductContents,{...this.ContentFrom,current:this.pageData.currentPage,size:this.pageData.pageSize}).then(e=>{this.ContentData=e.records,this.ContenttotalSize=e.total,this.loading=!1})},queryDigitalProductContentsByKeyword(){this.pageData.currentPage=1,this.queryDigitalProductContents()},QuerySelect(e){this.pageData.currentPage=1,this.ConditionFrom.prodClassBusi=e.form.radioModel[0],this.ConditionFrom.offerType=e.form.radioModel[2],this.ConditionFrom.itemType=e.form.radioModel[1],this.getProductList()},handleSizeChange(e){this.pageData.pageSize=e,this.getProductList()},handleCurrentChange(e){this.pageData.currentPage=e,this.getProductList()},handleSizeChangeContent(e){this.pageData.pageSize=e,this.queryDigitalProductContents()},handleCurrentChangeContent(e){this.pageData.pageSize=e,this.queryDigitalProductContents()},DataRestore(){this.Current="product",this.visible=!1,this.ProductDetails=!1,this.ContentDetails=!1,this.TabsNav={data:[{id:"1",label:"选产品",value:"product"},{id:"2",label:"选内容",value:"content"}],default:"1"}},showMpDialog(){this.productSelectType=this.baseInformation.isCheckboxPro,this.visible=!0},async TabsSwitch(e){this.showHistoryFlag=!1,this.labelFlag=e.value;let t=this.Label.filter(e=>"product"===e.flag);if(this.mutualData=[],"7"===e.id)if(0!==t.length){this.getmutualList();let t={...this.TabsNav};t.default=e.id,this.TabsNav={...t},this.Current=e.value}else{let t={...this.TabsNav};t.default=e.id,this.TabsNav={...t},this.$nextTick(()=>{let e={...this.TabsNav};e.default="1",this.TabsNav={...e},this.Current="product",this.labelFlag="product"}),this.$message.error("请先选择主产品")}else{let t={...this.TabsNav};t.default=e.id,this.TabsNav={...t},this.Current=e.value}},handleClose(e){this.Label.splice(this.Label.indexOf(e),1),this.radio=""},ProductSub(){let e=[],t=[],a=[],i=[];if(this.Label.length>0){var r,l;let n=null===(r=this.Label.find(e=>"product"===e.flag))||void 0===r?void 0:r.planId;if(!n)return this.$message.error("请选择主产品");if((null===(l=this.getNodeData[0])||void 0===l?void 0:l.planId)!=n&&this.channelData.length)for(let e of this.channelData){var s,o;let t=!1;if((e.columnExt19||null!==(s=e.channelConf)&&void 0!==s&&s.columnExt19||null!==(o=e.channelConf)&&void 0!==o&&null!==(o=o.channelExtConf)&&void 0!==o&&o.columnExt19)&&(t=!0),x["f"].some(t=>t.value==e.channelId)&&t){let t;switch(e.channelId){case"804":t="columnExt2";break;case"808":t="columnExt2";break;case"906":t="execContent";break;case"924":t="columnExt7";break;default:t="execContent"}this.$store.commit("MarkPl/fnUpdateClearChannelData",{key:t,channelId:e.channelId,id:this.getNode.id}),this.$store.commit("MarkPl/fnUpdateClearChannelData",{key:"columnExt19",channelId:e.channelId,id:this.getNode.id})}}this.$store.commit("MarkPl/fuUpdateSceneNodeData",this.Label),this.Label.forEach(r=>{"product"===r.flag?e.push(r.planName):"mutual"===r.flag?t.push(r.planName):"homologous"===r.flag?a.push(r.planName):"fuse"===r.flag&&i.push(r.planName)});const c={NewData:e,mutual:t,homologous:a,fuse:i};this.$store.commit("MarkPl/fnUpdateActiveNodeList",c),this.$emit("ProductSub",this.Label[0]),this.DialogClose(),this.visible=!1}else this.$message.error("请选择产品")},DialogClose(){this.$emit("DialogClose")},AddProduct(e){switch(this.showHistoryFlag=!1,this.Current){case"product":this.productSelect(e,"planId","planName","product");break;case"productPackage":this.productSelect(e,"planId","planName");break;case"content":this.productSelect(e,"productCode","productName");break;case"mutual":this.productSelect(e,"planId","planName","mutual");break;case"homologous":this.productSelect(e,"planId","planName","homologous");break;case"fuse":this.productSelect(e,"planId","planName","fuse");break}},productSelect(e,t,a,i){this.currentData=JSON.parse(JSON.stringify(this.Current));let r={planEndDate:e["planEndDate"],planId:e[t],planName:e[a],flag:i};if(this.productSelectType){if("product"===i)this.Label=[r];else if("mutual"===i){const e=this.Label.some(e=>"product"===e.flag);e?this.productFormater("mutual",r,20):this.$message.error("请先选择主产品")}else if("homologous"===i){const e=this.Label.some(e=>"product"===e.flag);e?this.productFormater("homologous",r,20):this.$message.error("请先选择主产品")}else if("fuse"===i){const e=this.Label.some(e=>"product"===e.flag);e?this.productFormater("fuse",r,5):this.$message.error("请先选择主产品")}}else this.Label=[r],this.radio=r.planId},productFormater(e,t,a){let i=this.Label.filter(t=>t.flag===e);if(i.length<a){let e=this.Label.some(e=>e.planId===t.planId);e?this.$message.error("您已经添加过该商品，请勿重复添加"):(this.Label=this.Label.filter(e=>e.planId!==t.planId),this.Label.push(t))}else this.$message.error(`融合产品最多只能添加${a}个哦！`)},DetailsClick(e){this.planId=e.planId,this.visible=!1,this.ProductDetails=!0},DetailsClickContent(e){this.productCode=e.productCode,this.visible=!1,this.ContentDetails=!0},DetailsContentRetrun(){this.ContentDetails=!1,this.visible=!0},DialogRetrun(){this.ProductDetails=!1,this.visible=!0},async getmutualList(){const e=this.Label.filter(e=>"product"===e.flag);await Object(c["i"])(m["a"].mpapi.getmutualList,{planId:e[0].planId,sourceType:0}).then(e=>{this.mutualTableData=e.planExcluList;let t=this.Label;const a=this.mutualTableData.map(e=>({planId:e.planId,planName:e.planName,flag:"mutual"}));a.forEach(e=>{t.push(e)});const i={},r=t.reduce((e,t)=>(!i[t.planId]&&(i[t.planId]=e.push(t)),e),[]);this.Label=r})},handleSelectionChange(){},async showHistory(){let e=this.Label[0];this.historyOption.id=e.planId,this.historyOption.xAxis.data=[],this.historyOption.yAxis.data=[],this.showHistoryFlag=!0;try{this.historyOption.loading=!0;const t=await Object(c["i"])(g["a"].channel.planMarketingHistory,{planName:e.planName});for(let e of t)this.historyOption.xAxis.data.push(e.campsegName),this.historyOption.yAxis.data.push({value:parseFloat(e.successRate),campsegId:e.campsegId,campsegName:e.campsegName})}catch(t){}finally{this.historyOption.loading=!1}},closeHistoryBar(){this.showHistoryFlag=!1}}},S=N,L=(a("0188"),a("c53f"),Object(p["a"])(S,i,r,!1,null,"ce087f7c",null));t["a"]=L.exports},"7f9a":function(e,t,a){"use strict";a("1501")},"854d":function(e,t,a){"use strict";a("df2f")},8553:function(e,t,a){},"856c":function(e,t,a){e.exports=a.p+"img/loading.315fa32e.gif"},"863d":function(e,t,a){},"864b":function(e,t,a){"use strict";a("3193")},8657:function(e,t,a){},"866a":function(e,t,a){},"87ac":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("Tips",{attrs:{id:e.id},on:{getChannelDetail:e.getChannelDetail}}),t("div",{staticStyle:{display:"flex","justify-content":"end"}}),t("el-form",{ref:"CrmFrom",staticStyle:{width:"100%"},attrs:{"label-width":"145px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"推送方式：",prop:"columnExt1"}},[t("el-radio-group",{model:{value:e.CrmFrom.columnExt1,callback:function(t){e.$set(e.CrmFrom,"columnExt1",t)},expression:"CrmFrom.columnExt1"}},[t("el-radio",{attrs:{label:"1",disabled:!e.CrmFrom.channelFlag}},[e._v("全量推送")]),t("el-radio",{attrs:{label:"0",disabled:!e.CrmFrom.channelFlag}},[e._v("偏好推送")])],1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"外呼类型：",prop:"columnExt3"}},[t("el-select",{attrs:{placeholder:"请选择外呼类型"},on:{change:e.changeOutbound},model:{value:e.CrmFrom.columnExt3,callback:function(t){e.$set(e.CrmFrom,"columnExt3",t)},expression:"CrmFrom.columnExt3"}},e._l(e.outboundType,(function(e){return t("el-option",{key:e.enumId,attrs:{label:e.enumValue,value:e.enumValue}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"标准化素材：",prop:"columnExt20"}},[t("div",{staticClass:"select-material",on:{click:function(t){return e.selectMaterial(!0)}}},[e._v(e._s(e.CrmFrom.materialName||"请选择"))])])],1),"调研类_地市"==e.CrmFrom.columnExt3?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"地市：",prop:"columnExt8"}},[t("el-select",{staticStyle:{width:"189px"},attrs:{multiple:"","collapse-tags":"",placeholder:"请选择地市",disabled:"999"!=e.cityId},model:{value:e.citySelect,callback:function(t){e.citySelect=t},expression:"citySelect"}},e._l(e.cityList,(function(e){return t("el-option",{key:e.cityId,attrs:{label:e.cityName,value:e.cityId}})})),1)],1)],1):e._e(),e.showExt18?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"智能话术："}},[t("el-checkbox",{on:{change:()=>e.CrmFrom.columnExt18=e.checkColumnExt18?"1":"0"},model:{value:e.checkColumnExt18,callback:function(t){e.checkColumnExt18=t},expression:"checkColumnExt18"}},[e._v("启用")]),e.checkColumnExt18?t("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt18,callback:function(t){e.$set(e.CrmFrom,"columnExt18",t)},expression:"CrmFrom.columnExt18"}},[t("el-radio",{attrs:{label:"1"}},[e._v("省端模型")]),t("el-radio",{attrs:{label:"2"}},[e._v("一级IOP模型")])],1):e._e()],1)],1):e._e(),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"营销用语：",prop:"columnExt2","label-width":"148px"}},[t("el-input",{directives:[{name:"forbidChars",rawName:"v-forbidChars"}],ref:"wording",attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},model:{value:e.CrmFrom.columnExt2,callback:function(t){e.$set(e.CrmFrom,"columnExt2",t)},expression:"CrmFrom.columnExt2"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"标签属性：","label-width":"148px"}},[t("div",{staticClass:"label-content"},[t("div",{staticClass:"label"},["variable"==e.lableProp?t("div",{staticClass:"label-item"},e._l(e.labelConfig[e.lableProp],(function(a){return t("span",{key:a.id,on:{click:function(t){return e.addWord(a.attrCol)}}},[e._v(" "+e._s(a.attrColName)+" ")])})),0):t("div",{staticClass:"label-item"},e._l(e.labelConfig[e.lableProp],(function(a){return t("span",{key:a.labelId,class:[e.selectLabelList.some(e=>e.labelId==a.labelId)?"active":""],on:{click:function(t){return e.pushPoint(a)}}},[e._v(e._s(a.labelName)+" ")])})),0)]),t("el-radio-group",{attrs:{size:"mini"},model:{value:e.lableProp,callback:function(t){e.lableProp=t},expression:"lableProp"}},[t("el-radio-button",{attrs:{label:"variable"}},[e._v("营销变量")]),t("el-radio-button",{attrs:{label:"touchPoint"}},[e._v("推送至触点")])],1)],1)])],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"营销(服务)目标客户及提取原则：",prop:"columnExt4","label-width":"148px"}},[t("el-input",{directives:[{name:"forbidChars",rawName:"v-forbidChars"}],attrs:{id:"smsDetail",type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleTextareaKeydown.apply(null,arguments)}},model:{value:e.CrmFrom.columnExt4,callback:function(t){e.$set(e.CrmFrom,"columnExt4",t)},expression:"CrmFrom.columnExt4"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"任务描述及要求：",prop:"columnExt5","label-width":"148px"}},[t("el-input",{directives:[{name:"forbidChars",rawName:"v-forbidChars"}],attrs:{id:"smsDetail",type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"说明任务完成目标，例如：办理合约等"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleTextareaKeydown.apply(null,arguments)}},model:{value:e.CrmFrom.columnExt5,callback:function(t){e.$set(e.CrmFrom,"columnExt5",t)},expression:"CrmFrom.columnExt5"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"外呼需求附件（含需求正文、外呼脚本、客服文档等）：",prop:"columnExt6","label-width":"148px"}},[t("el-upload",{staticClass:"upload-demo",attrs:{action:e.action,"on-remove":e.handleRemove,"on-success":e.handleSuccess,"before-remove":e.beforeRemove,multiple:"",limit:1,"on-exceed":e.handleExceed,headers:{Authorization:e.header},"file-list":e.fileList}},[t("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1)],1)],1)],1)],1),t("materialList",{ref:"material",attrs:{adivId:e.CrmFrom.adivInfo.adivId,channelId:e.id},on:{addMaterial:e.addMaterial}})],1)},r=[],l=(a("14d9"),a("0fea")),s=a("5e05"),o=a("a454"),n=a("f1ce"),c=a("5ed5"),m=a("b893"),u=a("0557");const d=s["a"].common.getSysEnum,h=s["a"].common.queryAdivInfo,p=s["a"].common.queryHallInfo;var v={props:["channelNewData","id","deleteSub"],components:{materialList:n["a"],Tips:c["a"]},data(){return{CrmFrom:{adivInfo:{adivName:""},channelId:"",channelName:"",attributionInfo:{},columnExt1:"1",columnExt3:"",standard:"",CustomerRules:"",marketingWords:"",columnExt2:"",columnExt4:"",columnExt5:"",columnExt6:"",columnExt7:"",columnExt8:"",columnExt9:"",columnExt18:"0",checked:Boolean},showExt18:!1,checkColumnExt18:!1,fileList:[],citySelect:[],pass:!0,CrmFromRules:{columnExt1:[{required:!0,message:"请选择推送方式",trigger:"blur"}],marketingWords:[{required:!0,message:"请输入营销话术",trigger:"blur"}],columnExt3:[{required:!0,message:"请选择外呼类型",trigger:"blur"}],columnExt2:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],columnExt4:[{required:!0,message:"请输入营销(服务)目标客户及提取原则",trigger:"blur"}],columnExt5:[{required:!0,message:"请输入任务描述及要求",trigger:"blur"}],columnExt6:[{required:!0,message:"请选择要上传的文件",trigger:"blur"}],columnExt8:[{required:!0,message:"请选择地市",trigger:"change"}],adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},timeIdList:[],adivList:[],attributionList:[],outboundType:[],cityList:[],labelConfig:{variable:[],touchPoint:[{labelName:"可呼时段",labelId:"id123"}],availableLabelIdList:[]},lableProp:"variable",selectLabelList:[]}},watch:{channelNewData:{handler(){this.CrmFrom=Object(m["d"])(this.channelNewData),this.CrmFrom=Object(m["d"])(this.channelNewData),this.CrmFrom.columnExt6&&(this.fileList=[{name:this.CrmFrom.columnExt6}]),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"columnExt2",this.CrmFrom.columnExt2||""),this.$set(this.CrmFrom,"columnExt8",this.CrmFrom.columnExt8||""),this.CrmFrom.columnExt8&&(this.citySelect=this.CrmFrom.columnExt8.split(",")),this.checkColumnExt18=this.CrmFrom.columnExt18>0,this.getLabelList(),this.listCustAttr()},deep:!0},citySelect:{handler(e,t){0==e.length?(this.CrmFrom.columnExt8="",this.CrmFrom.columnExt9="全部"):(this.CrmFrom.columnExt8=e.join(","),this.CrmFrom.columnExt9=e.map(e=>this.cityList.find(t=>t.cityId==e).cityName).join(","))},deep:!0}},computed:{header(){return window.sessionStorage.getItem("IOP_TOKEN")},action(){return u["a"].commonConfig.baseURL+"/element-svc/api/jx/file/upload"},cityId(){return window.sessionStorage.getItem("cityId")}},mounted(){this.getOptionData(),this.getSysEnum(),this.CrmFrom=Object(m["d"])(this.channelNewData),this.CrmFrom.columnExt6&&(this.fileList=[{name:this.CrmFrom.columnExt6}]),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"columnExt2",this.CrmFrom.columnExt2||""),this.$set(this.CrmFrom,"columnExt8",this.CrmFrom.columnExt8||""),this.CrmFrom.columnExt8&&(this.citySelect=this.CrmFrom.columnExt8.split(",")),this.checkColumnExt18=this.CrmFrom.columnExt18>0,this.getLabelList(),this.listCustAttr()},methods:{getChannelDetail(e){1==e.smartScript&&(this.showExt18=!0)},async getOptionData(){Object(l["i"])(o["a"].user.citySelectData).then(e=>{this.cityList=e.filter(e=>"-1"!=e.cityId&&"999"!=e.cityId)}),await Object(l["i"])(d,{enumType:"iop_time_id"}).then(e=>{this.timeIdList=e}),await Object(l["i"])(h,{channelId:this.id}).then(e=>{this.adivList=e}),await Object(l["i"])(p,{}).then(e=>{this.attributionList=e})},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t||("906"===this.id||"922"===this.id)&&this.CrmFrom.marketingWords&&this.CrmFrom.adivInfo.adivId?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e},handleRemove(e,t){},handleExceed(e,t){this.$message.warning(`当前限制选择 1个文件，本次选择了 ${e.length} 个文件，共选择了 ${e.length+t.length} 个文件`)},beforeRemove(e,t){return this.$confirm(`确定移除 ${e.name}？`)},handleSuccess(e){this.CrmFrom={...this.CrmFrom,columnExt6:e.data.fileName}},onUploadBeforeSend(e){let t=e.name.substring(e.name.lastIndexOf(".")+1);const a="xls"===t,i="xlsx"===t,r="png"===t,l="jpg"===t,s="doc"===t;let o=e.size/1024/1024<5?1:0;0===o&&this.$message({message:"上传文件大小不能超过5MB!",type:"error"}),a||i||r||l||s||this.$message.error("请上传正确的文件格式");let n=a||i||r||l||s;return n},selectMaterial(e){this.$refs["material"].showDialog(e)},addMaterial(e){this.CrmFrom={...this.CrmFrom,columnExt20:e.materialId,materialName:e.materialName}},async getSysEnum(){await Object(l["i"])(s["a"].common.getSysEnum,{enumType:"10085_wh_type"}).then(e=>{this.outboundType=e})},async listCustAttr(){var e;const t=null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.customGroupId;try{const e=await Object(l["i"])(s["a"].common.listCustAttr+"?custGroupId="+t);this.labelConfig.variable=e}catch(a){}},async getLabelList(){try{var e;const t=await Object(l["i"])(o["a"].custgroup.getLabelByChannelId,{channelId:this.id,customGroupId:null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.customGroupId});this.labelConfig.touchPoint=t.allLabelInfoList.filter(e=>t.availableLabelIdList.includes(e.labelId)),this.CrmFrom.columnExt7&&(this.selectLabelList=this.labelConfig.touchPoint.filter(e=>this.CrmFrom.columnExt7.split(",").includes(e.labelId)))}catch(t){this.labelConfig.touchPoint=[]}},addWord(e){let t=this.$refs.wording.$el.querySelector(".el-textarea__inner");void 0===this.CrmFrom.columnExt2&&(this.CrmFrom.columnExt2=""),this.CrmFrom.columnExt2+=e,this.$forceUpdate(),t.focus()},pushPoint(e){this.selectLabelList.some(t=>t.labelId==e.labelId)?this.selectLabelList=this.selectLabelList.filter(t=>t.labelId!=e.labelId):this.selectLabelList.push(e),this.CrmFrom.columnExt7=this.selectLabelList.map(e=>e.labelId).join(",")},handleTextareaKeydown(){let e=arguments[0];if("Enter"===e.key||"Enter"===e.code||13==e.keyCode)return e.returnValue=!1,!1},changeOutbound(e){"调研类_地市"==e?"999"==this.cityId?(this.CrmFrom.columnExt8="",this.CrmFrom.columnExt9="",this.citySelect=[]):(this.CrmFrom.columnExt8=this.cityId,this.CrmFrom.columnExt9=this.cityList.find(e=>e.cityId==this.cityId).cityName,this.citySelect=[this.cityId]):(this.CrmFrom.columnExt8="",this.CrmFrom.columnExt9="")}},created(){}},C=v,b=(a("2ec7"),a("2877")),f=Object(b["a"])(C,i,r,!1,null,"084511de",null);t["a"]=f.exports},8914:function(e,t,a){"use strict";a("3f74")},"89b7":function(e,t,a){"use strict";a("7900")},"8b4b":function(e,t,a){},"8b53":function(e,t,a){},"8c3a":function(e,t,a){},"8c8d":function(e,t,a){"use strict";a("65e9")},"8d22":function(e,t,a){"use strict";a("1a65")},"8eb2":function(e,t,a){},9011:function(e,t,a){},9044:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("el-form-item",{attrs:{label:"运营位：",prop:"adivInfo.adivId"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:e.changeAid},model:{value:e.DataFrom.adivId,callback:function(t){e.$set(e.DataFrom,"adivId",t)},expression:"DataFrom.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1)],1)},r=[],l=a("0fea"),s=a("5e05");const o=s["a"].common.queryAdivInfo;var n={props:["CrmFrom","FromData"],data(){return{DataFrom:{},adivList:[]}},mounted(){this.getAdivInfo()},methods:{async getAdivInfo(){await Object(l["i"])(o,{channelId:this.FromData.channelId}).then(e=>{this.adivList=e,this.DataFrom=this.CrmFrom,"adivId"in this.DataFrom&&""!==this.DataFrom.adivId&&this.changeAid(this.DataFrom.adivId,1)})},changeAid(e,t){var a="",i="",r={};this.adivList.forEach(t=>{e===t.adivId&&(a=t.adivName,i=t.configId,r=t)}),this.DataFrom=Object.assign({},this.DataFrom,{adivId:e,adivName:a}),this.$emit("update:CrmFrom",this.DataFrom),this.$emit("getConfiguration",{configid:i,zt:t}),this.$emit("getadivObj",r)}}},c=n,m=a("2877"),u=Object(m["a"])(c,i,r,!1,null,"268ff5b3",null);t["a"]=u.exports},9101:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("Tips",{attrs:{id:e.id},on:{getChannelDetail:e.getChannelDetail}}),t("div",{staticStyle:{display:"flex","justify-content":"end"}}),t("el-form",{ref:"CrmFrom",staticStyle:{width:"100%"},attrs:{"label-width":"145px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"推送方式：",prop:"columnExt1"}},[t("el-radio-group",{model:{value:e.CrmFrom.columnExt1,callback:function(t){e.$set(e.CrmFrom,"columnExt1",t)},expression:"CrmFrom.columnExt1"}},[t("el-radio",{attrs:{label:"1",disabled:!e.CrmFrom.channelFlag}},[e._v("全量推送")]),t("el-radio",{attrs:{label:"0",disabled:!e.CrmFrom.channelFlag}},[e._v("偏好推送")])],1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"运营位：",prop:"adivInfo.adivId"}},[t("el-select",{attrs:{placeholder:"请选择短信类型"},on:{change:e.changeAid},model:{value:e.CrmFrom.adivInfo.adivId,callback:function(t){e.$set(e.CrmFrom.adivInfo,"adivId",t)},expression:"CrmFrom.adivInfo.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"标准化素材：",prop:"columnExt20"}},[t("div",{staticClass:"select-material",on:{click:function(t){return e.selectMaterial(!0)}}},[e._v(e._s(e.CrmFrom.materialName||"请选择"))])])],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"选择素材：",prop:"columnExt4"}},[t("el-select",{attrs:{filterable:"",placeholder:"请选择"},on:{change:e.changeMater},model:{value:e.CrmFrom.columnExt4,callback:function(t){e.$set(e.CrmFrom,"columnExt4",t)},expression:"CrmFrom.columnExt4"}},e._l(e.MaterList,(function(e){return t("el-option",{key:e.materialId,attrs:{label:e.materialName,value:e.materialId}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[e.url?t("el-button",{staticStyle:{"margin-left":"50px"},attrs:{size:"mini"},on:{click:e.onPreview}},[e._v("预览")]):e._e(),t("el-image",{directives:[{name:"show",rawName:"v-show",value:e.previewflag,expression:"previewflag"}],ref:"preview",staticStyle:{width:"100px",height:"100px"},attrs:{src:e.url,"preview-src-list":e.srcList}})],1),e.showExt18?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"智能话术："}},[t("el-checkbox",{on:{change:()=>e.CrmFrom.columnExt18=e.checkColumnExt18?"1":"0"},model:{value:e.checkColumnExt18,callback:function(t){e.checkColumnExt18=t},expression:"checkColumnExt18"}},[e._v("启用")]),e.checkColumnExt18?t("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt18,callback:function(t){e.$set(e.CrmFrom,"columnExt18",t)},expression:"CrmFrom.columnExt18"}},[t("el-radio",{attrs:{label:"1"}},[e._v("省端模型")]),t("el-radio",{attrs:{label:"2"}},[e._v("一级IOP模型")])],1):e._e()],1)],1):e._e(),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"推荐用语：",prop:"EXEC_CONTENT","label-width":"148px"}},[t("el-input",{attrs:{id:"smsDetail",type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},model:{value:e.CrmFrom.EXEC_CONTENT,callback:function(t){e.$set(e.CrmFrom,"EXEC_CONTENT",t)},expression:"CrmFrom.EXEC_CONTENT"}}),t("div",{staticClass:"button"},[t("div",{staticClass:"sub-otton",on:{click:function(t){return e.openDilog(!0)}}},[e._v("营销用语模板")]),t("div",{staticClass:"sub-otton",on:{click:function(t){return e.openDilog(!1)}}},[e._v("自定义短信用语")])])],1)],1)],1)],1),t("ShortMessageList",{ref:"messageList",attrs:{tableData:e.tableData,cols:e.cols,channelId:e.id},on:{getSmsContentTemplateList:e.getSmsContentTemplateList,addShortMessage:e.addShortMessage}}),t("materialList",{ref:"material",attrs:{adivId:e.CrmFrom.adivInfo.adivId,channelId:e.id},on:{addMaterial:e.addMaterial}})],1)},r=[],l=(a("88a7"),a("271a"),a("5494"),a("0fea")),s=a("5e05"),o=(a("d212"),a("d39c")),n=(a("0b16"),a("c3eb")),c=a("f1ce"),m=a("5ed5"),u=(a("0557"),a("b893"));s["a"].common.getSysEnum;const d=s["a"].common.queryAdivInfo;s["a"].common.queryHallInfo;var h={props:["channelNewData","id","deleteSub"],components:{ShortMessageList:n["a"],materialList:c["a"],Tips:m["a"]},data(){return{CrmFrom:{adivInfo:{adivName:""},channelId:"",channelName:"",attributionInfo:{},columnExt1:"1",columnExt2:"",columnExt3:"",standard:"",CustomerRules:"",marketingWords:"",EXEC_CONTENT:"",showScene:!1,columnExt4:"",columnExt18:"0",columnExt20:""},showExt18:!1,checkColumnExt18:!1,CrmFromRules:{columnExt1:[{required:!0,message:"请选择推送方式",trigger:"blur"}],columnExt4:[{required:!0,message:"请选择素材",trigger:"blur"}],marketingWords:[{required:!0,message:"请输入营销话术",trigger:"blur"}],EXEC_CONTENT:[{required:!0,message:"请输入短信推荐用语",trigger:"blur"}],num:[{required:!0,message:"请填写次数",trigger:"blur"}],CEP_EVENT_ID:[{required:!0,message:"请选择复杂事件场景",trigger:"blur"}],adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},timeIdList:[],adivList:[],attributionList:[],tableData:[],MaterList:[],cols:[{label:"模板编号",props:"id"},{label:"模板内容",props:"content"}],url:"",srcList:[],previewflag:!1,toolTopContent:"IOP免打扰时间段为21:00-8:00,在此期间将不会主动推送营销信息给客户。周期性客群如当天任务没有发送完成,将不会在第二天发送,第二天直接使用更新后客群发送。"}},watch:{channelNewData:{handler(){this.CrmFrom=Object(u["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.checkColumnExt18=this.CrmFrom.columnExt18>0},deep:!0},CrmFrom:{handler(e,t){JSON.parse(JSON.stringify(e))},deep:!0},deleteSub(){}},computed:{EXEC_CONTENT(){return this.CrmFrom.EXEC_CONTENT}},mounted(){this.getOptionData(),this.getMater(),this.CrmFrom=Object(u["d"])(this.channelNewData),setTimeout(()=>{this.srcList=this.MaterList.filter(e=>{var t;return e.materialId===(null===(t=this.channelNewData.channelConf.channelExtConf)||void 0===t?void 0:t.columnExt4)}).map(e=>e.resourceUrl),this.url=this.srcList[0]},1e3),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.checkColumnExt18=this.CrmFrom.columnExt18>0},methods:{getChannelDetail(e){1==e.smartScript&&(this.showExt18=!0)},async getOptionData(){await Object(l["i"])(d,{channelId:this.id}).then(e=>{this.adivList=e})},async getMater(){await Object(l["i"])(s["a"].common.getMater,{channelId:this.id,positionId:this.CrmFrom.adivInfo.adivId}).then(e=>{this.MaterList=e})},changeAid(e){var t="";this.adivList.forEach(a=>{e===a.adivId&&(t=a.adivName)}),this.CrmFrom.adivInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,adivName:t}),"8012"===this.CrmFrom.adivInfo.adivId||"9012"===this.CrmFrom.adivInfo.adivId?this.CrmFrom.showScene=!0:this.CrmFrom.showScene=!1},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t||("906"===this.id||"922"===this.id)&&this.CrmFrom.marketingWords&&this.CrmFrom.adivInfo.adivId?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e},openDilog(e){this.$refs["messageList"].showDialog(e)},async getSmsContentTemplateList(e){await Object(l["i"])(s["a"].common.getSmsContentTemplateList,e).then(e=>{e.width=570,this.tableData=e})},addShortMessage(e){this.CrmFrom={...this.CrmFrom,EXEC_CONTENT:e.row.content}},selectMaterial(e){this.$refs["material"].showDialog(e)},addMaterial(e){this.CrmFrom={...this.CrmFrom,columnExt20:e.materialId,materialName:e.materialName}},async onPreview(){if(this.CrmFrom.columnExt4)try{const{data:e}=await Object(l["b"])(o["a"].seapi.downloadChanPromptFile,{fileUrlAndName:this.CrmFrom.columnExt2}),t=new Blob([e],{type:e.type});let a=URL.createObjectURL(t);this.srcList=[a],this.$refs.preview.clickHandler()}catch(e){}else this.$message.error("请先选择素材")},changeMater(e){this.srcList=this.MaterList.filter(t=>t.materialId===e).map(e=>e.resourceUrl);const t=this.MaterList.filter(t=>t.materialId===e);this.CrmFrom.columnExt3=t[0].materialName,this.CrmFrom.columnExt2=this.srcList[0],this.url=this.srcList[0]}},created(){}},p=h,v=(a("0ef1"),a("2877")),C=Object(v["a"])(p,i,r,!1,null,"277ec8d2",null);t["a"]=C.exports},9192:function(e,t,a){},9193:function(e,t,a){"use strict";a("53e3")},9286:function(e,t,a){},9547:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("Tips",{attrs:{id:e.channelNewData.channelId},on:{getChannelDetail:e.getChannelDetail}}),t("el-form",{ref:"CrmFrom",staticStyle:{width:"100%"},attrs:{"label-width":"145px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"推送方式：",prop:"columnExt1"}},[t("el-radio-group",{model:{value:e.CrmFrom.columnExt1,callback:function(t){e.$set(e.CrmFrom,"columnExt1",t)},expression:"CrmFrom.columnExt1"}},[t("el-radio",{attrs:{label:"1",disabled:!e.CrmFrom.channelFlag}},[e._v("全量推送")]),t("el-radio",{attrs:{label:"0",disabled:!e.CrmFrom.channelFlag}},[e._v("偏好推送")])],1)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"运营位：",prop:"adivInfo.adivId"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:e.changeAid},model:{value:e.CrmFrom.adivInfo.adivId,callback:function(t){e.$set(e.CrmFrom.adivInfo,"adivId",t)},expression:"CrmFrom.adivInfo.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1)],1),t("el-col",{attrs:{span:24}},["8082"!=e.CrmFrom.adivInfo.adivId?t("el-form-item",{attrs:{label:"营销类型：",prop:"saleType"}},[t("el-select",{attrs:{disabled:"",placeholder:"请选择营销类型"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.saleType,callback:function(t){e.$set(e.CrmFrom,"saleType",t)},expression:"CrmFrom.saleType"}},e._l(e.saleList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e()],1),"8082"!=e.CrmFrom.adivInfo.adivId&&"1"==e.CrmFrom.saleType?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"复杂事件场景：",prop:"CEP_EVENT_ID"}},[t("div",[t("div",{staticStyle:{display:"flex","justify-content":"space-between","max-width":"375px"}},[t("div",{staticClass:"add-botton"},[t("span",{on:{click:function(t){return e.openSceneDilog(!0)}}},[e._v(e._s(e.CrmFrom.sceneParams.eventName||"添加"))]),t("i",{directives:[{name:"show",rawName:"v-show",value:e.CrmFrom.sceneParams.eventName,expression:"CrmFrom.sceneParams.eventName"}],staticClass:"el-icon-close",on:{click:e.removeEvent}})]),t("el-checkbox",{model:{value:e.CrmFrom.checked,callback:function(t){e.$set(e.CrmFrom,"checked",t)},expression:"CrmFrom.checked"}},[e._v("取消推荐规则设置")])],1),"JX0000000001"===e.customGroupId?t("div",{staticStyle:{color:"red","font-size":"12px"}},[e._v("该活动没有限定客群，触发事件即发送，请慎重选择事件！")]):e._e(),e.CrmFrom.checked?t("div",{staticClass:"select"},[t("div",{staticClass:"setRules"},[t("p",[e._v("已选择事件："+e._s(e.CrmFrom.sceneParams.eventName||""))])]),t("div",[t("span",[e._v("取消推荐时间：")]),t("el-select",{attrs:{placeholder:"请选择执行端口",size:"mini"},model:{value:e.CrmFrom.columnExt4,callback:function(t){e.$set(e.CrmFrom,"columnExt4",t)},expression:"CrmFrom.columnExt4"}},e._l(e.columnExt4List,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]):e._e()])])],1):e._e(),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"任务类型：",prop:"columnExt6"}},[t("el-select",{attrs:{placeholder:"请选择任务类型"},on:{change:e.changeAlarm},model:{value:e.CrmFrom.columnExt6,callback:function(t){e.$set(e.CrmFrom,"columnExt6",t)},expression:"CrmFrom.columnExt6"}},e._l(e.alarmType,(function(e){return t("el-option",{key:e.typeCode,attrs:{label:e.typeName,value:e.typeCode}})})),1)],1)],1),e.showExt18?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"智能话术："}},[t("el-checkbox",{on:{change:()=>e.CrmFrom.columnExt18=e.checkColumnExt18?"1":"0"},model:{value:e.checkColumnExt18,callback:function(t){e.checkColumnExt18=t},expression:"checkColumnExt18"}},[e._v("启用")]),e.checkColumnExt18?t("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt18,callback:function(t){e.$set(e.CrmFrom,"columnExt18",t)},expression:"CrmFrom.columnExt18"}},[t("el-radio",{attrs:{label:"1"}},[e._v("省端模型")]),t("el-radio",{attrs:{label:"2"}},[e._v("一级模型")])],1):e._e()],1)],1):e._e(),e.CrmFrom.adivInfo.adivId?t("el-col",{attrs:{span:24}},[t("UseScript",{ref:"useScript",attrs:{"label-width":"145px","channel-id":e.channelNewData.channelId,"channel-name":e.channelNewData.channelName,"script-id":e.CrmFrom.columnExt19,CrmFrom:e.CrmFrom},on:{change:e.changeScript}}),t("el-form-item",{attrs:{label:"营销用语：",prop:"columnExt2"}},[e.isStrArr?t("Face2FaceWords",{attrs:{marketingWords:e.CrmFrom.columnExt2}}):t("el-input",{attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},on:{input:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt2,callback:function(t){e.$set(e.CrmFrom,"columnExt2",t)},expression:"CrmFrom.columnExt2"}})],1)],1):e._e(),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"短信内容：",prop:"columnExt5"}},[t("el-input",{attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},on:{input:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt5,callback:function(t){e.$set(e.CrmFrom,"columnExt5",t)},expression:"CrmFrom.columnExt5"}})],1)],1)],1)],1),t("ComplexScene",{ref:"SceneDialog",on:{addScene:e.addScene}})],1)},r=[],l=a("0fea"),s=a("5e05"),o=a("aedd"),n=a("f1ce"),c=a("5ed5"),m=a("98d2"),u=a("cd74"),d=a("b893"),h=a("00b8");s["a"].common.getSysEnum;const p=s["a"].common.queryAdivInfo,v=s["a"].common.getAlarmType;s["a"].common.queryHallInfo;var C={props:["channelNewData","id","deleteSub"],components:{ComplexScene:o["a"],materialList:n["a"],Tips:c["a"],UseScript:m["a"],Face2FaceWords:u["a"]},data(){return{CrmFrom:{adivInfo:{},channelId:"",channelName:"",attributionInfo:{},columnExt1:"1",standard:"",CustomerRules:"",marketingWords:"",columnExt2:"",columnExt3:"",columnExt4:"7",columnExt6:"",CEP_EVENT_ID:"",CEP_SCENE_NAME:"",sceneParams:{eventName:""},materialName:"",columnExt20:"",columnExt7:"",columnExt5:"",columnExt9:"1",columnExt18:"0",columnExt19:""},showExt18:!1,checkColumnExt18:!1,CrmFromRules:{columnExt1:[{required:!0,message:"请选择推送方式",trigger:"blur"}],marketingWords:[{required:!0,message:"请输入营销话术",trigger:"blur"}],columnExt2:[{required:!0,message:"请输入营销用语",trigger:"blur"}],columnExt6:[{required:!0,message:"请选择任务类型",trigger:"change"}],columnExt9:[{required:!0,message:"请选择营销类型",trigger:"blur"}],CEP_EVENT_ID:[{required:!0,message:"请选择实时事件",trigger:"blur"}],adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},timeIdList:[],adivList:[],attributionList:[],alarmType:[],columnExt4List:[{label:"1天",value:"1"},{label:"2天",value:"2"},{label:"3天",value:"3"},{label:"4天",value:"4"},{label:"5天",value:"5"},{label:"6天",value:"6"},{label:"7天",value:"7"}],saleList:[{label:"实时营销",value:"1"},{label:"批量营销",value:"2"}],isStrArr:!1}},computed:{checked(){return this.CrmFrom.checked},customGroupId(){var e;return null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.customGroupId}},watch:{channelNewData:{handler(){if(this.CrmFrom=Object(d["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"columnExt2",this.CrmFrom.columnExt2||""),this.$set(this.CrmFrom,"columnExt4",this.CrmFrom.columnExt4||"7"),this.$set(this.CrmFrom,"columnExt9",this.CrmFrom.columnExt9||"1"),this.$set(this.CrmFrom,"sceneParams",this.CrmFrom.sceneParams||{eventName:""}),this.checkColumnExt18=this.CrmFrom.columnExt18>0,this.CrmFrom.columnExt19&&this.CrmFrom.columnExt2)try{this.isStrArr=this.CrmFrom.columnExt2.includes("</header>")}catch(e){}},deep:!0},checked(e){this.CrmFrom=e?{...this.CrmFrom,columnExt3:"1"}:{...this.CrmFrom,columnExt3:"0"}}},created(){if(this.getOptionData(),this.CrmFrom=Object(d["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"columnExt2",this.CrmFrom.columnExt2||""),this.$set(this.CrmFrom,"columnExt4",this.CrmFrom.columnExt4||"7"),this.$set(this.CrmFrom,"columnExt9",this.CrmFrom.columnExt9||"1"),this.$set(this.CrmFrom,"sceneParams",this.CrmFrom.sceneParams||{eventName:""}),this.checkColumnExt18=this.CrmFrom.columnExt18>0,this.CrmFrom.columnExt19&&this.CrmFrom.columnExt2)try{this.isStrArr=this.CrmFrom.columnExt2.includes("</header>")}catch(e){}},methods:{getChannelDetail(e){1==e.smartScript&&(this.showExt18=!0)},async getOptionData(){await Object(l["i"])(p,{channelId:this.id}).then(e=>{this.adivList=e}),await Object(l["i"])(v+"?pcode=GWLX").then(e=>{this.alarmType=e})},changeAid(e){const t=this.adivList.find(t=>t.adivId===e);this.$set(this.CrmFrom,"adivInfo",{adivId:(null===t||void 0===t?void 0:t.adivId)||"",adivName:(null===t||void 0===t?void 0:t.adivName)||""}),this.removeEvent(),this.CrmFrom.checked=!1,this.CrmFrom.saleType="8082"==e?"":"1",this.isStrArr=!1,this.CrmFrom.columnExt19="",this.CrmFrom.columnExt2="",this.CrmFrom.columnExt5="",this.$refs.useScript&&this.$nextTick(()=>{this.$refs.useScript.getScriptList()})},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t||("906"===this.id||"922"===this.id)&&this.CrmFrom.marketingWords&&this.CrmFrom.adivInfo.adivId?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e},openSceneDilog(e){this.$refs["SceneDialog"].showDialog(e)},addScene(e){this.CrmFrom={...this.CrmFrom,CEP_EVENT_ID:e.eventId,CEP_SCENE_NAME:e.eventName,sceneParams:e}},removeEvent(){this.CrmFrom.sceneParams={eventName:""},this.CrmFrom.CEP_EVENT_ID="",this.CrmFrom.CEP_SCENE_NAME=""},selectMaterial(e){this.$refs["material"].showDialog(e)},addMaterial(e){this.CrmFrom={...this.CrmFrom,columnExt20:e.materialId,materialName:e.materialName}},changeAlarm(e){this.CrmFrom.columnExt7=this.alarmType.filter(t=>t.typeCode===e)[0].typeName,this.$forceUpdate()},changeScript(e){if(this.CrmFrom.columnExt19=e.scriptId,!e.scriptId&&this.isStrArr)return this.$set(this.CrmFrom,"columnExt2",""),this.$set(this.CrmFrom,"columnExt5",""),void(this.isStrArr=!1);this.isStrArr=!1,e.contentType<5&&(this.isStrArr=!0),this.CrmFrom=Object(h["a"])(e,this.CrmFrom),this.$forceUpdate()}}},b=C,f=(a("afa6"),a("2877")),g=Object(f["a"])(b,i,r,!1,null,"10417d0a",null);t["a"]=g.exports},"95b7":function(e,t,a){"use strict";a("52f7")},"96d7":function(e,t,a){"use strict";a("226f")},9747:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"CrmFrom",attrs:{"label-width":"130px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-form-item",{attrs:{label:"运营位：",prop:"adivInfo.adivId"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:e.changeAid},model:{value:e.CrmFrom.adivInfo.adivId,callback:function(t){e.$set(e.CrmFrom.adivInfo,"adivId",t)},expression:"CrmFrom.adivInfo.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1),t("el-form-item",{attrs:{label:"选择素材：",prop:"materialId"}},[t("el-select",{attrs:{placeholder:"请选择素材"},model:{value:e.CrmFrom.materialId,callback:function(t){e.$set(e.CrmFrom,"materialId",t)},expression:"CrmFrom.materialId"}},e._l(e.matList,(function(e){return t("el-option",{key:e.ID,attrs:{label:e.NAME,value:e.ID}})})),1),t("el-button",{staticClass:"ml-10",attrs:{type:"primary"},on:{click:e.showImage}},[e._v("预览")])],1),t("el-form-item",{attrs:{label:"推荐用语：",prop:"channelConf.execContent"}},[t("el-input",{attrs:{type:"textarea",maxlength:"500","show-word-limit":""},model:{value:e.CrmFrom.channelConf.execContent,callback:function(t){e.$set(e.CrmFrom.channelConf,"execContent",t)},expression:"CrmFrom.channelConf.execContent"}})],1)],1)],1)},r=[],l=a("0fea"),s=a("5e05");const o=s["a"].common.getSysEnum,n=s["a"].common.queryAdivInfo,c=s["a"].common.queryHallInfo;var m={props:["channelNewData"],data(){return{CrmFrom:{adivInfo:{},channelConf:{},channelId:"",channelName:"",attributionInfo:{},materialId:null},CrmFromRules:{materialId:[{required:!0,message:"请选择素材",trigger:"blur,change"}],adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},timeIdList:[],adivList:[],attributionList:[]}},mounted(){this.getOptionData(),this.CrmFrom=JSON.parse(JSON.stringify(this.channelNewData))},methods:{async getOptionData(){await Object(l["i"])(o,{enumType:"iop_time_id"}).then(e=>{this.timeIdList=e}),await Object(l["i"])(n,{channelId:this.CrmFrom.channelId}).then(e=>{this.adivList=e}),await Object(l["i"])(c,{}).then(e=>{this.attributionList=e})},changeAid(e){var t="";this.adivList.forEach(a=>{e===a.adivId&&(t=a.adivName)}),this.CrmFrom.adivInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,adivName:t})},changeAttribution(e){var t="";this.attributionList.forEach(a=>{e===a.adivId&&(t=a.attributionName)}),this.CrmFrom.attributionInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,attributionName:t})},changeTime(){this.timeIdList.forEach(e=>{e.enumKey===this.CrmFrom.timeId&&(this.CrmFrom.timeName=e.enumValue)})},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e}},created(){}},u=m,d=a("2877"),h=Object(d["a"])(u,i,r,!1,null,"0ab312bb",null);t["a"]=h.exports},"98d2":function(e,t,a){"use strict";var i=function(){var e,t=this,a=t._self._c;return a("el-form",{ref:"ruleForm",attrs:{"label-width":t.labelWidth,"label-position":t.labelPosition,model:t.form,rules:t.rules}},[a("el-form-item",{attrs:{label:"引用营销话术：",prop:"scriptId"}},[a("el-select",{attrs:{placeholder:"请选择营销话术",clearable:""},on:{change:t.changeScript},model:{value:t.form.scriptId,callback:function(e){t.$set(t.form,"scriptId",e)},expression:"form.scriptId"}},[a("el-option",{attrs:{value:"never",disabled:""}},[a("div",{staticClass:"search"},[a("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{size:"mini",placeholder:"请输入关键字"},model:{value:t.keyword,callback:function(e){t.keyword="string"===typeof e?e.trim():e},expression:"keyword"}},[a("i",{staticClass:"el-input__icon el-icon-search cursor-pointer",attrs:{slot:"suffix"},on:{click:t.getScriptList},slot:"suffix"})])],1)]),[t.loading?a("el-option-group",[a("el-option",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{"element-loading-spinner":"el-icon-loading",value:""}})],1):a("el-option-group",t._l(t.scriptList,(function(e){return a("el-option",{key:e.scriptId,attrs:{value:e.scriptId,label:e.scriptName}},[a("div",{staticClass:"el-option__content"},[a("span",[t._v(t._s(e.scriptName))]),a("span",{staticClass:"recommend"},[a("span",{staticClass:"score"},[t._v(t._s(e.score))]),e.score>9?a("img",{attrs:{src:t.good}}):t._e()])])])})),1),t.loading||0!==t.scriptList.length?t._e():a("el-option",{attrs:{value:"empty",disabled:""}},[a("div",{staticClass:"empty"},[t._v(" 暂无数据 ")])])]],2),t.form.scriptId?a("span",{staticClass:"preview-btn",on:{click:function(e){t.viewVisible=!0}}},[t._v(" 预览 ")]):t._e(),a("span",{staticStyle:{float:"right"}},[t.form.scriptId&&t.form.contentType>4?a("el-button",{staticStyle:{"margin-right":"1px"},attrs:{type:"primary"},on:{click:function(e){t.compareVisible=!0}}},[t._v("话术比对")]):t._e(),a("el-button",{attrs:{type:"primary",loading:t.saveLoading},on:{click:function(e){return t.syncScript(!1)}}},[t._v("同步至话术库")])],1),t.showMarketingWords?a("div",{staticClass:"desc"},[t._v("面对面营销语暂不支持修改和同步")]):t._e()],1),a("CompareDialog",{attrs:{dialogVisible:t.compareVisible,"channel-data":t.CrmFrom,"script-data":t.form},on:{"update:dialogVisible":function(e){t.compareVisible=e},"update:dialog-visible":function(e){t.compareVisible=e}}}),a("ScriptViewDialog",{attrs:{dialogVisible:t.viewVisible,id:t.form.scriptId,enableEvaluate:""},on:{"update:dialogVisible":function(e){t.viewVisible=e},"update:dialog-visible":function(e){t.viewVisible=e}}}),a("BaseDialog",{attrs:{title:"内容类型",width:"400px","confirm-button-text":"确 定","confirm-loading":t.saveLoading},on:{confirm:t.saveContentType,close:function(e){t.contentTypeVisible=!1}},model:{value:t.contentTypeVisible,callback:function(e){t.contentTypeVisible=e},expression:"contentTypeVisible"}},[a("el-form",{ref:"contentForm",staticClass:"content-form",attrs:{model:t.form,rules:t.rules}},[a("el-form-item",{attrs:{label:"内容类型：",prop:"contentType"}},[a("el-select",{attrs:{placeholder:"请选择内容类型"},model:{value:t.form.contentType,callback:function(e){t.$set(t.form,"contentType",e)},expression:"form.contentType"}},t._l(t.channelContentType[(null===(e=t.CrmFrom.adivInfo)||void 0===e?void 0:e.adivId)||t.channelId+"1"],(function(e){return a("el-option",{key:e.contentType,attrs:{label:e.contentName,value:e.contentType,disabled:Number(e.contentType)<5}})})),1)],1)],1)],1)],1)},r=[],l=a("0fea"),s=a("cdbb"),o=a("ac7c"),n=a("5a4a"),c=a("00b8"),m=a("d4f7"),u=a.n(m),d=a("79a2"),h=a("2102"),p=function(){var e=this,t=e._self._c;return t("BaseDialog",{attrs:{title:"话术内容⽐对",visible:e.dialogVisible,width:"80%",top:"8vh","confirm-button-text":"关 闭","show-cancel-button":!1},on:{confirm:e.close,close:e.close}},[e.dialogVisible?t("div",{staticClass:"compare-text-container"},e._l(2,(function(a){return t("section",[t("header",[e._v(e._s(1===a?"引用":"配置")+"话术内容")]),t("main",e._l(e.scriptData.marketingWords,(function(i,r){var l,s;return t("div",{key:r},[t("div",{staticClass:"title"},[e._v(e._s(i.typeName))]),null!==(l=i.list)&&void 0!==l&&l.length||i.uploadType?null!==(s=i.list)&&void 0!==s&&s.length?[t("div",{staticClass:"content"})]:e._e():[t("div",{staticClass:"content"},[t("div",{staticClass:"content-text",domProps:{innerHTML:e._s(e.diffText(i.content,e.curScriptData.marketingWords[r].content)[a-1])}})])]],2)})),0)])})),0):e._e()])},v=[],C=a("ea45"),b={components:{BaseDialog:C["a"]},props:{dialogVisible:{type:Boolean,default:!1},channelData:{type:Object,default:()=>({})},scriptData:{type:Object,default:()=>({})}},watch:{dialogVisible(e){if(e){const e=JSON.parse(JSON.stringify(this.scriptData));this.curScriptData=Object(c["b"])(this.channelData,e)}}},data(){return{curScriptData:{}}},methods:{close(){this.$emit("update:dialogVisible",!1)},diffText(e,t){return Object(n["b"])(e,t)}}},f=b,g=(a("5985"),a("3074"),a("2877")),_=Object(g["a"])(f,p,v,!1,null,"fae4a1d2",null),x=_.exports,E=a("1bd8"),y={components:{MarketingWords:d["a"],MarketingWordsPreview:h["a"],CompareDialog:x,ScriptViewDialog:E["a"],BaseDialog:C["a"]},props:{CrmFrom:{type:Object,default:()=>({})},scriptId:{type:String||void 0,default:""},channelId:{type:String,default:""},channelName:{type:String,default:""},labelWidth:{type:String,default:"110px"},labelPosition:{type:String,default:"right"}},computed:{planObj(){const e=this.$store.state.MarkPl.SceneNodeData,t=this.$store.state.MarkPl.CurrentNode.id;let a="",i="";return e.forEach(e=>{e.forEach(r=>{r.id===t&&(a=e[0].NodeObj[0].planId,i=e[0].NodeObj[0].planName)})}),{planId:a,planName:i}},showMarketingWords(){const e=["1","2","3","4"],t=this.form.contentType+"";return e.includes(t)}},data(){return{good:u.a,CONTENT_TYPE:o["a"],loading:!1,keyword:"",scriptList:[],channelContentType:{},form:{scriptId:"",contentType:"",marketingWords:[{typeId:"3",typeName:"推荐语",content:""}]},rules:{contentType:[{required:!0,message:"请选择内容类型",trigger:"change"}]},viewVisible:!1,saveLoading:!1,compareVisible:!1,contentTypeVisible:!1}},methods:{async getChannelContentType(){try{let e=await Object(l["i"])(s["a"].queryChannelContentType,[this.channelId]);e=e.flat();for(let t of e){const e=t.adivId||this.channelId+"1";this.$set(this.channelContentType,e,[...this.channelContentType[e]||[],t])}}catch(e){}},notifyUpdate(e={scriptId:"",contentType:void 0}){e.scriptId||e.contentType||(this.form={scriptId:"",contentType:"",marketingWords:[{typeId:"3",typeName:"推荐语",content:""}]}),this.$emit("change",e)},async getScriptList(){try{var e;this.loading=!0;const t=await Object(l["i"])(s["a"].queryChannelIdAndPlan,{planId:this.planObj.planId,channelId:this.channelId,adivId:(null===(e=this.CrmFrom.adivInfo)||void 0===e?void 0:e.adivId)||this.channelId+"1",scriptKey:this.keyword});if(this.scriptList=[],this.scriptList=t.sort((e,t)=>e.score===t.score?new Date(t.updateTime||null).getTime()-new Date(e.updateTime||null).getTime():Number(t.score)-Number(e.score)),!this.scriptList.length)return;if(this.scriptId)return this.changeScript(this.scriptId)}catch(t){this.scriptList=[]}finally{this.loading=!1}},async changeScript(e){if(!e)return void this.notifyUpdate();const t=this.scriptList.find(t=>t.scriptId===e);t&&(this.form=Object(n["c"])(t),this.notifyUpdate(this.form))},changeContentType(e){const t=this.CONTENT_TYPE.find(t=>t.value===e);this.$set(this.form,"marketingWords",t.marketingWords)},async syncScript(e=!1){if(this.form.contentType&&Number(this.form.contentType)<5)return this.$message.error("该话术类型不支持同步");if(!e&&!this.CrmFrom.columnExt19||!this.form.contentType)return void(this.contentTypeVisible=!0);this.fillContentByChannel();const t=Object(n["e"])(this.form);if(t)try{let e;if(this.saveLoading=!0,this.form.scriptId){var a;e={...this.form,businessId:"",scriptId:"",parentId:this.form.parentId||this.form.scriptId,scriptType:"2",scriptTypeStr:"个性化话术",cityId:sessionStorage.getItem("cityId"),channelId:this.channelId,channelName:this.channelName,adivId:null===(a=this.CrmFrom.adivInfo)||void 0===a?void 0:a.adivId,planId:this.planObj.planId,planName:this.planObj.planName,marketingWords:this.form.marketingWords,scriptStatus:"0",score:null}}else{var i;const t={channelId:this.channelId,channelName:this.channelName,adivId:null===(i=this.CrmFrom.adivInfo)||void 0===i?void 0:i.adivId,planId:this.planObj.planId,planName:this.planObj.planName,scriptType:"1",scriptName:"【策略同步】"+this.planObj.planName+"-"+this.channelName,scriptType:"1",scriptTypeStr:"标准话术",contentType:this.form.contentType};e={...t,marketingWords:this.form.marketingWords}}e=Object(n["d"])(e);const t=await Object(l["i"])(s["a"].saveScript,e);t.length?(this.$message.success("同步成功"),this.form.scriptId="",this.notifyUpdate(this.form)):this.$message.error(res.message)}catch(r){}finally{this.saveLoading=!1}},saveContentType(){this.$refs.contentForm.validate(e=>{e&&(this.changeContentType(this.form.contentType),this.syncScript(!0),this.$nextTick(()=>{this.contentTypeVisible=!1}))})},fillContentByChannel(){this.form=Object(c["b"])(this.CrmFrom,this.form),this.$forceUpdate()}},created(){this.getScriptList(),this.getChannelContentType()}},F=y,I=(a("492d"),Object(g["a"])(F,i,r,!1,null,"6a029e06",null));t["a"]=I.exports},"9a05":function(e,t,a){},"9a5b":function(e,t,a){},"9b26":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"SelectList"},e._l(e.selectList,(function(a){return t("div",{key:a.channelId,staticClass:"Button",class:a.checked?"ButtonHover":"",on:{click:function(t){return e.selectClick(a)}}},[t("span",{attrs:{title:a.channelName}},[e._v(" "+e._s(a.channelName)+" "),t("i",{staticClass:"el-icon-question",on:{click:function(t){return t.stopPropagation(),e.getdetail(a)}}})]),a.checked?t("div",{staticClass:"ButtonHoverduoxuan"},[t("i",{staticClass:"iconfont icongonggongtubiao-duoxuan"})]):e._e()])})),0)},r=[],l={props:{SelectBuList:{type:Array,default:()=>[]},ischeckbox:{type:Boolean,default:()=>!0}},watch:{SelectBuList:{handler(e){},deep:!0}},computed:{isWave(){return"3"==this.$store.state.MarkPl.ProcessData.example_type}},mounted(){this.$watch("SelectBuList",e=>{this.selectList=e.map(e=>!0!==e.checked?{...e,checked:!1}:{...e})},{deep:!0})},data(){return{selectList:[]}},methods:{selectClick(e){this.ischeckbox||this.selectList.map(e=>{e.checked=!1}),"808"===e.channelId||"906"===e.channelId||"922"===e.channelId?this.isWave?e.checked=!0:(e.checked,this.selectList=this.selectList.map(e=>("808"!==e.channelId&&"906"!==e.channelId&&"922"!==e.channelId||(e.checked=!0),e))):e.checked=!0,this.$emit("selectClick",e)},Unhighlight(e){let t=[...this.selectList];this.selectList=t.map(t=>t.channelId===e?{...t,checked:!1}:{...t})},getdetail(e){this.$emit("openDetail",e)}}},s=l,o=(a("be9a"),a("2877")),n=Object(o["a"])(s,i,r,!1,null,"3145963c",null);t["a"]=n.exports},"9c4a":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("Tips",{attrs:{id:e.id},on:{getChannelDetail:e.getChannelDetail}}),t("el-form",{ref:"CrmFrom",staticStyle:{width:"100%"},attrs:{"label-width":"150px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"推送方式：",prop:"columnExt1"}},[t("el-radio-group",{model:{value:e.CrmFrom.columnExt1,callback:function(t){e.$set(e.CrmFrom,"columnExt1",t)},expression:"CrmFrom.columnExt1"}},[t("el-radio",{attrs:{label:"1",disabled:!e.CrmFrom.channelFlag}},[e._v("全量推送")]),t("el-radio",{attrs:{label:"0",disabled:!e.CrmFrom.channelFlag}},[e._v("偏好推送")])],1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"短信类型：",prop:"adivInfo.adivId"}},[t("el-select",{attrs:{placeholder:"请选择短信类型"},on:{change:e.changeAid},model:{value:e.CrmFrom.adivInfo.adivId,callback:function(t){e.$set(e.CrmFrom.adivInfo,"adivId",t)},expression:"CrmFrom.adivInfo.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"标准化素材：",prop:"columnExt20"}},[t("div",{staticClass:"select-material",on:{click:function(t){return e.selectMaterial(!0)}}},[e._v(e._s(e.CrmFrom.materialName||"请选择"))])])],1),e.CrmFrom.showScene?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"复杂事件场景：",prop:"CEP_EVENT_ID"}},[t("div",[t("div",{staticStyle:{display:"flex","justify-content":"space-between","max-width":"375px"}},[t("div",{staticClass:"add-botton"},[t("span",{on:{click:function(t){return e.openSceneDilog(!0)}}},[e._v(e._s(e.CrmFrom.sceneParams.eventName||"添加"))]),t("i",{directives:[{name:"show",rawName:"v-show",value:e.CrmFrom.sceneParams.eventName,expression:"CrmFrom.sceneParams.eventName"}],staticClass:"el-icon-close",on:{click:e.removeEvent}})]),t("el-checkbox",{model:{value:e.CrmFrom.checked,callback:function(t){e.$set(e.CrmFrom,"checked",t)},expression:"CrmFrom.checked"}},[e._v("取消推荐规则设置")])],1),"JX0000000001"===e.customGroupId?t("div",{staticStyle:{color:"red","font-size":"12px"}},[e._v("该活动没有限定客群，触发事件即发送，请慎重选择事件！")]):e._e(),e.CrmFrom.checked?t("div",{staticClass:"select"},[t("div",{staticClass:"setRules"},[t("p",[e._v("已选择事件："+e._s(e.CrmFrom.sceneParams.eventName||""))])]),t("div",[t("span",[e._v("取消推荐时间：")]),t("el-select",{attrs:{placeholder:"请选择执行端口",size:"mini"},model:{value:e.CrmFrom.columnExt4,callback:function(t){e.$set(e.CrmFrom,"columnExt4",t)},expression:"CrmFrom.columnExt4"}},e._l(e.columnExt4List,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]):e._e()])])],1):e._e(),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"执行端口：",prop:"columnExt2"}},[t("el-select",{attrs:{placeholder:"请选择执行端口"},model:{value:e.CrmFrom.columnExt2,callback:function(t){e.$set(e.CrmFrom,"columnExt2",t)},expression:"CrmFrom.columnExt2"}},e._l(e.SubChannelOptions,(function(e){return t("el-option",{key:e.channelId,attrs:{label:e.channelName,value:e.channelId}})})),1)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"测试短信接收号码：",prop:"productNo"}},[t("el-input",{attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"允许添加多个测试号码，请以英文状态下的逗号“,”分割"},model:{value:e.CrmFrom.productNo,callback:function(t){e.$set(e.CrmFrom,"productNo",t)},expression:"CrmFrom.productNo"}})],1)],1),e.showExt18?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"智能话术："}},[t("el-checkbox",{on:{change:()=>e.CrmFrom.columnExt18=e.checkColumnExt18?"1":"0"},model:{value:e.checkColumnExt18,callback:function(t){e.checkColumnExt18=t},expression:"checkColumnExt18"}},[e._v("启用")]),e.checkColumnExt18?t("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt18,callback:function(t){e.$set(e.CrmFrom,"columnExt18",t)},expression:"CrmFrom.columnExt18"}},[t("el-radio",{attrs:{label:"1"}},[e._v("省端模型")]),t("el-radio",{attrs:{label:"2"}},[e._v("一级IOP模型")])],1):e._e()],1)],1):e._e(),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"短信推荐用语：",prop:"execContent"}},[t("el-input",{attrs:{id:"smsDetail",type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},model:{value:e.CrmFrom.execContent,callback:function(t){e.$set(e.CrmFrom,"execContent",t)},expression:"CrmFrom.execContent"}}),t("div",{staticClass:"button"},[t("div",{staticClass:"sub-otton",on:{click:function(t){return e.openDilog(!0)}}},[e._v("营销用语模板")]),t("div",{staticClass:"sub-otton",on:{click:function(t){return e.openDilog(!1)}}},[e._v("自定义短信用语")])])],1)],1),t("el-col",{attrs:{span:24}},[1==e.custgroupSource?t("el-form-item",{attrs:{label:"营销用语替换变量："}},[t("DNAReplaceVar",{on:{getVar:e.getContent}})],1):t("el-form-item",{attrs:{label:"营销用语替换变量："}},e._l(e.replaceVar,(function(a){return t("el-tag",{key:a.id,attrs:{type:"info"},on:{click:function(t){return e.getContent(a.attrCol)}}},[e._v(e._s(a.attrColName))])})),1)],1),1!=e.custgroupSource?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"发送周期：",prop:"UPDATE_CYCLE"}},[t("div",{staticStyle:{display:"flex",width:"100px"}},[t("el-tag",{attrs:{type:"1"===e.CrmFrom.UPDATE_CYCLE?"":"info"},on:{click:function(t){return e.getTags("1")}}},[e._v("一次性")]),1!==e.updateCycle?t("el-tag",{staticStyle:{"margin-left":"10px"},attrs:{type:"0"===e.CrmFrom.UPDATE_CYCLE?"":"info"},on:{click:function(t){return e.getTags("0")}}},[e._v("周期性")]):e._e()],1)])],1):e._e(),1!==e.updateCycle&&0==e.CrmFrom.UPDATE_CYCLE||1==e.custgroupSource?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"频次配置：",prop:e.CrmFrom.FREQUENCY?"num":"FREQUENCY"}},[t("div",{staticStyle:{display:"flex"}},[t("el-select",{attrs:{placeholder:"请选择天数"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.FREQUENCY,callback:function(t){e.$set(e.CrmFrom,"FREQUENCY",t)},expression:"CrmFrom.FREQUENCY"}},e._l(e.dateList,(function(e){return t("el-option",{key:e.cycleId,attrs:{label:e.cycleName,value:e.cycle}})})),1),t("el-input",{staticStyle:{width:"100px",margin:"0px 20px"},attrs:{type:"text",rows:8,placeholder:""},on:{input:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.num,callback:function(t){e.$set(e.CrmFrom,"num",t)},expression:"CrmFrom.num"}}),e._v("次 ")],1)])],1):e._e()],1)],1),t("el-button",{staticStyle:{position:"relative",left:"500px"},attrs:{type:"primary",size:"mini",round:""},on:{click:e.sendShortText}},[e._v("测试短信")]),t("ShortMessageList",{ref:"messageList",attrs:{tableData:e.tableData,cols:e.cols,channelId:e.id},on:{getSmsContentTemplateList:e.getSmsContentTemplateList,addShortMessage:e.addShortMessage}}),t("ChainedDialog",{ref:"chainedDialog"}),t("ComplexScene",{ref:"SceneDialog",on:{addScene:e.addScene}}),t("materialList",{ref:"material",attrs:{channelId:e.id,adivId:e.CrmFrom.adivInfo.adivId},on:{addMaterial:e.addMaterial}})],1)},r=[],l=a("0fea"),s=a("5e05"),o=a("c3eb"),n=a("006c"),c=a("aedd"),m=a("f1ce"),u=a("5ed5"),d=a("6501"),h=a("b893");const p=s["a"].common.getSysEnum,v=s["a"].common.queryAdivInfo,C=s["a"].common.queryHallInfo;var b={props:["channelNewData","id","deleteSub"],components:{ShortMessageList:o["a"],ChainedDialog:n["a"],ComplexScene:c["a"],materialList:m["a"],Tips:u["a"],DNAReplaceVar:d["a"]},data(){return{CrmFrom:{adivInfo:{adivName:""},channelId:"",channelName:"",attributionInfo:{},columnExt1:"1",columnExt3:"0",standard:"",CustomerRules:"",marketingWords:"",execContent:"",columnExt2:"",IF_HAVE_VAR:"0",FREQUENCY:"",UPDATE_CYCLE:"1",CEP_EVENT_ID:"",CEP_SCENE_NAME:"",num:"",textShortMessage:"",productNo:"",columnExt4:"7",showScene:!1,sceneParams:{eventName:""},checked:Boolean,columnExt18:"0",columnExt20:""},showExt18:!1,checkColumnExt18:!1,CrmFromRules:{columnExt1:[{required:!0,message:"请选择推送方式",trigger:"blur"}],marketingWords:[{required:!0,message:"请输入营销话术",trigger:"blur"}],execContent:[{required:!0,message:"请输入短信推荐用语",trigger:"blur"}],UPDATE_CYCLE:[{required:!0,message:"请选择发送周期",trigger:"blur"}],FREQUENCY:[{required:!0,message:"请选择频次配置",trigger:"blur"}],num:[{required:!0,message:"请填写次数",trigger:"blur"}],CEP_EVENT_ID:[{required:!0,message:"请选择复杂事件场景",trigger:"blur"}],adivInfo:{adivId:[{required:!0,message:"请选择短信类型",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},timeIdList:[],adivList:[],attributionList:[],tableData:[],cols:[{label:"模板编号",props:"id"},{label:"模板内容",props:"content"}],SubChannelOptions:[],replaceVar:[],ShortMsgContent:"",tagList:[{label:"一次性",id:0},{label:"周期性",id:1}],tagIndex:1,dateList:[],columnExt4List:[{label:"1天",value:"1"},{label:"2天",value:"2"},{label:"3天",value:"3"},{label:"4天",value:"4"},{label:"5天",value:"5"},{label:"6天",value:"6"},{label:"7天",value:"7"}]}},watch:{channelNewData:{handler(){this.CrmFrom=Object(h["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"columnExt3","0"),this.$set(this.CrmFrom,"columnExt4",this.CrmFrom.columnExt4||"7"),this.$set(this.CrmFrom,"UPDATE_CYCLE","1"),this.$set(this.CrmFrom,"sceneParams",this.CrmFrom.sceneParams||{eventName:""}),this.checkColumnExt18=this.CrmFrom.columnExt18>0},deep:!0},CrmFrom:{handler(e,t){JSON.parse(JSON.stringify(e))},deep:!0},deleteSub(){},checked(e){this.CrmFrom=e?{...this.CrmFrom,columnExt3:"1"}:{...this.CrmFrom,columnExt3:"0"}},execContent(e){if(e){const t=/\$[a-zA-Z0-9_\u4e00-\u9fa5]+\$/g,a=e.match(t);a&&a.length>0?this.CrmFrom.IF_HAVE_VAR="1":this.CrmFrom.IF_HAVE_VAR="0"}else this.CrmFrom.IF_HAVE_VAR="0"},showSceneFlag(e){this.CrmFrom="8012"===e||"9012"===e?{...this.CrmFrom,showScene:!0}:{...this.CrmFrom,showScene:!1,CEP_EVENT_ID:"",CEP_SCENE_NAME:"",sceneParams:{eventName:""},checked:""}}},computed:{execContent(){return this.CrmFrom.execContent},updateCycle(){var e;return null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.updateCycle},customGroupId(){var e;return null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.customGroupId},custgroupSource(){return this.$store.state.extendData.custgroupSource},checked(){return this.CrmFrom.checked},showSceneFlag(){return this.CrmFrom.adivInfo.adivId}},mounted(){this.getOptionData(),this.getlistSubChannel(),this.listCustAttr(),this.getDateList(),this.CrmFrom=Object(h["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"columnExt3","0"),this.$set(this.CrmFrom,"columnExt4",this.CrmFrom.columnExt4||"7"),this.$set(this.CrmFrom,"UPDATE_CYCLE","1"),this.$set(this.CrmFrom,"sceneParams",this.CrmFrom.sceneParams||{eventName:""}),this.checkColumnExt18=this.CrmFrom.columnExt18>0},methods:{getChannelDetail(e){1==e.smartScript&&(this.showExt18=!0)},async getOptionData(){await Object(l["i"])(p,{enumType:"iop_time_id"}).then(e=>{this.timeIdList=e}),await Object(l["i"])(v,{channelId:this.id}).then(e=>{this.adivList=e}),await Object(l["i"])(C,{}).then(e=>{this.attributionList=e})},changeAid(e){this.removeEvent(),this.CrmFrom.checked=!1;var t="";this.adivList.forEach(a=>{e===a.adivId&&(t=a.adivName)}),this.CrmFrom.adivInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,adivName:t}),this.CrmFrom.sceneParams={...this.CrmFrom.sceneParams},"8012"===this.CrmFrom.adivInfo.adivId||"9012"===this.CrmFrom.adivInfo.adivId?this.CrmFrom.showScene=!0:this.CrmFrom.showScene=!1},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t||("906"===this.id||"922"===this.id)&&this.CrmFrom.marketingWords&&this.CrmFrom.adivInfo.adivId?("801"!==this.id||this.CrmFrom.execContent.endsWith(" 如需退订此消息，请回复TD【中国移动】")||(this.CrmFrom.execContent+=" 如需退订此消息，请回复TD【中国移动】"),this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e},openDilog(e){this.$refs["messageList"].showDialog(e)},addShortMessage(e){this.CrmFrom={...this.CrmFrom,execContent:e.row.content}},async getSmsContentTemplateList(e){await Object(l["i"])(s["a"].common.getSmsContentTemplateList,e).then(e=>{e.width=570,this.tableData=e})},openChainedDilog(e){this.$refs["chainedDialog"].showDialog(e)},openSceneDilog(e){this.$refs["SceneDialog"].showDialog(e)},addScene(e){this.CrmFrom={...this.CrmFrom,CEP_EVENT_ID:e.eventId,CEP_SCENE_NAME:e.eventName,sceneParams:e}},removeEvent(){this.CrmFrom.sceneParams={eventName:""},this.CrmFrom.CEP_EVENT_ID="",this.CrmFrom.CEP_SCENE_NAME=""},async getlistSubChannel(){await Object(l["i"])(s["a"].common.getlistSubChannel+"?parentId="+this.id).then(e=>{this.SubChannelOptions=e||[]})},async listCustAttr(){var e;const t=null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.customGroupId;await Object(l["i"])(s["a"].common.listCustAttr+"?custGroupId="+t).then(e=>{this.replaceVar=e})},getContent(e){let t="$"+e+"$";e=t,this.ShortMsgContent=e;const a=document.querySelector("#smsDetail");if(a.selectionStart||0===a.selectionStart){var i=a.selectionStart,r=a.selectionEnd;this.CrmFrom={...this.CrmFrom,execContent:a.value.substring(0,i)+e+a.value.substring(r,a.value.length)},this.$nextTick(),a.focus(),a.setSelectionRange(r+e.length,r+e.length)}else this.CrmFrom.execContent+=e},getTags(e){this.CrmFrom={...this.CrmFrom,UPDATE_CYCLE:e},0==e&&(this.CrmFrom.FREQUENCY=null,this.CrmFrom.num=""),this.$forceUpdate()},async getDateList(){await Object(l["i"])(s["a"].common.getDateList).then(e=>{this.dateList=e})},async sendShortText(){const e={content:this.CrmFrom.execContent,productNo:this.CrmFrom.productNo,spCode:this.CrmFrom.columnExt2};let t=!0;for(let a in e)e[a]||(t=!1);t?await Object(l["i"])(s["a"].common.sendShortText,e).then(e=>{this.$message.success(e.message)}):this.$message.error("请选择或填写，测试短信接受号码、执行端口、短信内容")},selectMaterial(e){this.$refs["material"].getMaterialList(),this.$refs["material"].showDialog(e)},addMaterial(e){this.CrmFrom={...this.CrmFrom,columnExt20:e.materialId,materialName:e.materialName}}},created(){}},f=b,g=(a("b4c7"),a("2877")),_=Object(g["a"])(f,i,r,!1,null,"38db317d",null);t["a"]=_.exports},"9d33":function(e,t,a){},"9dc5":function(e,t,a){"use strict";var i=function(){var e,t,a,i,r,l,s=this,o=s._self._c;return o("div",{staticStyle:{width:"100%"}},[o("Tips",{attrs:{id:s.id},on:{getChannelDetail:s.getChannelDetail}}),o("div",{staticStyle:{display:"flex","justify-content":"end"}}),o("el-form",{ref:"CrmFrom",staticStyle:{width:"100%"},attrs:{"label-width":"145px",model:s.CrmFrom,rules:s.CrmFromRules}},[o("el-row",[o("el-col",{attrs:{span:24}},[o("el-form-item",{attrs:{label:"推送方式：",prop:"columnExt1"}},[o("el-radio-group",{model:{value:s.CrmFrom.columnExt1,callback:function(e){s.$set(s.CrmFrom,"columnExt1",e)},expression:"CrmFrom.columnExt1"}},[o("el-radio",{attrs:{label:"1",disabled:!s.CrmFrom.channelFlag}},[s._v("全量推送")]),o("el-radio",{attrs:{label:"0",disabled:!s.CrmFrom.channelFlag}},[s._v("偏好推送")])],1)],1)],1),o("el-col",{attrs:{span:24}},[o("el-form-item",{attrs:{label:"运营位：",prop:"adivInfo.adivId"}},[o("el-select",{attrs:{placeholder:"请选择短信类型"},on:{change:s.changeAid},model:{value:s.CrmFrom.adivInfo.adivId,callback:function(e){s.$set(s.CrmFrom.adivInfo,"adivId",e)},expression:"CrmFrom.adivInfo.adivId"}},s._l(s.adivList,(function(e){return o("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1)],1),s.xhlist.includes(s.CrmFrom.adivInfo.adivId)?[o("el-col",{attrs:{span:24}},[o("el-form-item",{attrs:{label:"素材：",prop:"columnExt16.columnExt4"}},[o("div",{staticClass:"sucai"},[o("div",{staticClass:"select-material",on:{click:function(e){s.dialogVisible=!0}}},[s.CrmFrom.columnExt16.columnExt5?o("div",{staticClass:"m-name"},[s._v(s._s(s.CrmFrom.columnExt16.columnExt5))]):o("span",[s._v("选择素材")])]),null!==(e=s.CrmFrom.columnExt16)&&void 0!==e&&e.columnExt4?o("el-popover",{attrs:{placement:"left",width:"220",trigger:"click"}},[o("div",[o("div",[s._v("素材描述："+s._s(s.CrmFrom.columnExt16.columnExt9||"--"))]),o("el-image",{staticStyle:{width:"200px",height:"200px"},attrs:{src:s.CrmFrom.columnExt16.columnExt6,"preview-src-list":[s.CrmFrom.columnExt16.columnExt6]}})],1),o("el-button",{attrs:{slot:"reference",type:""},slot:"reference"},[s._v("预览")])],1):s._e()],1)])],1),"9330101"==s.CrmFrom.adivInfo.adivId?[o("el-col",{attrs:{span:24}},[o("el-form-item",{attrs:{label:"复杂事件场景：",prop:"CEP_EVENT_ID"}},[o("div",[o("div",{staticStyle:{display:"flex","justify-content":"space-between","max-width":"375px"}},[o("div",{staticClass:"add-botton"},[o("span",{on:{click:function(e){return s.openSceneDilog(!0)}}},[s._v(s._s(s.CrmFrom.sceneParams.eventName||"添加"))]),o("i",{directives:[{name:"show",rawName:"v-show",value:s.CrmFrom.sceneParams.eventName,expression:"CrmFrom.sceneParams.eventName"}],staticClass:"el-icon-close",on:{click:s.removeEvent}})]),o("el-checkbox",{on:{change:s.changeCheck},model:{value:s.CrmFrom.checked,callback:function(e){s.$set(s.CrmFrom,"checked",e)},expression:"CrmFrom.checked"}},[s._v("取消推荐规则设置")])],1),"JX0000000001"===s.customGroupId?o("div",{staticStyle:{color:"red","font-size":"12px"}},[s._v("该活动没有限定客群，触发事件即发送，请慎重选择事件！")]):s._e(),s.CrmFrom.checked?o("div",{staticClass:"select"},[o("div",{staticClass:"setRules"},[o("p",[s._v("已选择事件："+s._s(s.CrmFrom.sceneParams.eventName))])]),o("div",[o("span",[s._v("取消推荐时间：")]),o("el-select",{attrs:{placeholder:"请选择取消时间",size:"mini"},model:{value:s.CrmFrom.columnExt16.columnExt3,callback:function(e){s.$set(s.CrmFrom.columnExt16,"columnExt3",e)},expression:"CrmFrom.columnExt16.columnExt3"}},s._l(s.columnExt3List,(function(e){return o("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]):s._e()])])],1),o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"活动停止方式：",prop:"columnExt16.columnExt11"}},[o("el-select",{model:{value:s.CrmFrom.columnExt16.columnExt11,callback:function(e){s.$set(s.CrmFrom.columnExt16,"columnExt11",e)},expression:"CrmFrom.columnExt16.columnExt11"}},[o("el-option",{attrs:{label:"活动结束时间",value:0}}),o("el-option",{attrs:{label:"超过时间停止发送",value:1}})],1)],1)],1),1==s.CrmFrom.columnExt16.columnExt11?o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"延后时间：",prop:"columnExt16.columnExt12"}},[o("el-input",{staticStyle:{width:"130px"},attrs:{placeholder:"请输入延后时间"},on:{input:s.toNum},model:{value:s.CrmFrom.columnExt16.columnExt12,callback:function(e){s.$set(s.CrmFrom.columnExt16,"columnExt12",e)},expression:"CrmFrom.columnExt16.columnExt12"}}),s._v(" 分钟 ")],1)],1):s._e()]:s._e(),s.showExt18?o("el-col",{attrs:{span:24}},[o("el-form-item",{attrs:{label:"智能话术："}},[o("el-checkbox",{on:{change:()=>s.CrmFrom.columnExt18=s.checkColumnExt18?"1":"0"},model:{value:s.checkColumnExt18,callback:function(e){s.checkColumnExt18=e},expression:"checkColumnExt18"}},[s._v("启用")]),s.checkColumnExt18?o("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:function(e){return s.$forceUpdate()}},model:{value:s.CrmFrom.columnExt18,callback:function(e){s.$set(s.CrmFrom,"columnExt18",e)},expression:"CrmFrom.columnExt18"}},[o("el-radio",{attrs:{label:"1"}},[s._v("省端模型")]),o("el-radio",{attrs:{label:"2"}},[s._v("一级IOP模型")])],1):s._e()],1)],1):s._e(),o("el-col",{attrs:{span:24}},[o("el-form-item",{attrs:{label:"营销话术：",prop:"columnExt16.columnExt1"}},[o("el-input",{attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:6,placeholder:"您还可以输入300个字"},model:{value:s.CrmFrom.columnExt16.columnExt1,callback:function(e){s.$set(s.CrmFrom.columnExt16,"columnExt1",e)},expression:"CrmFrom.columnExt16.columnExt1"}})],1)],1)]:[o("el-col",{attrs:{span:24}},[o("el-form-item",{attrs:{label:"物料：",prop:"columnExt4"}},[o("el-select",{attrs:{placeholder:"请选择物料",filterable:""},on:{change:s.changeMater},model:{value:s.CrmFrom.columnExt4,callback:function(e){s.$set(s.CrmFrom,"columnExt4",e)},expression:"CrmFrom.columnExt4"}},s._l(s.material,(function(e){return o("el-option",{key:e.matId,attrs:{label:e.matName,value:e.matId,disabled:e.disabled}})})),1),s.validText?o("span",{staticStyle:{"padding-left":"10px"}},["正在校验"==s.validText?o("i",{staticClass:"el-icon-loading",staticStyle:{color:"#2f87ec"}}):s._e(),o("span",{style:{color:"校验异常"==s.validText?"red":"#4093ff"}},[s._v(s._s(s.validText))])]):s._e()],1)],1),o("el-col",{directives:[{name:"show",rawName:"v-show",value:s.CrmFrom.columnExt4&&s.previewflag,expression:"CrmFrom.columnExt4 && previewflag"}],attrs:{span:24}},[o("el-form-item",{attrs:{label:"预览："}},[o("el-image",{ref:"preview",staticStyle:{width:"100px",height:"100px"},attrs:{src:s.url,"preview-src-list":s.srcList}})],1)],1),o("el-col",{attrs:{span:24}},[o("el-form-item",{attrs:{label:"产品价格：",prop:"columnExt3"}},[o("el-input",{attrs:{placeholder:"请输入产品价格"},model:{value:s.CrmFrom.columnExt3,callback:function(e){s.$set(s.CrmFrom,"columnExt3",e)},expression:"CrmFrom.columnExt3"}})],1)],1),o("el-col",{attrs:{span:24}},[o("el-form-item",{attrs:{label:"URL链接：",prop:"columnExt6"}},[o("el-input",{attrs:{placeholder:"请输入URL链接"},model:{value:s.CrmFrom.columnExt6,callback:function(e){s.$set(s.CrmFrom,"columnExt6",e)},expression:"CrmFrom.columnExt6"}})],1)],1)]],2)],1),o("WXMaterialList",{attrs:{"dialog-visible":s.dialogVisible,"current-mat":{id:null===(t=s.CrmFrom.columnExt16)||void 0===t?void 0:t.columnExt4,title:null===(a=s.CrmFrom.columnExt16)||void 0===a?void 0:a.columnExt5,content:null===(i=s.CrmFrom.columnExt16)||void 0===i?void 0:i.columnExt9,picUrl:null===(r=s.CrmFrom.columnExt16)||void 0===r?void 0:r.columnExt6},"current-type-id":null===(l=s.CrmFrom.columnExt16)||void 0===l?void 0:l.columnExt7},on:{"update:dialogVisible":function(e){s.dialogVisible=e},"update:dialog-visible":function(e){s.dialogVisible=e},change:s.selectMat}}),o("ComplexScene",{ref:"SceneDialog",on:{addScene:s.addScene}})],1)},r=[],l=(a("88a7"),a("271a"),a("5494"),function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"选择素材","append-to-body":"",width:"80%",top:"10vh",visible:e.dialogVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("main",[t("div",{staticClass:"top"},[t("div",{staticClass:"search"},[t("span",[t("label",[e._v("素材名称：")]),t("el-input",{attrs:{clearable:"",placeholder:"请输入素材名称"},model:{value:e.keyWords,callback:function(t){e.keyWords=t},expression:"keyWords"}})],1),t("span",[t("label",[e._v("素材类型：")]),t("el-select",{on:{change:e.changeType},model:{value:e.query.categoryId,callback:function(t){e.$set(e.query,"categoryId",t)},expression:"query.categoryId"}},e._l(e.materialTypeList,(function(e){return t("el-option",{key:e.categoryId,attrs:{label:e.name,value:e.categoryId}})})),1)],1),t("el-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("搜索")])],1),t("div",{staticClass:"left"},[t("LabelScreen",{attrs:{title:"已选素材",Default:{id:"id",value:"title"},Label:e.selectList},on:{close:function(t){e.selectList=[]}}})],1)]),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"","max-height":"350"}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"60",align:"center"}}),t("el-table-column",{attrs:{label:"素材类型",align:"center",width:"100","show-overflow-tooltip":""}},[[e._v(" "+e._s(e.currentType.name)+" ")]],2),t("el-table-column",{attrs:{label:"素材ID",prop:"id","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"素材名称",prop:"title","min-width":"200","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"素材内容",align:"center",width:"70"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-popover",{attrs:{placement:"top",width:"220",trigger:"click"}},[t("div",[t("div",[e._v("素材描述："+e._s(a.content||"--"))]),t("el-image",{attrs:{src:a.picUrl,"preview-src-list":[a.picUrl]}})],1),t("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v("查看")])],1)]}}])}),t("el-table-column",{attrs:{label:"素材价格",prop:"price",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"推荐标识",prop:"referenceStatusName",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"开始时间",prop:"beginTime",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"结束时间",prop:"endTime",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"操作",width:"70",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.add(a.row)}}},[e._v("添加")])]}}])})],1),t("el-pagination",{attrs:{size:"small","current-page":e.query.current,"page-sizes":[10,20,30,40],"page-size":e.query.size,"pager-count":5,layout:"total, sizes, prev, pager, next",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("确 定")])],1)])}),s=[],o=a("7b5a"),n=a("0fea"),c=a("5e05"),m={name:"WXMaterialList",components:{LabelScreen:o["a"]},props:{dialogVisible:{type:Boolean,default:!1},currentTypeId:{type:Number|String,default:""},currentMat:{type:Object,default:()=>{}}},data(){return{loading:!1,tableData:[],keyWords:"",query:{search:"",materialType:"",categoryId:"",current:1,size:10},total:0,materialTypeList:[],currentType:"",selectList:[]}},methods:{async getMaterialType(){try{var e;const t=await Object(n["i"])(c["a"].common.queryMaterialType);let a=(null===(e=JSON.parse(t))||void 0===e?void 0:e.data)||[];this.materialTypeList=a.filter(e=>2!=e.materialType),this.materialTypeList.length>0&&(this.currentType=this.materialTypeList[0],this.query.materialType=this.currentType.materialType,this.query.categoryId=this.currentType.categoryId,this.currentTypeId&&(this.currentType=this.materialTypeList.find(e=>e.categoryId===this.currentTypeId),this.query.materialType=this.currentType.materialType,this.query.categoryId=this.currentType.categoryId))}catch(t){}},changeType(e){this.currentType=this.materialTypeList.find(t=>t.categoryId===e)||{},this.query.materialType=this.currentType.materialType},async getList(){try{this.loading=!0;const{records:e,total:t}=await Object(n["i"])(c["a"].common.queryMaterialInfos,this.query);this.tableData=e,this.total=t}catch(e){}finally{this.loading=!1}},handleSizeChange(e){this.query.current=1,this.query.size=e,this.getList()},handleCurrentChange(e){this.query.current=e,this.getList()},search(){this.query.current=1,this.query.search=this.keyWords,this.getList()},add(e){this.selectList=[e]},cancel(){this.selectList=[],this.$emit("update:dialogVisible",!1)},confirm(){this.$emit("change",this.selectList,this.currentType),this.$emit("update:dialogVisible",!1)}},watch:{dialogVisible(e){e&&0===this.tableData.length&&this.getList(),e&&this.currentMat.id&&0===this.selectList.length&&this.$nextTick(()=>{this.$set(this.selectList,0,this.currentMat)})}},created(){this.getMaterialType()}},u=m,d=(a("12ed"),a("2877")),h=Object(d["a"])(u,l,s,!1,null,"0d6156c8",null),p=h.exports,v=a("aedd"),C=a("856c"),b=a.n(C),f=a("5ed5"),g=a("b893");const _=c["a"].common.queryAdivInfo;var x={props:["channelNewData","id","deleteSub"],components:{Tips:f["a"],WXMaterialList:p,ComplexScene:v["a"]},computed:{customGroupId(){var e;return null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.customGroupId}},data(){return{xhlist:[9330101,"9330101",9330102,"9330102"],xhsslist:[9330101,"9330101"],CrmFrom:{adivInfo:{adivName:""},channelId:"",channelName:"",sucai:{matId:"",matName:""},CEP_EVENT_ID:"",CEP_SCENE_NAME:"",sceneParams:{eventName:"",eventId:""},checked:!1,columnExt1:"1",columnExt3:"",columnExt4:"",standard:"",CustomerRules:"",marketingWords:"",columnExt2:"",columnExt5:"",columnExt6:"",columnExt7:"",columnExt8:"",columnExt9:"",columnExt10:"",columnExt11:{},columnExt12:{},columnExt13:{},columnExt14:{},columnExt16:{columnExt1:"",columnExt2:"",columnExt3:"",columnExt4:"",columnExt5:"",columnExt6:"",columnExt7:"",columnExt8:"",columnExt9:"",columnExt10:"",columnExt11:0,columnExt12:""},columnExt18:"0"},showExt18:!1,checkColumnExt18:!1,material:[],columnExt3List:[{label:"1天",value:"1"},{label:"2天",value:"2"},{label:"3天",value:"3"},{label:"4天",value:"4"},{label:"5天",value:"5"},{label:"6天",value:"6"},{label:"7天",value:"7"}],CrmFromRules:{columnExt1:[{required:!0,message:"请选择推送方式",trigger:"blur"}],columnExt4:[{required:!0,message:"请选择物料",trigger:"blur"}],columnExt3:[{required:!0,message:"请填写产品价格",trigger:"blur"}],columnExt6:[{required:!0,message:"请填写URL连接",trigger:"blur"}],adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},columnExt16:{columnExt1:[{required:!0,message:"请输入营销用语",trigger:"blur"}],columnExt4:[{required:!0,message:"请选择素材",trigger:"blur"}],columnExt11:[{required:!0,message:"请选择活动停止方式",trigger:"blur"}],columnExt12:[{required:!0,message:"请输入延后时间",trigger:"blur"}]},CEP_EVENT_ID:[{required:!0,message:"请选择实时事件",trigger:"blur"}]},adivList:[],url:"",srcList:[],previewflag:!1,validText:"",dialogVisible:!1}},watch:{channelNewData:{handler(){this.CrmFrom=Object(g["d"])(this.channelNewData),this.url=this.CrmFrom.columnExt10,this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.CrmFrom.columnExt16&&"string"==typeof this.CrmFrom.columnExt16&&(this.CrmFrom.columnExt16=JSON.parse(this.CrmFrom.columnExt16)),this.$set(this.CrmFrom,"columnExt16",this.CrmFrom.columnExt16||{columnExt1:"",columnExt2:"",columnExt3:"",columnExt4:"",columnExt5:"",columnExt6:"",columnExt7:"",columnExt8:"",columnExt9:"",columnExt10:"",columnExt11:0,columnExt12:""}),this.$set(this.CrmFrom,"checked",1==this.CrmFrom.columnExt16.columnExt2),this.checkColumnExt18=this.CrmFrom.columnExt18>0},deep:!0}},created(){var e;this.getOptionData(),this.getAllDataView();let t={...this.CrmFrom,...this.channelNewData};this.CrmFrom=Object(g["d"])(t),this.url=this.CrmFrom.columnExt10,this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.CrmFrom.columnExt16&&"string"==typeof this.CrmFrom.columnExt16&&(this.CrmFrom.columnExt16=JSON.parse(this.CrmFrom.columnExt16)),this.$set(this.CrmFrom,"columnExt16",this.CrmFrom.columnExt16||{columnExt1:"",columnExt2:"",columnExt3:"",columnExt4:"",columnExt5:"",columnExt6:"",columnExt7:"",columnExt8:"",columnExt9:"",columnExt10:"",columnExt11:0,columnExt12:""}),this.$set(this.CrmFrom,"checked",1==(null===(e=this.CrmFrom.columnExt16)||void 0===e?void 0:e.columnExt2)),this.checkColumnExt18=this.CrmFrom.columnExt18>0},methods:{getChannelDetail(e){1==e.smartScript&&(this.showExt18=!0)},async getOptionData(){await Object(n["i"])(_,{channelId:this.id}).then(e=>{this.adivList=e})},changeAid(e){var t="";this.adivList.forEach(a=>{e===a.adivId&&(t=a.adivName)}),this.CrmFrom.adivInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,adivName:t}),this.removeEvent(),this.CrmFrom.checked=!1,this.xhlist.includes(e)?(this.CrmFrom.columnExt2="",this.CrmFrom.columnExt3="",this.CrmFrom.columnExt4="",this.CrmFrom.columnExt5="",this.CrmFrom.columnExt6="",this.CrmFrom.columnExt7="",this.CrmFrom.columnExt8="",this.CrmFrom.columnExt9="",this.CrmFrom.columnExt10="",this.CrmFrom.columnExt11="",this.CrmFrom.columnExt12="",this.CrmFrom.columnExt13="",this.CrmFrom.columnExt14="",this.CrmFrom.columnExt15="",this.CrmFrom.columnExt16.columnExt2="",this.CrmFrom.columnExt16.columnExt3="",this.CrmFrom.columnExt16.columnExt11=this.xhsslist.includes(e)?0:""):this.CrmFrom.columnExt16={columnExt1:"",columnExt2:"",columnExt3:"",columnExt4:"",columnExt5:"",columnExt6:"",columnExt7:"",columnExt8:"",columnExt9:"",columnExt10:"",columnExt11:0,columnExt12:""}},changeCheck(e){this.$set(this.CrmFrom.columnExt16,"columnExt2",e?"1":"0")},toNum(e){let t=e.replace(/^(0+)|[^\d]+/g,"");this.CrmFrom.columnExt16.columnExt12=parseInt(t)||""},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{if(t){const t=JSON.parse(JSON.stringify(this.CrmFrom));"object"==typeof t.columnExt16&&(t.columnExt16=JSON.stringify(t.columnExt16)),this.$emit("saveChannelData",t),e=!0}else e=!1}),e},async getAllDataView(){await Object(n["i"])(c["a"].common.getAllDataView,{keyWords:"",pageNum:1}).then(e=>{this.material=e.recordList})},async changeMater(e){const t=this.material.filter(t=>t.matId===e)[0];this.validText="正在校验";let a="";this.previewflag=!0,this.url=b.a;try{const{matUrl:e}=await Object(n["i"])(c["a"].common.downLoadMatUrl,{matUrl:t.matUrl});a="物料图片名称已获取",Object(n["b"])(c["a"].common.loadImage,{picName:e}).then(({data:e})=>{const t=new Blob([e],{type:e.type});this.url=URL.createObjectURL(t),this.srcList=[this.url]}).catch(e=>{this.url=""});const i=await Object(n["i"])(c["a"].common.validChannelAdvidIdAvailable,{channelId:this.CrmFrom.channelId,channelAdivdId:t.matId,matUrl:e});1==i?(a="物料可以正常使用",this.validText=""):a="当前物料已被使用"}catch(i){this.validText="校验异常",""==a?this.url="":"物料图片名称已获取"==a&&(a="校验异常")}if("当前物料已被使用"==a)return this.validText="",this.$alert("当前物料已被使用，请重新选择","提示",{confirmButtonText:"确定",customClass:"errorPrompt",callback:e=>{let a=this.material.find(e=>e.matId==t.matId);this.$set(a,"disabled",!0),this.CrmFrom={...this.CrmFrom,columnExt4:"",columnExt5:"",columnExt2:"",columnExt7:"",columnExt8:"",columnExt9:"",columnExt10:"",columnExt11:"",columnExt12:"",columnExt13:"",columnExt14:""},this.url="",this.srcList=[],this.previewflag=!1}});this.CrmFrom={...this.CrmFrom,columnExt5:t.matName,columnExt2:+t.ifJb>=0?t.ifJb:"1",columnExt7:t.jbType,columnExt8:t.jbShow,columnExt9:t.jbText,columnExt10:t.jbPicSrc,columnExt11:JSON.stringify(t.searchInfo),columnExt12:JSON.stringify(t.ugInfo),columnExt13:JSON.stringify(t.cardInfo),columnExt14:JSON.stringify(t.generalInfo)}},openSceneDilog(e){this.$refs["SceneDialog"].showDialog(e)},addScene(e){this.CrmFrom={...this.CrmFrom,CEP_EVENT_ID:e.eventId,CEP_SCENE_NAME:e.eventName,sceneParams:e}},removeEvent(){this.CrmFrom.sceneParams={eventName:"",eventId:""},this.CrmFrom.CEP_EVENT_ID="",this.CrmFrom.CEP_SCENE_NAME=""},selectMat(e,t){if(e.length){let a=e[0];const{id:i,title:r,content:l,picUrl:s}=a;this.CrmFrom.columnExt16={...this.CrmFrom.columnExt16,columnExt4:i,columnExt5:r,columnExt6:s,columnExt7:t.categoryId,columnExt8:t.materialType,columnExt9:l,columnExt10:t.name}}else this.CrmFrom.columnExt16={...this.CrmFrom.columnExt16,columnExt4:"",columnExt5:"",columnExt6:"",columnExt7:"",columnExt8:"",columnExt9:"",columnExt10:"",columnExt11:0,columnExt12:""}}}},E=x,y=(a("7248"),Object(d["a"])(E,i,r,!1,null,"c3cdc640",null));t["a"]=y.exports},"9f5d":function(e,t,a){},a02f:function(e,t,a){"use strict";a("dd73")},a078:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return r}));var i={MUNUMBER:2},r=[{example_type:"1",example_content:"[[1], [2], [3]]",new_example_content:"[{group: [1, 2, 3], children:[]}]",CAMPSEG_NAME:"产品导向最简流程",isOpenProcess:!0,isCheckboxPro:!0,isCheckboxCust:!0,isCheckboxChannel:!0,isMultiActivities:!1,isCheckboxChan:!0},{CAMPSEG_NAME:"多波次流程",example_type:"3",example_content:"[[1], [2], [3], [5]]",new_example_content:"[{group: [1, 2, 3], children:[]}]",isOpenProcess:!0,isCheckboxPro:!0,isCheckboxCust:!1,isCheckboxChannel:!1,isCheckboxChan:!1,isMultiActivities:!1}]},a28d:function(e,t,a){"use strict";a("cddb")},a2b3:function(e,t,a){"use strict";a("e5da")},a365:function(e,t,a){},a3cc:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"CrmFrom",attrs:{"label-width":"150px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-form-item",{attrs:{label:"运营位：",prop:"adivInfo.adivId"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:e.changeAid},model:{value:e.CrmFrom.adivInfo.adivId,callback:function(t){e.$set(e.CrmFrom.adivInfo,"adivId",t)},expression:"CrmFrom.adivInfo.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1),t("el-form-item",{attrs:{label:"产品图片URL：",prop:"channelConf.materialDisplayUrl"}},[t("el-input",{model:{value:e.CrmFrom.channelConf.materialDisplayUrl,callback:function(t){e.$set(e.CrmFrom.channelConf,"materialDisplayUrl",t)},expression:"CrmFrom.channelConf.materialDisplayUrl"}})],1),t("el-form-item",{attrs:{label:"互联网产品跳转URL："}},[t("el-input",{model:{value:e.CrmFrom.channelConf.materialClickUrl,callback:function(t){e.$set(e.CrmFrom.channelConf,"materialClickUrl",t)},expression:"CrmFrom.channelConf.materialClickUrl"}})],1),t("el-form-item",{attrs:{label:"推荐用语：",prop:"channelConf.execContent"}},[t("el-input",{attrs:{type:"textarea",maxlength:"500","show-word-limit":""},model:{value:e.CrmFrom.channelConf.execContent,callback:function(t){e.$set(e.CrmFrom.channelConf,"execContent",t)},expression:"CrmFrom.channelConf.execContent"}})],1),t("el-form-item",{attrs:{label:"时机选择："}},[t("el-select",{attrs:{placeholder:"请选择"},on:{click:e.changeTime},model:{value:e.CrmFrom.channelConf.timeId,callback:function(t){e.$set(e.CrmFrom.channelConf,"timeId",t)},expression:"CrmFrom.channelConf.timeId"}},e._l(e.timeIdList,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),t("el-form-item",{attrs:{label:"时机描述："}},[t("el-input",{attrs:{type:"textarea",maxlength:"240","show-word-limit":""},model:{value:e.CrmFrom.channelConf.timeDistindes,callback:function(t){e.$set(e.CrmFrom.channelConf,"timeDistindes",t)},expression:"CrmFrom.channelConf.timeDistindes"}})],1)],1)],1)},r=[],l=a("0fea"),s=a("5e05");const o=s["a"].common.getSysEnum,n=s["a"].common.queryAdivInfo,c=s["a"].common.queryHallInfo;var m={props:["channelNewData"],data(){return{CrmFrom:{adivInfo:{},channelConf:{},channelId:"",channelName:"",attributionInfo:{}},CrmFromRules:{adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}],materialDisplayUrl:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},timeIdList:[],adivList:[],attributionList:[]}},mounted(){this.getOptionData(),this.CrmFrom=JSON.parse(JSON.stringify(this.channelNewData))},methods:{async getOptionData(){await Object(l["i"])(o,{enumType:"iop_time_id"}).then(e=>{this.timeIdList=e}),await Object(l["i"])(n,{channelId:this.CrmFrom.channelId}).then(e=>{this.adivList=e}),await Object(l["i"])(c,{}).then(e=>{this.attributionList=e})},changeAid(e){var t="";this.adivList.forEach(a=>{e===a.adivId&&(t=a.adivName)}),this.CrmFrom.adivInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,adivName:t})},changeAttribution(e){var t="";this.attributionList.forEach(a=>{e===a.adivId&&(t=a.attributionName)}),this.CrmFrom.attributionInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,attributionName:t})},changeTime(){this.timeIdList.forEach(e=>{e.enumKey===this.CrmFrom.timeId&&(this.CrmFrom.timeName=e.enumValue)})},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e}},created(){}},u=m,d=a("2877"),h=Object(d["a"])(u,i,r,!1,null,"c964ca44",null);t["a"]=h.exports},a469:function(e,t,a){},a5b3:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"95%"}},[t("Tips",{attrs:{id:e.channelNewData.channelId},on:{getChannelDetail:e.getChannelDetail}}),t("el-form",{ref:"CrmFrom",staticStyle:{width:"100%"},attrs:{"label-width":"145px",model:e.CrmFrom,rules:e.CrmFromRules}},[e._e(),t("el-form-item",{attrs:{label:"运营位：",prop:"adivInfo.adivId"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:e.changeAid},model:{value:e.CrmFrom.adivInfo.adivId,callback:function(t){e.$set(e.CrmFrom.adivInfo,"adivId",t)},expression:"CrmFrom.adivInfo.adivId"}},e._l(e.colAdivInfo.adivList,(function(a){return t("el-option",{key:a.adivId,attrs:{label:a.adivName,value:a.adivId,disabled:e.selectedAdivId.has(a.adivId)}})})),1)],1),t("el-form-item",{attrs:{label:"标准化素材：",prop:"columnExt20"}},[t("div",{staticClass:"select-material",on:{click:function(t){return e.selectMaterial(!0)}}},[e._v(e._s(e.CrmFrom.materialName||"请选择"))])]),e.showExt18?t("el-form-item",{attrs:{label:"智能话术："}},[t("el-checkbox",{on:{change:()=>e.CrmFrom.columnExt18=e.checkColumnExt18?"1":"0"},model:{value:e.checkColumnExt18,callback:function(t){e.checkColumnExt18=t},expression:"checkColumnExt18"}},[e._v("启用")]),e.checkColumnExt18?t("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt18,callback:function(t){e.$set(e.CrmFrom,"columnExt18",t)},expression:"CrmFrom.columnExt18"}},[t("el-radio",{attrs:{label:"1"}},[e._v("省端模型")]),t("el-radio",{attrs:{label:"2"}},[e._v("一级IOP模型")])],1):e._e()],1):e._e(),t("el-form-item",{attrs:{label:"推荐用语：",prop:"execContent"}},[t("el-input",{attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},model:{value:e.CrmFrom.execContent,callback:function(t){e.$set(e.CrmFrom,"execContent",t)},expression:"CrmFrom.execContent"}})],1)],1),t("materialList",{ref:"material",attrs:{channelId:e.CrmFrom.channelId,adivId:e.CrmFrom.adivInfo.adivId},on:{addMaterial:e.addMaterial}})],1)},r=[],l=a("0fea"),s=a("5e05"),o=a("b893"),n=a("f1ce"),c=a("5ed5");a("0b16");const m=s["a"].common.getSysEnum,u=(s["a"].common.queryAdivInfo,s["a"].common.queryHallInfo);var d={props:["channelNewData","id","deleteSub","columnExt1","colAdivInfo","selectedAdivId"],components:{materialList:n["a"],Tips:c["a"]},data(){return{CrmFrom:{adivInfo:{},channelId:"",channelName:"",attributionInfo:{},columnExt1:"1",standard:"",CustomerRules:"",execContent:"",columnExt18:"0",columnExt20:""},showExt18:!1,checkColumnExt18:!1,CrmFromRules:{columnExt1:[{required:!0,message:"请选择推送方式",trigger:"blur"}],execContent:[{required:!0,message:"请输入营销话术",trigger:"blur"}],adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},timeIdList:[],attributionList:[]}},watch:{columnExt1(e,t){this.CrmFrom.columnExt1=e}},mounted(){this.getOptionData(),this.CrmFrom=JSON.parse(JSON.stringify(Object(o["d"])(this.channelNewData))),this.$set(this.CrmFrom,"columnExt1",this.columnExt1),this.checkColumnExt18=this.CrmFrom.columnExt18>0},methods:{getChannelDetail(e){1==e.smartScript&&(this.showExt18=!0)},async getOptionData(){await Object(l["i"])(m,{enumType:"iop_time_id"}).then(e=>{this.timeIdList=e}),await Object(l["i"])(u,{}).then(e=>{this.attributionList=e})},changeAid(e){var t="";this.colAdivInfo.adivList.forEach(a=>{e===a.adivId&&(t=a.adivName)}),this.CrmFrom.adivInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,adivName:t}),this.$emit("changeAdiv",e)},SubInstall(e=!0){var t=!0;return this.$refs.CrmFrom.validate(a=>{a||("906"===this.id||"922"===this.id)&&this.CrmFrom.execContent&&this.CrmFrom.adivInfo.adivId?(e&&this.$emit("saveChannelData",this.colAdivInfo.id,this.CrmFrom),t=!0):t=!1}),t},selectMaterial(e){this.$refs["material"].getMaterialList(),this.$refs["material"].showDialog(e)},addMaterial(e){this.CrmFrom={...this.CrmFrom,columnExt20:e.materialId,materialName:e.materialName}}},created(){}},h=d,p=(a("3aeb"),a("2877")),v=Object(p["a"])(h,i,r,!1,null,"1aa78f3e",null);t["a"]=v.exports},a640:function(e,t,a){"use strict";var i=a("d039");e.exports=function(e,t){var a=[][e];return!!a&&i((function(){a.call(null,t||function(){return 1},1)}))}},a9fc:function(e,t,a){"use strict";a("a469")},aa07:function(e,t,a){},aabc:function(e,t,a){"use strict";a("66d1")},ab51:function(e,t,a){},abba:function(e,t,a){},abbae:function(e,t,a){"use strict";a("7911")},ac9f:function(e,t,a){},ae3d:function(e,t,a){},aedd:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{attrs:{title:e.title,visible:e.dialogVisible,width:"1000px",modal:!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("div",{staticClass:"search_box"},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],staticClass:"input-search",attrs:{placeholder:"请输入事件名称编码"},model:{value:e.queryForm.keyWords,callback:function(t){e.$set(e.queryForm,"keyWords","string"===typeof t?t.trim():t)},expression:"queryForm.keyWords"}},[t("i",{staticClass:"el-input__icon el-icon-search cursor-pointer",attrs:{slot:"suffix"},on:{click:function(t){return e.searchList()}},slot:"suffix"})])],1),t("div",{staticClass:"content"},[t("div",{staticClass:"tree"},[t("div",{staticClass:"search_box"},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],staticClass:"input-search",staticStyle:{width:"80%",margin:"0 auto"},attrs:{placeholder:"输入事件类型名称"},model:{value:e.keyWords,callback:function(t){e.keyWords="string"===typeof t?t.trim():t},expression:"keyWords"}},[t("i",{staticClass:"el-input__icon el-icon-search cursor-pointer",attrs:{slot:"suffix"},on:{click:e.initChannel},slot:"suffix"})])],1),t("el-tree",{ref:"vueTree",attrs:{props:e.props,data:e.channelList,"node-key":"id",accordion:"","highlight-current":"","icon-class":"iconfont icongonggongtubiao-shouqi Treecolor"},on:{"node-click":e.TreeNodeClick},scopedSlots:e._u([{key:"default",fn:function({node:a,data:i}){return t("div",{staticClass:"custom-tree-node"},[t("span",[e._v(e._s(a.label))]),t("span",[e._v(e._s(i.num))])])}}])})],1),t("div",{staticClass:"content-table"},[t("el-table",{staticClass:"table",staticStyle:{width:"100%"},attrs:{data:e.chainedData},on:{"row-click":e.singleElection}},[t("el-table-column",{attrs:{align:"center",width:"55",label:"选择"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-radio",{staticClass:"radio",attrs:{label:a.row.eventId},model:{value:e.templateSelection,callback:function(t){e.templateSelection=t},expression:"templateSelection"}},[e._v(" ")])]}}])}),t("el-table-column",{attrs:{prop:"eventId",label:"事件编码","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"eventName",label:"事件名称","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"firstClassName",label:"一级分类"}}),t("el-table-column",{attrs:{prop:"createUserName",label:"创建人"}}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间","show-overflow-tooltip":""}})],1)],1)]),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{"current-page":e.queryForm.current,"page-size":e.queryForm.size,layout:"total, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("确 定")])],1)])],1)},r=[],l=a("0fea"),s=(a("d370"),a("5e05")),o=a("b893"),n={props:{title:{type:String,default:"复杂事件场景实例"}},data(){return{dialogVisible:!1,tagsList:[],queryForm:{keyWords:"",current:1,size:10,status:"1",classifyId:""},total:0,chainedData:[],props:{label:"label",children:"children",num:"num"},channelList:[],templateSelection:"",checkList:[],keyWords:""}},created(){this.getChainedList(this.queryForm),this.initChannel()},methods:{async getChainedList(e){let t=await Object(l["i"])(s["a"].common.getSceneList,e);this.chainedData=t.records,this.total=t.total},searchList(){this.getChainedList(this.queryForm)},showDialog(e){this.dialogVisible=e},handleCurrentChange(e){this.queryForm.current=e,this.getChainedList(this.queryForm)},handleSizeChange(e){this.queryForm.size=e,this.getChainedList(this.queryForm)},copyItem(e){},addItem(e){this.$set(this.tagsList,0,e)},handleClose(e){this.tagsList.splice(this.tagsList.indexOf(e),1)},async initChannel(){await Object(l["i"])(s["a"].common.getSceneTypeList,{keyWords:this.keyWords}).then(e=>{this.initAdivInfo(e)})},async initAdivInfo(e){let t=e.map(e=>({id:e.id,label:e.label,children:e.children,parentId:e.parentId}));t=[{label:"全部",id:"-1",parentId:"-2",children:t}],t.forEach(e=>{e.children=e.children.map(e=>({id:e.id,label:e.label,children:e.children,parentId:e.parentId}))}),this.channelList=Object(o["f"])(t,"id","parentId","children","-2")},TreeNodeClick(e){"全部"===e.label?(this.queryForm={...this.queryForm,classifyId:"",current:1},this.getChainedList(this.queryForm)):(this.queryForm={...this.queryForm,classifyId:e.id},this.getChainedList(this.queryForm))},singleElection(e){this.templateSelection=e.eventId,this.checkList=this.chainedData.filter(t=>t.eventId===e.eventId)},clearEvent(){this.templateSelection="",this.checkList=[],this.$forceUpdate()},submit(){this.$emit("addScene",this.checkList[0]),this.dialogVisible=!1}}},c=n,m=(a("8914"),a("2877")),u=Object(m["a"])(c,i,r,!1,null,"5a199ac2",null);t["a"]=u.exports},af75:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"channelBaseDialog"},[t("mp-dialog",{attrs:{title:"策略基本信息配置",visible:e.visible,width:"700px",IsAscertain:!1},on:{"update:visible":function(t){e.visible=t},DialogClose:e.DialogClose}},[e.visible?t("div",{attrs:{slot:"Dialogcontent"},slot:"Dialogcontent"},[t("el-form",{ref:"baseFrom",staticClass:"base-form",attrs:{"label-width":"110px",model:e.baseFrom,rules:e.baseFromRules}},[t("el-form-item",{attrs:{label:"策略名称:",prop:"campsegName"}},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],model:{value:e.baseFrom.campsegName,callback:function(t){e.$set(e.baseFrom,"campsegName",t)},expression:"baseFrom.campsegName"}})],1),t("el-form-item",{attrs:{label:"策略描述:",prop:"campsegDesc"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.baseFrom.campsegDesc,callback:function(t){e.$set(e.baseFrom,"campsegDesc",t)},expression:"baseFrom.campsegDesc"}})],1),t("el-form-item",{attrs:{label:"专题:"}},[t("el-select",{staticStyle:{width:"230px"},attrs:{placeholder:"请选择专题"},model:{value:e.baseFrom.topicId,callback:function(t){e.$set(e.baseFrom,"topicId",t)},expression:"baseFrom.topicId"}},e._l(e.topOption,(function(e){return t("el-option",{key:e.topicId,attrs:{label:e.topicName,value:e.topicId}})})),1)],1),t("el-form-item",{attrs:{label:"营销模板:"}},[t("el-select",{staticStyle:{width:"230px"},attrs:{placeholder:"请选择营销模板"},on:{change:e.changeTemplate},model:{value:e.baseFrom.activityTemplateId,callback:function(t){e.$set(e.baseFrom,"activityTemplateId",t)},expression:"baseFrom.activityTemplateId"}},e._l(e.iopTempOption,(function(e){return t("el-option",{key:e.activityTemplateid,attrs:{label:e.activityName,value:e.activityTemplateid}})})),1)],1),t("el-form-item",{attrs:{label:"营销类型:",prop:"activityType"}},[e.baseFrom.activityTemplateId?e._e():t("el-select",{staticStyle:{width:"230px"},attrs:{placeholder:"请选择营销类型"},model:{value:e.baseFrom.activityType,callback:function(t){e.$set(e.baseFrom,"activityType",t)},expression:"baseFrom.activityType"}},e._l(e.typeOption,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1),e.baseFrom.activityTemplateId?t("el-select",{staticStyle:{width:"230px"},attrs:{placeholder:"请选择营销类型",disabled:""},model:{value:e.baseFrom.activityType,callback:function(t){e.$set(e.baseFrom,"activityType",t)},expression:"baseFrom.activityType"}},e._l(e.typeOption,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1):e._e()],1),t("el-form-item",{attrs:{label:"营销活动目标:",prop:"activityObjective"}},[e.baseFrom.activityTemplateId?e._e():t("el-select",{staticStyle:{width:"230px"},attrs:{placeholder:"请选择营销活动目标"},model:{value:e.baseFrom.activityObjective,callback:function(t){e.$set(e.baseFrom,"activityObjective",t)},expression:"baseFrom.activityObjective"}},e._l(e.targetOption,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),e._l(e.nextNodesList.nextNodesApprover,(function(a,i){return t("el-form-item",{key:i,attrs:{label:a.node.nodeName,rules:{required:!0,message:"审批人不能为空",trigger:"blur"},prop:"nextNodesList["+i+"].value"}},[t("el-select",{staticStyle:{width:"230px"},attrs:{placeholder:"请选择",multiple:null!==a.processVersionNum},on:{change:e.clone},model:{value:e.baseFrom.nextNodesList[i].value,callback:function(t){e.$set(e.baseFrom.nextNodesList[i],"value",t)},expression:"baseFrom.nextNodesList[index].value"}},e._l(a.approverUser,(function(e,a){return t("el-option",{key:a,attrs:{label:e.userName,value:e.userId}})})),1)],1)}))],2),t("div",{staticStyle:{"text-align":"center"}},[t("el-button",{attrs:{type:"success",size:"medium"},on:{click:e.sumbit}},[e._v(e._s(1===e.isSubmit?"提交审批":"保存草稿"))])],1)],1):e._e()])],1)},r=[],l=(a("14d9"),a("f9ae")),s=a("0fea"),o=a("b132"),n=a("f3ba"),c=a("2f62"),m=a("eced"),u=a("31b1"),d=a("5e05"),h=a("d370");const p=d["a"].common.getSysEnum,v=(n["a"].home.getDicValueByKey,u["a"].channel.getNextApprovers,u["a"].channel.queryTopics,u["a"].channel.queryIopTemplate,u["a"].channel.saveChannel,u["a"].channel.getTemplateData);var C={name:"channelBaseDialog",components:{MpDialog:o["a"]},props:{baseCampInfo:{type:Object,default:()=>({})},childrenSchemes:{type:Array,default:()=>[]}},data(){return{visible:!1,SceneNodeData:[],typeOption:[],checked:"",targetOption:[],baseFrom:{campsegName:"",dateList:[],processNum:1},baseFromRules:{campsegName:[{required:!0,message:"请输入策略名称",trigger:"blur"}],dateList:[{required:!0,message:"请选择投放周期",trigger:"blur"}],campsegDesc:[{required:!0,message:"请输入策略描述",trigger:"blur"}],activityType:[{required:!0,message:"请选择营销类型",trigger:"blur"}],activityObjective:[{required:!0,message:"请选择营销目标",trigger:"blur"}]},ProcessItemList:[],iopTempOption:[],topOption:[],approverList:[],approveUserId:{},campInfoBO:{},processNumList:[],nextNodesList:{},TemplateData:{},ApproverUser:[],isSubmit:"",pickerOptions:{disabledDate(e){return e.getTime()<Date.now()-864e5}}}},computed:{...Object(c["b"])("MarkPl",["getNodeDataId","getNodeFirstChannelData","getNodeDataIdObj"]),ActiveNodeList:function(){return this.$store.state.MarkPl.ActiveNodeList},processData(){return this.$store.state.MarkPl.ProcessData}},created(){},mounted(){},methods:{clone(){this.baseFrom=Object.assign({},this.baseFrom)},getTemlate(){if("approveFlowId"in this.baseFrom&&null!==this.baseFrom.approveFlowId){var e={approveFlowId:this.baseFrom.approveFlowId};this.getNextApprovers(e)}else Object(s["i"])(v).then(e=>{this.TemplateData=e,this.getNextApprovers(e)})},async getNextApprovers(e){var t=[];this.childrenSchemes.map(e=>{e.data.campSchemes.map(e=>{null===e.channels[0].channelConf.wavesChannelPid&&t.push(e.channels)})});var a=[];t.map(e=>{e.map(e=>{a.push(e.channelId)})});var i={berv:e.berv,instanceId:e.approveFlowId,nodeId:"",processId:e.processId,triggerParm:{channelId:a.join(",")}};await Object(s["i"])(u["a"].channel.getNextApprovers,i).then(e=>{this.baseFrom.nextNodesList=[],e.nextNodesApprover.map(e=>{var t;this.baseFrom.nextNodesList.push({value:(null===(t=e.approverUser[0])||void 0===t?void 0:t.userId)||""})}),this.nextNodesList=e})},getOptionData(){this.SceneNodeData=this.$store.state.MarkPl.SceneNodeData,Object(s["i"])(p,{enumType:"activity_type"}).then(e=>{this.typeOption=e}),Object(s["i"])(p,{enumType:"activity_objective"}).then(e=>{this.targetOption=e}),this.processNumList=Object(m["g"])(this.SceneNodeData),"{}"!==JSON.stringify(this.baseCampInfo)?(this.baseFrom={...this.baseFrom,...this.baseCampInfo},this.baseFrom.dateList=[this.baseCampInfo.startDate,this.baseCampInfo.endDate]):this.intiCampInfo()},ChangeProcessNum(){this.baseFrom.processNum=JSON.parse(JSON.stringify(this.baseFrom.processNum))},intiCampInfo(){var e=new Date(+new Date+288e5).toJSON().substr(0,19).replace("T"," ");this.baseFrom.campsegName="营销策略"+e},changeAppId(){this.approverList.forEach(e=>{(this.baseFrom.approveId=e.userId)&&(this.approveUserId.userId=e.userId,this.approveUserId.userName=e.userName)})},changeTemplate(){this.iopTempOption.forEach(e=>{(this.baseFrom.activityTemplateid=e.activityTemplateid)&&(this.baseFrom.activityType=e.activityType,this.baseFrom.activityObjective=e.activityObjective)})},save(){},DialogClose(){this.$emit("DialogClose")},sumbit:Object(l["a"])((function(){this.$refs.baseFrom.validate(async e=>{if(e){var t=JSON.parse(JSON.stringify(this.baseFrom));t.startDate="2022-02-17 00:00:00",t.endDate="2050-02-17 00:00:00";var a=JSON.parse(JSON.stringify(this.ActiveNodeList));t.tacticsMap=JSON.stringify(Object(m["l"])(a));var i={};if(1===this.isSubmit){var r=[];this.nextNodesList.nextNodesApprover.filter((e,t)=>{var a=this.baseFrom.nextNodesList[t],i=[];e.approverUser.map(e=>{Array.isArray(a.value)?a.value.map(t=>{t===e.userId&&i.push(e)}):a.value===e.userId&&i.push(e)}),r.push({approverUser:i,node:e.node})}),i={nodeId:this.nextNodesList.nodeId,processId:this.nextNodesList.processId,berv:this.nextNodesList.berv,submitStatus:1,instanceId:this.baseFrom.approveFlowId,nextNodesApprover:r}}var l=[];this.childrenSchemes.map(e=>{var t=e.data.campSchemes.map(t=>null===t.channels[0].channelConf.wavesChannelPid?{baseCampInfo:e.data.baseCampInfo,campGroup:e.id,...t}:{campGroup:e.id,...t});l=[...t,...l]});var o=[];this.childrenSchemes.map(e=>{e.data.childrenSchemes.forEach(t=>{t.campGroup=e.id}),o=[...o,...e.data.childrenSchemes]});var n={baseCampInfo:t,approveUserId:i,campSchemes:l,childrenSchemes:o,type:this.processData.example_type,isSubmit:this.isSubmit},c=["策划保存草稿成功","策划提交审批成功"];try{const e=await Object(s["i"])(h["a"].mpapi.tacticsCreateSave,n);if("ERROR"===(null===e||void 0===e?void 0:e.status))return this.$alert(e.message,"操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"});this.$alert(c[this.isSubmit],"操作成功",{confirmButtonText:"确定",customClass:"successPrompt",callback:e=>{this.$router.push({path:"/MarketingPlanning/MarketingMP"})}})}catch(u){}}})})),showMpDialog(e){this.$forceUpdate();for(let t=0;t<this.ActiveNodeList.length;t++)for(let e=0;e<this.ActiveNodeList[t].length;e++)if(""===this.ActiveNodeList[t][e].content)return void this.$alert("请完善节点信息！","配置失败",{confirmButtonText:"确定",customClass:"errorPrompt"});this.isSubmit=e,this.getOptionData(),1===this.isSubmit&&this.getTemlate(),this.visible=!0},timeSet(e){var t,a=e.replace(/-/g,"/"),i=new Date(a),r=i.getFullYear()+"-",l=(i.getMonth()+1<10?"0"+(i.getMonth()+1):i.getMonth()+1)+"-",s=(i.getDate()<10?"0"+i.getDate():i.getDate())+"  ",o="23:",n="59:",c=59;return t=r+l+s+o+n+c,t}}},b=C,f=(a("297b"),a("2877")),g=Object(f["a"])(b,i,r,!1,null,"7d81ee1b",null);t["a"]=g.exports},afa6:function(e,t,a){"use strict";a("ac9f")},b132:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"Dialog-center"},[t("transition",{attrs:{name:"slide-fade"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"Dialog",style:`width:${e.width};`},[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("div",{staticClass:"TitleArea"},[e.TabsNav.data.length>0?t("div",[t("tabs-nav",{attrs:{TabsNav:e.TabsNav.data,active:e.TabsNav.default},on:{"tabs-click":e.TabsClick}})],1):e._e(),e.isReturn?t("div",{staticClass:"Return-Button"},[t("el-button",{attrs:{type:"text",icon:"el-icon-arrow-left",size:"medium"},on:{click:function(t){return e.DialogRetrun(t)}}},[e._v("返回")])],1):e._e(),""!=e.title?t("span",[e._v(" "+e._s(e.title)+" ")]):e._e()]),t("div",[e.isClose?t("el-button",{staticStyle:{"font-size":"20px"},attrs:{type:"text",icon:"el-icon-close"},on:{click:e.DialogClock}}):e._e()],1)]),t("div",{staticClass:"cs"},[e._t("Dialogcontent")],2),e.IsAscertain?t("div",{staticClass:"UnifiedDete"},[t("el-button",{attrs:{type:"success"}},[e._v("确定")])],1):e._e()])],1)]),e.visible?t("div",{staticClass:"mask",attrs:{size:"medium"},on:{click:e.DialogClock}}):e._e()],1)},r=[],l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"TabsNav"},[t("ul",e._l(e.TabsNav,(function(a){return t("li",{key:a.id,class:a.id==e.activeIndex?"b":"",on:{click:function(t){return e.TabsClick(a)}}},[e._v(" "+e._s(a.label)+" ")])})),0)])},s=[],o={name:"TabsNavs",props:{TabsNav:{type:Array,default:()=>[]},active:{type:String,default:()=>""}},watch:{active:function(e,t){this.activeIndex=this.active}},data(){return{activeIndex:this.active}},methods:{TabsClick(e){this.activeIndex=e.id,this.$emit("tabs-click",e)}}},n=o,c=(a("da3c"),a("2877")),m=Object(c["a"])(n,l,s,!1,null,"61533993",null),u=m.exports,d={name:"MpDialog",components:{TabsNav:u},props:{visible:{type:Boolean},isClose:{type:Boolean,default:()=>!0},title:{type:String,default:()=>""},width:{type:String,default:()=>"808px"},isReturn:{type:Boolean,default:()=>!1},IsAscertain:{type:Boolean,default:()=>!0},TabsNav:{type:Object,default:()=>({data:[],default:null})}},data(){return{}},methods:{DialogClock(){this.$emit("update:visible",!1),this.$emit("DialogClose")},DialogRetrun(e){this.$emit("dialog-retrun",e)},TabsClick(e){this.$emit("tabs-click",e)}}},h=d,p=(a("cbd2"),a("3dd3"),a("673f"),a("c4a0"),Object(c["a"])(h,i,r,!1,null,"74578806",null));t["a"]=p.exports},b1d2a:function(e,t,a){},b1d3:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALgAAAD2CAMAAABSv73pAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAACalBMVEUAAABrbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG5rbG4AAACmE6HhAAAAzHRSTlMABSNUmPAeLPIlBHct5jU/SFNfTEBreAmFAJQBowOEswZQwwlF1Q075xIy+RcqHSMkHCwW9TQR4j4M0UcIv1IFr10Dn2oBkHYAgoQAdZIBaKEDXLEFUcIJRtMNPOURM/gXKx0jJB0rFvc0EeQ9DNJGCMFRBbFcA6FoAZJ1AISDAHaRAWmgA12vBVLACEfRDD3jETT2FiwcJCMdKhf5MxLmPA3URQnDUAayWwOiZ2wBk3QZxAEAhYEDfgV3y9m41mkC1CBiRxGqLWKrCQmv49X6AAAAAWJLR0QAiAUdSAAAAAlwSFlzAAAA/AAAAPwARztR4QAAA1xJREFUeNrt1WVz20AUheETql27KTllZmZmZmZmZmZmZmZmZmZu90e1ycS9bmNPM65k752c96tmr56RdiWAMcYYYzmvhMSk5BTjVrlcc3u8rqEzyu0O2+d3l/2rPK64U113G5PXBbj7zzu9fI67PTFxG5PfYXeCy+dSKuAsPDFWbmMKOgpPCo4NOPwqM0r7Q17IydHJbrr/gpvCDo4O/i+LxAJuihZzbHRwpCvuLHBTvIRSuClZShW8tMjLlNUETysn8vIVNMFRUeSVKmuCo4rIq1bTBEd1kdeoqQmOWiEfl9qa4KgTIq+rCY56IfL6muBo0FDkjTTB0biJyJtqgqNZc5G30ARHy1Yib60JjjZtRd5OExztO4i8oyY4OnUWeRdNcHTtJvLuPRTBgZ4i79VbExx9RN63nyY4+ot8wEBNcAwS+eAhmuAYKvJhwzXBMULkI0dpgmO0yMeM1QTHOJGb8ZrgmBAin6gJjkkh8sma4JgyVeTTNMExfYbIZ2qCY9Zskc/RBMfceSKfrwmOBQtFvkgTHIuXiHypJjiWLRf5Ck1wrFwl8tVrFMGBtSJft14THBtEvnGTJjg2i3zLVk1wbBP59h2a4Ngp8l27NcGxR+R792mCY7/IDxzUBMchkZvDmuA4EiI/qgmOYyHy45rgOHFS5Kc0wXH6jMjPaoLj3HmRX9AEx8VLIr+sCY4rV0V+TRMc12+I/Gbc4LeiWHv7jsjvxhp+L3P6/QdRLH74SOSPYwx/Ehz/9Fk0y5+LPMZwvPh955evouh13OBvjEPFGv72nVI43muF44NWOD5qhePTZ6Vw4MvXbzrh/xPhhBNuaYQTTrilEU444ZZGOOGEWxrhhBNuaYQTTrilEU444ZZGOOGEWxrhhBNuaYQTTrilEU444ZZGOOGEWxrhhBNuaYQTTrilEU444ZZGOOGEWxrhhBNuaYQTTrilEU444ZZGOOGEWxrhhBNuaYQTTrilEU444ZZGOOGEWxrhhBNuaYQTTrilEU444ZZGOOE5FZ6SeeF7vIER+hEJnpx5IRBvYYQCkeBJxmp5IOJWTjQ6ygJP8MablK28WV+GJ96mbOUJs4388UZlI3+4/e9LjTfrn6X6wp5cn+3P3B/enb7PbT6hXg8YY4wxltP6CRgictp+5LVmAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE2LTAxLTA4VDAwOjU5OjI3KzA4OjAwYw2MzAAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNi0wMS0wOFQwMDo1OToyNyswODowMBJQNHAAAABjdEVYdHN2Zzpjb21tZW50ACBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE3LjAuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIG+eZkEAAAAYdEVYdHN2Zzp0aXRsZQBEb2N1bWVudC1lbXB0ed4yOrcAAAAASUVORK5CYII="},b2cc:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"channelBaseDialog"},[t("mp-dialog",{attrs:{title:"策略基本信息配置",visible:e.visible,width:"700px",IsAscertain:!1},on:{"update:visible":function(t){e.visible=t},DialogClose:e.DialogClose}},[e.visible?t("div",{attrs:{slot:"Dialogcontent"},slot:"Dialogcontent"},[t("span",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[e._v(e._s(e.allChannelList)+"别删这行代码")]),t("el-form",{ref:"baseFrom",staticClass:"base-form",attrs:{"label-width":"110px",model:e.baseFrom,rules:e.baseFromRules}},[t("el-form-item",{attrs:{label:"策略名称:",prop:"campsegName"}},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],model:{value:e.baseFrom.campsegName,callback:function(t){e.$set(e.baseFrom,"campsegName",t)},expression:"baseFrom.campsegName"}})],1),1==e.custgroupSource?t("el-form-item",{attrs:{label:"执行周期:",prop:"dnaUpdateCycle"}},[t("el-radio-group",{model:{value:e.baseFrom.dnaUpdateCycle,callback:function(t){e.$set(e.baseFrom,"dnaUpdateCycle",t)},expression:"baseFrom.dnaUpdateCycle"}},[t("el-radio",{attrs:{label:1}},[e._v("一次性")]),t("el-radio",{attrs:{label:3}},[e._v("日周期")]),t("el-radio",{attrs:{label:2}},[e._v("月周期")])],1)],1):e._e(),t("el-form-item",{attrs:{label:"投放周期:",prop:"dateList"}},[t("el-date-picker",{attrs:{type:"daterange","value-format":"yyyy-MM-dd HH:mm:ss",format:"yyyy-MM-dd","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},on:{change:e.changeDate},model:{value:e.baseFrom.dateList,callback:function(t){e.$set(e.baseFrom,"dateList",t)},expression:"baseFrom.dateList"}})],1),t("el-form-item",{attrs:{label:"策略描述:",prop:"campsegDesc"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.baseFrom.campsegDesc,callback:function(t){e.$set(e.baseFrom,"campsegDesc",t)},expression:"baseFrom.campsegDesc"}})],1),t("el-form-item",{attrs:{label:"策略类型:",prop:"campsegTypeId"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.baseFrom.campsegTypeId,callback:function(t){e.$set(e.baseFrom,"campsegTypeId",t)},expression:"baseFrom.campsegTypeId"}},e._l(e.tacticsOption,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),t("el-form-item",{attrs:{label:"专题:"}},[t("el-select",{attrs:{placeholder:"请选择专题"},model:{value:e.baseFrom.topicId,callback:function(t){e.$set(e.baseFrom,"topicId",t)},expression:"baseFrom.topicId"}},e._l(e.topOption,(function(e){return t("el-option",{key:e.topicId,attrs:{label:e.topicName,value:e.topicId}})})),1)],1),t("el-form-item",{attrs:{label:"场景:",prop:"campScene"}},[t("SceneSelect",{attrs:{baseForm:e.baseFrom}})],1),t("el-form-item",{attrs:{label:"营销模板:"}},[t("el-select",{attrs:{placeholder:"请选择营销模板",clearable:""},model:{value:e.baseFrom.activityTemplateId,callback:function(t){e.$set(e.baseFrom,"activityTemplateId",t)},expression:"baseFrom.activityTemplateId"}},e._l(e.iopTempOption,(function(e){return t("el-option",{key:e.ACTIVITY_TEMPLATE_ID,attrs:{label:e.ACTIVITY_NAME,value:e.ACTIVITY_TEMPLATE_ID}})})),1)],1),t("el-form-item",{attrs:{label:"活动类型:",prop:"activityType"}},[t("el-select",{attrs:{placeholder:"请选择活动类型"},model:{value:e.baseFrom.activityType,callback:function(t){e.$set(e.baseFrom,"activityType",t)},expression:"baseFrom.activityType"}},e._l(e.typeOption,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),t("el-form-item",{attrs:{label:"活动目的:",prop:"activityObjective"}},[t("el-select",{attrs:{placeholder:"请选择营销活动目标"},model:{value:e.baseFrom.activityObjective,callback:function(t){e.$set(e.baseFrom,"activityObjective",t)},expression:"baseFrom.activityObjective"}},e._l(e.targetOption,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),e.approve?e._l(e.nextNodesList.nextNodesApprover,(function(a,i){return t("el-form-item",{key:i,attrs:{label:a.node.nodeName,rules:{required:!0,message:"审批人不能为空",trigger:"blur"},prop:"nextNodesList["+i+"].value"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.clone},model:{value:e.baseFrom.nextNodesList[i].value,callback:function(t){e.$set(e.baseFrom.nextNodesList[i],"value",t)},expression:"baseFrom.nextNodesList[index].value"}},e._l(a.approverUser,(function(e,a){return t("el-option",{key:a,attrs:{label:e.userName,value:e.userId}})})),1)],1)})):e._e(),e.approve?e._e():t("el-form-item",{attrs:{label:"策略预演：",prop:"previewCamp"}},[t("el-select",{attrs:{placeholder:"请选择",disabled:!e.previewBtnFlag},model:{value:e.baseFrom.previewCamp,callback:function(t){e.$set(e.baseFrom,"previewCamp",t)},expression:"baseFrom.previewCamp"}},e._l(e.rehearsalList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"敏感用户群：",prop:"sensitiveCustIdList"}},[t("el-select",{attrs:{placeholder:"请选择",multiple:"","collapse-tags":""},model:{value:e.baseFrom.sensitiveCustIdList,callback:function(t){e.$set(e.baseFrom,"sensitiveCustIdList",t)},expression:"baseFrom.sensitiveCustIdList"}},e._l(e.userGroups,(function(e){return t("el-option",{key:e.enumId,attrs:{label:e.enumValue,value:e.enumId}})})),1)],1)],2),t("div",{staticStyle:{"text-align":"center"}},[e.approve?t("el-button",{attrs:{loading:e.saveLoading,type:"success",size:"medium"},on:{click:function(t){return e.sumbit("1")}}},[e._v("提交审批")]):[t("el-button",{attrs:{loading:e.saveLoading&&e.previewFlag,type:e.previewCampColor,size:"medium",disabled:!e.previewFlag},on:{click:function(t){return e.sumbit("0")}}},[e._v("保存并预演")]),t("el-button",{attrs:{loading:e.saveLoading,type:e.submitColor,size:"medium",disabled:e.previewFlag},on:{click:function(t){return e.sumbit("0")}}},[e._v("保存")])]],2)],1):e._e()])],1)},r=[],l=(a("14d9"),a("0fea")),s=a("b132"),o=a("2f62"),n=a("eced"),c=a("31b1"),m=a("5e05"),u=a("d370"),d=a("d39c"),h=a("5310");const p=m["a"].common.getSysEnum,v=c["a"].channel.getTemplateData;var C={name:"channelBaseDialog",components:{MpDialog:s["a"],SceneSelect:h["a"]},props:{baseCampInfo:{type:Object,default:()=>({})},childrenSchemes:{type:Array,default:()=>[]},approve:{type:Boolean,default:()=>!1}},data(){return{saveLoading:!1,previewBtnFlag:!0,submitColor:"",previewCampColor:"",rehearsalList:[{value:"1",label:"预演"},{value:"2",label:"批量预演"},{value:"0",label:"不预演"}],tacticsOption:[],sceneList:[],userGroups:[],visible:!1,typeOption:[],checked:"",targetOption:[],baseFrom:{campsegName:"",dnaUpdateCycle:null,dateList:[],processNum:1,previewCamp:"",sensitiveCustIds:null,sensitiveCustIdList:[],campScene:""},baseFromRules:{campsegTypeId:[{required:!0,message:"请选择策略类型",trigger:"blur"}],campsegName:[{required:!0,message:"请输入策略名称",trigger:"blur"}],dnaUpdateCycle:[{required:!0,message:"请选择执行周期",trigger:"blur"}],dateList:[{required:!0,message:"请选择投放周期",trigger:"blur"}],campsegDesc:[{required:!0,message:"请输入策略描述",trigger:"blur"}],campScene:[{required:!0,message:"请选择场景",trigger:"blur"}],activityType:[{required:!0,message:"请选择营销类型",trigger:"blur"}],activityObjective:[{required:!0,message:"请选择营销目标",trigger:"blur"}],previewCamp:[{required:!0,message:"请选择是否预演",trigger:"blur"}]},ProcessItemList:[],iopTempOption:[],topOption:[],approverList:[],approveUserId:{},campInfoBO:{},processNumList:[],nextNodesList:{},TemplateData:{},ApproverUser:[],isSubmit:0,pickerOptions:{disabledDate(e){return e.getTime()<Date.now()-864e5}},channelList:[],ifHave9330102:!1}},computed:{...Object(o["b"])("MarkPl",["getNodeDataId","getNodeFirstChannelData","getNodeDataIdObj"]),ActiveNodeList:function(){return this.$store.state.MarkPl.ActiveNodeList},SceneNodeData:function(){return this.$store.state.MarkPl.SceneNodeData},processData(){return this.$store.state.MarkPl.ProcessData},custgroupSource(){return this.$store.state.extendData.custgroupSource},allChannelList(){const e=[];if(this.SceneNodeData.forEach(t=>{const a=t.find(e=>"channelDialog"===e.assembly);a&&a.NodeObj.forEach(t=>{e.some(e=>e.channelId===t.channelId)||e.push(t)})}),e.some(e=>"933"===e.channelId)){const t=e.find(e=>"933"===e.channelId)||{};"9330102"===t.adivInfo.adivId&&(this.ifHave9330102=!0)}return e},previewFlag(){if(this.previewBtnFlag=!0,1==this.channelList.length&&"957"==this.channelList[0].channelId){var e,t;let a=null===(e=this.typeOption.find(e=>e.enumKey==this.baseFrom.activityType))||void 0===e?void 0:e.enumValue,i=null===(t=this.targetOption.find(e=>e.enumKey==this.baseFrom.activityObjective))||void 0===t?void 0:t.enumValue;return"非营销类"==a&&"非营销类"==i||"9"==this.baseFrom.activityType&&"8"==this.baseFrom.activityObjective?(this.previewBtnFlag=!0,"1"==this.baseFrom.previewCamp?(this.previewCampColor="success",this.submitColor="info",!0):(this.previewCampColor="info",this.submitColor="success",!1)):(this.previewBtnFlag=!1,this.baseFrom.previewCamp="1",this.previewCampColor="success",this.submitColor="info",!0)}const a=["802","811"];return this.channelList.every(e=>a.includes(e.channelId))&&"1"==this.baseFrom.campsegTypeId||this.channelList.some(e=>3==e.previewStatus)?(this.previewBtnFlag=!1,this.baseFrom.previewCamp="1",this.previewCampColor="success",this.submitColor="info",!0):this.channelList.some(e=>a.includes(e.channelId))?"1"==this.baseFrom.campsegTypeId?(this.previewBtnFlag=!1,this.baseFrom.previewCamp="1",this.previewCampColor="success",this.submitColor="info",!0):(this.previewBtnFlag=!0,"1"==this.baseFrom.previewCamp?(this.previewCampColor="success",this.submitColor="info",!0):(this.previewCampColor="info",this.submitColor="success",!1)):this.channelList.every(e=>2==e.previewStatus)?(this.previewBtnFlag=!1,this.baseFrom.previewCamp="0",this.previewCampColor="info",this.submitColor="success",!1):(this.channelList.some(e=>1==e.previewStatus),"1"===this.baseFrom.previewCamp?(this.previewCampColor="success",this.submitColor="info",!0):(this.previewCampColor="info",this.submitColor="success",!1))}},methods:{async getChannelList(){var e;let t=null===(e=this.SceneNodeData[0][2])||void 0===e?void 0:e.NodeObj.map(e=>e.channelId);try{let e=t.map(e=>Object(l["i"])(d["a"].seapi.queryDimChannelInfo,{channelId:e})),a=await Promise.all(e);this.channelList=a}catch(a){}},changeDate(e){var t,a;if(null==e)return;let i,r,l=null===(t=this.SceneNodeData[0][1])||void 0===t||null===(t=t.NodeObj[0])||void 0===t?void 0:t.failTime,s=null===(a=this.SceneNodeData[0][0])||void 0===a||null===(a=a.NodeObj[0])||void 0===a?void 0:a.planEndDate;new Date(l).getTime()>new Date(s).getTime()?(i=s,r=`活动结束日期大于产品失效日期(${i})，请修改活动结束时间`):(i=l,r=`活动结束日期大于客户群失效日期(${i})，请修改活动结束时间`);let o=new Date(i).getTime(),n=new Date(e[1]).getTime();n>o&&(this.$message.error(r),this.baseFrom.dateList=[])},clone(){this.baseFrom=Object.assign({},this.baseFrom)},getTemlate(){if("approveFlowId"in this.baseFrom&&null!==this.baseFrom.approveFlowId){var e={approveFlowId:this.baseFrom.approveFlowId};this.getNextApprovers(e)}else Object(l["i"])(v).then(e=>{this.TemplateData=e,this.getNextApprovers(e)})},getSelectList(){Object(l["i"])(p,{enumType:"camp_type_list"}).then(e=>{this.tacticsOption=e}),Object(l["i"])(p,{enumType:"camp_special_topic"}).then(e=>{this.specialList=e}),Object(l["i"])(p,{enumType:"camp_scene"}).then(e=>{this.sceneList=e}),Object(l["i"])(p,{enumType:"activity_type"}).then(e=>{this.typeOption=e}),Object(l["i"])(p,{enumType:"activity_objective"}).then(e=>{this.targetOption=e}),Object(l["i"])(p,{enumType:"camp_sensitive_cust_list"}).then(e=>{this.userGroups=e})},async getNextApprovers(e){var t=this.getNodeFirstChannelData("3"),a=this.getNodeDataIdObj(t.id),i=[];a.map(e=>{i.push(e.channelId)});var r={berv:e.berv,instanceId:e.approveFlowId,nodeId:"",processId:e.processId,triggerParm:{channelId:i.join(",")}};await Object(l["i"])(c["a"].channel.getNextApprovers,r).then(e=>{this.baseFrom.nextNodesList=[],e.nextNodesApprover.map(e=>{var t;this.baseFrom.nextNodesList.push({value:(null===(t=e.approverUser[0])||void 0===t?void 0:t.userId)||""})}),this.nextNodesList=e})},getOptionData(){let e=JSON.parse(JSON.stringify(this.SceneNodeData)),t=e[0].filter(e=>"1"===e.cId)[0].NodeObj.filter(e=>"product"===e.flag);var a;(e[0][0].NodeObj=t,this.processNumList=Object(n["g"])(e),"{}"!==JSON.stringify(this.baseCampInfo))?(this.baseFrom={...this.baseFrom,...this.baseCampInfo,campsegTypeId:this.baseCampInfo.campsegTypeId.toString()},(null===(a=this.baseCampInfo.sensitiveCustIds)||void 0===a?void 0:a.length)>0&&(this.baseFrom.sensitiveCustIdList=this.baseCampInfo.sensitiveCustIds.split(",")),this.baseFrom.dateList=[this.baseCampInfo.startDate,this.baseCampInfo.endDate],this.childrenSchemes.length!==this.processNumList.length&&(this.baseFrom.processNum=2),this.childrenSchemes.map(e=>{this.processNumList.map(t=>{e.data.join(",")===t.data.join(",")&&(t.checked=!0,t.campsegId=e.campsegId)})})):this.intiCampInfo()},ChangeProcessNum(){this.baseFrom.processNum=JSON.parse(JSON.stringify(this.baseFrom.processNum))},intiCampInfo(){var e=new Date(+new Date+288e5).toJSON().substr(0,19).replace("T"," ");this.baseFrom.campsegName="营销策略"+e},changeAppId(){this.approverList.forEach(e=>{(this.baseFrom.approveId=e.userId)&&(this.approveUserId.userId=e.userId,this.approveUserId.userName=e.userName)})},getIopTemp(){Object(l["i"])(u["a"].mpapi.queryIopTemplateSaveUse).then(e=>{this.iopTempOption=e})},DialogClose(){this.$emit("DialogClose")},sumbit(e){if(!(this.channelList.some(e=>"933"==e.channelId)&&this.baseFrom.campsegName.length>50))return this.ifHave9330102&&this.baseFrom.campsegName.length>20?this.$message.error("当前策略包含星火推荐营销运营位，策略名称不得超过20个字！"):void this.$refs.baseFrom.validate(async t=>{if(t){var a=JSON.parse(JSON.stringify(this.baseFrom));a.startDate=this.baseFrom.dateList[0],a.endDate=this.timeSet(this.baseFrom.dateList[1]);var i=JSON.parse(JSON.stringify(this.ActiveNodeList));a.tacticsMap=JSON.stringify(Object(n["l"])(i)),a.sensitiveCustIds=this.baseFrom.sensitiveCustIdList.join(","),a.custgroupSource=this.custgroupSource,a.dnaUpdateCycle=1==this.custgroupSource?this.baseFrom.dnaUpdateCycle:null,delete a.sensitiveCustIdList;var r={};if("1"===e){a.previewCamp="";var s=[];this.nextNodesList.nextNodesApprover.filter((e,t)=>{var a=this.baseFrom.nextNodesList[t],i=[];e.approverUser.map(e=>{Array.isArray(a.value)?a.value.map(t=>{t===e.userId&&i.push(e)}):a.value===e.userId&&i.push(e)}),s.push({approverUser:i,node:e.node})}),r={nodeId:this.nextNodesList.nodeId,processId:this.nextNodesList.processId,berv:this.nextNodesList.berv,submitStatus:1,instanceId:this.baseFrom.approveFlowId,nextNodesApprover:s},41==a.campsegStatId&&(a.campsegStatId=40)}var o=Object(n["k"])(this.SceneNodeData);let t=[],p=[];for(let e=0;e<o.length;e++){let a=o[e],i={campExclusivePlan:[],campFusionPlans:[],campSeriesPlan:[],planId:"",planName:""};a.product.forEach(e=>{"mutual"===e.flag?i.campExclusivePlan.push(e):"homologous"===e.flag?i.campSeriesPlan.push(e):"fuse"===e.flag?i.campFusionPlans.push(e):"product"===e.flag&&(i.planName=e.planName,i.planId=e.planId)}),p.push(i);a.product.filter(e=>"mutual"!==e.flag);const r=a.channels.map(t=>{let a={};return t.hasOwnProperty("columnExt1")&&t.hasOwnProperty("columnExt2")?a={...t,channelId:t.channelId,channelName:t.channelName,adivInfo:t.adivInfo.adivId?t.adivInfo:{adivId:t.channelId+"1",adivName:t.channelName+"默认运营位"},channelConf:{execContent:t.marketingWords||t.EXEC_CONTENT||t.execContent||t.SMS_CONTENT,ifHaveVar:t.IF_HAVE_VAR-0,frequency:t.FREQUENCY?t.FREQUENCY.toString()+"_"+t.num:"",updateCycle:1==o[0]["customer"][0].updateCycle?1:0,cepEventId:t.CEP_EVENT_ID,cepSceneName:t.CEP_SCENE_NAME,channelAdivId:t.channelAdivId,wavesChannelPid:t.channelConf.wavesChannelPid,wavesRuleId:0===e?null:t.channelConf.wavesRuleId,wavesNo:t.channelConf.wavesRuleId,wavesNoDesc:t.channelConf.wavesNoDesc,channelExtConf:{columnExt1:t.columnExt1,columnExt2:t.columnExt2,columnExt3:t.columnExt3,columnExt4:t.columnExt4,columnExt5:t.columnExt5,columnExt6:t.columnExt6,columnExt7:t.columnExt7,columnExt8:t.columnExt8,columnExt9:t.columnExt9,columnExt10:t.columnExt10,columnExt11:t.columnExt11,columnExt12:t.columnExt12,columnExt13:t.columnExt13,columnExt14:t.columnExt14,columnExt15:t.columnExt15,columnExt16:t.columnExt16,columnExt17:t.columnExt17,columnExt18:t.columnExt18,columnExt19:t.columnExt19,columnExt20:t.columnExt20}}}:(a={...t},0===e&&(a.channelConf.wavesRuleId=null)),a});let l=a.product.filter(e=>"product"===e.flag);t.push({channels:r,customer:a.customer,product:l})}var c=[];NodeList=this.processNumList,NodeList.map((e,t)=>{e.data[3]||(e.data[3]=e.data[2]+"1"),c.push({data:e.data,wavePid:0===t?null:e.wavePid,wavesRuleId:0===t?null:e.wavesRuleId})});var m={baseCampInfo:a,approveUserId:r,campSchemes:t,childrenSchemes:c,planExtInfoList:p,type:this.processData.example_type,isSubmit:e};if("4"===this.processData.example_type)this.$emit("save",m);else{var d=["策划保存草稿成功","策划提交审批成功"];try{this.saveLoading=!0;const e=await Object(l["i"])(u["a"].mpapi.tacticsCreateSave,m);if("ERROR"===(null===e||void 0===e?void 0:e.status))return this.$alert(e.message,"操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"});this.$alert(d[this.isSubmit],"操作成功",{confirmButtonText:"确定",customClass:"successPrompt",callback:e=>{this.$router.push({path:"/MarketingPlanning/MarketingMP"})}})}catch(h){}finally{this.saveLoading=!1}}}});this.$message.error("当前策略包含企业微信渠道，策略名称不得超过50个字！")},showMpDialog(e){this.$forceUpdate();for(let t=0;t<this.SceneNodeData.length;t++)for(let e=0;e<this.SceneNodeData[t].length;e++)if(0==this.SceneNodeData[t][e].NodeObj.length)return this.$alert("请完善节点信息！","配置失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),this.DialogClose();this.isSubmit=e,this.getChannelList(),this.getOptionData(),this.getSelectList(),this.getTemlate(),this.getIopTemp(),this.visible=!0},timeSet(e){var t,a=e.replace(/-/g,"/"),i=new Date(a),r=i.getFullYear()+"-",l=(i.getMonth()+1<10?"0"+(i.getMonth()+1):i.getMonth()+1)+"-",s=(i.getDate()<10?"0"+i.getDate():i.getDate())+"  ",o="23:",n="59:",c=59;return t=r+l+s+o+n+c,t}}},b=C,f=(a("abbae"),a("2877")),g=Object(f["a"])(b,i,r,!1,null,"56ce0327",null);t["a"]=g.exports},b4c7:function(e,t,a){"use strict";a("863d")},b54e:function(e,t,a){"use strict";a("f8fd")},b605:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("Tips",{attrs:{id:e.id}}),t("el-form",{ref:"CrmFrom",attrs:{"label-width":"145px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"推送方式：",prop:"columnExt1"}},[t("el-radio-group",{model:{value:e.CrmFrom.columnExt1,callback:function(t){e.$set(e.CrmFrom,"columnExt1",t)},expression:"CrmFrom.columnExt1"}},[t("el-radio",{attrs:{label:"1",disabled:!e.CrmFrom.channelFlag}},[e._v("全量推送")]),t("el-radio",{attrs:{label:"0",disabled:!e.CrmFrom.channelFlag}},[e._v("偏好推送")])],1)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"应用号：",prop:"columnExt5"}},[t("el-select",{attrs:{placeholder:"请选择应用号"},model:{value:e.CrmFrom.columnExt5,callback:function(t){e.$set(e.CrmFrom,"columnExt5",t)},expression:"CrmFrom.columnExt5"}},e._l(e.ApplicationNumList,(function(e){return t("el-option",{key:e.applicationId,attrs:{label:e.applicationName,value:e.applicationId}})})),1)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"模板ID：",prop:"columnExt6"}},[t("el-input",{attrs:{type:"text","show-word-limit":"",placeholder:"请输入模板ID"},model:{value:e.CrmFrom.columnExt6,callback:function(t){e.$set(e.CrmFrom,"columnExt6",t)},expression:"CrmFrom.columnExt6"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"发送参数类型：",prop:"columnExt7"}},[t("el-select",{attrs:{placeholder:"请选择发送参数类型"},on:{change:e.changeSendParams},model:{value:e.CrmFrom.columnExt7,callback:function(t){e.$set(e.CrmFrom,"columnExt7",t)},expression:"CrmFrom.columnExt7"}},e._l(e.sendParamsList,(function(e){return t("el-option",{key:e.enumId,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1)],1),t("el-col",{attrs:{span:24}},[1!=e.custgroupSource||1!=e.CrmFrom.columnExt7&&2!=e.CrmFrom.columnExt7?e._e():t("el-form-item",{attrs:{label:1==e.CrmFrom.columnExt7?"个性变量：":"通用变量：",prop:"columnExt8"}},[t("div",{staticClass:"tag1"},[t("div",[0===e.varList.length?t("div",{staticClass:"placeholder"},[e._v("请添加变量")]):e._e(),e._l(e.varList,(function(a,i){return t("el-tag",{key:a.varValue,attrs:{type:"success",closable:""},on:{close:function(t){return e.removeVar(i)}}},[e._v(" "+e._s(a.varName)+" ")])}))],2),t("div",{staticClass:"varList"},[t("DNAReplaceVar",{on:{getVar:e.addVar}})],1)])])],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"营销类型：",prop:"saleType"}},[t("el-select",{attrs:{placeholder:"请选择营销类型"},on:{change:e.changeSaleType},model:{value:e.CrmFrom.saleType,callback:function(t){e.$set(e.CrmFrom,"saleType",t)},expression:"CrmFrom.saleType"}},e._l(e.saleList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),"1"==e.CrmFrom.saleType?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"复杂事件场景：",prop:"CEP_EVENT_ID"}},[t("div",[t("div",{staticStyle:{display:"flex","justify-content":"space-between","max-width":"375px"}},[t("div",{staticClass:"add-botton"},[t("span",{on:{click:function(t){return e.openSceneDilog(!0)}}},[e._v(e._s(e.CrmFrom.sceneParams.eventName||"添加"))]),t("i",{directives:[{name:"show",rawName:"v-show",value:e.CrmFrom.sceneParams.eventName,expression:"CrmFrom.sceneParams.eventName"}],staticClass:"el-icon-close",on:{click:e.removeEvent}})]),t("el-checkbox",{model:{value:e.CrmFrom.checked,callback:function(t){e.$set(e.CrmFrom,"checked",t)},expression:"CrmFrom.checked"}},[e._v("取消推荐规则设置")])],1),"JX0000000001"===e.customGroupId?t("div",{staticStyle:{color:"red","font-size":"12px"}},[e._v("该活动没有限定客群，触发事件即发送，请慎重选择事件！")]):e._e(),e.CrmFrom.checked?t("div",{staticClass:"select"},[t("div",{staticClass:"setRules"},[t("p",[e._v("已选择事件："+e._s(e.CrmFrom.sceneParams.eventName))])]),t("div",[t("span",[e._v("取消推荐时间：")]),t("el-select",{attrs:{placeholder:"请选择执行端口",size:"mini"},model:{value:e.CrmFrom.columnExt4,callback:function(t){e.$set(e.CrmFrom,"columnExt4",t)},expression:"CrmFrom.columnExt4"}},e._l(e.columnExt4List,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]):e._e()])])],1):e._e(),1!==e.updateCycle?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"频次配置：",prop:e.CrmFrom.FREQUENCY?"FREQUENCY":"num"}},[t("div",{staticStyle:{display:"flex"}},[t("el-select",{attrs:{placeholder:"请选择天数"},model:{value:e.CrmFrom.FREQUENCY,callback:function(t){e.$set(e.CrmFrom,"FREQUENCY",t)},expression:"CrmFrom.FREQUENCY"}},e._l(e.dateList,(function(e){return t("el-option",{key:e.cycleId,attrs:{label:e.cycleName,value:e.cycle}})})),1),t("el-input",{staticStyle:{width:"100px",margin:"0px 20px"},attrs:{type:"text",rows:8,placeholder:""},model:{value:e.CrmFrom.num,callback:function(t){e.$set(e.CrmFrom,"num",t)},expression:"CrmFrom.num"}}),e._v("次 ")],1)])],1):e._e()],1)],1),t("ComplexScene",{ref:"SceneDialog",on:{addScene:e.addScene}})],1)},r=[],l=(a("d9e2"),a("14d9"),a("0fea")),s=a("5e05"),o=a("b893"),n=(a("0b16"),a("aedd")),c=a("5ed5"),m=a("6501");const u=s["a"].common.getSysEnum;s["a"].common.queryAdivInfo,s["a"].common.queryHallInfo;var d={props:["channelNewData","id","deleteSub"],components:{ComplexScene:n["a"],Tips:c["a"],DNAReplaceVar:m["a"]},data(){return{CrmFrom:{channelId:"",channelName:"",attributionInfo:{},columnExt1:"1",standard:"",CustomerRules:"",marketingWords:"",FREQUENCY:"",num:"",CEP_EVENT_ID:"",CEP_SCENE_NAME:"",SMS_CONTENT:"",columnExt5:"",columnExt6:"",columnExt7:"",columnExt8:"",columnExt4:"7",columnExt2:"",IF_HAVE_VAR:"0",sceneParams:{eventName:""},checked:Boolean,channelAdivId:""},CrmFromRules:{columnExt1:[{required:!0,message:"请选择推送方式",trigger:"blur"}],marketingWords:[{required:!0,message:"请输入营销话术",trigger:"blur"}],CEP_EVENT_ID:[{required:!0,message:"请选择复杂事件场景",trigger:"blur"}],FREQUENCY:[{required:!0,message:"请选择频次配置",trigger:"blur"}],num:[{required:!0,message:"请填写次数",trigger:"blur"}],columnExt5:[{required:!0,message:"请选择应用号",trigger:"blur"}],columnExt6:[{required:!0,message:"请填写模板ID",trigger:"blur"}],columnExt7:[{required:!0,message:"请选择发送参数类型",trigger:"blur"}],columnExt8:[{required:!0,validator:(e,t,a)=>{0===t.length?a(new Error("请选择变量")):a()},trigger:"change"}],saleType:[{required:!0,message:"请选择营销类型",trigger:"blur"}],adivInfo:{adivId:[{required:!0,message:"请选择营销类型",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},timeIdList:[],adivList:[],attributionList:[],varList:[],showScene:!0,dateList:[],replaceVar:[],columnExt4List:[{label:"1天",value:"1"},{label:"2天",value:"2"},{label:"3天",value:"3"},{label:"4天",value:"4"},{label:"5天",value:"5"},{label:"6天",value:"6"},{label:"7天",value:"7"}],saleList:[{label:"实时营销",value:"1"},{label:"批量营销",value:"2"}],msgTypeList:[{label:"补发消息",value:"1"},{label:"追尾消息",value:"2"}],ShortMsgContent:"",ApplicationNumList:[],SysEnumList:[],sendParamsList:[]}},watch:{channelNewData:{handler(){this.CrmFrom=Object(o["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"columnExt4",this.CrmFrom.columnExt4||"7"),this.$set(this.CrmFrom,"sceneParams",this.CrmFrom.sceneParams||{eventName:""}),this.varList=JSON.parse(this.CrmFrom.columnExt8||"[]")},deep:!0},CrmFrom:{handler(e,t){},deep:!0},deleteSub(){},checked(e){this.CrmFrom=e?{...this.CrmFrom,columnExt3:"1"}:{...this.CrmFrom,columnExt3:"0"}},SMS_CONTENT(e){if(val){const e=/\$[a-zA-Z0-9_\u4e00-\u9fa5]+\$/g,t=val.match(e);t&&t.length>0?this.CrmFrom.IF_HAVE_VAR="1":this.CrmFrom.IF_HAVE_VAR="0"}else this.CrmFrom.IF_HAVE_VAR="0"}},computed:{updateCycle(){var e;return null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.updateCycle},customGroupId(){var e;return null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.customGroupId},SMS_CONTENT(){return this.CrmFrom.columnExt2},checked(){return this.CrmFrom.checked},custgroupSource(){return this.$store.state.extendData.custgroupSource}},created(){this.getOptionData(),this.getDateList(),this.getApplicationNumInfo(),this.CrmFrom=Object(o["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"columnExt4",this.CrmFrom.columnExt4||"7"),this.$set(this.CrmFrom,"sceneParams",this.CrmFrom.sceneParams||{eventName:"",eventId:""}),this.varList=JSON.parse(this.CrmFrom.columnExt8||"[]")},methods:{async getOptionData(){Object(l["i"])(u,{enumType:"iop_time_id"}).then(e=>{this.timeIdList=e}),Object(l["i"])(u,{enumType:"5g_cloud_send_param_type"}).then(e=>{this.sendParamsList=e})},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t||("906"===this.id||"922"===this.id)&&this.CrmFrom.marketingWords&&this.CrmFrom.adivInfo.adivId?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e},changeSaleType(e){this.removeEvent(),this.CrmFrom.checked=!1},openSceneDilog(e){this.$refs["SceneDialog"].showDialog(e)},addScene(e){this.CrmFrom={...this.CrmFrom,CEP_EVENT_ID:e.eventId,CEP_SCENE_NAME:e.eventName,sceneParams:e}},removeEvent(){this.CrmFrom.sceneParams={eventName:""},this.CrmFrom.CEP_EVENT_ID="",this.CrmFrom.CEP_SCENE_NAME=""},async getDateList(){await Object(l["i"])(s["a"].common.getDateList).then(e=>{this.dateList=e})},async listCustAttr(){var e;const t=null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.customGroupId;await Object(l["i"])(s["a"].common.listCustAttr+"?custGroupId="+t).then(e=>{this.replaceVar=e})},getContent(e){const t=this.replaceVar.filter(t=>t.id===e)[0].attrCol;this.ShortMsgContent=t;const a=document.querySelector("#smsDetail");if(a.selectionStart||0===a.selectionStart){var i=a.selectionStart,r=a.selectionEnd;this.CrmFrom={...this.CrmFrom,columnExt2:a.value.substring(0,i)+t+a.value.substring(r,a.value.length)},this.$nextTick(),a.focus(),a.setSelectionRange(r+t.length,r+t.length)}else this.CrmFrom.columnExt2+=t},async getApplicationNumInfo(){await Object(l["i"])(s["a"].common.getApplicationNumInfo,{channelId:this.id}).then(e=>{this.ApplicationNumList=e})},changeSendParams(e){this.CrmFrom.IF_HAVE_VAR="0"===e?"0":"1",this.varList=[],this.CrmFrom.columnExt8=""},addVar(e,t){if(this.varList.some(t=>t.varValue==e))return;const a={varName:t.fieldName,varValue:t.field};this.varList.push(a),this.CrmFrom.columnExt8=JSON.stringify(this.varList)},removeVar(e){this.varList.splice(e,1),this.CrmFrom.columnExt8=JSON.stringify(this.varList),0===this.varList.length&&(this.CrmFrom.columnExt8="")}}},h=d,p=(a("4239"),a("2877")),v=Object(p["a"])(h,i,r,!1,null,"0089cb57",null);t["a"]=v.exports},b625:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",[e.isImport?t("scene-creation",{attrs:{MultiwaveList:e.MultiwaveList,CampInfo:e.CampInfo},on:{goback:e.goback}}):e.isMultiActivities?t("multi-scene-creation",{attrs:{MultiwaveList:e.MultiwaveList,CampInfo:e.CampInfo},on:{goback:e.goback}}):t("scene-flow",{on:{SceneFlow:e.SceneFlow,goback:e.goback}})],1)},r=[],l=(a("14d9"),function(){var e=this,t=e._self._c;return t("div",{staticClass:"circuitIndex"},[t("div",{staticClass:"circuit-cont"},[t("div",{staticClass:"circuit-nav"},[t("div",[t("span",{staticClass:"fontReturn",on:{click:function(t){return e.$emit("goback")}}},[t("i",{staticClass:"iconfont icongonggongtubiao-fanhui"}),e._v("返回")]),t("span",{staticClass:"FontTitle",attrs:{id:"process-name"}},[e._v(e._s(this.MultiwaveList.name))])]),t("div",[t("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){return e.nodeSave(!1)}}},[e._v("保存")]),t("el-button",{attrs:{type:"success",size:"small"},on:{click:function(t){return e.nodeSave(!0)}}},[e._v("审批")])],1)]),t("div",{staticClass:"circuit-case"},[t("div",{staticClass:"circuitCase"},[t("active-node",{attrs:{ActiveNode:e.newActiveNodeList},on:{"Node-click":e.NodeClick}})],1),t("div",[e.Componentstate.productDialog?t("product-dialog",{ref:"productDialog",on:{DialogClose:e.DialogClose,"Node-click":e.NodeClick}}):e._e(),e.Componentstate.customerDialog?t("customer-dialog",{ref:"customerDialog",attrs:{baseCampInfo:e.baseCampInfo},on:{DialogClose:e.DialogClose}}):e._e(),e.Componentstate.channelDialog?t("channel-dialog",{ref:"channelDialog",on:{DialogClose:e.DialogClose,stratgeClose:e.stratgeClose}}):e._e(),e.Componentstate.multiwaveDdialog?t("multiwave-dialog",{ref:"multiwaveDdialog",on:{DialogClose:e.DialogClose}}):e._e(),e.chBaseDdialog?t("channel-base-dialog",{key:e.componentKey,ref:"chBaseDdialog",attrs:{baseCampInfo:e.baseCampInfo,childrenSchemes:e.childrenSchemes},on:{DialogClose:e.DialogClosebase}}):e._e(),t("StrategyInfo",{attrs:{drawer:e.drawer},on:{stratgeClose:e.stratgeClose}}),e.newBaseDialog?t("newChannelBaseDialog",{key:e.componentKey,ref:"newBaseDdialog",attrs:{approve:e.approveInfo,baseCampInfo:e.baseCampInfo,childrenSchemes:e.childrenSchemes},on:{DialogClose:e.newDialogCloseBase}}):e._e()],1)])])])}),s=[],o=a("2adc"),n=o["a"],c=(a("d5b0"),a("2877")),m=Object(c["a"])(n,l,s,!1,null,"7666a427",null),u=m.exports,d=function(){var e=this,t=e._self._c;return t("div",{staticClass:"circuitIndex"},[t("el-tabs",{attrs:{type:"card",closable:"","before-leave":e.beforeLeave},on:{"tab-remove":e.removeTab,"tab-click":e.TabClick},model:{value:e.editableTabsValue,callback:function(t){e.editableTabsValue=t},expression:"editableTabsValue"}},e._l(e.editableTabs,(function(e){return t("el-tab-pane",{key:e.id,attrs:{label:e.name,name:e.id}},[t("div",{staticClass:"TabPane"})])})),1),t("div",{staticClass:"circuit-cont"},[t("div",{staticClass:"circuit-nav"},[t("div",[t("span",{staticClass:"fontReturn",on:{click:function(t){return t.stopPropagation(),e.$emit("goback")}}},[t("i",{staticClass:"iconfont icongonggongtubiao-fanhui"}),e._v("返回")]),t("el-button",{attrs:{icon:"el-icon-plus",type:"success",size:"small"},on:{click:e.addActivity}},[e._v("新建活动")])],1),t("div",[t("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){return e.nodeSave(0)}}},[e._v("保存(子活动)")]),t("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){return e.multiactivity(0)}}},[e._v("保存")]),(e.MultiwaveList.example_type="4")?t("el-button",{attrs:{type:"success",size:"small"},on:{click:function(t){return e.multiactivity(1)}}},[e._v("审批")]):t("el-button",{attrs:{type:"success",size:"small"},on:{click:function(t){return e.nodeSave(1)}}},[e._v("审批")])],1)]),t("div",{staticClass:"circuit-case"},[t("div",{staticClass:"circuitCase"},[t("active-node",{attrs:{ActiveNode:e.ActiveNodeList},on:{"Node-click":e.NodeClick}})],1),t("div",[e.Componentstate.productDialog?t("product-dialog",{ref:"productDialog",on:{DialogClose:e.DialogClose}}):e._e(),e.Componentstate.customerDialog?t("customer-dialog",{ref:"customerDialog",on:{DialogClose:e.DialogClose}}):e._e(),e.Componentstate.channelDialog?t("channel-dialog",{ref:"channelDialog",on:{DialogClose:e.DialogClose}}):e._e(),e.Componentstate.multiwaveDdialog?t("multiwave-dialog",{ref:"multiwaveDdialog",on:{DialogClose:e.DialogClose}}):e._e(),e.chBaseDdialog?t("channel-base-dialog",{key:e.componentKey,ref:"chBaseDdialog",attrs:{baseCampInfo:e.baseCampInfo,childrenSchemes:e.childrenSchemes},on:{DialogClose:e.DialogClosebase,save:e.save}}):e._e(),e.activityDdialog?t("multi-activity-dialog",{key:e.componentKey,ref:"activityDdialog",attrs:{baseCampInfo:e.baseCampInfo,childrenSchemes:e.editableTabs},on:{DialogClose:e.DialogClosebase}}):e._e()],1)])])],1)},h=[],p=a("7550"),v=p["a"],C=(a("28e0"),Object(c["a"])(v,d,h,!1,null,"41bdccba",null)),b=C.exports,f=function(){var e=this,t=e._self._c;return t("div",{staticClass:"scene-create"},e._l(e.showLists,(function(a,i){return t("div",{key:i,staticClass:"process-item",on:{click:function(t){return e.jumpBtn(i)}}},[t("p",{staticClass:"process-item-header"},[t("i",{class:a.icon}),t("em",{attrs:{title:a.name}},[e._v(e._s(a.name>11?a.name.substr(0,11)+"...":a.name)+" ")])]),t("div",{staticClass:"process-item-cont",class:{big:a.length>4}},[t("div",{staticClass:"process-item-cont-tran"},e._l(a,(function(a,i){return t("ul",{key:i},e._l(a,(function(a,i){return t("li",{key:i,class:a.className},[e._v(" "+e._s(a.title)+" ")])})),0)})),0)])])})),0)},g=[],_=a("a078"),x={data(){return{dataLists:_["b"],showLists:[]}},created(){this.initExample()},methods:{lbNum2Str(e){const t=JSON.parse(e);for(const a in t)for(const e in t[a])t[a][e]+="";return t},initExample(){for(var e=0;e<this.dataLists.length;e++)if(this.dataLists[e].isOpenProcess){this.dataLists[e].name=this.dataLists[e].CAMPSEG_NAME,this.dataLists[e].content=this.lbNum2Str(this.dataLists[e].example_content);var t="other";t=-1!==this.dataLists[e].name.indexOf("用户群细分多产品流程")?"yonghuqun":-1!==this.dataLists[e].name.indexOf("分箱")?"fenxiang":-1!==this.dataLists[e].name.indexOf("用户")?"yonghu":-1!==this.dataLists[e].name.indexOf("多波次")?"duoboci":-1!==this.dataLists[e].name.indexOf("客户")?"yonghuqun":-1!==this.dataLists[e].name.indexOf("产品")||-1!==this.dataLists[e].name.indexOf("素材")?"sucai":-1!==this.dataLists[e].name.indexOf("5G消息")?"fivegmessage":"other",this.dataLists[e].icon=t}this.appendShowLists()},appendShowLists(){for(const e in this.dataLists){if(!this.dataLists[e].isOpenProcess)continue;const t=this.dataLists[e].content,a=[];for(const i in t){const r=[];for(const e in t[i]){let a="";t[i][e].length>1&&(a=" more");const l=t[i][e].slice(0,1);let s={};switch(l){case"0":s={id:0,title:"活动",className:"bluebox"+a};break;case"1":s={id:1,title:"产品",className:"bluebox"+a};break;case"2":s={id:2,title:"客户",className:"yellowbox"+a};break;case"3":s={id:3,title:"渠道",className:"greenbox"+a};break;case"5":s={id:5,title:"波次",className:"redbox"+a};break;case"6":s=t[i][e].length>1?{id:"6-"+e,title:"裂变",className:"greybox more"}:{id:6,title:"裂变客户群",className:"greybox jt3"};break;case"7":s={id:7,title:"5G消息",className:"fivegmessage"+a};break;case"8":s=t[i][e].length>1?{id:"8-"+e,title:"分箱"+(+e+1),className:"fenxiang more"}:{id:8,title:"客户分箱",className:"fenxiang jt3"};break}r.push(s)}a.push(r),a.name=this.dataLists[e].name,a.icon=this.dataLists[e].icon}this.showLists.push(a)}},jumpBtn(e){this.$emit("SceneFlow",this.dataLists[e])}}},E=x,y=(a("fb59"),Object(c["a"])(E,f,g,!1,null,"3594b092",null)),F=y.exports,I=a("0fea"),D=a("d370"),w={components:{SceneCreation:u,SceneFlow:F,multiSceneCreation:b},data(){return{isImport:!1,isMultiActivities:!1,MultiwaveList:{example_content:"[[1], [2], [3]]",name:"过来的内容"},CampInfo:{}}},mounted(){"campId"in this.$route.query&&this.getCampInfo()},methods:{async getCampInfo(){await Object(I["i"])(D["a"].mpapi.getCampInfo,{id:this.$route.query.campId}).then(e=>{this.MultiwaveList=this.initRelationshipItem(e.type),this.CampInfo=e,this.MultiwaveList.name=e.baseCampInfo.campsegName,this.$store.commit("MarkPl/fnProcessData",this.MultiwaveList),this.$store.commit("extendData/SET_CUSTGOUPSOURCE",e.baseCampInfo.custgroupSource||0),4!==e.type?this.isImport=!0:this.isMultiActivities=!0})},SceneFlow(e){e.isMultiActivities?this.isMultiActivities=!0:this.isImport=!0,this.MultiwaveList=e,this.$store.commit("MarkPl/fnProcessData",this.MultiwaveList)},initRelationshipItem(e){var t=_["b"].filter(t=>Number(t.example_type)===Number(e));return t[0]},goback(){"campId"in this.$route.query?this.$router.push("MarketingMP"):(this.isImport=!1,this.isMultiActivities=!1)}}},k=w,N=Object(c["a"])(k,i,r,!1,null,"7b833486",null);t["default"]=N.exports},b62e:function(e,t,a){"use strict";a("bb6e")},b953:function(e,t,a){"use strict";a("aa07")},bb6e:function(e,t,a){},bc05:function(e,t,a){"use strict";a("2d81")},bcd9:function(e,t,a){},be9a:function(e,t,a){"use strict";a("8b4b")},c0ec:function(e,t,a){"use strict";a("17e3")},c126:function(e,t,a){},c144:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("MpDialog",{attrs:{title:"策略基本信息配置",visible:e.drawer,width:"760px",IsAscertain:!1},on:{"update:visible":function(t){e.drawer=t},DialogClose:e.DialogClose}},[t("div",{staticClass:"content",attrs:{slot:"Dialogcontent"},slot:"Dialogcontent"},[t("el-form",{ref:"baseFrom",attrs:{"label-position":"'left'","label-width":"100px",model:e.baseFrom,rules:e.baseFromRules}},[t("el-form-item",{attrs:{label:"策略名称：",prop:"campsegName"}},[t("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入策略名称"},model:{value:e.baseFrom.campsegName,callback:function(t){e.$set(e.baseFrom,"campsegName",t)},expression:"baseFrom.campsegName"}})],1),t("el-form-item",{attrs:{label:"投放周期：",prop:"dateList"}},[t("el-date-picker",{staticStyle:{width:"300px"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.baseFrom.dateList,callback:function(t){e.$set(e.baseFrom,"dateList",t)},expression:"baseFrom.dateList"}})],1),t("el-form-item",{attrs:{label:"策略描述：",prop:"campsegDesc"}},[t("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入策略名称"},model:{value:e.baseFrom.campsegDesc,callback:function(t){e.$set(e.baseFrom,"campsegDesc",t)},expression:"baseFrom.campsegDesc"}})],1),t("el-form-item",{attrs:{label:"策略类型：",prop:"type"}},[t("el-select",{staticStyle:{width:"300px"},attrs:{placeholder:"请选择"},model:{value:e.baseFrom.type,callback:function(t){e.$set(e.baseFrom,"type",t)},expression:"baseFrom.type"}},e._l(e.typeOption,(function(e){return t("el-option",{key:e.enumId,attrs:{label:e.enumValue,value:e.enumId}})})),1)],1),t("el-form-item",{attrs:{label:"专题：",prop:"topicId"}},[t("el-select",{staticStyle:{width:"300px"},attrs:{placeholder:"请选择"},model:{value:e.baseFrom.topicId,callback:function(t){e.$set(e.baseFrom,"topicId",t)},expression:"baseFrom.topicId"}},e._l(e.specialList,(function(e){return t("el-option",{key:e.topicId,attrs:{label:e.topicName,value:e.topicId}})})),1)],1),t("el-form-item",{attrs:{label:"场景：",prop:"scene"}},[t("el-select",{staticStyle:{width:"300px"},attrs:{placeholder:"请选择"},model:{value:e.baseFrom.scene,callback:function(t){e.$set(e.baseFrom,"scene",t)},expression:"baseFrom.scene"}},e._l(e.sceneList,(function(e){return t("el-option",{key:e.enumId,attrs:{label:e.enumValue,value:e.enumId}})})),1)],1),t("el-form-item",{attrs:{label:"营销模板：",prop:"activityTemplateId"}},[t("el-select",{staticStyle:{width:"300px"},attrs:{placeholder:"请选择"},model:{value:e.baseFrom.activityTemplateId,callback:function(t){e.$set(e.baseFrom,"activityTemplateId",t)},expression:"baseFrom.activityTemplateId"}},e._l(e.sellTemplateList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"活动类型：",prop:"activityType"}},[t("el-select",{staticStyle:{width:"300px"},attrs:{placeholder:"请选择"},model:{value:e.baseFrom.activityType,callback:function(t){e.$set(e.baseFrom,"activityType",t)},expression:"baseFrom.activityType"}},e._l(e.activeTypeList,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),t("el-form-item",{attrs:{label:"活动目的：",prop:"activityObjective"}},[t("el-select",{staticStyle:{width:"300px"},attrs:{placeholder:"请选择"},model:{value:e.baseFrom.activityObjective,callback:function(t){e.$set(e.baseFrom,"activityObjective",t)},expression:"baseFrom.activityObjective"}},e._l(e.goalOfActivityList,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),e._l(e.nextNodesList.nextNodesApprover,(function(a,i){return t("el-form-item",{key:i,attrs:{label:a.node.nodeName,rules:{required:!0,message:"审批人不能为空",trigger:"blur"},prop:"nextNodesList["+i+"].value"}},[t("el-select",{staticStyle:{width:"230px"},attrs:{placeholder:"请选择",multiple:null!==a.processVersionNum},on:{change:e.clone},model:{value:e.baseFrom.nextNodesList[i].value,callback:function(t){e.$set(e.baseFrom.nextNodesList[i],"value",t)},expression:"baseFrom.nextNodesList[index].value"}},e._l(a.approverUser,(function(e,a){return t("el-option",{key:a,attrs:{label:e.userName,value:e.userId}})})),1)],1)})),t("el-form-item",{attrs:{label:"策略预演：",prop:"rehearsal"}},[t("el-select",{staticStyle:{width:"300px"},attrs:{placeholder:"请选择"},model:{value:e.baseFrom.rehearsal,callback:function(t){e.$set(e.baseFrom,"rehearsal",t)},expression:"baseFrom.rehearsal"}},e._l(e.rehearsalList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"敏感用户群：",prop:"user"}},[t("el-select",{staticStyle:{width:"300px"},attrs:{placeholder:"请选择"},model:{value:e.baseFrom.user,callback:function(t){e.$set(e.baseFrom,"user",t)},expression:"baseFrom.user"}},e._l(e.userGroups,(function(e){return t("el-option",{key:e.enumId,attrs:{label:e.enumValue,value:e.enumId}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.submit(0)}}},[e._v("预演并保存")]),t("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.submit(1)}}},[e._v("保存")]),t("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.submit(2)}}},[e._v("提交审批")])],1)],2)],1)])],1)},r=[],l=(a("14d9"),a("b132")),s=a("0fea"),o=a("5e05"),n=a("31b1"),c=a("2f62");a("f9ae");const m=o["a"].common.getSysEnum,u=(n["a"].channel.getNextApprovers,n["a"].channel.getTemplateData);var d={props:{drawer:{type:Boolean,default(){return!1}}},components:{MpDialog:l["a"]},data(){return{baseFrom:{campsegName:"",dateList:"",campsegDesc:"",type:"",topicId:"",scene:"",activityTemplateId:"",activityType:"",activityObjective:"",leader:"",rehearsal:"",user:""},nextNodesList:{},typeOption:[],specialList:[],sceneList:[],sellTemplateList:[],activeTypeList:[],goalOfActivityList:[],leaderList:[],userGroups:[],rehearsalList:[{value:1,label:"预演"},{value:0,label:"不预演"}],SceneNodeData:[],baseFromRules:{campsegName:[{required:!0,message:"请选择策略名称",trigger:"change"}],dateList:[{required:!0,message:"请选择投放周期",trigger:"change"}],campsegDesc:[{required:!0,message:"请输入策略描述",trigger:"change"}],type:[{required:!0,message:"请选择策略类型",trigger:"change"}],activityType:[{required:!0,message:"请选择活动类型",trigger:"change"}],activityObjective:[{required:!0,message:"请选择活动目的",trigger:"change"}]}}},computed:{...Object(c["b"])("MarkPl",["getNodeDataId","getNodeFirstChannelData","getNodeDataIdObj"])},methods:{DialogClose(){this.$emit("stratgeClose",!1)},clone(){this.baseFrom=Object.assign({},this.baseFrom)},intiCampInfo(){var e=new Date(+new Date+288e5).toJSON().substr(0,19).replace("T"," ");this.baseFrom.campsegName="营销策略"+e},getTemlate(){if("approveFlowId"in this.baseFrom&&null!==this.baseFrom.approveFlowId){var e={approveFlowId:this.baseFrom.approveFlowId};this.getNextApprovers(e)}else Object(s["i"])(u).then(e=>{this.TemplateData=e,this.getNextApprovers(e)})},async getNextApprovers(e){var t=this.getNodeFirstChannelData("3"),a=this.getNodeDataIdObj(t.id),i=[];a.map(e=>{i.push(e.channelId)});var r={berv:e.berv,instanceId:e.approveFlowId,nodeId:"",processId:e.processId,triggerParm:{channelId:i.join(",")}};await Object(s["i"])(n["a"].channel.getNextApprovers,r).then(e=>{this.baseFrom.nextNodesList=[],e.nextNodesApprover.map(e=>{var t;this.baseFrom.nextNodesList.push({value:(null===(t=e.approverUser[0])||void 0===t?void 0:t.userId)||""})}),this.nextNodesList=e})},async getSelectList(){await Object(s["i"])(m,{enumType:"camp_type_list"}).then(e=>{this.typeOption=e}),await Object(s["i"])(m,{enumType:"camp_special_topic"}).then(e=>{this.specialList=e}),await Object(s["i"])(m,{enumType:"camp_scene"}).then(e=>{this.sceneList=e}),Object(s["i"])(m,{enumType:"activity_type"}).then(e=>{this.activeTypeList=e}),Object(s["i"])(m,{enumType:"activity_objective"}).then(e=>{this.goalOfActivityList=e}),Object(s["i"])(m,{enumType:"camp_sensitive_cust_list"}).then(e=>{this.userGroups=e})},submit(e){this.$refs.baseFrom.validate(async e=>{})}},mounted(){this.SceneNodeData=this.$store.state.MarkPl.SceneNodeData,this.getSelectList(),this.getTemlate()}},h=d,p=(a("a2b3"),a("2877")),v=Object(p["a"])(h,i,r,!1,null,null,null);t["a"]=v.exports},c37e:function(e,t,a){"use strict";a("c56f")},c3eb:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{attrs:{title:"模板列表",visible:e.dialogVisible,width:e.tableData.width+"px",modal:!1,top:"25vh",left:"25vw","custom-class":"dialog"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-table",{ref:"singleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData.records}},[t("el-table-column",{attrs:{type:"index",label:"序号"}}),e._l(e.cols,(function(e){return t("el-table-column",{key:e.props,attrs:{prop:e.props,label:e.label,"show-overflow-tooltip":"content"===e.props}})})),t("el-table-column",{attrs:{property:"address",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-link",{staticClass:"text-sm mr-16",attrs:{type:"primary",underline:!1},on:{click:function(t){return e.addShortMessage(a)}}},[e._v("添加 ")])]}}])})],2),t("div",{staticClass:"pager"},[t("el-pagination",{attrs:{"current-page":e.pageData.currentPage,"page-sizes":e.pageData.pageSizeList,"page-size":e.pageData.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.tableData.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("确 定")])],1)],1)],1)},r=[],l={props:["tableData","cols","channelId"],data(){return{pageData:{current:1,pageSizeList:[5,10,15,20],size:5,keyWords:"",planId:""},dialogVisible:!1}},created(){this.$emit("getSmsContentTemplateList",this.pageData)},methods:{handleCurrentChange(e){this.pageData.current=e,this.$emit("getSmsContentTemplateList",this.pageData)},handleSizeChange(e){this.pageData.size=e,this.$emit("getSmsContentTemplateList",this.pageData)},showDialog(e){this.dialogVisible=e},addShortMessage(e){this.$emit("addShortMessage",e)}}},s=l,o=(a("864b"),a("2877")),n=Object(o["a"])(s,i,r,!1,null,"2671bee6",null);t["a"]=n.exports},c4a0:function(e,t,a){"use strict";a("cc76")},c53f:function(e,t,a){"use strict";a("eb2a")},c56f:function(e,t,a){},c675:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ProductDialog"},[t("mp-dialog",{attrs:{title:"多波次",isClose:!0,isReturn:!1,IsAscertain:!1,width:"760px",visible:e.visible},on:{"update:visible":function(t){e.visible=t}}},[t("div",{attrs:{slot:"Dialogcontent"},slot:"Dialogcontent"},[e._l(e.MultiwaveDataList,(function(a){return t("div",{key:a.id,staticClass:"MuliWave"},[t("div",{staticClass:"condition"},[t("div",{staticClass:"conditiongong"},[t("i",{staticClass:"iconfont icongonggongtubiao-huitiaoliangcedianzhui"})]),t("div",[t("el-select",{attrs:{placeholder:"请选择",size:"mini"},on:{change:function(t){return e.ChangeRule(a)}},model:{value:a.waveNo,callback:function(t){e.$set(a,"waveNo",t)},expression:"item.waveNo"}},e._l(e.options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("div",e._l(e.isOriginal(a.waveNo),(function(i,r){return t("span",{key:r},["N"!==i?t("em",[e._v(" "+e._s(i)+" ")]):t("em",[t("el-input",{staticStyle:{width:"72px",height:"28px"},model:{value:a.waveRuleExp,callback:function(t){e.$set(a,"waveRuleExp",t)},expression:"item.waveRuleExp"}})],1)])})),0)]),t("div",{staticClass:"close",on:{click:function(t){return e.MultClose(a)}}},[t("i",{staticClass:"iconfont icongonggongtubiao-guanbi"})])])})),t("div",{staticClass:"addMuliWave",on:{click:e.AddMultiwave}},[t("div",[t("i",{staticClass:"iconfont icongonggongtubiao-xinjiantianjia"}),t("span",[e._v("添加波次")])])]),t("div",{staticClass:"Product-button"},[t("el-button",{attrs:{type:"success",size:"medium"},on:{click:e.MultiwaveSub}},[e._v("确定")])],1)],2)])],1)},r=[],l=a("d8f8"),s=l["a"],o=(a("5bcb"),a("a9fc"),a("2877")),n=Object(o["a"])(s,i,r,!1,null,"3c8f3bf9",null);t["a"]=n.exports},c691:function(e,t,a){"use strict";a("b1d2a")},c87e:function(e,t,a){"use strict";a("3a17")},c88b:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"CrmFrom",attrs:{"label-width":"150px",model:e.CrmFrom,rules:e.CrmFromRules}},[e.isadivInfo?t("adivInfo",{attrs:{CrmFrom:e.CrmFrom.adivInfo,FromData:e.CrmFrom},on:{"update:CrmFrom":function(t){return e.$set(e.CrmFrom,"adivInfo",t)},"update:crm-from":function(t){return e.$set(e.CrmFrom,"adivInfo",t)},getConfiguration:e.getConfiguration,getadivObj:e.getadivObj}}):e._e(),t("el-form-item",{attrs:{label:"优先级：",prop:"channelConf.priorityOrder"}},[t("div",{staticClass:"block"},[t("el-slider",{attrs:{"show-input":""},model:{value:e.CrmFrom.channelConf.priorityOrder,callback:function(t){e.$set(e.CrmFrom.channelConf,"priorityOrder",t)},expression:"CrmFrom.channelConf.priorityOrder"}})],1)]),1001===e.curAdivInfo.execType?t("el-form-item",{attrs:{label:"复杂事件场景：",prop:"channelConf.cepEventId"}},[void 0!==e.CrmFrom.channelConf.cepEventId?t("el-tag",{staticClass:"cepEventIdTag",attrs:{size:"medium"}},[e._v(e._s(e.CrmFrom.channelConf.cepEventId))]):e._e(),t("el-button",{attrs:{size:"small"},on:{click:function(t){e.cepEventIdVisible=!0}}},[e._v("添加")])],1):e._e(),t("el-form-item",{attrs:{label:"流量激发活动：",prop:"channelConf.ifHaveVar"}},[t("el-radio-group",{model:{value:e.CrmFrom.channelConf.ifHaveVar,callback:function(t){e.$set(e.CrmFrom.channelConf,"ifHaveVar",t)},expression:"CrmFrom.channelConf.ifHaveVar"}},[t("el-radio",{attrs:{label:!0}},[e._v("是")]),t("el-radio",{attrs:{label:!1}},[e._v("否")])],1)],1),t("el-form-item",{attrs:{label:"推荐用语：",prop:"channelConf.execContent"}},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{type:"textarea",rows:4,"show-word-limit":"",maxlength:500},model:{value:e.CrmFrom.channelConf.execContent,callback:function(t){e.$set(e.CrmFrom.channelConf,"execContent",t)},expression:"CrmFrom.channelConf.execContent"}})],1),e.CrmFrom.channelConf.ifHaveVar?t("el-form-item",{attrs:{label:"短信用语变量："}},[t("ul",{staticClass:"variableLabl"},e._l(e.variable,(function(a){return t("li",{key:a.label},[e._v(" "+e._s(a.name)+" ")])})),0)]):e._e(),t("el-form-item",{attrs:{label:"执行时间："}},[e.isadivInfo?t("ExecutionTime",{key:e.execution,attrs:{form:e.TimeForm},on:{onChange:e.onChange}},[t("el-button",[e._v("执行时间")])],1):e._e()],1),e.isadivInfo?t("configurationSheet",{ref:"configurationSheet",attrs:{CrmFrom:e.CrmFrom.channelConf},on:{configGsheet:e.configGsheet,"update:CrmFrom":function(t){return e.$set(e.CrmFrom,"channelConf",t)},"update:crm-from":function(t){return e.$set(e.CrmFrom,"channelConf",t)}}}):e._e()],1),t("el-dialog",{attrs:{title:"复杂事件实列",width:"1100px",visible:e.cepEventIdVisible,"append-to-body":"","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.cepEventIdVisible=t}}},[e.cepEventIdVisible?t("complexEvents",{ref:"complexEvents",attrs:{cepEventId:e.CrmFrom.channelConf.cepEventId}}):e._e(),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.cepEventIdVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.SubEvents}},[e._v("保 存")])],1)],1)],1)},r=[],l=a("0fea"),s=a("5e05"),o=a("57d8"),n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"complexEvents"},[t("div",{staticClass:"tree"},[t("el-tree",{ref:"vueTree",attrs:{props:e.props,data:e.channelList,"node-key":"id",accordion:"","highlight-current":"","icon-class":"iconfont icongonggongtubiao-shouqi Treecolor"},on:{"node-click":e.TreeNodeClick},scopedSlots:e._u([{key:"default",fn:function({node:a}){return t("div",{staticClass:"custom-tree-node"},[t("span",[e._v(e._s(a.label))])])}}])})],1),t("div",{staticClass:"table"},[t("div",{staticClass:"search_box"},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],staticClass:"input-search",attrs:{placeholder:"请输入事件编号或名称"},model:{value:e.queryForm.keyWords,callback:function(t){e.$set(e.queryForm,"keyWords","string"===typeof t?t.trim():t)},expression:"queryForm.keyWords"}},[t("i",{staticClass:"el-input__icon el-icon-search cursor-pointer",attrs:{slot:"suffix"},on:{click:e.QuerykeyWords},slot:"suffix"})])],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"Mp-table",staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-class-name":e.tableRowClassName,height:"calc(100vh - 470px)"}},[t("el-table-column",{attrs:{prop:"eventId",label:"事件编码"}}),t("el-table-column",{attrs:{prop:"eventName",label:"事件名称"}}),t("el-table-column",{attrs:{prop:"firstClassName",label:"一级分类"}}),t("el-table-column",{attrs:{prop:"secondClassName",label:"二级分类"}}),t("el-table-column",{attrs:{prop:"createUserName",label:"创建人"}}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间"}}),t("el-table-column",{attrs:{prop:"approveTime",label:"审批时间"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-radio",{attrs:{label:a.row.eventId},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[e._v(e._s(""))])]}}])})],1),t("div",{staticClass:"pager"},[t("el-pagination",{attrs:{"current-page":e.pageData.currentPage,"page-sizes":e.pageData.size,"page-size":e.pageData.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pageData.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)])},c=[],m=a("d370"),u={props:["cepEventId"],data(){return{queryForm:{classifyId:"",keyWords:"",status:""},tableData:[],loading:!1,props:{label:"label",children:"children",num:"num"},pageData:{currentPage:1,pageSize:10,pageSizeList:[10,20,30,40],total:0},channelList:[],radio:""}},mounted(){null!==this.cepEventId&&void 0!==this.cepEventId&&(this.radio=this.cepEventId),this.queryEvents(),this.queryCepEventTypeList()},methods:{queryCepEventTypeList(){Object(l["i"])(m["a"].mpapi.queryCepEventTypeList,{statTime:""}).then(e=>{this.channelList=e,this.loading=!1})},queryEvents(){Object(l["i"])(m["a"].mpapi.queryEvents,{...this.queryForm,current:this.pageData.currentPage,size:this.pageData.pageSize}).then(e=>{this.tableData=e.records,this.loading=!1,this.pageData.total=e.total})},QuerykeyWords(){this.pageData.current=1,this.queryEvents()},tableRowClassName(e){const t=e.rowIndex%2;return 0===t?"gray-row":""},TreeNodeClick(e){},handleSizeChange(e){this.pageData.pageSize=e,this.queryEvents()},handleCurrentChange(e){this.pageData.currentPage=e,this.queryEvents()}}},d=u,h=(a("d5cd"),a("40ca"),a("2877")),p=Object(h["a"])(d,n,c,!1,null,"7c362d85",null),v=p.exports,C=a("9044"),b=function(){var e=this,t=e._self._c;return t("div",[t("el-popover",{attrs:{placement:"top-start",trigger:"click"}},[t("div",{staticClass:"ExcutionTime"},[t("div",{staticClass:"Time"},[t("div",{staticClass:"title"},[t("span",[e._v("月执行时间")]),t("span",[t("el-checkbox",{on:{change:function(t){return e.SelectAll(e.month,31,"Month")}},model:{value:e.month,callback:function(t){e.month=t},expression:"month"}},[e._v("全选")])],1)]),t("div",{staticClass:"MonthTable"},[t("ul",e._l(7,(function(e){return t("li",{key:e})})),0),t("ul",e._l(35,(function(a){return t("li",{key:a,class:e.isMonth(a)?"bg":"",on:{click:function(t){return e.SingleChoice(a,"Month")}}},[e._v(" "+e._s(a>31?"":a)+" ")])})),0),t("ul",e._l(7,(function(e){return t("li",{key:e})})),0)])]),t("div",{staticClass:"Time"},[t("div",{staticClass:"title"},[t("span",[e._v("周执行时间")]),t("span",[t("el-checkbox",{on:{change:function(t){return e.SelectAll(e.week,7,"Week")}},model:{value:e.week,callback:function(t){e.week=t},expression:"week"}},[e._v("全选")])],1)]),t("div",{staticClass:"WeekTable"},[t("ul",e._l(7,(function(a){return t("li",{key:a,class:e.isWeek(a)?"bg":"",on:{click:function(t){return e.SingleChoice(a,"Week")}}},[e._v(" 星期"+e._s(e.WeekList[a-1])+" ")])})),0)])]),t("div",{staticClass:"Time Day"},[t("div",{staticClass:"title"},[t("span",[e._v("天执行时间")]),t("span",[t("el-checkbox",{on:{change:function(t){return e.SelectAll(e.day,48,"Day")}},model:{value:e.day,callback:function(t){e.day=t},expression:"day"}},[e._v("全选")])],1)]),t("div",{staticClass:"DayTable"},[t("ul",[t("li",[t("div",[t("el-checkbox",{on:{change:function(t){return e.DaySelect(e.isbeforeDawn,16,"beforeDawn")}},model:{value:e.isbeforeDawn,callback:function(t){e.isbeforeDawn=t},expression:"isbeforeDawn"}},[e._v("凌晨(0点~8点)")])],1),t("ul",{staticClass:"DayTableTimeSlot"},e._l(e.beforeDawn,(function(a,i){return t("li",{key:a,class:e.isDay(i,0)?"bg":"",on:{click:function(t){return e.SingleChoice(i,"beforeDawn")}}},[e._v(e._s(a))])})),0)]),t("li",[t("div",[t("el-checkbox",{on:{change:function(t){return e.DaySelect(e.isDayList,16,"DayList")}},model:{value:e.isDayList,callback:function(t){e.isDayList=t},expression:"isDayList"}},[e._v("白天(8点~16点)")])],1),t("ul",{staticClass:"DayTableTimeSlot"},e._l(e.DayList,(function(a,i){return t("li",{key:a,class:e.isDay(i,16)?"bg":"",on:{click:function(t){return e.SingleChoice(i,"DayList")}}},[e._v(e._s(a))])})),0)]),t("li",[t("div",[t("el-checkbox",{on:{change:function(t){return e.DaySelect(e.isnight,16,"night")}},model:{value:e.isnight,callback:function(t){e.isnight=t},expression:"isnight"}},[e._v("夜间(16点~24点)")])],1),t("ul",{staticClass:"DayTableTimeSlot"},e._l(e.night,(function(a,i){return t("li",{key:a,class:e.isDay(i,32)?"bg":"",on:{click:function(t){return e.SingleChoice(i,"night")}}},[e._v(e._s(a))])})),0)])])])])]),e._t("default",null,{slot:"reference"})],2)],1)},f=[],g=(a("14d9"),{props:["form"],data(){return{month:!1,week:!1,day:!1,isbeforeDawn:!1,isDayList:!1,isnight:!1,WeekList:["一","二","三","四","五","六","日"],TimeList:[],beforeDawn:[],night:[],DayList:[],isWeekSelect:"0000000",isMonthSelect:"0000000000000000000000000000000",isDaySelect:"000000000000000000000000000000000000000000000000"}},computed:{isWeek:function(){return e=>"1"===this.isWeekSelect[e-1]},isMonth:function(){return e=>"1"===this.isMonthSelect[e-1]},isDay:function(){return(e,t)=>"1"===this.isDaySelect[e+t]}},mounted(){var e=this.getTimeList(24,30);e.push("23:30~00:00"),this.beforeDawn=e.slice(0,16),this.DayList=e.slice(16,32),this.night=e.slice(32,48),""!==this.form.dayMask&&(this.isMonthSelect=this.form.dayMask,this.month=this.verificationStr(this.isMonthSelect)),""!==this.form.weekMask&&(this.isWeekSelect=this.form.weekMask,this.week=this.verificationStr(this.isWeekSelect)),""!==this.form.minute10Mask&&(this.isDaySelect=this.form.minute10Mask,this.day=this.verificationStr(this.isDaySelect),this.isbeforeDawn=this.verificationStr(this.isDaySelect.substring(0,16)),this.isDayList=this.verificationStr(this.isDaySelect.substring(16,32)),this.isnight=this.verificationStr(this.isDaySelect.substring(32,this.isDaySelect.length))),this.Change()},methods:{SelectAll(e,t,a){for(var i="",r=0;r<t;r++)i+=e?1:0;"Month"===a?this.isMonthSelect=i:"Week"===a?this.isWeekSelect=i:(this.isDaySelect=i,this.isbeforeDawn=this.day,this.isDayList=this.day,this.isnight=this.day),this.Change()},DaySelect(e,t,a){for(var i="",r=this.isDaySelect,l=0;l<t;l++)i+=e?1:0;this.isDaySelect="beforeDawn"===a?i+r.substring(16,r.length):"DayList"===a?r.substring(0,16)+i+r.substring(32,r.length):r.substring(0,32)+i,this.Change()},SingleChoice(e,t){"Month"===t?(this.isMonthSelect=this.replaceStr(this.isMonthSelect,e-1),this.month=this.verificationStr(this.isMonthSelect)):"Week"===t?(this.isWeekSelect=this.replaceStr(this.isWeekSelect,e-1),this.week=this.verificationStr(this.isWeekSelect)):"beforeDawn"===t?(this.isDaySelect=this.replaceStr(this.isDaySelect,e),this.isbeforeDawn=this.verificationStr(this.isDaySelect.substring(0,16)),this.day=this.verificationStr(this.isDaySelect)):"DayList"===t?(this.isDaySelect=this.replaceStr(this.isDaySelect,e+16),this.isDayList=this.verificationStr(this.isDaySelect.substring(16,32)),this.day=this.verificationStr(this.isDaySelect)):(this.isDaySelect=this.replaceStr(this.isDaySelect,e+32),this.isnight=this.verificationStr(this.isDaySelect.substring(32,this.isDaySelect.length)),this.day=this.verificationStr(this.isDaySelect)),this.Change()},Change(){var e={week:this.isWeekSelect,day:this.isDaySelect,Month:this.isMonthSelect};this.$emit("onChange",e)},verificationStr(e){const t=e.split("");var a=t.filter(e=>"1"!==e);return 0===a.length},replaceStr(e,t){const a=e.split("");return a[t]="1"===a[t]?"0":"1",a.join("")},getTimeList(e,t){for(var a=60,i=[],r=[],l=0;l<e;l++){var s="";s=l<10?"0"+l:""+l;for(var o=0;o<a;o++)if(o%t===0){var n=o<10?":0"+o:":"+o;n=s+n,i.length>0&&r.push(i[i.length-1]+"~"+n),i.push(n)}}return r}}}),_=g,x=(a("95b7"),Object(h["a"])(_,b,f,!1,null,"f02c07f0",null)),E=x.exports;const y=s["a"].common.getSysEnum;var F={components:{configurationSheet:o["a"],adivInfo:C["a"],complexEvents:v,ExecutionTime:E},props:["channelNewData"],data(){return{CrmFrom:{adivInfo:{},channelConf:{ifHaveVar:!1,priorityOrder:0},channelId:"",channelName:""},CrmFromRules:{adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],priorityOrder:[{required:!0,message:"请输入优先等级",trigger:"blur"}],cepEventId:[{required:!0,message:"请选择复杂事件",trigger:"blur"}],ifHaveVar:[{required:!0,message:"请选择流量激发活动",trigger:"blur"}]}},timeIdList:[],adivList:[],isadivInfo:!1,variable:[{name:"APP名称",label:"$APP_NAME$"},{name:"内容热点",label:"$CONTENT_HOT_SPOT$"},{name:"内容标签",label:"$CONTENT_LABEL$"},{name:"内容主题",label:"$CONTENT_SUBJECT$"}],cepEventIdVisible:!1,TimeForm:{weekMask:"",dayMask:"",minute10Mask:""},curAdivInfo:{},execution:1}},mounted(){this.getOptionData();var e=Object.assign({},this.CrmFrom.channelConf);this.CrmFrom=JSON.parse(JSON.stringify(this.channelNewData)),this.CrmFrom.channelConf=Object.assign({},{...e,...this.channelNewData.channelConf});var t=new Date,a=t.getDate()-1,i="0000000000000000000000000000000";this.TimeForm={weekMask:this.CrmFrom.channelConf.executeTimeWeek||"1111111",dayMask:this.CrmFrom.channelConf.executeTimeMonth||this.replaceStr(i,a),minute10Mask:this.CrmFrom.channelConf.executeTimeDay||"000000000000000011111111111111111111111100000000"},this.isadivInfo=!0},methods:{async getOptionData(){await Object(l["i"])(y,{enumType:"iop_time_id"}).then(e=>{this.timeIdList=e})},getConfiguration(e){if(1!==e.zt){this.CrmFrom.channelConf={priorityOrder:0,ifHaveVar:!1};var t=new Date,a=t.getDate()-1,i="0000000000000000000000000000000";this.TimeForm={weekMask:"1111111",dayMask:this.replaceStr(i,a),minute10Mask:"000000000000000011111111111111111111111100000000"}}this.execution++,this.$refs.configurationSheet.lookSchedulingInfo(e.configid)},changeAid(e){var t="";this.adivList.forEach(a=>{e===a.adivId&&(t=a.adivName)}),this.CrmFrom.adivInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,adivName:t})},changeTime(){this.timeIdList.forEach(e=>{e.enumKey===this.CrmFrom.timeId&&(this.CrmFrom.timeName=e.enumValue)})},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e},configGsheet(e){this.CrmFrom.channelConf=Object.assign(this.CrmFrom.channelConf,e),this.CrmFrom=JSON.parse(JSON.stringify(this.CrmFrom))},onChange(e){this.CrmFrom.channelConf.executeTimeDay=e.day,this.CrmFrom.channelConf.executeTimeMonth=e.Month,this.CrmFrom.channelConf.executeTimeWeek=e.week},SubEvents(){this.CrmFrom.channelConf.cepEventId=this.$refs.complexEvents.radio,this.CrmFrom.channelConf=Object.assign({},this.CrmFrom.channelConf),this.cepEventIdVisible=!1},getadivObj(e){this.curAdivInfo=e},replaceStr(e,t){const a=e.split("");return a[t]="1"===a[t]?"0":"1",a.join("")}},created(){}},I=F,D=(a("0dd9"),a("7032"),Object(h["a"])(I,i,r,!1,null,"6c38c9aa",null));t["a"]=D.exports},c98a:function(e,t,a){"use strict";a("a365")},cbd2:function(e,t,a){"use strict";a("4a7d")},cc70:function(e,t,a){},cc76:function(e,t,a){},cd74:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mk-content"},[t("div",{staticClass:"mk-html-content",domProps:{innerHTML:e._s(e.marketingWords)}})])},r=[],l={props:{marketingWords:{type:String,default:""}},methods:{}},s=l,o=(a("4880"),a("2877")),n=Object(o["a"])(s,i,r,!1,null,"539dcce2",null);t["a"]=n.exports},cddb:function(e,t,a){},d013:function(e,t,a){},d1a4:function(e,t,a){"use strict";a("d4be")},d212:function(e,t,a){"use strict";const i="/mcd-eval/action",r="/plan-svc/api",l="/element-svc/api";t["a"]={effectAppraisal:{queryActServiceTypeInfo:i+"/effectEvaluate/activity/queryActServiceTypeInfo.do",queryUserCityInfo:i+"/effectEvaluate/activity/queryUserCityInfo.do",queryChannelInfo:i+"/effectEvaluate/activity/queryChannelInfo.do",queryPlanTypeInfo:i+"/effectEvaluate/activity/queryPlanTypeInfo.do",queryActServiceTypeIndicatorInfo:i+"/effectEvaluate/activity/queryActServiceTypeIndicatorInfo.do",saveViewIndicatorInfo:i+"/effectEvaluate/activity/saveViewIndicatorInfo.do",listCampInfo:i+"/effectEvaluate/activity/listCampInfo.do",listPlanInfo:i+"/effectEvaluate/product/listPlanInfo.do",channelOrSceneAppraise:i+"/appraisal/channelOrSceneAppraise.do",pagelist:r+"/singleUser/pagelist",queryPage:"/eval-svc/eval5g/queryPage",export:"/eval-svc/eval5g/export",queryPageCloud:"/eval-svc/eval/5gcloud/queryPage",export5gCloudEvalListData:"/eval-svc/eval/5gcloud/export5gCloudEvalListData",exportIvr:"/eval-svc/reportIvr/export",queryPageIvr:"/eval-svc/reportIvr/queryPage",querySystemUsageCityList:r+"/action/systemUsage/querySystemUsageCityList",querySystemUsageDeptList:r+"/action/systemUsage/querySystemUsageDeptList",querySystemUsagePersonageList:r+"/action/systemUsage/querySystemUsagePersonageList",getUsageCityDetailList:r+"/action/systemUsage/getUsageCityDetailList",getUsageDeptDetailList:r+"/action/systemUsage/getUsageDeptDetailList",getUsagePersonageDetailList:r+"/action/systemUsage/getUsagePersonageDetailList",exportReport:"/eval-svc/report/export",queryPageReport:"/eval-svc/report/queryPage",batchDeleteMaterial:l+"/mcdDimMaterial/jx/batchDeleteMaterial",deleteMaterial:l+"/mcdDimMaterial/jx/deleteMaterial",getIntelligentMatchingMaterialList:l+"/mcdDimMaterial/jx/getIntelligentMatchingMaterialList",getMaterial:l+"/mcdDimMaterial/jx/getMaterial",loadImage:l+"/mcdDimMaterial/jx/loadImage",materialImportTemplateDownload:l+"/mcdDimMaterial/jx/materialImportTemplateDownload",queryChannel:l+"/mcdDimMaterial/jx/queryChannel",queryContact:l+"/mcdDimMaterial/jx/queryContact",queryMaterialPageList:l+"/mcdDimMaterial/jx/queryMaterialPageList",queryPosition:l+"/mcdDimMaterial/jx/queryPosition",removeMaterialById:l+"/mcdDimMaterial/jx/removeMaterialById",saveOrUpdateMaterial:l+"/mcdDimMaterial/jx/saveOrUpdateMaterial",updateMaterialStatus:l+"/mcdDimMaterial/jx/updateMaterialStatus",uploadMaterialPicture:l+"/mcdDimMaterial/jx/uploadMaterialPicture",uploadMaterialsFile:l+"/mcdDimMaterial/jx/uploadMaterialsFile",uploadMaterialVideo:l+"/mcdDimMaterial/jx/uploadMaterialVideo",exportMaterialsFile:l+"/mcdDimMaterial/jx/exportMaterialsFile",queryChart:"/eval-svc/home/eval/queryChart",monthEffect:"/eval-svc/home/eval/month/effect",dayEffect:"/eval-svc/home/eval/day/effect",getTacticsListByCityId:"/eval-svc/home/eval/getTacticsListByCityId",queryChannelRadarMap:"/eval-svc/eval/queryChannelRadarMap",queryMonitor:"/plan-svc/api/monitor/queryMonitor",getCaliberInfo:"/plan-svc/api/kpi/getCaliberInfo",updateCaliberInfo:"/plan-svc/api/kpi/updateCaliberInfo",queryChannelEval:"/eval-svc/evaluate/channel/jx/list",exportChannelEval:"/eval-svc/evaluate/channel/jx/exportChannelEval",campEval:"/eval-svc/eval/campEval",exportActivityEval:"/eval-svc/eval/export",exportEffectEval:"/eval-svc/effect/eval/exportEffectEval",getDetailByDrillDownType:"/eval-svc/effect/eval/getDetailByDrillDownType",queryEffectEvalAllCount:"/eval-svc/effect/eval/queryEffectEvalAllCount",gridExport:"/eval-svc/smart/grid/eval/export",gridEval:"/eval-svc/smart/grid/eval/gridEval",exportSmsSendHistory:"/plan-svc/mcd/sms/send/exportSmsSendHistory",querySmsSendHistory:"/plan-svc/mcd/sms/send/querySmsSendHistory",querySmsSendMonitory:"/plan-svc/mcd/sms/send/querySmsSendMonitory",smsSendHistoryTask:"/plan-svc/mcd/sms/send/smsSendHistoryTask",smsSendMonitorTask:"/plan-svc/mcd/sms/send/smsSendMonitorTask",smsSendTaskPause:"/plan-svc/mcd/sms/send/smsSendTaskPause",queryTask:"/plan-svc/mcd-camp-import-task/queryTask",batchImportCamp:"/plan-svc/mcd-camp-import-task/batchImportCamp",successRate:"/eval-svc/eval/home/successRate",sucess:"/eval-svc/eval/home/sucess",total:"/eval-svc/eval/home/total",dw88Camp:"/eval-svc/mcd/onlinel/report/dw88Camp",dwHeigh88City:"/eval-svc/mcd/onlinel/report/dwHeigh88City",getDateTime:"/eval-svc/mcd/onlinel/report/getDateTime",onlineReportDataExport:"/eval-svc/mcd/onlinel/report/onlineReportDataExport",stCamp85CityDm:"/eval-svc/mcd/onlinel/report/stCamp85CityDm",stCamp85HdDm:"/eval-svc/mcd/onlinel/report/stCamp85HdDm",stCamp86CityDm:"/eval-svc/mcd/onlinel/report/stCamp86CityDm",stCamp86HdDm:"/eval-svc/mcd/onlinel/report/stCamp86HdDm",qryTermEval:"/mkt-term-svc/api/qryTermEval"}}},d443:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("input",{ref:"uploadRef",staticStyle:{display:"none"},attrs:{type:"file",accept:e.accept,multiple:e.multiple},on:{change:e.getFile}}),t("el-button",{attrs:{type:"primary",loading:e.uploadLoading},on:{click:e.clickUploadBtn}},[e._v(e._s(e.uploadLoading?"正在上传":"点击上传"))]),e.tip?t("span",{staticClass:"tip",domProps:{innerHTML:e._s(e.tip)}}):e._e(),t("div",{staticClass:"file-content"},[t("transition-group",{staticClass:"file-fade-group",attrs:{name:"fade"}},e._l(e.file_list,(function(a,i){return t("section",{key:a.url+i,staticClass:"file-item",on:{click:function(t){return e.downloadFile(a)}}},[a.imgUrl?t("el-image",{staticStyle:{width:"50",height:"50px"},attrs:{fit:"cover",src:a.imgUrl,"preview-src-list":[a.imgUrl]}},[t("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[t("i",{staticClass:"el-icon-picture-outline"})])]):t("img",{attrs:{src:a.icon,width:"50",height:"50"}}),t("el-tooltip",[t("div",{attrs:{slot:"content"},slot:"content"},[e._v(e._s(a.fileName))]),t("span",{staticClass:"file-name"},[e._v(" "+e._s(a.fileName)+" ")])]),t("div",{staticClass:"close"},[t("i",{staticClass:"el-icon-close",on:{click:function(t){return e.clearFile(t,a)}}})])],1)})),0)],1)],1)},r=[],l=(a("14d9"),a("88a7"),a("271a"),a("5494"),a("0fea")),s=a("5af3"),o=a("fcff"),n=a.n(o),c=a("b1d3"),m=a.n(c),u=a("5414"),d=a.n(u),h=a("56b3"),p=a.n(h),v=a("f26a"),C=a.n(v),b={name:"UploadComponent",props:{accept:{type:String,default:"*"},action:{type:String,default:""},multiple:{type:Boolean,default:!1},limit:{type:Number||void 0,default:void 0},fileList:{type:Array||Object,default:()=>[]},requestKey:{type:String,default:"file"},responseKey:{type:Object,default:()=>({fileName:"fileName",url:"url"})},tip:{type:String||Array,default:""},rules:{type:Object,default:()=>({size:524288e3,type:[],imgSize:[]})}},data(){return{loadList:[],file_list:[],imgTypes:["jpg","jpeg","png","gif","bmp","webp","psd","svg","tiff"]}},computed:{uploadLoading(){return this.loadList.length>0}},watch:{fileList:{handler(e){let t=[];Array.isArray(this.fileList)?t=this.fileList:t.push(this.fileList),t.forEach(e=>{this.handleData(e)})},immediate:!0,deep:!0},file_list:{handler(e){this.$emit("changeFile",e)},deep:!0}},methods:{handleData(e){if(void 0===e.url)return;let t={fileName:e.fileName,url:e.url,icon:this.getFileIconUrl(e.fileName),imgUrl:""};this.imgTypes.includes(e.fileName.substring(e.fileName.lastIndexOf(".")+1))&&Object(s["d"])(e.url).then(e=>{t.imgUrl=e}),this.file_list.push(t)},clickUploadBtn(){this.$refs["uploadRef"].value=null,this.$refs["uploadRef"].click()},getFile({target:e}){if(!this.multiple&&this.file_list.length>0)return void this.$message.error("文件已上传，请先删除后再上传");if(this.multiple&&this.limit&&this.file_list.length+e.files.length>this.limit)return void this.$message.error("文件数量超出限制，请最多上传"+this.limit+"个文件");let t=e.files;for(let a of t)this.validateFile(a).then(e=>{e&&this.uploadFile(a)})},async validateFile(e){let{size:t,type:a,imgSize:i}=this.rules,r=e.name.substring(e.name.lastIndexOf(".")+1);if((null===a||void 0===a?void 0:a.length)>0&&!a.includes(r))return this.$message.error("文件类型不符合要求,请上传"+a.join(",")+"格式文件"),Promise.resolve(!1);if(e.size>t)return this.$message.error("文件大小不符合要求,请上传小于"+t/1024/1024+"M的文件"),Promise.resolve(!1);if((null===i||void 0===i?void 0:i.length)>0){let t=new Image,a=URL.createObjectURL(e);return t.src=a,new Promise((e,a)=>{t.onload=()=>t.width!=i[0]||t.height!=i[1]?(this.$message.error("图片尺寸不符合要求, 请上传"+i[0]+"*"+i[1]+"的图片"),e(!1)):e(!0)})}return Promise.resolve(!0)},async uploadFile(e){this.loadList.push(1);try{let t=new FormData,a="file";t.append(a,e);const i=await Object(l["j"])(this.action,t),r=i[this.responseKey.fileName],s=i[this.responseKey.url];this.handleData({fileName:r,url:s})}catch(t){}finally{this.loadList.pop()}},clearFile(e,t){e.stopPropagation(),this.file_list.splice(this.file_list.indexOf(t),1)},getFileIconUrl(e){const t=e.substring(e.lastIndexOf(".")+1);return"xls"===t||"xlsx"===t?n.a:"pdf"===t?d.a:"txt"===t?p.a:"doc"===t||"docx"===t?C.a:m.a},async downloadFile(e){if(!e.imgUrl)try{const t=await Object(s["d"])(e.url);let a=document.createElement("a");a.style.display="none",a.href=t,a.setAttribute("download",e.fileName),document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(t){}},clearFileList(){this.file_list=[]}}},f=b,g=(a("8d22"),a("2877")),_=Object(g["a"])(f,i,r,!1,null,"f73081b2",null);t["a"]=_.exports},d4be:function(e,t,a){},d4f7:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAPVJREFUOE+lk8ENgkAQRf+ECkzWO1YAHYCVKGXsSTxtGWolaAdQgd7ZxArMmI+uIZhIkDmxmb/vDzszgpkhY/dT15YK2Qj0VNtlOdT/BKSuzRWyE0SF4lE11qwmAvwW0JjOifPaWPNl+LOCxPmrIFrTVfE4NNZ03/34AFJHtxAaKyQT4FRbc2ROAb7DnoraLs9B2QGCAMANQA7gLIj2tV3wHPJZzzlnZcy/AW0JyI1uifMVnfouw7LZGZpQ8xcgcf4gwIWGMwCvX/wX0HVnDuAzE5MreHcsa6wp+LiTAKm7xxyofpcCgDNfjS0W52S4VKPbOAZ9Av0TtRGHhvvtAAAAAElFTkSuQmCC"},d58f:function(e,t,a){"use strict";var i=a("59ed"),r=a("7b0b"),l=a("44ad"),s=a("07fa"),o=TypeError,n=function(e){return function(t,a,n,c){var m=r(t),u=l(m),d=s(m);i(a);var h=e?d-1:0,p=e?-1:1;if(n<2)while(1){if(h in u){c=u[h],h+=p;break}if(h+=p,e?h<0:d<=h)throw new o("Reduce of empty array with no initial value")}for(;e?h>=0:d>h;h+=p)h in u&&(c=a(c,u[h],h,m));return c}};e.exports={left:n(!1),right:n(!0)}},d5b0:function(e,t,a){"use strict";a("8657")},d5cd:function(e,t,a){"use strict";a("4873")},d600:function(e,t,a){"use strict";a("bcd9")},d6bd:function(e,t,a){"use strict";a("9d33")},d7d2:function(e,t,a){"use strict";a("866a")},d83e:function(e,t,a){"use strict";var i=function(){var e,t,a,i=this,r=i._self._c;return r("div",{staticStyle:{width:"100%"}},[r("Tips",{attrs:{id:i.id},on:{getChannelDetail:i.getChannelDetail}}),r("el-form",{ref:"CrmFrom",staticStyle:{width:"100%"},attrs:{"label-width":"145px",model:i.CrmFrom,rules:i.CrmFromRules}},[r("el-row",[r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"推送方式：",prop:"columnExt1"}},[r("el-radio-group",{model:{value:i.CrmFrom.columnExt1,callback:function(e){i.$set(i.CrmFrom,"columnExt1",e)},expression:"CrmFrom.columnExt1"}},[r("el-radio",{attrs:{label:"1",disabled:!i.CrmFrom.channelFlag}},[i._v("全量推送")]),r("el-radio",{attrs:{label:"0",disabled:!i.CrmFrom.channelFlag}},[i._v("偏好推送")])],1)],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"运营位：",prop:"adivInfo.adivId"}},[r("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:i.changeAid},model:{value:i.CrmFrom.adivInfo.adivId,callback:function(e){i.$set(i.CrmFrom.adivInfo,"adivId",e)},expression:"CrmFrom.adivInfo.adivId"}},i._l(i.adivList,(function(e){return r("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"标准化素材：",prop:"columnExt20"}},[r("div",{staticClass:"select-material",on:{click:function(e){return i.selectMaterial(!0)}}},[i._v(i._s(i.CrmFrom.materialName||"请选择"))])])],1),r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"项目层级二：",prop:"columnExt5"}},[r("el-select",{attrs:{placeholder:"请选择项目层级二"},on:{change:i.changeProject},model:{value:i.CrmFrom.columnExt5,callback:function(e){i.$set(i.CrmFrom,"columnExt5",e)},expression:"CrmFrom.columnExt5"}},i._l(i.projectLevelSec,(function(e){return r("el-option",{key:e.id,attrs:{label:e.levelValue,value:e.id}})})),1)],1)],1),r("el-col",{attrs:{span:24}},[null!==(e=i.CrmFrom.adivInfo)&&void 0!==e&&null!==(e=e.adivId)&&void 0!==e&&e.includes("8111")?i._e():r("el-form-item",{attrs:{label:"营销类型：",prop:"saleType"}},[r("el-select",{attrs:{placeholder:"请选择营销类型"},on:{change:i.changeSaleType},model:{value:i.CrmFrom.saleType,callback:function(e){i.$set(i.CrmFrom,"saleType",e)},expression:"CrmFrom.saleType"}},i._l(i.saleList,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"项目层级三：",prop:"columnExt6"}},[r("el-select",{attrs:{placeholder:"请选择项目层级三"},on:{change:i.changeProjectTh},model:{value:i.CrmFrom.columnExt6,callback:function(e){i.$set(i.CrmFrom,"columnExt6",e)},expression:"CrmFrom.columnExt6"}},i._l(i.projectLevelTh,(function(e){return r("el-option",{key:e.id,attrs:{label:e.levelValue,value:e.id}})})),1)],1)],1),"1"!==i.CrmFrom.saleType||null!==(t=i.CrmFrom.adivInfo)&&void 0!==t&&null!==(t=t.adivId)&&void 0!==t&&t.includes("8111")?i._e():r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"复杂事件场景：",prop:"CEP_EVENT_ID"}},[r("div",[r("div",{staticStyle:{display:"flex","justify-content":"space-between","max-width":"375px"}},[r("div",{staticClass:"add-botton"},[r("span",{on:{click:function(e){return i.openSceneDilog(!0)}}},[i._v(i._s(i.CrmFrom.sceneParams.eventName||"添加"))]),r("i",{directives:[{name:"show",rawName:"v-show",value:i.CrmFrom.sceneParams.eventName,expression:"CrmFrom.sceneParams.eventName"}],staticClass:"el-icon-close",on:{click:i.removeEvent}})]),r("el-checkbox",{model:{value:i.CrmFrom.checked,callback:function(e){i.$set(i.CrmFrom,"checked",e)},expression:"CrmFrom.checked"}},[i._v("取消推荐规则设置")])],1),"JX0000000001"===i.customGroupId?r("div",{staticStyle:{color:"red","font-size":"12px"}},[i._v("该活动没有限定客群，触发事件即发送，请慎重选择事件！")]):i._e(),i.CrmFrom.checked?r("div",{staticClass:"select"},[r("div",{staticClass:"setRules"},[r("p",[i._v("已选择事件："+i._s(i.CrmFrom.sceneParams.eventName))])]),r("div",[r("span",[i._v("取消推荐时间：")]),r("el-select",{attrs:{placeholder:"请选择执行端口",size:"mini"},model:{value:i.CrmFrom.columnExt4,callback:function(e){i.$set(i.CrmFrom,"columnExt4",e)},expression:"CrmFrom.columnExt4"}},i._l(i.columnExt4List,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]):i._e()])])],1),r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"营销(服务)目标客户及提取规则：",prop:"columnExt9"}},[r("el-input",{directives:[{name:"forbidChars",rawName:"v-forbidChars"}],attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&i._k(e.keyCode,"enter",13,e.key,"Enter")?null:i.handleTextareaKeydown.apply(null,arguments)}},model:{value:i.CrmFrom.columnExt9,callback:function(e){i.$set(i.CrmFrom,"columnExt9",e)},expression:"CrmFrom.columnExt9"}})],1)],1),r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"任务描述及要求：",prop:"columnExt11","label-width":"148px"}},[r("el-input",{directives:[{name:"forbidChars",rawName:"v-forbidChars"}],attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&i._k(e.keyCode,"enter",13,e.key,"Enter")?null:i.handleTextareaKeydown.apply(null,arguments)}},model:{value:i.CrmFrom.columnExt11,callback:function(e){i.$set(i.CrmFrom,"columnExt11",e)},expression:"CrmFrom.columnExt11"}})],1)],1),i.showExt18?r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"智能话术："}},[r("el-checkbox",{on:{change:()=>i.CrmFrom.columnExt18=i.checkColumnExt18?"1":"0"},model:{value:i.checkColumnExt18,callback:function(e){i.checkColumnExt18=e},expression:"checkColumnExt18"}},[i._v("启用")]),i.checkColumnExt18?r("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:function(e){return i.$forceUpdate()}},model:{value:i.CrmFrom.columnExt18,callback:function(e){i.$set(i.CrmFrom,"columnExt18",e)},expression:"CrmFrom.columnExt18"}},[r("el-radio",{attrs:{label:"1"}},[i._v("省端模型")]),r("el-radio",{attrs:{label:"2"}},[i._v("一级IOP模型")])],1):i._e()],1)],1):i._e(),r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"营销用语：",prop:"columnExt2"}},[r("el-input",{directives:[{name:"forbidChars",rawName:"v-forbidChars"}],ref:"wording",attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},model:{value:i.CrmFrom.columnExt2,callback:function(e){i.$set(i.CrmFrom,"columnExt2",e)},expression:"CrmFrom.columnExt2"}})],1)],1),r("el-col",{attrs:{span:24}},[1==i.custgroupSource?r("el-form-item",{attrs:{label:"营销用语替换变量："}},[r("DNAReplaceVar",{on:{getVar:i.addWord}})],1):r("el-form-item",{attrs:{label:"标签属性：","label-width":"148px"}},[r("div",{staticClass:"label-content"},[r("div",{staticClass:"label"},["variable"==i.lableProp?r("div",{staticClass:"label-item"},i._l(i.labelConfig[i.lableProp],(function(e){return r("span",{key:e.id,on:{click:function(t){return i.addWord(e.attrCol)}}},[i._v(" "+i._s(e.attrColName)+" ")])})),0):r("div",{staticClass:"label-item"},i._l(i.labelConfig[i.lableProp],(function(e){return r("span",{key:e.labelId,class:[i.selectLabelList.some(t=>t.labelId==e.labelId)?"active":""],on:{click:function(t){return i.pushPoint(e)}}},[i._v(i._s(e.labelName)+" ")])})),0)]),r("el-radio-group",{attrs:{size:"mini"},model:{value:i.lableProp,callback:function(e){i.lableProp=e},expression:"lableProp"}},[r("el-radio-button",{attrs:{label:"variable"}},[i._v("营销变量")]),r("el-radio-button",{attrs:{label:"touchPoint"}},[i._v("推送至触点")])],1)],1)])],1),null!==(a=i.CrmFrom.adivInfo)&&void 0!==a&&null!==(a=a.adivId)&&void 0!==a&&a.includes("8111")?r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"外呼需求附件（含需求正文、外呼脚本、客服文档等）：",prop:"columnExt10","label-width":"148px"}},[r("el-upload",{staticClass:"upload-demo",attrs:{action:i.action,"on-remove":i.handleRemove,"before-remove":i.beforeRemove,"on-success":i.handleSuccess,multiple:"",limit:1,"on-exceed":i.handleExceed,headers:{Authorization:i.header},"file-list":i.fileList}},[r("el-button",{attrs:{size:"small",type:"primary"}},[i._v("点击上传")])],1)],1)],1):i._e()],1)],1),r("ComplexScene",{ref:"SceneDialog",on:{addScene:i.addScene}}),r("materialList",{ref:"material",attrs:{adivId:i.CrmFrom.adivInfo.adivId,channelId:i.id},on:{addMaterial:i.addMaterial}})],1)},r=[],l=(a("14d9"),a("0fea")),s=a("5e05"),o=a("a454"),n=(a("0b16"),a("aedd")),c=a("f1ce"),m=a("5ed5"),u=a("6501"),d=a("0557"),h=a("b893");s["a"].common.getSysEnum;const p=s["a"].common.queryAdivInfo;s["a"].common.queryHallInfo;var v={props:["channelNewData","id","deleteSub"],components:{ComplexScene:n["a"],materialList:c["a"],Tips:m["a"],DNAReplaceVar:u["a"]},data(){return{CrmFrom:{adivInfo:{},channelId:"",channelName:"",attributionInfo:{},columnExt1:"1",standard:"",CustomerRules:"",marketingWords:"",columnExt2:"",columnExt3:"",columnExt4:"7",columnExt5:"",columnExt6:"",CEP_EVENT_ID:"",CEP_SCENE_NAME:"",sceneParams:{eventName:""},materialName:"",columnExt20:"",saleType:"",columnExt11:"",columnExt10:"",columnExt7:"",columnExt8:"",columnExt12:"",columnExt13:"",columnExt14:"",columnExt15:"",columnExt16:"",columnExt18:"0",IF_HAVE_VAR:"0"},showExt18:!1,checkColumnExt18:!1,fileList:[],CrmFromRules:{columnExt1:[{required:!0,message:"请选择推送方式",trigger:"blur"}],marketingWords:[{required:!0,message:"请输入营销话术",trigger:"blur"}],columnExt9:[{required:!0,message:"请输入营销(服务)目标客户及提取规则",trigger:"blur"}],columnExt11:[{required:!0,message:"请输入任务描述及要求",trigger:"blur"}],columnExt10:[{required:!0,message:"请上传外呼需求附件",trigger:"blur"}],columnExt2:[{required:!0,message:"请输入营销用语",trigger:"blur"}],columnExt5:[{required:!0,message:"请选择项目层级2",trigger:"blur"}],columnExt6:[{required:!0,message:"请选择任务类型",trigger:"blur"}],CEP_EVENT_ID:[{required:!0,message:"请选择实时事件",trigger:"blur"}],adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},timeIdList:[],adivList:[],attributionList:[],projectLevelSec:[],projectLevelTh:[],columnExt4List:[{label:"1天",value:"1"},{label:"2天",value:"2"},{label:"3天",value:"3"},{label:"4天",value:"4"},{label:"5天",value:"5"},{label:"6天",value:"6"},{label:"7天",value:"7"}],saleList:[{label:"实时营销",value:"1"},{label:"批量营销",value:"2"}],labelConfig:{variable:[],touchPoint:[{labelName:"可呼时段",labelId:"id123"}],availableLabelIdList:[]},lableProp:"variable",selectLabelList:[]}},computed:{checked(){return this.CrmFrom.checked},customGroupId(){var e;return null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.customGroupId},header(){return window.sessionStorage.getItem("IOP_TOKEN")},action(){return d["a"].commonConfig.baseURL+"/element-svc/api/jx/file/upload"},saleTypes(){return this.CrmFrom.saleType},custgroupSource(){return this.$store.state.extendData.custgroupSource}},watch:{channelNewData:{handler(){if(this.CrmFrom=Object(h["d"])(this.channelNewData),this.fileList=void 0!==this.CrmFrom.columnExt10?[{name:this.CrmFrom.columnExt10}]:[],this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"columnExt2",this.CrmFrom.columnExt2||""),this.$set(this.CrmFrom,"columnExt4",this.CrmFrom.columnExt4||"7"),this.$set(this.CrmFrom,"columnExt5",this.CrmFrom.columnExt5||""),this.$set(this.CrmFrom,"columnExt6",this.CrmFrom.columnExt6||""),this.$set(this.CrmFrom,"columnExt18",this.CrmFrom.columnExt18||"0"),this.$set(this.CrmFrom,"sceneParams",this.CrmFrom.sceneParams||{eventName:""}),this.$set(this.CrmFrom,"IF_HAVE_VAR",this.channelNewData.IF_HAVE_VAR||"0"),this.checkColumnExt18=this.CrmFrom.columnExt18>0,this.getLabelList(),this.listCustAttr(),this.CrmFrom.adivInfo.adivId){let e={levelType:"iop_projectLevel2_id",parentId:this.CrmFrom.adivInfo.adivId};this.getProject(e);let t={levelType:"iop_projectLevel3_id",parentId:this.CrmFrom.columnExt5};this.getProject(t)}},deep:!0},CrmFrom:{handler(e,t){},deep:!0},checked(e){this.CrmFrom=e?{...this.CrmFrom,columnExt3:"1"}:{...this.CrmFrom,columnExt3:"0"}}},mounted(){if(this.getOptionData(),this.CrmFrom=Object(h["d"])(this.channelNewData),this.fileList=void 0!==this.CrmFrom.columnExt10?[{name:this.CrmFrom.columnExt10}]:[],this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"columnExt2",this.CrmFrom.columnExt2||""),this.$set(this.CrmFrom,"columnExt4",this.CrmFrom.columnExt4||"7"),this.$set(this.CrmFrom,"columnExt5",this.CrmFrom.columnExt5||""),this.$set(this.CrmFrom,"columnExt6",this.CrmFrom.columnExt6||""),this.$set(this.CrmFrom,"columnExt7",this.CrmFrom.columnExt7||""),this.$set(this.CrmFrom,"columnExt8",this.CrmFrom.columnExt8||""),this.$set(this.CrmFrom,"columnExt18",this.CrmFrom.columnExt18||"0"),this.$set(this.CrmFrom,"sceneParams",this.CrmFrom.sceneParams||{eventName:""}),this.$set(this.CrmFrom,"IF_HAVE_VAR",this.channelNewData.IF_HAVE_VAR||"0"),this.checkColumnExt18=this.CrmFrom.columnExt18>0,this.getLabelList(),this.listCustAttr(),this.CrmFrom.adivInfo.adivId){let e={levelType:"iop_projectLevel2_id",parentId:this.CrmFrom.adivInfo.adivId};this.getProject(e);let t={levelType:"1"===this.CrmFrom.saleType?"iop_projectLevel3_actual_id":"iop_projectLevel3_id",parentId:this.CrmFrom.columnExt5};this.getProject(t)}},methods:{getChannelDetail(e){1==e.smartScript&&(this.showExt18=!0)},async getOptionData(){await Object(l["i"])(p,{channelId:this.id}).then(e=>{this.adivList=e})},changeAid(e){e.includes("8111")&&(this.CrmFrom.CEP_EVENT_ID="",this.CrmFrom.CEP_SCENE_NAME="",this.CrmFrom.sceneParams={eventName:""},this.CrmFrom.checked=!1);var t="";this.adivList.forEach(a=>{e===a.adivId&&(t=a.adivName)}),this.CrmFrom.adivInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,adivName:t});const a={parentId:e,levelType:"iop_projectLevel2_id"};this.getProject(a),this.CrmFrom.columnExt5="",this.CrmFrom.columnExt6="",this.CrmFrom.columnExt7="",this.CrmFrom.columnExt8="",this.CrmFrom.columnExt13="",this.CrmFrom.columnExt14="",this.CrmFrom.columnExt15="",this.CrmFrom.columnExt16=""},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t||("906"===this.id||"922"===this.id)&&this.CrmFrom.marketingWords&&this.CrmFrom.adivInfo.adivId?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e},openSceneDilog(e){this.$refs["SceneDialog"].showDialog(e)},addScene(e){this.CrmFrom={...this.CrmFrom,CEP_EVENT_ID:e.eventId,CEP_SCENE_NAME:e.eventName,sceneParams:e}},removeEvent(){this.CrmFrom.sceneParams={eventName:""},this.CrmFrom.CEP_EVENT_ID="",this.CrmFrom.CEP_SCENE_NAME=""},selectMaterial(e){this.$refs["material"].showDialog(e)},addMaterial(e){this.CrmFrom={...this.CrmFrom,columnExt20:e.materialId,materialName:e.materialName}},handleRemove(e,t){},handleExceed(e,t){this.$message.warning(`当前限制选择 1个文件，本次选择了 ${e.length} 个文件，共选择了 ${e.length+t.length} 个文件`)},beforeRemove(e,t){return this.$confirm(`确定移除 ${e.name}？`)},handleSuccess(e){this.CrmFrom={...this.CrmFrom,columnExt10:e.data.fileName}},onUploadBeforeSend(e){let t=e.name.substring(e.name.lastIndexOf(".")+1);const a="xls"===t,i="xlsx"===t,r="png"===t,l="jpg"===t,s="doc"===t;let o=e.size/1024/1024<5?1:0;0===o&&this.$message({message:"上传文件大小不能超过5MB!",type:"error"}),a||i||r||l||s||this.$message.error("请上传正确的文件格式");let n=a||i||r||l||s;return n},async getProject(e){await Object(l["i"])(s["a"].common.getProject,e).then(t=>{"iop_projectLevel2_id"===e.levelType?this.projectLevelSec=t:this.projectLevelTh=t})},changeProject(e){const t=this.projectLevelSec.find(t=>t.id===e);this.CrmFrom.columnExt7=t.levelValue,this.CrmFrom.columnExt15=t.levelKey;const a={parentId:t.id,levelType:"iop_projectLevel3_id"};this.CrmFrom.columnExt6="",this.CrmFrom.columnExt8="",this.CrmFrom.columnExt13="",this.CrmFrom.columnExt14="",this.CrmFrom.columnExt16="",this.getProject(a)},changeSaleType(e){this.removeEvent(),this.CrmFrom.checked=!1,"2"===e&&(this.CrmFrom={...this.CrmFrom,CEP_SCENE_NAME:"",CEP_EVENT_ID:"",sceneParams:{eventName:""},checked:!1}),this.CrmFrom.columnExt6="",this.CrmFrom.columnExt8="",this.CrmFrom.columnExt13="",this.CrmFrom.columnExt14="",this.CrmFrom.columnExt16="";let t={levelType:"1"===e?"iop_projectLevel3_actual_id":"iop_projectLevel3_id",parentId:this.CrmFrom.columnExt5};this.getProject(t)},changeProjectTh(e){const t=this.projectLevelTh.find(t=>t.id===e);this.CrmFrom={...this.CrmFrom,columnExt8:t.levelValue,columnExt13:t.taskTypeId,columnExt14:t.taskTypeName,columnExt16:t.levelKey}},async listCustAttr(){try{var e;const t=null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.customGroupId,a=await Object(l["i"])(s["a"].common.listCustAttr+"?custGroupId="+t);this.labelConfig.variable=a}catch(t){}},async getLabelList(){try{var e;const t=await Object(l["i"])(o["a"].custgroup.getLabelByChannelId,{channelId:this.id,customGroupId:null===(e=this.$store.state.MarkPl.SceneNodeData[0][1])||void 0===e||null===(e=e.NodeObj[0])||void 0===e?void 0:e.customGroupId});this.labelConfig.touchPoint=t.allLabelInfoList.filter(e=>t.availableLabelIdList.includes(e.labelId)),this.CrmFrom.columnExt12&&(this.selectLabelList=this.labelConfig.touchPoint.filter(e=>this.CrmFrom.columnExt12.split(",").includes(e.labelId)))}catch(t){this.labelConfig.touchPoint=[]}},addWord(e){let t="$"+e+"$";e=t,this.CrmFrom.IF_HAVE_VAR="1";let a=this.$refs.wording.$el.querySelector(".el-textarea__inner");void 0===this.CrmFrom.columnExt2&&(this.CrmFrom.columnExt2=""),this.CrmFrom.columnExt2+=e,this.$forceUpdate(),a.focus()},pushPoint(e){this.selectLabelList.some(t=>t.labelId==e.labelId)?this.selectLabelList=this.selectLabelList.filter(t=>t.labelId!=e.labelId):this.selectLabelList.push(e),this.CrmFrom.columnExt12=this.selectLabelList.map(e=>e.labelId).join(",")},handleTextareaKeydown(){let e=arguments[0];if("Enter"===e.key||"Enter"===e.code||13==e.keyCode)return e.returnValue=!1,!1}}},C=v,b=(a("7b98"),a("2877")),f=Object(b["a"])(C,i,r,!1,null,"a83cccdc",null);t["a"]=f.exports},d8f8:function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("14d9"),core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__),_Components_MpDialog_vue__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("b132"),_config_config_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("a078"),vuex__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("2f62"),_config_MpNode_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("eced"),_api_manage__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("0fea"),_api_MpApi_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("d370");__webpack_exports__["a"]={name:"MultiwaveDialog",components:{MpDialog:_Components_MpDialog_vue__WEBPACK_IMPORTED_MODULE_1__["a"]},computed:{isOriginal(){return e=>{let t=this.options.filter(t=>e===t.value);var a;return void 0!==t?null===(a=t[0])||void 0===a?void 0:a.label.split(""):""}},...Object(vuex__WEBPACK_IMPORTED_MODULE_3__["b"])("MarkPl",["getNodeData","getNodeDataId","getNodeGroupId","getCurrentList","getCurrentSubAllList","getCurrentPerAllList","getNodeDataId","getNodeDataIdObj"]),CurrentNode(){return this.$store.state.MarkPl.CurrentNode}},data(){return{visible:!1,entryDom:"",options:[{id:1,label:"N天没有接触",value:"1",isentry:!1,waveRuleExp:""},{id:1,label:"N天未订阅",value:"2",isentry:!1,waveRuleExp:""},{id:1,label:"接触次数大于N次",value:"3",isentry:!1,waveRuleExp:""},{id:1,label:"明确拒绝",value:"4",isentry:!0,waveRuleExp:""}],value:"",MultiwaveDataList:[{id:1,waveNo:"1",label:"N天没有接触",waveRuleExp:"",isentry:!1}]}},created(){"{}"!==JSON.stringify(this.getNodeData)&&(this.MultiwaveDataList=this.getNodeData)},methods:{showMpDialog(){this.visible=!0,this.queryWaveNumber(),this.MultiwaveDataList=[],"{}"!==JSON.stringify(this.getNodeData)&&(this.MultiwaveDataList=JSON.parse(JSON.stringify(this.getNodeData)))},queryWaveNumber(){var e=this.getNodeDataId("3"),t=this.getNodeDataIdObj(e.id);Object(_api_manage__WEBPACK_IMPORTED_MODULE_5__["i"])(_api_MpApi_js__WEBPACK_IMPORTED_MODULE_6__["a"].mpapi.queryFeedbackStatusInfo,{channelId:t[0].channelId}).then(e=>{this.options=e.map(e=>({id:e.ruleId,label:e.statusName,value:e.ruleId,isentry:3===e.status,waveRuleExp:""}))})},ChangeRule(e){let t,a=[...this.MultiwaveDataList];this.options.forEach(a=>{e.waveNo===a.value&&(t={...a})}),e={...e,isentry:t.isentry,waveRuleExp:"",label:t.label},this.MultiwaveDataList=a.map(t=>t.id===e.id?e:t)},AddMultiwave(){if(0===this.options.length)return void this.$message.error("未查询到策略反馈状态信息！");let e=[...this.MultiwaveDataList],t=!1;if(e.length>=_config_config_js__WEBPACK_IMPORTED_MODULE_2__["a"].MUNUMBER)return void this.$message.error(`最多创建${_config_config_js__WEBPACK_IMPORTED_MODULE_2__["a"].MUNUMBER}条波次`);if(this.MultiwaveDataList.forEach(e=>{e.isentry||""!==e.waveRuleExp||(this.$message.error("请输入规则"),t=!0)}),t)return;let a={...this.options[0],id:e.length+(new Date).getTime(),waveNo:this.options[0].value};this.MultiwaveDataList.push(a)},CheckArrayElement(e){e.sort();for(var t=0,a=0;a<e.length;a++)a+1!==e.length&&e[a]===e[a+1]&&(t+=1);return t},MultiwaveSub(){if(0===this.MultiwaveDataList.length)return void this.$message.error("请添加波次");var ientry=!1;if(this.MultiwaveDataList.forEach(e=>{e.isentry||""!==e.waveRuleExp||(this.$message.error("请输入规则"),ientry=!0)}),ientry)return;var multiwaveList=this.MultiwaveDataList.map(e=>Number(e.waveNo));if(this.CheckArrayElement(multiwaveList)>0)return void this.$message.error("检测到重复的规则，请修改");let arr=this.MultiwaveDataList.map(e=>e.label.replace("N",e.waveRuleExp)),newArr={NewData:arr,fuse:[],homologous:[],mutual:[]};this.$store.commit("MarkPl/fnUpdateActiveNodeList",newArr),this.$store.commit("MarkPl/fuUpdateSceneNodeData",this.MultiwaveDataList);var NodeList=JSON.parse(JSON.stringify(this.$store.state.MarkPl.ActiveNodeList)),newCharacter=eval("([{group: [1, 2, 3], children:[]},{group: [1, 2, 3], children:[]}])");NodeList=this.RecursionUpdateNodeList(NodeList,this.CurrentNode),this.$store.commit("MarkPl/fnActiveNodeList",[...NodeList]),this.visible=!1},RecursionUpdateNodeList(NodeList,CurrentNode){for(let index=0;index<NodeList.length;index++){for(let i=0;i<NodeList[index].group.length;i++)if(CurrentNode.id===NodeList[index].group[i].id){var NewChar=[],charRule=[],charName=[];for(let e=0;e<this.MultiwaveDataList.length;e++)NewChar.push("{group: [1, 3], children:[]}"),charRule[e]=this.MultiwaveDataList[e].waveNo+"_"+this.MultiwaveDataList[e].waveRuleExp,charName[e]=this.MultiwaveDataList[0].label,charName[e]=charName[e];var newCharacter=eval("(["+NewChar.join(",")+"])");this.$store.commit("MarkPl/fnUpdateNodeChannel",{Rule:charRule.join(","),name:charName.join(",")});var newCharacterData=Object(_config_MpNode_js__WEBPACK_IMPORTED_MODULE_4__["j"])(newCharacter,this.CurrentNode.wavePid,charRule,charName);0!==NodeList[index].children.length&&this.$store.commit("MarkPl/fnUpdateSceneNodeData",NodeList[index].children),NodeList[index].children=newCharacterData;var NodeDataList=JSON.parse(JSON.stringify(this.$store.state.MarkPl.SceneNodeData)),newNodeList=[];newCharacterData.map(e=>{var t=[];e.group.map(e=>{t.push({id:e.id,cId:e.cId,assembly:e.assembly,NodeObj:[]})}),newNodeList.push(t)}),this.$store.commit("MarkPl/fnSceneNodeData",[...NodeDataList,...newNodeList]);break}null!==NodeList[index].children&&0!==NodeList[index].children.length&&this.RecursionUpdateNodeList(NodeList[index].children,CurrentNode)}return NodeList},MultClose(e){let t=[...this.MultiwaveDataList];t.splice(t.indexOf(e),1),this.MultiwaveDataList=[...t]}}}},d9d6:function(e,t,a){"use strict";a("0853")},da3c:function(e,t,a){"use strict";a("9f5d")},dd73:function(e,t,a){},df2f:function(e,t,a){},df4d:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"CrmFrom",attrs:{"label-width":"100px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-form-item",{attrs:{label:"运营位：",prop:"adivId"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:e.changeAid},model:{value:e.CrmFrom.adivId,callback:function(t){e.$set(e.CrmFrom,"adivId",t)},expression:"CrmFrom.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1),t("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"物料：",prop:"material"}},[t("el-input",{staticStyle:{width:"60%"},on:{focus:e.preMaterial},model:{value:e.CrmFrom.material,callback:function(t){e.$set(e.CrmFrom,"material",t)},expression:"CrmFrom.material"}}),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:e.preview}},[e._v(" 预览 ")])],1),t("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"产品价格",prop:"proPrice"}},[t("el-input",{staticStyle:{width:"60%"},model:{value:e.CrmFrom.proPrice,callback:function(t){e.$set(e.CrmFrom,"proPrice",t)},expression:"CrmFrom.proPrice"}})],1),t("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"URL链接：",prop:"urlLink"}},[t("el-input",{staticStyle:{width:"60%"},model:{value:e.CrmFrom.urlLink,callback:function(t){e.$set(e.CrmFrom,"urlLink",t)},expression:"CrmFrom.urlLink"}})],1),t("el-form-item",{attrs:{label:"优先级：",prop:"priorityOrder"}},[t("div",{staticClass:"block"},[t("el-slider",{attrs:{"show-input":""},model:{value:e.CrmFrom.priorityOrder,callback:function(t){e.$set(e.CrmFrom,"priorityOrder",t)},expression:"CrmFrom.priorityOrder"}})],1)]),t("el-form-item",{attrs:{label:"时机选择："}},[t("el-select",{attrs:{placeholder:"请选择"},on:{click:e.changeTime},model:{value:e.CrmFrom.timeId,callback:function(t){e.$set(e.CrmFrom,"timeId",t)},expression:"CrmFrom.timeId"}},e._l(e.timeIdList,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),t("el-form-item",{attrs:{label:"时机描述："}},[t("el-input",{attrs:{type:"textarea",maxlength:"240","show-word-limit":""},model:{value:e.CrmFrom.timeDistindes,callback:function(t){e.$set(e.CrmFrom,"timeDistindes",t)},expression:"CrmFrom.timeDistindes"}})],1),t("el-form-item",[t("el-button",{on:{click:e.SubInstall}},[e._v("保存当前设置")])],1)],1),!0===e.gHandIsShow?t("group-hand-dialog"):e._e()],1)},r=[],l=a("0fea"),s=a("5e05"),o=a("180b");const n=s["a"].common.getSysEnum,c=s["a"].common.queryAdivInfo;var m={props:["channelId","channelData"],components:{GroupHandDialog:o["a"]},data(){return{CrmFrom:{adivId:null,material:null,proPrice:null,urlLink:null,priorityOrder:null,timeId:null,timeDistindes:null},CrmFromRules:{adivId:[{required:!0,message:"请选择运营位",trigger:"blur,change"}],material:[{required:!0,message:"请选择物料",trigger:"blur"}],urlLink:[{required:!0,message:"请输入URL链接",trigger:"blur"}]},timeIdList:[],adivList:[],gHandIsShow:!1}},mounted(){var e;this.CrmFrom=null!==(e=this.channelData)&&void 0!==e?e:this.CrmFrom,this.getOptionData()},methods:{getOptionData(){Object(l["i"])(c,{channelId:this.channelId}).then(e=>{this.adivList=e}),Object(l["i"])(n,{enumType:"iop_time_id"}).then(e=>{this.timeIdList=e})},changeAid(){this.adivList.forEach(e=>{(this.CrmFrom.adivId=e.adivId)&&(this.CrmFrom.adivName=e.adivName)})},changeTime(){this.timeIdList.forEach(e=>{e.enumKey===this.CrmFrom.timeId&&(this.CrmFrom.timeName=e.enumValue)})},preMaterial(){this.gHandIsShow=!this.gHandIsShow},preview(){this.$alert("没有可预览的材料",{confirmButtonText:"确定"})},SubInstall(){this.$refs.CrmFrom.validate(e=>{e&&this.$emit("saveChannelData",this.CrmFrom)})}}},u=m,d=a("2877"),h=Object(d["a"])(u,i,r,!1,null,"07b4c493",null);t["a"]=h.exports},e0bf:function(e,t,a){},e349:function(e,t,a){},e404:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("Tips",{attrs:{id:e.id},on:{getChannelDetail:e.getChannelDetail}}),t("el-form",{ref:"CrmFrom",staticStyle:{width:"100%"},attrs:{"label-width":"145px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"推送方式：",prop:"columnExt1"}},[t("el-radio-group",{model:{value:e.CrmFrom.columnExt1,callback:function(t){e.$set(e.CrmFrom,"columnExt1",t)},expression:"CrmFrom.columnExt1"}},[t("el-radio",{attrs:{label:"1",disabled:!e.CrmFrom.channelFlag}},[e._v("全量推送")]),t("el-radio",{attrs:{label:"0",disabled:!e.CrmFrom.channelFlag}},[e._v("偏好推送")])],1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"标准化素材：",prop:"columnExt20"}},[t("div",{staticClass:"select-material",on:{click:function(t){return e.selectMaterial(!0)}}},[e._v(e._s(e.CrmFrom.materialName||"请选择"))])])],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"任务类型：",prop:"columnExt4"}},[t("el-select",{attrs:{placeholder:"请选择任务类型"},on:{change:e.changeAlarm},model:{value:e.CrmFrom.columnExt4,callback:function(t){e.$set(e.CrmFrom,"columnExt4",t)},expression:"CrmFrom.columnExt4"}},e._l(e.alarmType,(function(e){return t("el-option",{key:e.typeCode,attrs:{label:e.typeName,value:e.typeCode}})})),1)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"重点活动：",prop:"columnExt6"}},[t("el-select",{attrs:{placeholder:"是否为重点活动"},model:{value:e.CrmFrom.columnExt6,callback:function(t){e.$set(e.CrmFrom,"columnExt6",t)},expression:"CrmFrom.columnExt6"}},[t("el-option",{attrs:{label:"是",value:"1"}}),t("el-option",{attrs:{label:"否",value:"0"}})],1)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"加入抢单：",prop:"columnExt7"}},[t("el-select",{attrs:{placeholder:"是否加入抢单"},model:{value:e.CrmFrom.columnExt7,callback:function(t){e.$set(e.CrmFrom,"columnExt7",t)},expression:"CrmFrom.columnExt7"}},[t("el-option",{attrs:{label:"是",value:"1"}}),t("el-option",{attrs:{label:"否",value:"0"}})],1)],1)],1),t("el-col",{attrs:{span:24}},[t("UseScript",{ref:"useScript",attrs:{"label-width":"145px","channel-id":e.channelNewData.channelId,"channel-name":e.channelNewData.channelName,"script-id":e.CrmFrom.columnExt19,CrmFrom:e.CrmFrom},on:{change:e.changeScript}})],1),e.showExt18?t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"智能话术："}},[t("el-checkbox",{on:{change:()=>e.CrmFrom.columnExt18=e.checkColumnExt18?"1":"0"},model:{value:e.checkColumnExt18,callback:function(t){e.checkColumnExt18=t},expression:"checkColumnExt18"}},[e._v("启用")]),e.checkColumnExt18?t("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt18,callback:function(t){e.$set(e.CrmFrom,"columnExt18",t)},expression:"CrmFrom.columnExt18"}},[t("el-radio",{attrs:{label:"1"}},[e._v("省端模型")]),t("el-radio",{attrs:{label:"2"}},[e._v("一级模型")])],1):e._e()],1)],1):e._e(),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"营销用语：",prop:"columnExt2"}},[t("el-input",{attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},model:{value:e.CrmFrom.columnExt2,callback:function(t){e.$set(e.CrmFrom,"columnExt2",t)},expression:"CrmFrom.columnExt2"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"短信内容：",prop:"columnExt3"}},[t("el-input",{attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},model:{value:e.CrmFrom.columnExt3,callback:function(t){e.$set(e.CrmFrom,"columnExt3",t)},expression:"CrmFrom.columnExt3"}})],1)],1)],1)],1),t("materialList",{ref:"material",attrs:{channelId:e.id},on:{addMaterial:e.addMaterial}})],1)},r=[],l=a("0fea"),s=a("5e05"),o=a("f1ce"),n=a("5ed5"),c=a("98d2"),m=a("b893"),u=a("00b8");s["a"].common.getSysEnum;const d=s["a"].common.queryAdivInfo,h=s["a"].common.getAlarmType;s["a"].common.queryHallInfo;var p={props:["channelNewData","id","deleteSub"],components:{materialList:o["a"],Tips:n["a"],UseScript:c["a"]},data(){return{CrmFrom:{adivInfo:{},channelId:"",channelName:"",attributionInfo:{},columnExt1:"1",standard:"",CustomerRules:"",marketingWords:"",columnExt2:"",columnExt3:"",columnExt4:"",columnExt20:"",columnExt5:"",columnExt6:"",columnExt7:"",columnExt8:"",columnExt18:"0",columnExt19:""},showExt18:!1,checkColumnExt18:!1,CrmFromRules:{columnExt1:[{required:!0,message:"请选择推送方式",trigger:"blur"}],marketingWords:[{required:!0,message:"请输入营销话术",trigger:"blur"}],columnExt2:[{required:!0,message:"请输入营销用语",trigger:"blur"}],columnExt4:[{required:!0,message:"请选择任务类型",trigger:"blur"}],columnExt6:[{required:!0,message:"请选择是否为重点活动",trigger:"blur"}],columnExt7:[{required:!0,message:"请选择是否加入抢单",trigger:"blur"}],adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},timeIdList:[],adivList:[],attributionList:[],alarmType:[]}},watch:{channelNewData:{handler(){this.CrmFrom=Object(m["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.checkColumnExt18=this.CrmFrom.columnExt18>0},deep:!0},CrmFrom:{handler(e,t){},deep:!0},deleteSub(){}},mounted(){this.getOptionData(),this.CrmFrom=Object(m["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.checkColumnExt18=this.CrmFrom.columnExt18>0},methods:{getChannelDetail(e){1==e.smartScript&&(this.showExt18=!0)},getOptionData(){Object(l["i"])(d,{channelId:this.id}).then(e=>{this.adivList=e}),Object(l["i"])(h+"?pcode=GWLX").then(e=>{this.alarmType=e})},changeAid(e){var t="";this.adivList.forEach(a=>{e===a.adivId&&(t=a.adivName)}),this.CrmFrom.adivInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,adivName:t})},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t||("906"===this.id||"922"===this.id)&&this.CrmFrom.marketingWords&&this.CrmFrom.adivInfo.adivId?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e},selectMaterial(e){this.$refs["material"].showDialog(e)},addMaterial(e){this.CrmFrom={...this.CrmFrom,columnExt20:e.materialId,materialName:e.materialName}},changeAlarm(e){this.CrmFrom.columnExt5=this.alarmType.filter(t=>t.typeCode===e)[0].typeName},changeScript(e){this.CrmFrom.columnExt19=e.scriptId,this.CrmFrom=Object(u["a"])(e,this.CrmFrom),this.$forceUpdate()}},created(){}},v=p,C=(a("96d7"),a("2877")),b=Object(C["a"])(v,i,r,!1,null,"50b909cb",null);t["a"]=b.exports},e5da:function(e,t,a){},e6f1:function(e,t,a){"use strict";a("8c3a")},e8e4:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mutiple-wrap-content"},[t("Tips",{attrs:{id:e.id}}),t("div",{staticClass:"option"},[t("span",[e._v("推送方式：")]),t("el-radio-group",{model:{value:e.columnExt1,callback:function(t){e.columnExt1=t},expression:"columnExt1"}},[t("el-radio",{attrs:{label:"1",disabled:!e.channelNewData.channelFlag}},[e._v("全量推送")]),t("el-radio",{attrs:{label:"0",disabled:!e.channelNewData.channelFlag}},[e._v("偏好推送")])],1)],1),t("transition-group",{attrs:{name:"fade"}},[e.positionList.length?e._l(e.positionList,(function(a,i){return t("div",{key:a.id,staticClass:"position-content",class:[1===e.positionList.length?"no-border":"",i>=e.currentIndex&&e.showMoveAnimation?"move":""]},[e.positionList.length>1?t("i",{staticClass:"el-icon-close",on:{click:function(t){return e.closePosition(i)}}}):e._e(),t(e.component,{ref:"comRef",refInFor:!0,tag:"component",attrs:{columnExt1:e.columnExt1,channelNewData:a.channelNewData,id:a.id,deleteSub:e.deleteSub,colAdivInfo:a,selectedAdivId:e.selectedAdivId},on:{changeAdiv:t=>e.changeAdiv(t,i),saveChannelData:e.saveChannelData,beforeLeave:e.beforeLeave}})],1)})):e._e()],2)],1)},r=[],l=(a("14d9"),a("0fea")),s=a("5e05"),o=a("a5b3"),n=a("76a4"),c=a("5ed5"),m={name:"MutiplePositionComponent",components:{WillBuyApp:o["a"],ServiceHall:n["a"],Tips:c["a"]},props:["channelNewData","id","deleteSub","adivListCB"],data(){return{component:null,positionList:[],adivList:[],currentIndex:0,showMoveAnimation:!1,columnExt1:"1",selectedAdivId:new Set,adivInfoList:new Array}},watch:{positionList:{handler(e){this.$emit("disableAddAdivFn",e.length===this.adivList.length);let t=new Set;e.forEach(e=>{e.selectedAdivId&&t.add(e.selectedAdivId)}),this.selectedAdivId=t},deep:!0}},created(){var e;this.component=906==this.channelNewData.channelId?"ServiceHall":"WillBuyApp",this.columnExt1=this.channelNewData.columnExt1||(null===(e=this.channelNewData.channelConf)||void 0===e||null===(e=e.channelExtConf)||void 0===e?void 0:e.columnExt1)||"1",this.channelNewData.channelFlag||(this.columnExt1="1"),this.echoData(),this.getAdivList()},methods:{saveChannelData(e,t){if(this.SubInstall(!1)){this.adivInfoList=[];for(let e=0;e<this.positionList.length;e++)this.adivInfoList.push(JSON.parse(JSON.stringify(this.$refs.comRef[e].CrmFrom)));this.adivInfoList.some(e=>!e)||this.$emit("saveChannelData",t,this.adivInfoList)}},beforeLeave(){this.$emit("beforeLeave")},SubInstall(e=!0){let t=[];for(let a=0;a<this.$refs.comRef.length;a++)t.push(this.$refs.comRef[a].SubInstall(e));return!t.some(e=>!1===e)},async getAdivList(){try{const e=await Object(l["i"])(s["a"].common.queryAdivInfo,{channelId:this.id});this.adivList=e;let t=JSON.parse(JSON.stringify(e));for(let a of this.positionList)a.adivList=t}catch(e){}},closePosition(e){this.currentIndex=e,this.showMoveAnimation=!0,this.positionList.splice(e,1),setTimeout(()=>{this.showMoveAnimation=!1},500)},addPosition(){if(!this.SubInstall(!1))return void this.$message.warning("请先填写完整当前运营位信息");let e=JSON.parse(JSON.stringify(this.adivList)),t=JSON.parse(JSON.stringify(this.channelNewData));t.adivInfo.adivId=null,t.adivInfo.adivName=null;let a={id:Date.now()+Math.floor(16777216*Math.random()).toString(16),selectedAdivId:null,adivList:e,channelNewData:t};this.positionList.push(a)},changeAdiv(e,t){this.$set(this.positionList[t],"selectedAdivId",e);let a=new Set;this.positionList.forEach(e=>{e.selectedAdivId&&a.add(e.selectedAdivId)}),this.selectedAdivId=a},echoData(){if(this.adivListCB.length>0){let t=[];for(let a=0;a<this.adivListCB.length;a++){var e;if(null!==(e=this.adivListCB[a])&&void 0!==e&&e.length)for(let e of this.adivListCB[a])if(e.channelId==this.id){t=JSON.parse(JSON.stringify(this.adivListCB[a]));break}}if(0==t.length){let e={id:Date.now()+Math.floor(16777216*Math.random()).toString(16),selectedAdivId:null,adivList:[],channelNewData:JSON.parse(JSON.stringify(this.channelNewData))};this.positionList.push(e)}for(let e=0;e<t.length;e++){let a={id:Date.now()+Math.floor(16777216*Math.random()).toString(16),selectedAdivId:t[e].adivInfo.adivId,adivList:[],channelNewData:JSON.parse(JSON.stringify(t[e]))};this.positionList.push(a)}}else{let e={id:Date.now()+Math.floor(16777216*Math.random()).toString(16),selectedAdivId:null,adivList:[],channelNewData:JSON.parse(JSON.stringify(this.channelNewData))};this.positionList.push(e)}}}},u=m,d=(a("b54e"),a("2877")),h=Object(d["a"])(u,i,r,!1,null,"63aabbd6",null);t["a"]=h.exports},ea45:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("el-dialog",{class:{"title-center":e.titleCenter},attrs:{title:e.title,visible:void 0===e.value?e.visible:e.value,width:e.width,top:e.top,"append-to-body":"","show-close":!1,"close-on-click-modal":!1,"destroy-on-close":e.destroyOnClose},on:{"update:visible":function(t){void 0===e.value?e.visible:e.value=t}}},[t("i",{staticClass:"el-icon-close",on:{click:e.close}}),e._t("default"),t("div",{style:{textAlign:e.footerPosition},attrs:{slot:"footer"},slot:"footer"},[e.showCancelButton?t("el-button",{on:{click:e.close}},[e._v(e._s(e.cancelButtonText))]):e._e(),e._t("footerBtn"),t("el-button",{attrs:{type:"primary",loading:e.confirmLoading},on:{click:e.confirm}},[e._v(e._s(e.confirmButtonText))])],2)],2)},r=[],l={model:{prop:"value",event:"change"},props:{value:{type:void 0|Boolean},visible:{type:void 0|Boolean},titleCenter:{type:Boolean,default:!1},title:{type:String,required:!0},width:{type:String,default:"50%"},top:{type:void 0|String,default:void 0},confirmLoading:{type:Boolean,default:!1},confirmButtonText:{type:String,default:"确 认"},cancelButtonText:{type:String,default:"取 消"},showCancelButton:{type:Boolean,default:!0},footerPosition:{type:String,default:"center"},destroyOnClose:{type:Boolean,default:!0}},methods:{close(){void 0===this.value?this.$emit("close"):this.$emit("change",!1)},confirm(){this.$emit("confirm")}}},s=l,o=(a("b62e"),a("2877")),n=Object(o["a"])(s,i,r,!1,null,"1be2cb38",null);t["a"]=n.exports},eae4:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("transition-group",{attrs:{name:"top-from"}},[e.fileInfo.uploadFileUrl||e.isView?t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],key:"2",staticClass:"file-container"},[e.isView?e._e():t("i",{staticClass:"el-icon-close",on:{click:e.removeFile}}),t("div",{staticClass:"file-info"},[t("el-row",[t("span",[e._v("名称：")]),t("span",{staticClass:"text"},[e._v(e._s(e.fileInfo.uploadFileName))])]),t("el-row",[t("span",[e._v("尺寸：")]),t("span",[e._v(e._s(e.fileInfo.fileSize))])])],1),t("div",{staticClass:"file-view"},["image"===e.type?t("el-image",{attrs:{src:e.fileInfo.fileSrc,"preview-src-list":[e.fileInfo.fileSrc],fit:"fill"}}):e._e()],1)]):t("div",{key:"1",staticClass:"script-upload"},[t("el-upload",{attrs:{action:"/",accept:e.typeInfo.accept,multiple:e.multiple,"show-file-list":!1,"before-upload":e.beforeUpload,"http-request":e.uploadFile}},[t("div",{staticClass:"upload-content"},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v("点击上传"+e._s(e.typeInfo.typeName))]),t("div",{staticClass:"el-upload__info"},[e._v(e._s(e.typeInfo.tip))])])]),e.showProgress?[t("el-progress",{staticClass:"upload-progress",attrs:{percentage:e.progress,"stroke-width":2,status:e.uploadStatus,"text-inside":""}}),t("span",[e._v(e._s(e.progress+"%"))])]:e._e()],2)])},r=[],l=(a("88a7"),a("271a"),a("5494"),a("0fea")),s=a("d39c"),o={model:{prop:"fileObj",event:"change"},props:{isView:{type:Boolean,default:!1},type:{type:String,validator(e){return-1!==["image","video","audio"].indexOf(e)},default:"image"},action:{type:String,default:"/mkt-term-svc/api/uploadScriptMaterial"},multiple:{type:Boolean,default:!1},fileObj:{type:Object,default:()=>{}}},computed:{typeInfo(){switch(this.type){case"image":return{accept:"image/*",typeName:"图片",size:10485760,tip:"文件大小不能超过10M，支持jpg、jpeg、png格式"};case"video":return{accept:"video/*",typeName:"视频",size:104857600,tip:"文件大小不能超过100M，支持mp4、avi、rmvb格式"};case"audio":return{accept:"audio/*",typeName:"音频",size:10485760,tip:"文件大小不能超过10M，支持mp3、wav格式"}}}},data(){return{loading:!1,fileInfo:{uploadFileName:"",uploadFileUrl:"",fileSrc:"",fileSize:""},showProgress:!1,progress:0,uploadStatus:null}},methods:{handleFile(e){if("image"===this.type){const t=new Image;t.src=window.URL.createObjectURL(e),t.onload=()=>{this.fileInfo.fileSize=`${t.width} × ${t.height}`,this.fileInfo.uploadFileName=e.name,this.fileInfo.fileSrc=window.URL.createObjectURL(e)}}if("video"===this.type||"audio"===this.type){this.fileInfo.uploadFileName=e.name,this.fileInfo.fileSrc=window.URL.createObjectURL(e);const t=document.createElement(this.type);t.preload="metadata",t.onloadedmetadata=()=>{window.URL.revokeObjectURL(t.src),this.fileInfo.fileSize=Math.floor(t.duration)+"s"}}},beforeUpload(e){if(e.size>this.typeInfo.size)return this.$message.error(`${this.typeInfo.typeName}大小不能超过${this.typeInfo.size/1024/1024}M, 请重新选择${this.typeInfo.typeName}`),!1;this.handleFile(e)},async uploadFile(e){try{this.showProgress=!0,this.progress=0,this.uploadStatus=null;const t=new FormData;t.append("file",e.file);const{resourceUrl:a}=await Object(l["j"])(this.action,t,this.uploadProgressEvent);this.fileInfo.uploadFileUrl=a;let i={...this.fileInfo};delete i.fileSrc,this.$emit("change",i),this.showProgress=!1,this.progress=0}catch(t){this.uploadStatus="exception",setTimeout(()=>{this.showProgress=!1},1e3)}},uploadProgressEvent(e){this.progress=Math.floor(100*e.loaded/e.total)},removeFile(){this.fileInfo.uploadFileUrl="",this.fileInfo.uploadFileName="",this.fileInfo.fileSrc="",this.fileInfo.fileSize="",this.$emit("change",this.fileInfo)},async setFileInfo(){try{this.loading=!0;const{data:e}=await Object(l["b"])(s["a"].seapi.downloadChanPromptFile,{fileUrlAndName:this.fileInfo.uploadFileUrl}),t=new Blob([e],{type:e.type});this.fileInfo.fileSrc=URL.createObjectURL(t);const a=new File([t],this.fileInfo.uploadFileName||this.fileInfo.uploadFileName||"",{type:e.type});this.handleFile(a)}catch(e){}finally{this.loading=!1}}},created(){this.fileInfo={...this.fileInfo,...this.fileObj},this.fileInfo.uploadFileUrl&&this.setFileInfo()}},n=o,c=(a("f9b4"),a("2877")),m=Object(c["a"])(n,i,r,!1,null,"73835c26",null);t["a"]=m.exports},eafd:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("Tips",{attrs:{id:e.id}}),t("el-form",{ref:"CrmFrom",staticStyle:{width:"100%"},attrs:{"label-width":"145px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"推送方式：",prop:"columnExt1"}},[t("el-radio-group",{model:{value:e.CrmFrom.columnExt1,callback:function(t){e.$set(e.CrmFrom,"columnExt1",t)},expression:"CrmFrom.columnExt1"}},[t("el-radio",{attrs:{label:"1",disabled:!e.CrmFrom.channelFlag}},[e._v("全量推送")]),t("el-radio",{attrs:{label:"0",disabled:!e.CrmFrom.channelFlag}},[e._v("偏好推送")])],1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"切换类型：",prop:"type"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},on:{"visible-change":e.savePreType},model:{value:e.CrmFrom.type,callback:function(t){e.$set(e.CrmFrom,"type",t)},expression:"CrmFrom.type"}},e._l(e.typeList,(function(a){return t("el-option",{key:a.value,attrs:{label:a.label,value:a.value},nativeOn:{click:function(t){return e.clickValidate.apply(null,arguments)}}})})),1)],1)],1),"1"===e.CrmFrom.type?[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"活动标题：",prop:"columnExt2"}},[t("el-input",{directives:[{name:"forbidChars",rawName:"v-forbidChars"}],attrs:{placeholder:"请输入活动标题"},model:{value:e.CrmFrom.columnExt2,callback:function(t){e.$set(e.CrmFrom,"columnExt2",t)},expression:"CrmFrom.columnExt2"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"活动链接：",prop:"columnExt3"}},[t("el-input",{attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},model:{value:e.CrmFrom.columnExt3,callback:function(t){e.$set(e.CrmFrom,"columnExt3",t)},expression:"CrmFrom.columnExt3"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"活动图片：",prop:"columnExt4"}},[t("input",{ref:"uploadRef",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:e.getFile}}),t("el-button",{attrs:{type:"primary",loading:e.uploadLoading},on:{click:e.clickUploadBtn}},[e._v("点击上传")]),t("span",{staticClass:"upload-tip"},[e._v("图片尺寸 长 * 宽＝"),t("em",[e._v("1020(px)")]),e._v(" * "),t("em",[e._v("462(px)")]),e._v("，仅支持"),t("em",[e._v("JPG")]),e._v("格式，文件小于"),t("em",[e._v("1M")])]),e.imgUrl?t("el-image",{staticStyle:{width:"200px",height:"100px"},attrs:{src:e.imgUrl,"preview-src-list":[e.imgUrl]}}):e._e(),e.imgUrl?t("i",{staticClass:"el-icon-close",staticStyle:{color:"red"},on:{click:e.clearFile}}):e._e()],1)],1)]:"2"===e.CrmFrom.type?[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"活动标题：",prop:"columnExt5"}},[t("el-input",{directives:[{name:"forbidChars",rawName:"v-forbidChars"}],attrs:{placeholder:"请输入活动标题"},model:{value:e.CrmFrom.columnExt5,callback:function(t){e.$set(e.CrmFrom,"columnExt5",t)},expression:"CrmFrom.columnExt5"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"活动内容：",prop:"columnExt6"}},[t("el-input",{directives:[{name:"forbidChars",rawName:"v-forbidChars"}],attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"请输入活动内容"},model:{value:e.CrmFrom.columnExt6,callback:function(t){e.$set(e.CrmFrom,"columnExt6",t)},expression:"CrmFrom.columnExt6"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"活动链接：",prop:"columnExt7"}},[t("el-input",{attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"请输入活动链接"},model:{value:e.CrmFrom.columnExt7,callback:function(t){e.$set(e.CrmFrom,"columnExt7",t)},expression:"CrmFrom.columnExt7"}})],1)],1)]:[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"活动标题：",prop:"columnExt8"}},[t("el-input",{directives:[{name:"forbidChars",rawName:"v-forbidChars"}],attrs:{placeholder:"请输入活动标题"},model:{value:e.CrmFrom.columnExt8,callback:function(t){e.$set(e.CrmFrom,"columnExt8",t)},expression:"CrmFrom.columnExt8"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"活动内容：",prop:"columnExt9"}},[t("el-input",{directives:[{name:"forbidChars",rawName:"v-forbidChars"}],attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"请输入活动内容"},model:{value:e.CrmFrom.columnExt9,callback:function(t){e.$set(e.CrmFrom,"columnExt9",t)},expression:"CrmFrom.columnExt9"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"活动链接：",prop:"columnExt10"}},[t("el-input",{attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"请输入活动链接"},model:{value:e.CrmFrom.columnExt10,callback:function(t){e.$set(e.CrmFrom,"columnExt10",t)},expression:"CrmFrom.columnExt10"}})],1)],1)]],2)],1)],1)},r=[],l=(a("88a7"),a("271a"),a("5494"),a("0fea")),s=a("5e05"),o=(a("d39c"),a("5af3")),n=a("5ed5"),c=(a("0b16"),a("0557")),m=a("b893");s["a"].common.getSysEnum;const u=s["a"].common.queryAdivInfo;s["a"].common.queryHallInfo;var d={props:["channelNewData","id","deleteSub"],components:{Tips:n["a"]},data(){return{CrmFrom:{adivInfo:{},channelId:"",channelName:"",attributionInfo:{},columnExt1:"1",standard:"",CustomerRules:"",marketingWords:"",columnExt2:"",columnExt3:"",columnExt4:"",columnExt5:"",columnExt6:"",columnExt7:"",columnExt8:"",columnExt9:"",columnExt10:"",columnExt11:"",type:"1"},CrmFromRules:{columnExt1:[{required:!0,message:"请选择推送方式",trigger:"blur"}],columnExt2:[{required:!0,message:"请输入活动标题",trigger:"blur"}],columnExt3:[{required:!0,message:"请输入活动链接",trigger:"blur"}],columnExt5:[{required:!0,message:"请输入活动标题",trigger:"blur"}],columnExt6:[{required:!0,message:"请输入活动内容",trigger:"blur"}],columnExt4:[{required:!0,message:"请上传活动图片",trigger:"blur"}],columnExt7:[{required:!0,message:"请输入活动链接",trigger:"blur"}],columnExt8:[{required:!0,message:"请输入活动标题",trigger:"blur"}],columnExt9:[{required:!0,message:"请输入活动内容",trigger:"blur"}],columnExt10:[{required:!0,message:"请输入活动链接",trigger:"blur"}],adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},timeIdList:[],adivList:[],attributionList:[],typeList:[{label:"发现栏目",value:"1"},{label:"金币摇钱盒",value:"2"},{label:"消息推送",value:"3"}],preType:"",fileListIMG:[],imgUrl:"",uploadLoading:!1}},computed:{header(){return window.sessionStorage.getItem("IOP_TOKEN")},action(){return c["a"].commonConfig.baseURL+"/plan-svc/api/action/tactics/tacticsCreate/jx/fileUpload"}},watch:{channelNewData:{handler(){this.CrmFrom={...Object(m["d"])(this.channelNewData),type:"1",adivInfo:{adivId:this.id+"1"}},this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"columnExt11",this.CrmFrom.columnExt11||""),this.judgeType(this.CrmFrom)},deep:!0},deleteSub(){}},mounted(){this.getOptionData(),this.CrmFrom={...Object(m["d"])(this.channelNewData),type:"1",adivInfo:{adivId:this.id+"1"}},this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"columnExt11",this.CrmFrom.columnExt11||""),this.judgeType(this.CrmFrom)},methods:{judgeType(e){e.columnExt2?(this.CrmFrom.type="1",Object(o["d"])(this.CrmFrom.columnExt11).then(e=>{this.imgUrl=e})):e.columnExt5?this.CrmFrom.type="2":e.columnExt8?this.CrmFrom.type="3":this.CrmFrom.type="1"},async getOptionData(){await Object(l["i"])(u,{channelId:this.id}).then(e=>{this.adivList=e})},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t||("906"===this.id||"922"===this.id)&&this.CrmFrom.marketingWords&&this.CrmFrom.adivInfo.adivId?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e},clickUploadBtn(){this.$refs["uploadRef"].value=null,this.$refs["uploadRef"].click()},getFile({target:e}){let t=e.files[0],a=t.name.substring(t.name.lastIndexOf(".")+1);if("jpg"!==a)return this.$refs["uploadRef"].value=null,this.$message.error("图片格式不符合要求,请上传jpg格式图片"),!1;if(t.size>1048576)return this.$refs["uploadRef"].value=null,this.$message.error("图片大小不符合要求,请上传小于1M的图片"),!1;let i=new Image,r=URL.createObjectURL(t);i.src=r,i.onload=()=>{1020!=i.width||462!=i.height?(this.$refs["uploadRef"].value=null,this.$message.error("图片尺寸不符合要求,请上传1020*462的图片")):this.uploadPic(t,r)}},async uploadPic(e){this.uploadLoading=!0;try{let t=new FormData;t.append("file",e);const{fileName:a,url:i}=await Object(l["j"])(this.action,t);this.CrmFrom.columnExt4=a,this.CrmFrom.columnExt11=i,this.imgUrl=await Object(o["d"])(i)}catch(t){this.CrmFrom.columnExt4=null,this.CrmFrom.columnExt11=null}finally{this.uploadLoading=!1}},clearFile(){this.CrmFrom.columnExt4=null,this.CrmFrom.columnExt11=null,this.imgUrl=null},savePreType(e){e&&(this.preType=this.CrmFrom.type)},clickValidate(){if(this.preType!=this.CrmFrom.type){if("1"==this.preType){if(this.CrmFrom.columnExt2||this.CrmFrom.columnExt3||this.CrmFrom.columnExt4){let e=["columnExt2","columnExt3","columnExt4"];this.typeValidate(e)}}else if("2"==this.preType){if(this.CrmFrom.columnExt5||this.CrmFrom.columnExt6||this.CrmFrom.columnExt7){let e=["columnExt5","columnExt6","columnExt7"];this.typeValidate(e)}}else if("3"==this.preType&&(this.CrmFrom.columnExt8||this.CrmFrom.columnExt9||this.CrmFrom.columnExt10)){let e=["columnExt8","columnExt9","columnExt10"];this.typeValidate(e)}this.$refs.CrmFrom.clearValidate()}},typeValidate(e){for(let t=0;t<e.length;t++)if(!this.CrmFrom[e[t]])return this.CrmFrom.type=this.preType,this.$nextTick(()=>{this.$refs.CrmFrom.validate(()=>{}),this.$alert("切换类型前，请先填写必填项，或者清空选项数据！","提示",{confirmButtonText:"确定",callback:e=>{this.$refs.CrmFrom.clearValidate()}})})}},created(){}},h=d,p=(a("c87e"),a("2877")),v=Object(p["a"])(h,i,r,!1,null,"748ba195",null);t["a"]=v.exports},eb28:function(e,t,a){},eb2a:function(e,t,a){},ecb5:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("Tips",{attrs:{id:e.id},on:{getChannelDetail:e.getChannelDetail}}),t("el-form",{ref:"CrmFrom",staticStyle:{width:"100%"},attrs:{"label-width":"145px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("el-form-item",{attrs:{label:"推送方式：",prop:"columnExt1"}},[t("el-radio-group",{model:{value:e.CrmFrom.columnExt1,callback:function(t){e.$set(e.CrmFrom,"columnExt1",t)},expression:"CrmFrom.columnExt1"}},[t("el-radio",{attrs:{label:"1",disabled:!e.CrmFrom.channelFlag}},[e._v("全量推送")]),t("el-radio",{attrs:{label:"0",disabled:!e.CrmFrom.channelFlag}},[e._v("偏好推送")])],1)],1),t("el-form-item",{attrs:{label:"运营位：",prop:"adivInfo.adivId"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:e.changeAid},model:{value:e.CrmFrom.adivInfo.adivId,callback:function(t){e.$set(e.CrmFrom.adivInfo,"adivId",t)},expression:"CrmFrom.adivInfo.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1),e.showMessage?t("el-form-item",{attrs:{label:"短信模板：",prop:"columnExt2"}},[t("div",{staticClass:"short-message"},e._l(e.radioGroup,(function(a){return t("div",{key:a.typeId,staticClass:"radio-group"},[t("span",[e._v(e._s(a.typeName)+"：")]),e._l(a.templateList,(function(a){return t("el-tooltip",{key:a.templateId,attrs:{placement:"top"}},[t("div",{staticClass:"tool-tip",attrs:{slot:"content"},slot:"content"},[e._v(e._s(a.templateContent))]),t("el-radio",{attrs:{label:a.templateId,border:"",size:"medium"},model:{value:e.CrmFrom.columnExt2,callback:function(t){e.$set(e.CrmFrom,"columnExt2",t)},expression:"CrmFrom.columnExt2"}},[e._v(" "+e._s(a.templateId+" | "+a.templateName))])],1)}))],2)})),0)]):e._e(),e.showExt18?t("el-form-item",{attrs:{label:"智能话术："}},[t("el-checkbox",{on:{change:()=>e.CrmFrom.columnExt18=e.checkColumnExt18?"1":"0"},model:{value:e.checkColumnExt18,callback:function(t){e.checkColumnExt18=t},expression:"checkColumnExt18"}},[e._v("启用")]),e.checkColumnExt18?t("el-radio-group",{staticStyle:{"margin-left":"20px"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt18,callback:function(t){e.$set(e.CrmFrom,"columnExt18",t)},expression:"CrmFrom.columnExt18"}},[t("el-radio",{attrs:{label:"1"}},[e._v("省端模型")]),t("el-radio",{attrs:{label:"2"}},[e._v("一级IOP模型")])],1):e._e()],1):e._e(),t("el-form-item",{attrs:{label:"推荐用语：",prop:"EXEC_CONTENT"}},[t("el-input",{attrs:{type:"textarea",maxlength:"300","show-word-limit":"",rows:8,placeholder:"您还可以输入300个字"},model:{value:e.CrmFrom.EXEC_CONTENT,callback:function(t){e.$set(e.CrmFrom,"EXEC_CONTENT",t)},expression:"CrmFrom.EXEC_CONTENT"}}),t("div",{staticClass:"button"},[t("div",{staticClass:"sub-otton",on:{click:function(t){return e.openDilog(!0)}}},[e._v("营销用语模板")]),t("div",{staticClass:"sub-otton",on:{click:function(t){return e.openDilog(!1)}}},[e._v("自定义短信用语")])])],1)],1),t("ShortMessageList",{ref:"messageList",attrs:{tableData:e.tableData,cols:e.cols,channelId:e.id},on:{addShortMessage:e.addShortMessage,getSmsContentTemplateList:e.getSmsContentTemplateList}})],1)},r=[],l=a("0fea"),s=a("5e05"),o=(a("0b16"),a("c3eb")),n=a("5ed5"),c=a("b893");const m=s["a"].common.getSysEnum,u=s["a"].common.queryAdivInfo,d=s["a"].common.queryHallInfo;var h={props:["channelNewData","id","deleteSub"],components:{ShortMessageList:o["a"],Tips:n["a"]},data(){return{CrmFrom:{adivInfo:{},channelId:"",channelName:"",attributionInfo:{},columnExt1:"1",standard:"",CustomerRules:"",marketingWords:"",EXEC_CONTENT:"",columnExt2:"",columnExt18:"0"},showExt18:!1,checkColumnExt18:!1,dialogVisible:!1,tableData:[],cols:[{label:"模板编号",props:"id"},{label:"模板内容",props:"content"}],CrmFromRules:{columnExt1:[{required:!0,message:"请选择推送方式",trigger:"blur"}],marketingWords:[{required:!0,message:"请输入营销话术",trigger:"blur"}],EXEC_CONTENT:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],columnExt2:[{required:!0,message:"请选择短信模板",trigger:"blur"}],adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]},channelConf:{execContent:[{required:!0,message:"请输入推荐用语",trigger:"blur"}],smsContent:[{required:!0,message:"请输入短信用语",trigger:"blur"}]}},timeIdList:[],adivList:[],attributionList:[],templateId:"",radioGroup:[],showMessage:!1,sceneParams:{}}},watch:{channelNewData:{handler(){this.CrmFrom=Object(c["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.checkColumnExt18=this.CrmFrom.columnExt18>0},deep:!0},CrmFrom:{handler(e,t){},deep:!0},deleteSub(){},async shortMessage(e){await Object(l["i"])(s["a"].common.getShortMessage,{channelId:this.id,adviId:e}).then(e=>{this.radioGroup=e,this.showMessage=!0})}},computed:{shortMessage(){return this.CrmFrom.adivInfo.adivId}},mounted(){this.getOptionData(),this.CrmFrom=Object(c["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.checkColumnExt18=this.CrmFrom.columnExt18>0},methods:{getChannelDetail(e){1==e.smartScript&&(this.showExt18=!0)},async getOptionData(){await Object(l["i"])(m,{enumType:"iop_time_id"}).then(e=>{this.timeIdList=e}),await Object(l["i"])(u,{channelId:this.id}).then(e=>{this.adivList=e}),await Object(l["i"])(d,{}).then(e=>{this.attributionList=e})},async changeAid(e){var t="";this.adivList.forEach(a=>{e===a.adivId&&(t=a.adivName)}),this.CrmFrom.adivInfo=Object.assign({},this.CrmFrom.adivInfo,{adivId:e,adivName:t})},SubInstall(){var e=!0;return this.$refs.CrmFrom.validate(t=>{t||("906"===this.id||"922"===this.id)&&this.CrmFrom.marketingWords&&this.CrmFrom.adivInfo.adivId?(this.$emit("saveChannelData",this.CrmFrom),e=!0):e=!1}),e},openDilog(e){this.$refs["messageList"].showDialog(e)},addShortMessage(e){this.CrmFrom={...this.CrmFrom,EXEC_CONTENT:e.row.content}},async getSmsContentTemplateList(e){await Object(l["i"])(s["a"].common.getSmsContentTemplateList,e).then(e=>{e.width=570,this.tableData=e})}},created(){}},p=h,v=(a("661d"),a("2877")),C=Object(v["a"])(p,i,r,!1,null,"16fdfa08",null);t["a"]=C.exports},f04e:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("el-form",{ref:"CrmFrom",attrs:{"label-width":"145px",model:e.CrmFrom,rules:e.CrmFromRules}},[t("Tips",{attrs:{id:e.id}}),t("el-form-item",{attrs:{label:"推送方式：",prop:"columnExt1"}},[t("el-radio-group",{model:{value:e.CrmFrom.columnExt1,callback:function(t){e.$set(e.CrmFrom,"columnExt1",t)},expression:"CrmFrom.columnExt1"}},[t("el-radio",{attrs:{label:"1",disabled:!e.CrmFrom.channelFlag}},[e._v("全量推送")]),t("el-radio",{attrs:{label:"0",disabled:!e.CrmFrom.channelFlag}},[e._v("偏好推送")])],1)],1),t("el-form-item",{attrs:{label:"运营位：",prop:"adivInfo.adivId"}},[t("el-select",{attrs:{placeholder:"请选择运营位"},on:{change:e.changeAdiv},model:{value:e.CrmFrom.adivInfo.adivId,callback:function(t){e.$set(e.CrmFrom.adivInfo,"adivId",t)},expression:"CrmFrom.adivInfo.adivId"}},e._l(e.adivList,(function(e){return t("el-option",{key:e.adivId,attrs:{label:e.adivName,value:e.adivId}})})),1)],1),t("el-form-item",{attrs:{label:"素材：",prop:"columnExt2"}},[t("el-select",{attrs:{disabled:!e.CrmFrom.adivInfo.adivId,filterable:"",placeholder:"请选择素材"},on:{change:e.changeMater},model:{value:e.CrmFrom.columnExt2,callback:function(t){e.$set(e.CrmFrom,"columnExt2",t)},expression:"CrmFrom.columnExt2"}},e._l(e.materList,(function(e){return t("el-option",{key:e.materialId,attrs:{label:e.materialName,value:e.materialId,disabled:e.disabled}})})),1),t("span",{staticStyle:{"margin-left":"10px",color:"#aaa"}},[e._v("目前仅支持图片素材")]),e.CrmFrom.columnExt2?t("div",{staticClass:"mater-desc"},[t("el-button",{attrs:{type:"text",size:"medium"},on:{click:e.onPreview}},[e._v("预览素材")]),t("span",[e._v("素材ID："+e._s(e.CrmFrom.columnExt2))])],1):e._e(),t("el-image",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"preview",attrs:{src:e.srcList[0],"preview-src-list":e.srcList}})],1),t("el-form-item",{attrs:{label:"链接：",prop:"columnExt6"}},[t("el-input",{attrs:{placeholder:"请输入链接地址"},on:{input:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt6,callback:function(t){e.$set(e.CrmFrom,"columnExt6",t)},expression:"CrmFrom.columnExt6"}})],1),t("el-form-item",{attrs:{label:"描述：",prop:"columnExt5"}},[t("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入描述"},on:{input:function(t){return e.$forceUpdate()}},model:{value:e.CrmFrom.columnExt5,callback:function(t){e.$set(e.CrmFrom,"columnExt5",t)},expression:"CrmFrom.columnExt5"}})],1)],1)},r=[],l=(a("14d9"),a("0fea")),s=a("5e05"),o=a("5af3"),n=a("b893"),c=a("f9ae"),m=a("5ed5"),u={props:["channelNewData","id"],components:{Tips:m["a"]},data(){return{CrmFrom:{adivInfo:{adivId:"",adivName:""},channelId:"",channelName:"",columnExt1:"1",columnExt2:"",columnExt3:"",columnExt4:"",columnExt5:"",columnExt6:""},CrmFromRules:{columnExt1:[{required:!0,message:"请选择推送方式",trigger:"blur"}],columnExt2:[{required:!0,message:"请选择素材",trigger:"blur"}],adivInfo:{adivId:[{required:!0,message:"请选择运营位",trigger:"change"}]}},adivList:[],materList:[],srcList:[]}},computed:{SceneNodeData(){return this.$store.state.MarkPl.SceneNodeData},materIdList(){if(!this.isWave)return[];const e=[];for(let i=0;i<this.SceneNodeData.length;i++)for(let r=0;r<this.SceneNodeData[i].length;r++){const l=this.SceneNodeData[i][r];var t,a;if("channelDialog"===l.assembly)if("968"===(null===(t=l.NodeObj[0])||void 0===t?void 0:t.channelId))(l.NodeObj[0].columnExt2||null!==(a=l.NodeObj[0].channelConf)&&void 0!==a&&null!==(a=a.channelExtConf)&&void 0!==a&&a.columnExt2)&&e.push(l.NodeObj[0].columnExt2||l.NodeObj[0].channelConf.channelExtConf.columnExt2)}return e},isWave(){return"3"==this.$store.state.MarkPl.ProcessData.example_type}},watch:{channelNewData:{handler(){var e;this.CrmFrom=Object(n["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"columnExt2",this.channelNewData.columnExt2||(null===(e=this.channelNewData.channelConf)||void 0===e||null===(e=e.channelExtConf)||void 0===e?void 0:e.columnExt2)||"")},deep:!0}},methods:{getAdivList(){Object(l["i"])(s["a"].common.queryAdivInfo,{channelId:this.id}).then(e=>{this.adivList=e})},disabledMater(e,t){if(this.isWave&&this.materIdList.length)for(const a of this.materIdList){const i=e.find(e=>e.materialId===a);i&&i.materialId!==t&&(i.disabled=!0)}return e},getMater(){Object(l["i"])(s["a"].common.getMater,{channelId:this.id,positionId:this.CrmFrom.adivInfo.adivId}).then(e=>{if(this.CrmFrom.columnExt2){const t={materialId:this.CrmFrom.columnExt2,materialName:this.CrmFrom.columnExt3,resourceUrl:this.CrmFrom.columnExt4,description:this.CrmFrom.columnExt5,targetUrl:this.CrmFrom.columnExt6};e.some(e=>e.materialId===t.materialId)||e.push(t)}this.materList=this.disabledMater(e,this.CrmFrom.columnExt2)})},changeAdiv(e){const t=this.adivList.find(t=>t.adivId===e);this.CrmFrom.adivInfo=t||{},this.CrmFrom.columnExt2="",this.CrmFrom.columnExt3="",this.CrmFrom.columnExt4="",this.getMater()},changeMater(e){this.srcList=[];const t=this.materList.find(t=>t.materialId===e);this.CrmFrom.columnExt3=t.materialName,this.CrmFrom.columnExt4=t.resourceUrl,this.CrmFrom.columnExt5=t.description,this.CrmFrom.columnExt6=t.targetUrl},async onPreview(){if(this.srcList.length)this.$refs.preview.clickHandler();else try{const e=await Object(o["d"])(this.CrmFrom.columnExt4);this.srcList=[e],this.$nextTick(()=>{this.$refs.preview.clickHandler()})}catch(e){}},SubInstall(){let e=!0;return this.$refs.CrmFrom.validate(t=>{if(t){if(this.CrmFrom.columnExt6&&!Object(c["e"])(this.CrmFrom.columnExt6))return setTimeout(()=>{this.$alert("链接格式不正确","提示",{confirmButtonText:"确定",customClass:"errorPrompt"})},200),e=!1,e;this.$emit("saveChannelData",this.CrmFrom),e=!0}else e=!1}),e}},created(){var e;this.getAdivList(),this.CrmFrom=Object(n["d"])(this.channelNewData),this.$set(this.CrmFrom,"columnExt1",this.channelNewData.columnExt1||"1"),this.$set(this.CrmFrom,"columnExt2",this.channelNewData.columnExt2||(null===(e=this.channelNewData.channelConf)||void 0===e||null===(e=e.channelExtConf)||void 0===e?void 0:e.columnExt2)||""),this.CrmFrom.adivInfo.adivId&&this.getMater()}},d=u,h=(a("c98a"),a("2877")),p=Object(h["a"])(d,i,r,!1,null,"330b0784",null);t["a"]=p.exports},f1ce:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"标准化素材",visible:e.dialogVisible,modal:!1,width:"760px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("div",{staticClass:"search"},[t("el-form",{ref:"queryForm",staticStyle:{width:"100%"},attrs:{"label-width":"90px",model:e.queryForm}},[t("el-row",[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"创建人：",prop:"creator"}},[t("el-input",{attrs:{placeholder:"请输入创建人"},model:{value:e.queryForm.creator,callback:function(t){e.$set(e.queryForm,"creator",t)},expression:"queryForm.creator"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"素材名称：",prop:"materialName"}},[t("el-input",{attrs:{placeholder:"请输入素材名称"},model:{value:e.queryForm.materialName,callback:function(t){e.$set(e.queryForm,"materialName",t)},expression:"queryForm.materialName"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"素材类型：",prop:"materialName"}},[t("el-select",{attrs:{placeholder:"请选择类型",disabled:""},model:{value:e.queryForm.value,callback:function(t){e.$set(e.queryForm,"value",t)},expression:"queryForm.value"}},e._l(e.requirement,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("div",{staticClass:"bottpn"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.getMaterialList()}}},[e._v("搜索")])],1)],1)],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"","highlight-current-row":""},on:{"row-click":e.singleElection}},[t("el-table-column",{attrs:{align:"center",width:"55",label:"选择",fixed:""},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-radio",{staticClass:"radio",attrs:{label:a.row.materialId},model:{value:e.templateSelection,callback:function(t){e.templateSelection=t},expression:"templateSelection"}},[e._v(" ")])]}}])}),t("el-table-column",{attrs:{prop:"materialName",label:"素材名称","show-overflow-tooltip":!0}}),t("el-table-column",{attrs:{prop:"materialType",label:"类型"}}),t("el-table-column",{attrs:{prop:"planName",label:"产品名称","show-overflow-tooltip":!0}}),t("el-table-column",{attrs:{prop:"planId",label:"产品编号"}}),t("el-table-column",{attrs:{prop:"targetUrl",label:"链接","show-overflow-tooltip":!0}}),t("el-table-column",{attrs:{prop:"creator",label:"创建人"}}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间","show-overflow-tooltip":!0}})],1),t("div",{staticClass:"pager"},[t("el-pagination",{attrs:{"current-page":e.queryForm.current,"page-size":e.queryForm.size,layout:"total, prev, pager, next, jumper",total:e.queryForm.total},on:{"current-change":e.handleCurrentChange}})],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("确 定")])],1)],1)},r=[],l=a("0fea"),s=a("5e05"),o={props:["channelId","adivId"],data(){return{dialogVisible:!1,tableData:[],templateSelection:"",checkList:[],queryForm:{creator:"",materialName:"",size:10,current:1,positionId:"",channelId:"",total:10,value:"1"},requirement:[{label:"文字",value:"1"}]}},mounted(){this.getMaterialList()},computed:{planId(){return this.$store.state.MarkPl.SceneNodeData[0][0].NodeObj.filter(e=>"product"===e.flag)[0].planId}},methods:{async getMaterialList(){const e={creator:this.queryForm.creator,materialName:this.queryForm.materialName,positionId:this.adivId,channelId:this.channelId,planId:this.planId,size:this.queryForm.size,current:this.queryForm.current};let t=await Object(l["i"])(s["a"].common.getMaterialList,e);this.queryForm={...this.queryForm,total:t.total},this.tableData=t.records.map(e=>("0"===e.materialType?e.materialType="图片":"0"===e.materialType?e.materialType="文字":e.materialType="视频",e))},showDialog(e){this.dialogVisible=e},singleElection(e){this.templateSelection=e.materialId,this.checkList=this.tableData.filter(t=>t.materialId===e.materialId),this.$emit("addMaterial",e)},handleCurrentChange(e){this.queryForm.current=e}}},n=o,c=(a("bc05"),a("2877")),m=Object(c["a"])(n,i,r,!1,null,"375d7c70",null);t["a"]=m.exports},f26a:function(e,t,a){e.exports=a.p+"img/word.6dc42442.png"},f3ba:function(e,t,a){"use strict";const i="/plan-svc/api/home/";t["a"]={home:{queryPlanCount:i+"queryPlanCount",querySaleSituation:i+"jx/querySaleSituation",tacticsOverallAll:"/plan-svc/tacticOverview",queryTacticsByUserId:"/plan-svc/api/home/jx/queryTacticsByUserId",queryGoodAcitive:i+"",queryIopTemplate:"/plan-svc/action/iop/excellentTemplateManager/queryIopTemplate",excellentRecomCamp:"/plan-svc/api/home/jx/excellentRecomCamp"}}},f7b7:function(e,t,a){},f8fd:function(e,t,a){},f9b4:function(e,t,a){"use strict";a("75c8")},fa86:function(e,t,a){"use strict";a("8553")},fb59:function(e,t,a){"use strict";a("d013")},fcff:function(e,t,a){e.exports=a.p+"img/excel.2485de68.png"}}]);