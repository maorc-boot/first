(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1ee1416c"],{"0853":function(e,t,a){},"08ab":function(e,t,a){},"0918":function(e,t,a){},"0bec":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"zy-step"},[e.dataSource&&e.dataSource.length>0?t("div",[e.title?t("div",{staticClass:"title"},[e._v(e._s(e.title))]):e._e(),t("div",{staticClass:"step-box"},e._l(e.dataSource,(function(a,s){return t("div",{key:s,staticClass:"item1",class:e.position(s)},e._l(a,(function(a,i){return t("div",{key:i,staticClass:"item mt10",staticStyle:{width:"100%"}},[t("div",{staticClass:"icon",class:{lineleft:0!==s,line:s!==e.dataSource.length-1}},[1===Number(a.submitStatus)?t("i",{staticClass:"el-icon-success fontsize",class:{cur1:1===Number(a.submitStatus)}}):t("i",{staticClass:"el-icon-time fontsize"})]),t("div",{staticClass:"name",class:{cur1:1===Number(a.submitStatus)}},[e._v(" "+e._s(a.nodeName)+" ")]),t("div",{staticClass:"time"},[e._v(" "+e._s(a.instanceId)+" ")])])})),0)})),0),e._t("default")],2):t("div",{staticClass:"no-data"},[e._v("暂无审批记录")])])},i=[],n={props:{title:{type:String},dataSource:{type:Array}},data(){return{}},computed:{position:function(){return(e,t)=>{let a=0;return this.dataSource.map(e=>{e.length>a&&(a=e.length)}),e>=this.dataSource.length-1?"":this.dataSource[e].length<this.dataSource[e+1].length||this.dataSource[e].length>this.dataSource[e+1].length?"linehigh":""}}},methods:{},mounted(){},watch:{}},o=n,l=(a("0ca8"),a("2877")),r=Object(l["a"])(o,s,i,!1,null,"6d48b568",null);t["a"]=r.exports},"0ca8":function(e,t,a){"use strict";a("86e5")},"0ed7":function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return l}));var s=a("0fea"),i=a("cdbb");async function n(e){return Object(s["i"])(i["a"].getScriptPreview+"?scriptId="+e)}async function o(e){return Object(s["i"])(i["a"].clickScript+"?scriptId="+e)}async function l(){const e=await Object(s["g"])(i["a"].getTermRule);return e}},1059:function(e,t,a){},"13d5":function(e,t,a){"use strict";var s=a("23e7"),i=a("d58f").left,n=a("a640"),o=a("2d00"),l=a("605d"),r=!l&&o>79&&o<83,c=r||!n("reduce");s({target:"Array",proto:!0,forced:c},{reduce:function(e){var t=arguments.length;return i(this,e,t,t>1?arguments[1]:void 0)}})},"1b3c":function(e,t,a){"use strict";a("8fc5")},"1c45":function(e,t,a){},"1d25":function(e,t,a){},2102:function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"script-container"},[t("el-form",e._l(e.marketingWords,(function(a,s){var i;return t("el-form-item",{key:s,attrs:{label:e.marketingWords.length>1?a.typeName+"：":"","label-width":e.marketingWords.length>1?"100px":"10px"}},[a.list&&a.list.length?e._l(a.list,(function(a){return t("div",{key:a.name},[t("header",[e._v("【"+e._s(a.name)+"】")]),t("div",{domProps:{innerHTML:e._s(a.content)}})])})):e._e(),a.uploadType||null!==(i=a.list)&&void 0!==i&&i.length?e._e():t("span",[e._v(e._s(a.content))]),a.uploadType?[t("Upload",{attrs:{"is-view":!0,type:"1"==a.uploadType?"image":"2"==a.uploadType?"video":"3"==a.uploadType?"audio":"image"},model:{value:e.marketingWords[s],callback:function(t){e.$set(e.marketingWords,s,t)},expression:"marketingWords[i]"}}),t("div",{staticClass:"link"},[t("span",[e._v("跳转链接：")]),t("el-link",{attrs:{underline:!1,href:a.linkUrl,target:"_blank"}},[e._v(e._s(a.linkUrl))])],1)]:e._e()],2)})),1)],1)},i=[],n=a("eae4"),o={components:{Upload:n["a"]},props:{marketingWords:{type:Array,default:()=>[]}}},l=o,r=(a("327a"),a("2877")),c=Object(r["a"])(l,s,i,!1,null,"4a48a557",null);t["a"]=c.exports},"27ac":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"before-rehearsal"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableData,"span-method":e.objectSpanMethod,border:""}},e._l(e.column1,(function(a){return t("el-table-column",{key:a.prop,attrs:{prop:a.prop,label:a.label,width:a.width||"auto","render-header":e.renderHeader,align:"center","show-overflow-tooltip":""}})})),1),t("header",[e._v("转化率预测")]),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableData,"span-method":e.objectSpanMethod,border:""}},e._l(e.column2,(function(e){return t("el-table-column",{key:e.prop,attrs:{prop:e.prop,label:e.label,align:"center","show-overflow-tooltip":""}})})),1),t("div",{staticClass:"tip"},[e._v("转化率=∑【预演后客群每个人的产品偏好度(归一化处理) X 预演后客群每个人的渠道偏好度(归一化处理)】/ 预演后客群数")])],1)},i=[],n=a("0fea"),o=a("d370"),l={data(){return{loading:!1,tableData:[],column1:[{label:"产品名称",prop:"planName",width:150},{label:"客户群",prop:"custgroupName",width:120},{label:"原始目标,客群数",prop:"targetCustomNum",width:"80",renderHeader:this.renderHeader},{label:"执行渠道",prop:"channelName"},{label:"预演",prop:"status"},{label:"开始时间",prop:"startTime",width:90},{label:"结束时间",prop:"endTime",width:90},{label:"预演完成,客群数",prop:"previewCustomNum",width:"80",renderHeader:this.renderHeader},{label:"预演,总剔除数",prop:"filterTotal",width:"80",renderHeader:this.renderHeader},{label:"已订购,删除",prop:"filterCount1",width:"80",renderHeader:this.renderHeader},{label:"已订购,互斥删除",prop:"filterCount2",width:"80",renderHeader:this.renderHeader},{label:"已推荐,删除",prop:"filterCount3",width:"80",renderHeader:this.renderHeader},{label:"频次剔除",prop:"filterCount4"},{label:"渠道偏好,剔除",prop:"filterCount5",width:"80",renderHeader:this.renderHeader},{label:"特殊名单,剔除",prop:"otherFilterCount",width:"80",renderHeader:this.renderHeader}],column2:[{label:"产品名称",prop:"planName"},{label:"执行渠道",prop:"channelName"},{label:"产品偏好度",prop:"planAccuracyRate"},{label:"渠道偏好度",prop:"contactCoverage"},{label:"转化率预测",prop:"sucessRate"}]}},methods:{async getTableData(){const{campsegRootId:e,campsegId:t}=this.$route.query,a={campsegId:t,campsegRootId:e};try{this.loading=!0;const s=await Object(n["i"])(o["a"].mpapi.getBeforeRehearsal+`?campsegRootId=${e}&&campsegId=${t||""}`,a);this.tableData=this.getSpanFlag(s)}catch(s){}finally{this.loading=!1}},renderHeader(e,{column:t}){return e("div",{},[e("div",{},t.label.split(",")[0]),e("div",{},t.label.split(",")[1])])},objectSpanMethod({row:e,column:t,rowIndex:a,columnIndex:s}){if(0===s)return e.spanFlag?{rowspan:this.tableData.filter(t=>t.planName===e.planName).length,colspan:1}:{rowspan:0,colspan:0}},getSpanFlag(e){const t=e.sort((e,t)=>e.planId-t.planId);return t.map((e,a)=>t.findIndex(t=>t.planName===e.planName)===a?{...e,status:"支持",spanFlag:!0}:{...e,status:"支持",spanFlag:!1})}},mounted(){this.getTableData()}},r=l,c=(a("c29d"),a("2877")),p=Object(c["a"])(r,s,i,!1,null,"57eafbe6",null);t["a"]=p.exports},"2ec76":function(e,t,a){"use strict";a("d946")},"2f14":function(e,t,a){},"327a":function(e,t,a){"use strict";a("0918")},"335d":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"chanel-table"},[t("div",{staticClass:"time"},[t("span",[e._v("日期：")]),t("el-date-picker",{staticStyle:{width:"215px"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd"},on:{change:e.changeDate},model:{value:e.queryTime,callback:function(t){e.queryTime=t},expression:"queryTime"}})],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableData,stripe:"",border:"","header-cell-class-name":"c-header","cell-class-name":"c-body"}},[t("el-table-column",{attrs:{prop:"channelId",label:"渠道ID"}}),t("el-table-column",{attrs:{prop:"channelName",label:"渠道名称"}}),t("el-table-column",{attrs:{prop:"filterRule",label:"过滤规则"}}),t("el-table-column",{attrs:{prop:"filterNum",label:"过滤数量"}})],1)],1)},i=[],n=a("0fea"),o=a("d370"),l=a("c1df"),r=a.n(l),c={name:"RemindFilter",data(){return{loading:!1,queryTime:null,query:{campsegId:"",startDate:"",endDate:""},tableData:[]}},methods:{changeDate(e){e?(this.query.startDate=e[0],this.query.endDate=e[1]):(this.query.startDate="",this.query.endDate=""),this.getRemindList()},async getRemindList(){var e,t;let a=null===(e=this.$store.state.MarkPl.SceneNodeData[0][2])||void 0===e?void 0:e.NodeObj,s=null===a||void 0===a||null===(t=a.map(e=>e.channelId))||void 0===t?void 0:t.toString();try{this.loading=!0,this.query.campsegId=this.$route.query.campsegRootId;const e=await Object(n["i"])(o["a"].mpapi.getAlterCenterInfo,{...this.query,channelId:s});this.tableData=e}catch(i){}finally{this.loading=!1}}},created(){this.queryTime=[r()().startOf("month").format("YYYY-MM-DD"),r()().endOf("month").format("YYYY-MM-DD")],this.query.startDate=this.queryTime[0],this.query.endDate=this.queryTime[1],this.getRemindList()}},p=c,d=(a("883d"),a("2877")),u=Object(d["a"])(p,s,i,!1,null,"e6330582",null);t["a"]=u.exports},"38b1":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",e._l(e.channelList,(function(a){var s,i,n;return t("div",{key:a.channelId,staticClass:"info-preview"},[t("header",[e._v(e._s(a.channelName))]),t("div",{directives:[{name:"loading",rawName:"v-loading",value:a.loading,expression:"channel.loading"}]},[null!==(s=a.scriptInfo)&&void 0!==s&&s.marketingWords&&null!==(i=a.scriptInfo)&&void 0!==i&&i.marketingWords.length?t("MarketingWordsPreview",{attrs:{"marketing-words":(null===(n=a.scriptInfo)||void 0===n?void 0:n.marketingWords)||[]}}):t("div",{staticClass:"empty"},[t("el-empty",{attrs:{description:"未引用话术"}})],1)],1)])})),0)},i=[],n=(a("14d9"),a("ac7c"),a("0ed7")),o=a("5a4a"),l=a("2102"),r={components:{MarketingWordsPreview:l["a"]},props:{campInfoList:{type:Array,default:()=>[]}},watch:{campInfoList:{handler(e){null!==e&&void 0!==e&&e.length&&this.getChannelList(e)},deep:!0,immediate:!0}},data(){return{loading:!1,channelList:[]}},methods:{getChannelList(e){const t=JSON.parse(JSON.stringify(e));this.channelList=[];for(let i=0;i<t.length;i++)t[i].channels&&t[i].channels.length&&this.channelList.push(...t[i].channels);for(let i of this.channelList){var a,s;if(this.$set(i,"loading",!1),null!==(a=i.channelConf)&&void 0!==a&&null!==(a=a.channelExtConf)&&void 0!==a&&a.columnExt19)this.getScriptInfo(null===(s=i.channelConf)||void 0===s||null===(s=s.channelExtConf)||void 0===s?void 0:s.columnExt19,i)}},async getScriptInfo(e,t){t.loading=!0,Object(n["b"])(e).then(e=>{this.$set(t,"scriptInfo",Object(o["c"])(e))}).finally(()=>{t.loading=!1})}}},c=r,p=(a("e8b9"),a("2877")),d=Object(p["a"])(c,s,i,!1,null,"6f028226",null);t["a"]=d.exports},4356:function(e,t,a){"use strict";a("cb59")},"44e6":function(e,t,a){},4927:function(e,t,a){},"4ce3":function(e,t,a){"use strict";a("1d25")},"4cec":function(e,t,a){"use strict";a("e349")},"51a5":function(e,t,a){"use strict";a("1059")},5624:function(e,t,a){},"605d":function(e,t,a){"use strict";var s=a("da84"),i=a("c6b6");e.exports="process"===i(s.process)},"649d":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ActiveNode"},[t("div",{staticClass:"Active"},e._l(e.ActiveNode,(function(a,s){return t("div",{key:s},[t("ul",{key:s,ref:"lavender",refInFor:!0,staticClass:"lavender-box"},e._l(a.group,(function(s,i){return t("li",{key:i,class:`${e.Arrow(a,i)} ${s.className}`,attrs:{data:s.id+"-"+i},on:{click:function(t){return t.stopPropagation(),e.NodeClick(s,t)}}},[t("div",{staticClass:"lavender-header-after"}),t("div",{staticClass:"lavender-header"},[t("el-checkbox",{model:{value:s.checked,callback:function(t){e.$set(s,"checked",t)},expression:"data.checked"}},[t("span",[e._v(e._s(s.label))])]),t("i",{staticClass:"el-icon-more"})],1),t("div",{staticClass:"ArrowBottom"}),s.status?e._e():t("div",[t("div",{staticClass:"product-sub"},["选产品"===s.label?t("p",[e._v(" 主产品")]):e._e(),t("span",[e._v(e._s(e.filterData(s.content)))])]),"选产品"===s.label?[s.fuse?t("div",{staticClass:"product-sub"},[t("p",[e._v("融合产品")]),t("span",[e._v(e._s(s.fuse))])]):e._e(),s.homologous?t("div",{staticClass:"product-sub"},[t("p",[e._v("同系列产品")]),t("span",[e._v(e._s(s.homologous))])]):e._e(),s.mutual?t("div",{staticClass:"product-sub"},[t("p",[e._v("互斥产品")]),t("span",[e._v(e._s(s.mutual))])]):e._e()]:e._e()],2)])})),0),t("ActiveNode",{attrs:{ActiveNode:a.children},on:{"Node-click":e.ActiveNodeClick}})],1)})),0)])},i=[],n=(a("14d9"),{name:"ActiveNode",comments:{},props:{ActiveNode:{type:Array,default:()=>[]}},data(){return{checked:!1,maxLength:0,maxwidth:"0",params:""}},watch:{ActiveNode:function(e,t){this.recalculatePosition()}},computed:{Arrow(){return function(e,t){return t!==e.group.length-1?"arrow1":"arrow"+e.children.length}}},mounted(){var e=0;this.ActiveNode.map(t=>{e<t.length&&(e=t.length)}),this.maxLength=e,this.recalculatePosition()},methods:{NodeClick(e,t){t.stopPropagation(),e.checked=!e.checked,this.$emit("Node-click",e)},ActiveNodeClick(e){this.$emit("Node-click",e)},SkipProgress(e){"INPUT"!==e.target.tagName||e.stopPropagation()},recalculatePosition(){this.$nextTick().then(()=>{void 0!==this.$refs.lavender&&this.$refs.lavender.map(e=>{var t=e.nextSibling.cloneNode(!0),a=e.nextSibling,s=t.getElementsByClassName("ActiveNode");for(let c=s.length-1;c>=0;c--)s[c].remove();var i=[],n=a.getElementsByClassName("lavender-box"),o=t.getElementsByClassName("lavender-box");for(let c=n.length-1;c>=0;c--)for(let e=o.length-1;e>=0;e--)o[e].firstElementChild.attributes["data"].value===n[c].firstElementChild.attributes["data"].value&&i.push(n[c].firstElementChild);if(0!==i.length&&1!==i.length){var l=i[0].offsetWidth,r=i[i.length-1].offsetWidth;e.style.width=l+r+30*i.length+"px"}else 1===i.length&&(e.style.width="250px")})})},filterData(e){let t=e.includes(",")?",":" ";var a=e.split(t),s=[];for(let i=0;i<a.length;i++)-1===s.indexOf(a[i])&&s.push(a[i]);return s.join(" ")}},created(){}}),o=n,l=(a("4cec"),a("d9d6"),a("51a5"),a("2877")),r=Object(l["a"])(o,s,i,!1,null,"7ca5ec16",null);t["a"]=r.exports},"75c8":function(e,t,a){},"75e0":function(e,t,a){},"7a485":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"preview-record"},[e.empty?[t("div",{staticClass:"empty"},[e._v(" 暂无数据 ")])]:[t("div",{staticClass:"export-con"},[t("el-button",{attrs:{type:"primary"},on:{click:e.openHistory}},[e._v("历史预演记录")])],1),e._l(e.groupTableData,(function(a,s){return t("div",{key:s,staticClass:"group-table"},[t("div",{staticClass:"group-table__title"},[e._v(e._s(s))]),t("el-table",{staticStyle:{width:"100%"},attrs:{data:a}},[t("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[a.modelName?t("div",{staticClass:"inner-table"},[t("div",{staticClass:"inner-table__title"},[e._v(e._s(a.modelName)+"(用户数:万)")]),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.handleInnerData(a.modelStatNum)}},e._l(e.handleInnerColumn(a.modelStatNum),(function(e){return t("el-table-column",{key:e.type,attrs:{prop:e.prop,label:e.label,width:e.width,"show-overflow-tooltip":""}})})),1)],1):e._e()]}}],null,!0)}),e._l(e.tableColumn,(function(a){return t("el-table-column",{key:a.prop,attrs:{prop:a.prop,label:a.label,width:a.width,"show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(e.handlePreviewStatus(t,a.prop))+" ")]}}],null,!0)})}))],2)],1)}))],t(e.componentId,{tag:"component",attrs:{"base-camp-info":e.baseCampInfo,"table-tree-data":e.tableTreeData},on:{closeDialog:e.onCloseDialog}})],2)},i=[],n=a("d47a"),o={name:"PreviewRecord",mixins:[n["a"]],props:{baseCampInfo:{type:Object,default:()=>{}},tableTreeData:{type:Array,default:()=>[]}},data(){return{componentId:null}},methods:{openHistory(){this.componentId=()=>a.e("chunk-e160a1a8").then(a.bind(null,"d887"))},onCloseDialog(){this.componentId=null}}},l=o,r=(a("c5dd"),a("2877")),c=Object(r["a"])(l,s,i,!1,null,"88fce4d6",null);t["a"]=c.exports},"7f64":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"沟通",visible:e.dialogVisible,width:"502px","append-to-body":"","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"communicationForm",attrs:{model:e.form,"label-width":"110px"}},[t("el-form-item",{attrs:{label:"沟通人意见：",prop:"advice",rules:[{required:!0,message:"请输入沟通人意见",trigger:"blur"}]}},[t("el-input",{attrs:{type:"textarea",rows:4},model:{value:e.form.advice,callback:function(t){e.$set(e.form,"advice",t)},expression:"form.advice"}})],1),t("el-form-item",{attrs:{label:"转发人意见："}},e._l(e.communicationTaskList,(function(a){return t("div",{staticClass:"communication"},[t("div",{staticClass:"title"},[t("span",[e._v(e._s(a.approverName||"-"))]),e._v("   "),t("span",[e._v(e._s(a.dealTime))])]),t("div",{staticClass:"content"},[t("span",[e._v(e._s(a.dealOpinion))])])])})),0)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:e.submit}},[e._v("提 交")])],1)],1)},i=[],n=a("0fea"),o=a("31b1"),l={name:"CommunicationApprove",props:{approvalType:{type:String,default:""}},data(){return{dialogVisible:!1,form:{advice:"",approvalUser:"",approvalUserName:"",instanceId:"",nodeId:"",processId:"",serviceType:""},ApprovalForm:{},nodeInfo:{},communicationTaskList:[],submitLoading:!1}},methods:{ShowPopup(e){this.ApprovalForm=e,this.communicationTaskList=[],this.queryCommunicationTask(),this.form={...this.form,advice:""},this.nodeInfo={},this.dialogVisible=!0},async getNodeInfo(){try{const e=await Object(n["i"])(o["a"].channel.getNextApprovers,{instanceId:this.ApprovalForm.instanceId,nodeId:this.ApprovalForm.nodeId,serviceType:this.ApprovalForm.businessId});this.nodeInfo=e,this.queryCommunicationTask()}catch(e){}},async queryCommunicationTask(){try{const e=await Object(n["i"])(o["a"].channel.queryCommunicationTask,{businessId:this.ApprovalForm.businessId,instanceId:this.ApprovalForm.instanceId,nodeId:this.ApprovalForm.nodeId,serviceType:this.ApprovalForm.businessId,submitter:this.ApprovalForm.approver});this.communicationTaskList=e}catch(e){}},submit(){this.$refs["communicationForm"].validate(async e=>{if(e){this.form.approvalUser=sessionStorage.getItem("userId"),this.form.approvalUserName=sessionStorage.getItem("userNameCn"),this.form.instanceId=this.ApprovalForm.instanceId,this.form.nodeId=this.ApprovalForm.nodeId,this.form.processId=this.ApprovalForm.processId,this.form.serviceType=this.ApprovalForm.businessId,this.form.systemId=this.approvalType,this.submitLoading=!0;try{await Object(n["i"])(o["a"].channel.communicationAppTask,this.form);this.$message.success("提交成功"),this.dialogVisible=!1,this.$emit("refresh")}catch(t){}finally{this.submitLoading=!1}}})}}},r=l,c=(a("4ce3"),a("2877")),p=Object(c["a"])(r,s,i,!1,null,"122cf13c",null);t["a"]=p.exports},"86e5":function(e,t,a){},"883d":function(e,t,a){"use strict";a("75e0")},"8fc5":function(e,t,a){},"90bf":function(e,t,a){"use strict";a("08ab")},9344:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"backBtn backtitle"},[t("span",{staticClass:"back",on:{click:e.goBack}},[t("i",{staticClass:"iconfont icongonggongtubiao-shangyiye"}),e._v("返回")]),t("span",{staticClass:"title"},[e._v("策略详情")]),t("el-dropdown",{attrs:{trigger:"click"}},[t("span",{staticClass:"el-dropdown-link"},[t("h3",[e._v(e._s(e.parent.campsegName)),t("span",[e._v("["+e._s(e.parent.campsegStatName||e.parent.statusName)+"]")]),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})])]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.campsegsList,(function(a){return t("el-dropdown-item",{key:a.campsegId,attrs:{disabled:a.campsegId==e.campsegId},nativeOn:{click:function(t){return e.jumpGo(a.campsegId)}}},[e._v(" "+e._s(a.campsegId)+"  "),e._v(" "+e._s(a.channelName)+" ")])})),1)],1)],1),t("div",{staticClass:"Details"},[t("div",{staticClass:"basic Product"},[t("ul",[t("li",{staticClass:"title"},[e._m(0),t("div",{staticClass:"content"},[e._v(e._s(e.campsegRootId))])]),e.campsegId?t("li",{staticClass:"title"},[e._m(1),t("div",{staticClass:"content"},[e._v(e._s(e.campsegId))])]):e._e(),t("li",{staticClass:"title"},[e._m(2),t("div",{staticClass:"content"},[e._v(e._s(e.ValidationTimeRange(e.parent.startDate))+" 到 "+e._s(e.ValidationTimeRange(e.parent.endDate)))])]),t("li",{staticClass:"title"},[e._m(3),t("div",{staticClass:"content"},[e._v(e._s(e.parent.createUserName||e.parent.createUserId))])]),t("li",{staticClass:"title"},[e._m(4),t("div",{staticClass:"content"},[e._v(e._s(e.parent.createTime))])]),t("li",{staticClass:"title"},[e._m(5),t("div",{staticClass:"content"},[e._v(" "+e._s(1==e.parent.campsegTypeId?"策略类":2==e.parent.campsegTypeId?"调研类":"")+" ")])]),t("li",{staticClass:"title"},[e._m(6),t("div",{staticClass:"content"},[e._v(e._s(e.parent.activityTypeName))])]),t("li",{staticClass:"title"},[e._m(7),t("div",{staticClass:"content"},[e._v(" "+e._s(e.parent.campScene)+" ")])]),t("li",{staticClass:"title"},[e._m(8),t("div",{staticClass:"content"},[e._v(e._s(e.parent.activityObjectiveName))])]),t("li",{staticClass:"title"},[e._m(9),t("div",{staticClass:"content"},[e._v(" "+e._s(e.getPreviewName(e.parent.previewCamp))+" ")])]),t("li",{staticClass:"title"},[e._m(10),t("div",{staticClass:"content"},[e._v(e._s(e.parent.campsegDesc))])])])]),t("div",{staticClass:"TabsDetails"},[t("el-tabs",{attrs:{type:"card"},on:{"tab-click":function(t){return e.TabsClick(e.tabActive)}},model:{value:e.tabActive,callback:function(t){e.tabActive=t},expression:"tabActive"}},[t("el-tab-pane",{attrs:{label:"基础信息",name:"product"}},[t("div",{staticClass:"information"},[t("div",{ref:"CircuitMout",staticClass:"circuit-cont",on:{mousedown:function(t){return e.MouseDown(t)},mousemove:function(t){return e.MouseMove(t)},mouseup:function(t){return e.MouseUp(t)}}},[t("div",{ref:"CircuitCont",staticClass:"CircuitMouse"},[t("active-node",{attrs:{ActiveNode:e.ActiveNodeCase},on:{"Node-click":e.TreeNodeClick}})],1)]),t("div",{staticClass:"circuit-fold"},[t("el-collapse",{attrs:{accordion:e.CampInfoList.length>1},on:{change:e.CollapseClick},model:{value:e.current,callback:function(t){e.current=t},expression:"current"}},e._l(e.product,(function(a){return t("el-collapse-item",{key:a.id,attrs:{name:a.cId}},[t("template",{slot:"title"},[t("div",{staticClass:"titleI"},[t("i",{staticClass:"iconfont icongonggongtubiao-huitiaoliangcedianzhui"}),t("span",{class:e.current==a.cId?"Click":""},[e._v(e._s(a.name))])])]),t("div",{staticClass:"CircuitDetails"},e._l(a.data,(function(a,s){return t("ul",{key:s},[t("li",[t("div",{staticClass:"Tableposition"},[e._v(" "+e._s(a.MultiType)+" ")])]),e._l(a.data,(function(a,s){return t("li",{key:s},[t("div",{staticClass:"TableTitle"},[e._v(e._s(a.value))]),t("div",{staticClass:"TableContent"},["客户群名称"==a.value?t("span",[1==a.info.customSourceId?t("el-link",{attrs:{type:"primary"},on:{click:function(t){return e.openCocIframe(a.info)}}},[e._v(e._s(a.info.customGroupName)+" ")]):t("span",[e._v(e._s(a.info.customGroupName))])],1):e._e(),e._v(" "+e._s("null"===a.key?"":a.key)+" "),a.imgUrl?t("el-image",{staticClass:"detail-img",attrs:{src:a.imgUrl,"preview-src-list":[a.imgUrl]}}):e._e(),a.fileUrl?t("el-link",{staticStyle:{"line-height":"16px"},on:{click:function(t){e.downloadFileByUrl(a.fileUrl,a.fileUrl.split("/").pop())}}},[e._v(e._s(a.fileUrl.split("/").pop())+" ")]):e._e(),a.isHtml?t("el-button",{attrs:{type:"text"},on:{click:function(t){e.tabActive="ScriptDetail"}}},[e._v("查看详情 ")]):e._e()],1)])}))],2)})),0)],2)})),1),40==e.parent.campsegStatId&&e.approveParams?t("el-button",{staticClass:"approve-btn",attrs:{type:"warning",size:"large"},on:{click:e.openApprovalDialog}},[e._v("审 批")]):e._e()],1)])]),e.showScript?t("el-tab-pane",{attrs:{label:"话术详情",name:"ScriptDetail",lazy:!0}},[t("ScriptInfo",{attrs:{"camp-info-list":e.CampInfoList}})],1):e._e(),t("el-tab-pane",{attrs:{label:"执行信息",name:"Executive"}},[e._l(e.tableData,(function(a,s){return t("div",{key:s,class:0===s?"":"MT"},[t("div",{staticClass:"implement"},[t("span",[e._v(e._s(a.channelName))]),t("div",{staticClass:"query-form-cell-wrap1"},[t("ul",[e._l(a.ClickTime,(function(s,i){return t("li",{key:i,class:a.time===i?"active":"",on:{click:function(t){return e.TimeChannel(s,a,i)}}},[t("div",[e._v(e._s(s.label))])])})),t("li",[t("el-date-picker",{staticClass:"dateTime",attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyyMMdd"},on:{change:function(t){return e.TimeCustom(a.TimeList,a,2)}},model:{value:a.TimeList,callback:function(t){e.$set(a,"TimeList",t)},expression:"item.TimeList"}})],1)],2)])]),t("div",{staticClass:"ExeTable"},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:a.data,"header-cell-style":e.headercellStyle,"cell-style":e.CellStyle,border:""}},[t("el-table-column",{attrs:{prop:"dataDate",label:"执行时间"}}),t("el-table-column",{attrs:{label:"运营位"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(e._s(a.channelAdivName||"默认运营位"))])]}}],null,!0)}),t("el-table-column",{attrs:{prop:"showNumDay",label:"当日展示政策次数"}}),t("el-table-column",{attrs:{prop:"showNumAll",label:"累计展示政策次数\t"}}),t("el-table-column",{attrs:{prop:"clickNumDay",label:"当日点击政策次数\t"}}),t("el-table-column",{attrs:{prop:"clickNumAll",label:"累计点击政策次数\t"}}),t("el-table-column",{attrs:{prop:"orderNumDay",label:"当日成功办理量\t"}}),t("el-table-column",{attrs:{prop:"orderNumAll",label:"累计成功办理量"}})],1)],1)])})),e.showChannelActive?t("ChannelActive"):e._e()],2),t("el-tab-pane",{attrs:{label:"执行前预演",name:"beforeRehearsal",lazy:!0}},[t("BeforeRehearsal",{attrs:{"table-data":e.beforeRehearsal}})],1),t("el-tab-pane",{attrs:{label:"执行中预演",name:"rehearsaling"}},[t("div",{staticClass:"book"},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.rehearsaling,"header-cell-style":e.headercellStyle,"cell-style":e.CellStyle,border:""}},[t("el-table-column",{attrs:{prop:"channelName",label:"渠道名称","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"ruleName",label:"过滤规则","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"filterNum",label:"过滤数量"}}),t("el-table-column",{attrs:{prop:"previewUserNum",label:"预演用户数"}}),t("el-table-column",{attrs:{prop:"comment",label:"备注","show-overflow-tooltip":""}})],1)],1)]),t("el-tab-pane",{attrs:{label:"预演记录",name:"preview"}},[t("PreviewRecord",{ref:"previewResult",attrs:{"base-camp-info":e.parent,"table-tree-data":e.tableTreeData}})],1),t("el-tab-pane",{attrs:{label:"提醒中心过滤",name:"remindFilter",lazy:!0}},[t("RemindFilter")],1),t("el-tab-pane",{attrs:{label:"审批记录",name:"Approval",lazy:!0}},[t("ApproveStepBar",{attrs:{businessId:e.campsegRootId}})],1),e.showChannelCapacity?t("el-tab-pane",{attrs:{label:"渠道容量展示",name:"ChannelCapacity",lazy:!0}},[t("ChannelCapacity",{attrs:{approveStatus:e.parent.campsegStatId}})],1):e._e()],1)],1)]),t("ApprovalDialog",{ref:"approval",on:{refresh:()=>{}}}),t("CommunicationApprove",{ref:"communicationApprove",on:{refresh:()=>{}}}),t("CocCustomerDialog",{ref:"customerDetailRef"})],1)},i=[function(){var e=this,t=e._self._c;return t("div",[t("span",[e._v("策略编码")])])},function(){var e=this,t=e._self._c;return t("div",[t("span",[e._v("子策略编码")])])},function(){var e=this,t=e._self._c;return t("div",[t("span",[e._v("执行周期")])])},function(){var e=this,t=e._self._c;return t("div",[t("span",[e._v("创建人")])])},function(){var e=this,t=e._self._c;return t("div",[t("span",[e._v("创建时间")])])},function(){var e=this,t=e._self._c;return t("div",[t("span",[e._v("策略类型")])])},function(){var e=this,t=e._self._c;return t("div",[t("span",[e._v("营销类型")])])},function(){var e=this,t=e._self._c;return t("div",[t("span",[e._v("场景")])])},function(){var e=this,t=e._self._c;return t("div",[t("span",[e._v("营销活动目标")])])},function(){var e=this,t=e._self._c;return t("div",[t("span",[e._v("营销预演")])])},function(){var e=this,t=e._self._c;return t("div",[t("span",[e._v("策略描述")])])}],n=a("eb75"),o=n["a"],l=(a("e2fa"),a("e228"),a("2877")),r=Object(l["a"])(o,s,i,!1,null,"7b629755",null);t["default"]=r.exports},"975f":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"标签客群详情",top:"7vh",visible:e.visible,width:"70%",center:""},on:{"update:visible":function(t){e.visible=t}}},[e.visible?t("div",{staticClass:"iframe-container"},[t("iframe",{attrs:{src:e.src,frameborder:"0",width:"100%",height:"100%"}})]):e._e(),t("footer",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.visible=!1}}},[e._v("关 闭")])],1)])},i=[],n=a("0fea"),o=a("a454"),l={data(){return{visible:!1,src:"",ip:"http://10.183.206.86:8080/loc/#inset/jx_custom_show_detail",params:{withoutIframe:!0,ailk_autoLogin_userId:sessionStorage.getItem("desId"),createTypeId:1,labelId:""}}},methods:{getIP(){Object(n["i"])(o["a"].dictionary.getDictionaryList,{keyWords:"coc_cust_detail_url",current:1,size:10}).then(({records:e})=>{null!==e&&void 0!==e&&e.length&&(this.ip=e[0].dicValue)})},open(e){this.visible=!0,this.params.labelId=e,this.src=this.ip+"?"+Object.keys(this.params).map(e=>e+"="+this.params[e]).join("&")}},created(){this.getIP()}},r=l,c=(a("f9cc"),a("2877")),p=Object(c["a"])(r,s,i,!1,null,"194c2d57",null);t["a"]=p.exports},"9cd2":function(e,t,a){},a640:function(e,t,a){"use strict";var s=a("d039");e.exports=function(e,t){var a=[][e];return!!a&&s((function(){a.call(null,t||function(){return 1},1)}))}},a65f:function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("section",[e.channelInfoList.length?e._e():t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{height:"300px"}}),e._l(e.channelInfoList,(function(a){return t("div",{key:a.channelId},[t("div",{staticClass:"channel-content"},[t("div",{staticClass:"item"},[t("transition",{attrs:{name:"fade"}},[40==e.approveStatus&&e.tipFlag?t("div",{staticClass:"tip-msg"},[t("div",{staticClass:"tip"},[t("i",{staticClass:"el-icon-warning"}),t("div",{staticClass:"tip-content"},[t("div",{staticClass:"top"},[t("span",[e._v("提示")])]),t("div",[e._v("若增加本策略推送任务，"),t("span",{staticClass:"mark"},[e._v("今日可能无法完成推送，未完成部分将在次日继续推送。")])])]),t("i",{staticClass:"el-icon-close",on:{click:function(t){e.tipFlag=!1}}})])]):e._e()]),t("div",{staticClass:"content"},[t("label",[e._v("渠道名称：")]),t("span",[e._v(e._s(a.channelName||"-"))])]),t("div",{staticClass:"content"},[t("label",[e._v("渠道可推送量：")]),t("span",[e._v(e._s(a.execCapacity))])]),t("div",{staticClass:"content"},[t("label",[e._v("渠道已推送量：")]),t("span",[e._v(e._s(a.execNum))])]),t("div",{staticClass:"content"},[t("label",[e._v("活动待下发量：")]),t("span",[e._v(e._s(a.noExecNum))])]),t("div",{staticClass:"content"},[t("label",[e._v("更新时间：")]),t("span",[e._v(e._s(a.updateTime))])])],1)])])}))],2)},i=[],n=a("0fea"),o=a("31b1"),l={name:"ChannelCapacity",props:["approveStatus"],data(){return{loading:!1,tipFlag:!0,channelInfoList:[]}},methods:{async getChannelExecList(){try{this.loading=!0;const e=await Object(n["i"])(o["a"].channel.queryChannelExecList,{campsegId:this.$route.query.campsegRootId});this.channelInfoList=e}catch(e){}finally{this.loading=!1}}},mounted(){this.getChannelExecList()}},r=l,c=(a("90bf"),a("2877")),p=Object(c["a"])(r,s,i,!1,null,"5bac7082",null);t["a"]=p.exports},c29d:function(e,t,a){"use strict";a("1c45")},c5dd:function(e,t,a){"use strict";a("44e6")},cb59:function(e,t,a){},d22d:function(e,t,a){"use strict";a("4927")},d47a:function(e,t,a){"use strict";a("14d9"),a("13d5");var s=a("0fea");const i=[{prop:"code",label:"预演ID",width:"180"},{prop:"startTime",label:"预演开始时间",width:"200"},{prop:"endTime",label:"预演结束时间",width:"200"},{prop:"channelName",label:"渠道",width:"180"},{prop:"statusName",label:"预演状态",width:"100"},{prop:"previewCustomNum",label:"目标客户数",width:"100"},{prop:"targetCustomNum",label:"可营销客户数",width:"100"},{prop:"fqcNum",label:"频次过滤数",width:"100"},{prop:"orderedFilterNum",label:"订购过滤数",width:"100"},{prop:"planExclusionNum",label:"产品互斥剔除数量",width:"100"}];t["a"]={data(){return{groupTableData:{},tableColumn:i,loading:!1,empty:!1}},methods:{getChildIdsById(e,t){const a=this.findNodeById(e,t);return a?a.childList&&0!==a.childList.length?this.getAllChildIds(a):[a.id]:void 0},getAllChildIds(e){let t=[];for(const a of e.childList)t.push(a.id),a.childList&&a.childList.length>0&&(t=t.concat(this.getAllChildIds(a)));return t},findNodeById(e,t){for(const s of e){var a;if(s.id===t)return s;if((null===(a=s.childList)||void 0===a?void 0:a.length)>0){const e=this.findNodeById(s.childList,t);if(e)return e}}return null},getPreviewRecord(e=0){this.loading=!0;const t="0"===this.baseCampInfo.campsegRootId?this.baseCampInfo.campsegId:this.baseCampInfo.campsegRootId,a=this.getChildIdsById(this.tableTreeData,this.baseCampInfo.campsegId);Object(s["i"])("/preview-svc-group/api/fivePeriod/preview/previewResult",{campsegId:t,childCampsegs:a,oldRecord:e}).then(e=>{if(e&&e.length){this.empty=!1;const t=[];e[0].specialInfoAll.forEach(e=>{t.push({prop:this.convertToCamelCase(JSON.parse(e.specialJsonStr).field),label:e.name,width:"100"})});const a=[];for(let s=1;s<=10;s++)e[0][`defExtNum${s}Name`]&&a.push({prop:"defExtNum"+s,label:e[0][`defExtNum${s}Name`],width:"100"});this.tableColumn=[...i,...t,...a],this.groupTableData=this.groupByDay(e)}else this.groupTableData={},this.empty=!0;this.loading=!1}).catch(()=>{this.loading=!1})},groupByDay(e){return e.reduce((e,t)=>{if(!t.startTime)return e["待预演"]||(e["待预演"]=[]),e["待预演"].push(t),e;const a=new Date(t.startTime),s=a.toISOString().slice(0,10);return e[s]||(e[s]=[]),e[s].push(t),e},{})},convertToCamelCase(e){const t=e.toLowerCase().split("_"),a=t.map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1));return a.join("")},handlePreviewStatus(e,t){const a=["code","startTime","endTime","channelName","statusName","previewCustomNum"];return a.includes(t)||2===e.status?e[t]:"-"},handleInnerData(e){if(!e)return[];const t=JSON.parse(e),a=[{}];return t.forEach(e=>{a[0][e.type.toString()]=e.num/1e4}),a},handleInnerColumn(e){if(!e)return[];const t=JSON.parse(e),a=t.map(e=>({prop:e.type.toString(),label:e.name}));return a}}}},d58f:function(e,t,a){"use strict";var s=a("59ed"),i=a("7b0b"),n=a("44ad"),o=a("07fa"),l=TypeError,r=function(e){return function(t,a,r,c){var p=i(t),d=n(p),u=o(p);s(a);var _=e?u-1:0,m=e?-1:1;if(r<2)while(1){if(_ in d){c=d[_],_+=m;break}if(_+=m,e?_<0:u<=_)throw new l("Reduce of empty array with no initial value")}for(;e?_>=0:u>_;_+=m)_ in d&&(c=a(c,d[_],_,p));return c}};e.exports={left:r(!1),right:r(!0)}},d946:function(e,t,a){},d9d6:function(e,t,a){"use strict";a("0853")},e228:function(e,t,a){"use strict";a("9cd2")},e2fa:function(e,t,a){"use strict";a("5624")},e349:function(e,t,a){},e8b9:function(e,t,a){"use strict";a("2f14")},eae4:function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("transition-group",{attrs:{name:"top-from"}},[e.fileInfo.uploadFileUrl||e.isView?t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],key:"2",staticClass:"file-container"},[e.isView?e._e():t("i",{staticClass:"el-icon-close",on:{click:e.removeFile}}),t("div",{staticClass:"file-info"},[t("el-row",[t("span",[e._v("名称：")]),t("span",{staticClass:"text"},[e._v(e._s(e.fileInfo.uploadFileName))])]),t("el-row",[t("span",[e._v("尺寸：")]),t("span",[e._v(e._s(e.fileInfo.fileSize))])])],1),t("div",{staticClass:"file-view"},["image"===e.type?t("el-image",{attrs:{src:e.fileInfo.fileSrc,"preview-src-list":[e.fileInfo.fileSrc],fit:"fill"}}):e._e()],1)]):t("div",{key:"1",staticClass:"script-upload"},[t("el-upload",{attrs:{action:"/",accept:e.typeInfo.accept,multiple:e.multiple,"show-file-list":!1,"before-upload":e.beforeUpload,"http-request":e.uploadFile}},[t("div",{staticClass:"upload-content"},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v("点击上传"+e._s(e.typeInfo.typeName))]),t("div",{staticClass:"el-upload__info"},[e._v(e._s(e.typeInfo.tip))])])]),e.showProgress?[t("el-progress",{staticClass:"upload-progress",attrs:{percentage:e.progress,"stroke-width":2,status:e.uploadStatus,"text-inside":""}}),t("span",[e._v(e._s(e.progress+"%"))])]:e._e()],2)])},i=[],n=(a("88a7"),a("271a"),a("5494"),a("0fea")),o=a("d39c"),l={model:{prop:"fileObj",event:"change"},props:{isView:{type:Boolean,default:!1},type:{type:String,validator(e){return-1!==["image","video","audio"].indexOf(e)},default:"image"},action:{type:String,default:"/mkt-term-svc/api/uploadScriptMaterial"},multiple:{type:Boolean,default:!1},fileObj:{type:Object,default:()=>{}}},computed:{typeInfo(){switch(this.type){case"image":return{accept:"image/*",typeName:"图片",size:10485760,tip:"文件大小不能超过10M，支持jpg、jpeg、png格式"};case"video":return{accept:"video/*",typeName:"视频",size:104857600,tip:"文件大小不能超过100M，支持mp4、avi、rmvb格式"};case"audio":return{accept:"audio/*",typeName:"音频",size:10485760,tip:"文件大小不能超过10M，支持mp3、wav格式"}}}},data(){return{loading:!1,fileInfo:{uploadFileName:"",uploadFileUrl:"",fileSrc:"",fileSize:""},showProgress:!1,progress:0,uploadStatus:null}},methods:{handleFile(e){if("image"===this.type){const t=new Image;t.src=window.URL.createObjectURL(e),t.onload=()=>{this.fileInfo.fileSize=`${t.width} × ${t.height}`,this.fileInfo.uploadFileName=e.name,this.fileInfo.fileSrc=window.URL.createObjectURL(e)}}if("video"===this.type||"audio"===this.type){this.fileInfo.uploadFileName=e.name,this.fileInfo.fileSrc=window.URL.createObjectURL(e);const t=document.createElement(this.type);t.preload="metadata",t.onloadedmetadata=()=>{window.URL.revokeObjectURL(t.src),this.fileInfo.fileSize=Math.floor(t.duration)+"s"}}},beforeUpload(e){if(e.size>this.typeInfo.size)return this.$message.error(`${this.typeInfo.typeName}大小不能超过${this.typeInfo.size/1024/1024}M, 请重新选择${this.typeInfo.typeName}`),!1;this.handleFile(e)},async uploadFile(e){try{this.showProgress=!0,this.progress=0,this.uploadStatus=null;const t=new FormData;t.append("file",e.file);const{resourceUrl:a}=await Object(n["j"])(this.action,t,this.uploadProgressEvent);this.fileInfo.uploadFileUrl=a;let s={...this.fileInfo};delete s.fileSrc,this.$emit("change",s),this.showProgress=!1,this.progress=0}catch(t){this.uploadStatus="exception",setTimeout(()=>{this.showProgress=!1},1e3)}},uploadProgressEvent(e){this.progress=Math.floor(100*e.loaded/e.total)},removeFile(){this.fileInfo.uploadFileUrl="",this.fileInfo.uploadFileName="",this.fileInfo.fileSrc="",this.fileInfo.fileSize="",this.$emit("change",this.fileInfo)},async setFileInfo(){try{this.loading=!0;const{data:e}=await Object(n["b"])(o["a"].seapi.downloadChanPromptFile,{fileUrlAndName:this.fileInfo.uploadFileUrl}),t=new Blob([e],{type:e.type});this.fileInfo.fileSrc=URL.createObjectURL(t);const a=new File([t],this.fileInfo.uploadFileName||this.fileInfo.uploadFileName||"",{type:e.type});this.handleFile(a)}catch(e){}finally{this.loading=!1}}},created(){this.fileInfo={...this.fileInfo,...this.fileObj},this.fileInfo.uploadFileUrl&&this.setFileInfo()}},r=l,c=(a("f9b4"),a("2877")),p=Object(c["a"])(r,s,i,!1,null,"73835c26",null);t["a"]=p.exports},eb75:function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("14d9"),core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__),_views_ProductPolicy_ScriptLib_constant__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("ac7c"),_api_manage__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("0fea"),_api_MpApi__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("d370"),_api_SeApi__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("d39c"),_utils_getFileUrl__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("5af3"),_utils_tools__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("b893"),_Components_ActiveNode_vue__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("649d"),moment__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("c1df"),moment__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_8__),vuex__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("2f62"),_Components_StepBar__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("0bec"),_Components_ChannelCapacity_vue__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("a65f"),_components_previewRecord_vue__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("7a485"),_Components_ApproveNode__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("8331"),_Components_ChannelActive_vue__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("fad4"),_Components_RemindFilter_vue__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("335d"),_components_ScriptInfo_vue__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("38b1"),_components_BeforeRehearsal_vue__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("27ac"),_ApprovalMp_components_ApprovalDialog_vue__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("efed"),_ApprovalMp_components_CommunicationApprove_vue__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("7f64"),_components_CocCustomerDialog_vue__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("975f"),_config_MpNode_js__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("eced"),x=0,y=0,l=0,t=0,isDown=!1;__webpack_exports__["a"]={components:{ActiveNode:_Components_ActiveNode_vue__WEBPACK_IMPORTED_MODULE_7__["a"],StepBar:_Components_StepBar__WEBPACK_IMPORTED_MODULE_10__["a"],ChannelCapacity:_Components_ChannelCapacity_vue__WEBPACK_IMPORTED_MODULE_11__["a"],PreviewRecord:_components_previewRecord_vue__WEBPACK_IMPORTED_MODULE_12__["a"],ApproveStepBar:_Components_ApproveNode__WEBPACK_IMPORTED_MODULE_13__["a"],ChannelActive:_Components_ChannelActive_vue__WEBPACK_IMPORTED_MODULE_14__["a"],RemindFilter:_Components_RemindFilter_vue__WEBPACK_IMPORTED_MODULE_15__["a"],ScriptInfo:_components_ScriptInfo_vue__WEBPACK_IMPORTED_MODULE_16__["a"],BeforeRehearsal:_components_BeforeRehearsal_vue__WEBPACK_IMPORTED_MODULE_17__["a"],ApprovalDialog:_ApprovalMp_components_ApprovalDialog_vue__WEBPACK_IMPORTED_MODULE_18__["a"],CommunicationApprove:_ApprovalMp_components_CommunicationApprove_vue__WEBPACK_IMPORTED_MODULE_19__["a"],CocCustomerDialog:_components_CocCustomerDialog_vue__WEBPACK_IMPORTED_MODULE_20__["a"]},data(){return{approveParams:null,showChannelCapacity:!1,showScript:!1,tabActive:"product",timeIndex:2,timeFlag:"",timeList:[],beforeRehearsal:[],rehearsaling:[],radio1:"",MultiwaveList:"[[1], [2], [3]]",tableData:[],parent:{},CampInfoList:[],Logging:[],ActiveNodeCase:[],current:["1","2","3"],product:[],channelsList:[],preData:[],rehearsalList:[{value:"1",label:"预演"},{value:"2",label:"批量预演"},{value:"0",label:"不预演"}],ClickTime:[{label:"近一周",value:"-7"},{label:"近一个月",value:"-30"},{label:"自定义",value:""}],routerQurey:{},campsegsList:[],approverProcessList:[],campsegRootId:"",campsegId:"",isDirectSon:!1,blobUrlList:[],tableTreeData:[]}},computed:{ActiveNodeList(){return this.$store.state.MarkPl.ActiveNodeList},SceneNodeData(){return this.$store.state.MarkPl.SceneNodeData},...Object(vuex__WEBPACK_IMPORTED_MODULE_9__["b"])("MarkPl",["getNodeDataIdObj"]),showChannelActive(){var e,t;const a=["901","932","801","960","964"];let s=this.$store.state.MarkPl.SceneNodeData;if(!s||!s[0]||0!=!(null!==(e=s[0][1])&&void 0!==e&&null!==(e=e.NodeObj)&&void 0!==e&&e.length))return!1;let i=null===(t=s[0][2])||void 0===t?void 0:t.NodeObj;return i&&i.some(e=>a.includes(e.channelId))}},watch:{$route(e){"MarketingDetails"===e.name&&this.queryMaterialById()}},mounted(){var e=this.$route.query;this.routerQurey=e,this.campsegId=e.campsegId||"",this.campsegRootId=e.campsegRootId,this.campsegId?(this.queryMaterialBySonId(),this.isDirectSon=!0):this.queryMaterialById(),this.$route.query.goPreview&&(this.tabActive="preview")},methods:{async queryCampsegs(){if(this.campsegRootId)try{const t=await Object(_api_manage__WEBPACK_IMPORTED_MODULE_2__["i"])(_api_MpApi__WEBPACK_IMPORTED_MODULE_3__["a"].mpapi.queryCampsegs,{id:this.campsegRootId});this.campsegsList=t;const a=await Object(_api_manage__WEBPACK_IMPORTED_MODULE_2__["i"])(_api_SeApi__WEBPACK_IMPORTED_MODULE_4__["a"].seapi.getOnlineChannels,{onlineStatus:"1"});for(let s of this.campsegsList){var e;this.$set(s,"channelName",null===(e=a.find(e=>e.channelId===s.data[2]))||void 0===e?void 0:e.channelName)}}catch(t){}else this.goBack()},ValidationTimeRange(e){return moment__WEBPACK_IMPORTED_MODULE_8___default()(e).format("YYYY-MM-DD")},jumpGo(e){this.$router.push({path:"MarketingDetails",query:{...this.$route.query,campsegId:e,campsegRootId:this.campsegRootId}})},getCampsegTree(){Object(_api_manage__WEBPACK_IMPORTED_MODULE_2__["i"])("/preview-svc-group/api/jx/fivePeriod/preview/getCampIdAndNameTree",{id:this.$route.query.campsegRootId}).then(e=>{this.tableTreeData=[e],this.$route.query.goPreview&&this.$nextTick(()=>{this.$refs.previewResult.getPreviewRecord()})})},async queryMaterialById(){if(await this.queryCampsegs(),!this.campsegRootId)return this.$message.error("错误的URL"),void this.goBack();await Object(_api_manage__WEBPACK_IMPORTED_MODULE_2__["i"])(_api_MpApi__WEBPACK_IMPORTED_MODULE_3__["a"].mpapi.getCampInfo,{id:this.campsegRootId}).then(e=>{if(4===e.type){var t=Object(_config_MpNode_js__WEBPACK_IMPORTED_MODULE_21__["f"])(e);this.Callback(t[0])}else this.Callback(e)})},async queryMaterialBySonId(){if(!this.campsegId)return this.$message.error("错误的URL"),void this.goBack();await this.queryCampsegs(),await Object(_api_manage__WEBPACK_IMPORTED_MODULE_2__["i"])(_api_MpApi__WEBPACK_IMPORTED_MODULE_3__["a"].mpapi.getChildCampInfo,{id:this.campsegId}).then(e=>{var t=e;t.baseCampInfo.tacticsMap="[{group: [1, 2, 3], children:[]}]",this.Callback(e)})},Callback(res){this.$store.commit("MarkPl/fnActiveNodeList",[]),this.$store.commit("MarkPl/fnSceneNodeData",[]),this.parent=res.baseCampInfo,40==this.parent.campsegStatId&&this.queryApproveProcess(),this.getCampsegTree(),this.CampInfoList=res.campSchemes,this.CampInfoList.length>1&&(this.current=[]),this.$store.commit("MarkPl/fnActiveNodeList",Object(_config_MpNode_js__WEBPACK_IMPORTED_MODULE_21__["j"])(eval(""+this.parent.tacticsMap)));for(let e=0;e<res.campSchemes.length;e++){var _res$planExtInfoList$,_res$planExtInfoList$2,_res$planExtInfoList$3,_res$campSchemes$i$ch;res.campSchemes[e].product=res.campSchemes[e].product.map(e=>({...e,flag:"product"})),null===(_res$planExtInfoList$=res.planExtInfoList[e])||void 0===_res$planExtInfoList$||null===(_res$planExtInfoList$=_res$planExtInfoList$.campExclusivePlan)||void 0===_res$planExtInfoList$||_res$planExtInfoList$.forEach(t=>{res.campSchemes[e].product.push({...t,flag:"mutual"})}),null===(_res$planExtInfoList$2=res.planExtInfoList[e])||void 0===_res$planExtInfoList$2||null===(_res$planExtInfoList$2=_res$planExtInfoList$2.campFusionPlans)||void 0===_res$planExtInfoList$2||_res$planExtInfoList$2.forEach(t=>{res.campSchemes[e].product.push({...t,flag:"fuse"})}),null===(_res$planExtInfoList$3=res.planExtInfoList[e])||void 0===_res$planExtInfoList$3||null===(_res$planExtInfoList$3=_res$planExtInfoList$3.campSeriesPlan)||void 0===_res$planExtInfoList$3||_res$planExtInfoList$3.forEach(t=>{res.campSchemes[e].product.push({...t,flag:"homologous"})}),res.campSchemes[e].channels[0].marketingWords=(null===(_res$campSchemes$i$ch=res.campSchemes[e].channels[0].channelConf)||void 0===_res$campSchemes$i$ch?void 0:_res$campSchemes$i$ch.execContent)||"",res.campSchemes[e].customer[0]&&(res.campSchemes[e].customer[0].customerFlag=!0)}var activeNodeList=Object(_config_MpNode_js__WEBPACK_IMPORTED_MODULE_21__["b"])(this.ActiveNodeList,res.campSchemes);for(let e=0;e<res.planExtInfoList.length;e++){let t=res.planExtInfoList[e];const a=t.campExclusivePlan.map(e=>e.planName).join(","),s=t.campFusionPlans.map(e=>e.planName).join(","),i=t.campSeriesPlan.map(e=>e.planName).join(",");for(let n=0;n<activeNodeList[e].length;n++){var _activeNodeList$i$j$N;"productDialog"===(null===(_activeNodeList$i$j$N=activeNodeList[e][n].NodeObj[0])||void 0===_activeNodeList$i$j$N?void 0:_activeNodeList$i$j$N.assembly)&&(activeNodeList[e][n].NodeObj[0]={...activeNodeList[e][n].NodeObj[0],campExclusivePlan:a,campFusionPlans:s,campSeriesPlan:i}),activeNodeList[e][n].NodeObj[0]={...activeNodeList[e][n].NodeObj[0],campExclusivePlan:a,campFusionPlans:s,campSeriesPlan:i}}}this.$store.commit("MarkPl/fnSceneNodeData",activeNodeList),this.ActiveNodeCase=this.$store.state.MarkPl.ActiveNodeList,this.NormalEcho();const channelList=res.campSchemes[0].channels,channelListS=["801","964","960"];channelList.forEach(e=>{channelListS.includes(e.channelId.toString())&&(this.showChannelCapacity=!0),_views_ProductPolicy_ScriptLib_constant__WEBPACK_IMPORTED_MODULE_1__["f"].some(t=>t.value===e.channelId)&&(this.showScript=!0)}),this.showChannelCapacity},NormalEcho(){this.product=[],this.ActiveNodeList[0].group.map((e,t)=>{if("multiwaveDdialog"!==e.assembly){var a={};a.id=e.id,a.cId=e.cId,a.name=e.label,a.data=this.CampInfoDataList(e.id,e.assembly),this.product.push(a)}})},CampInfoDataList(e,t){var a=[],s=this.getNodeDataIdObj(e);switch(t){case"productDialog":s.map(e=>{let t="null"!==e.planStartDate?`${e.planStartDate} 到 ${e.planEndDate}`:"";var s={MultiType:e.planName,data:[{value:"产品名称",key:e.planName},{value:"产品编号",key:e.planId},{value:"产品有效期",key:t},{value:"产品描述",key:e.planDesc},{value:"融合产品",key:e.campFusionPlans},{value:"同系列产品",key:e.campSeriesPlan},{value:"互斥产品",key:e.campExclusivePlan}]};a.push(s)}),a.length>1&&(a=[a[0]]);break;case"customerDialog":const e=["","一次性","月","日"];s.map(t=>{var s;let i="null"!==t.failTime&&t.effectiveTime?`${t.effectiveTime} 到 ${t.failTime}`:"";10==t.custType&&(t.customSourceId=0);const n={MultiType:t.customGroupName,data:[{value:"客户群名称",key:null,info:t},{value:"客户群编码",key:t.customGroupId},{value:"客户群来源",key:1==t.customSourceId?"COC客户群":"DNA客户群"},{value:"客户群有效期",key:i},{value:"客户群规模",key:t.customNum},{value:"数据日期",key:t.dataDate},{value:"客户群周期",key:e[1==t.customSourceId?+t.updateCycle:+this.parent.dnaUpdateCycle]},{value:"配置规则",key:null===(s=t.customAttrs)||void 0===s?void 0:s.join(",")}]};a.push(n)});break;case"channelDialog":s.map(e=>{var t,s,i;let n=e.channelId,o=null===(t=e.channelConf)||void 0===t||null===(t=t.channelExtConf)||void 0===t?void 0:t.columnExt18,l={MultiType:e.channelName,data:[{value:"子策略编码",key:this.campsegId||this.campsegsList.find(e=>e.data[2]==n).campsegId},{value:"渠道名称",key:e.channelName},{value:"推送方式",key:0==(null===(s=e.channelConf)||void 0===s||null===(s=s.channelExtConf)||void 0===s?void 0:s.columnExt1)?"偏好推送":"全量推送"},{value:"运营位名称",key:null===(i=e.adivInfo)||void 0===i?void 0:i.adivName},{value:"智能话术",key:"1"==o?"省端模型":"2"==o?"一级IOP模型":"未启用"},...Object(_config_MpNode_js__WEBPACK_IMPORTED_MODULE_21__["a"])(n,e.channelConf)]};if(l.data.some(e=>e.imgUrl)){let e=l.data.find(e=>e.imgUrl),t=e.imgUrl;this.blobUrlList.some(e=>e.imgUrl===t)?e.imgUrl=this.blobUrlList.find(e=>e.imgUrl===t).blobUrl:e.directShow?this.blobUrlList.push({imgUrl:t,blobUrl:t}):Object(_utils_getFileUrl__WEBPACK_IMPORTED_MODULE_5__["d"])(t).then(a=>{this.blobUrlList.push({imgUrl:t,blobUrl:a}),e.imgUrl=a})}a.push(l)});break}return a},async queryApproveProcess(){try{this.approveParams=null;const{records:e}=await Object(_api_manage__WEBPACK_IMPORTED_MODULE_2__["i"])(_api_MpApi__WEBPACK_IMPORTED_MODULE_3__["a"].mpapi.approveRecordNew,{campsegName:this.campsegRootId});this.approveParams=e.length>0?e[0]:null}catch(e){}},openApprovalDialog(){0==this.approveParams.communicationState?this.$refs["communicationApprove"].ShowPopup(this.approveParams):this.$refs["approval"].ShowPopup(this.approveParams)},downloadFileByUrl(e,t){Object(_utils_getFileUrl__WEBPACK_IMPORTED_MODULE_5__["b"])(e,t)},TabsClick(e){switch(e){case"journal":this.getLoggingDataList();break;case"product":break;case"preview":this.$nextTick(()=>{this.$refs.previewResult.getPreviewRecord()});break;case"Approval":break;case"beforeRehearsal":break;case"rehearsaling":this.getRehearsaling();break;case"Executive":this.GetExecutive(this.campsegRootId,this.campsegId);break}},async getRehearsaling(){await Object(_api_manage__WEBPACK_IMPORTED_MODULE_2__["i"])(_api_MpApi__WEBPACK_IMPORTED_MODULE_3__["a"].mpapi.getRehearsaling,{campsegRootId:this.campsegRootId,campsegId:this.campsegId}).then(e=>{const t=e.map(e=>({...e,status:"支持"}));this.rehearsaling=t})},async GetExecutive(e,t,a,s,i){await Object(_api_manage__WEBPACK_IMPORTED_MODULE_2__["i"])(_api_MpApi__WEBPACK_IMPORTED_MODULE_3__["a"].mpapi.GetExecutive,{campsegRootId:e,channelId:a,startDate:s,endDate:i,campsegId:t}).then(e=>{if(a){const t=this.tableData.findIndex(e=>e.channelId===a);this.$set(this.tableData,t,{...this.tableData[t],data:e})}else{this.tableData=[];let t=[...new Set(e.map(e=>e.channelId))];t.forEach(t=>{const a=e.filter(e=>e.channelId===t);this.tableData.push({channelId:t,channelName:a[0].channelName,data:a,time:2,ClickTime:JSON.parse(JSON.stringify(this.ClickTime)),TimeList:[]})})}})},TimeChannel(e,t,a){if(t.TimeList=[],t.time=a,2===a)return;let s=Object(_utils_tools__WEBPACK_IMPORTED_MODULE_6__["g"])(e.value);this.GetExecutive(this.campsegRootId,this.campsegId,t.channelId,s[0],s[1])},TimeCustom(e,t,a){null!==e&&(this.GetExecutive(this.campsegRootId,this.campsegId,t.channelId,e[0],e[1]),t.time=a)},async getLoggingDataList(){await Object(_api_manage__WEBPACK_IMPORTED_MODULE_2__["i"])(_api_MpApi__WEBPACK_IMPORTED_MODULE_3__["a"].mpapi.queryCampOperaLogs,{id:this.campsegId||this.campsegRootId}).then(e=>{this.Logging=e})},goBack(){if(this.$route.query.campsegId){const e=this.$route.query;this.$delete(e,"campsegId"),this.$router.push({name:"MarketingDetails",query:{...e,_cache:Date.now()}})}else{let e=this.$route.query;if(e.backName){let t={};"CanvasDetails"===e.backName&&(t=JSON.parse(e.queryParams)),this.$router.push({name:e.backName,params:{tab:e.tab||0,queryParams:e.queryParams},query:t})}else this.$router.push("MarketingMP")}},TreeNodeClick(e){this.current=e.cId,this.product.map(t=>{t.cId===e.cId&&(t.data=this.CampInfoDataList(e.id,e.assembly))})},CollapseClick(e){this.current=e},CellStyle(){return"text-align:center;"},headercellStyle(){return"background:rgba(249, 250, 251, 1);text-align:center;"},openCocIframe(e){this.$refs.customerDetailRef.open(e.customGroupId)},MouseDown(e){let a=this.$refs["CircuitCont"],s=this.$refs["CircuitMout"];x=e.clientX,y=e.clientY,l=a.offsetLeft,t=a.offsetTop,isDown=!0,a.style.cursor="move",s.style.cursor="move"},MouseMove(e){if(!1===isDown)return;let a=this.$refs["CircuitCont"];var s=e.clientX,i=e.clientY,n=s-(x-l),o=i-(y-t);a.style.left=n+"px",a.style.top=o+"px"},MouseUp(){let e=this.$refs["CircuitMout"],t=this.$refs["CircuitCont"];isDown=!1,t.style.cursor="default",e.style.cursor="default"},getPreviewName(e){var t;return(null===(t=this.rehearsalList.find(t=>t.value===e))||void 0===t?void 0:t.label)||"不预演"}}}},ed1e:function(e,t,a){},efed:function(e,t,a){"use strict";var s=function(){var e,t,a=this,s=a._self._c;return s("div",[s("el-dialog",{attrs:{title:"审批",visible:a.dialogVisible,width:"502px","append-to-body":"","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){a.dialogVisible=e}}},[s("div",{staticClass:"Contact-mtp"},[s("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:a.ruleForm,rules:a.rules,"label-width":"110px"}},[s("el-form-item",{attrs:{label:"审批结果：",prop:"resource"}},[s("el-radio-group",{model:{value:a.ruleForm.resource,callback:function(e){a.$set(a.ruleForm,"resource",e)},expression:"ruleForm.resource"}},[s("el-radio",{attrs:{label:1}},[a._v("通过")]),s("el-radio",{attrs:{label:0}},[a._v("驳回")])],1)],1),s("el-form-item",{attrs:{label:"审批意见：",prop:"desc"}},[s("el-input",{attrs:{type:"textarea",maxlength:"500","show-word-limit":"",rows:4},model:{value:a.ruleForm.desc,callback:function(e){a.$set(a.ruleForm,"desc",e)},expression:"ruleForm.desc"}})],1),0==(null===(e=a.nextNodesList.nextNodesApprover)||void 0===e?void 0:e.length)&&"IMCD"===a.approvalType?s("div",{staticClass:"Description"},[s("span",{staticClass:"all"},[a._v("审批通过后，策略将开始执行")]),a.channelInfo.show?s("div",{staticClass:"tip"},[s("span",[a._v("*")]),s("span",[a._v(a._s(`当前短信渠道发送任务执行中活动${a.channelInfo.activeNum}个，涉及${a.channelInfo.customerNum}用户请做好发送流量控制，IOP每小时约执行${a.channelInfo.IOP/1e4}万发送任务。`))])]):a._e()]):a._e(),0!==a.ruleForm.resource&&"{}"!==JSON.stringify(a.nextNodesList)?s("div",{staticClass:"nextNodesList"},a._l(a.nextNodesList.nextNodesApprover,(function(e,t){return s("el-form-item",{key:e.node.id,attrs:{"label-width":"auto",label:e.node.nodeName+"：",prop:"nextNodesList["+t+"].value",rules:{required:!0,message:"审批人不能为空",trigger:"blur"}}},[s("el-select",{on:{change:a.clone},model:{value:a.ruleForm.nextNodesList[t].value,callback:function(e){a.$set(a.ruleForm.nextNodesList[t],"value",e)},expression:"ruleForm.nextNodesList[index].value"}},a._l(e.approverUser,(function(e){return s("el-option",{key:e.id,attrs:{label:e.userName,value:e.userId}})})),1)],1)})),1):a._e(),a.communicationTaskList.length?s("el-form-item",{attrs:{label:"沟通人意见："}},a._l(a.communicationTaskList,(function(e){return s("div",{staticClass:"communication"},[s("div",{staticClass:"title"},[s("span",[a._v(a._s(e.approverName||"-"))]),a._v("   "),s("span",[a._v(a._s(e.dealTime))])]),s("div",{staticClass:"content"},[s("span",[a._v(a._s(e.dealOpinion))])])])})),0):a._e()],1)],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},["IMCD"!==a.approvalType||null!==(t=a.multiApprovelDataList)&&void 0!==t&&t.length?a._e():s("el-button",{on:{click:a.open2CommunicatorDialog}},[a._v("转至沟通人")]),s("el-button",{on:{click:a.cancel}},[a._v("取 消")]),s("el-button",{attrs:{type:"primary",loading:a.approveLoading},on:{click:a.Submit}},[a._v("提 交")])],1)]),s("ToCommunicator",{ref:"toCommunicator",attrs:{approvalType:a.approvalType},on:{refresh:function(e){return a.$emit("refresh")}}})],1)},i=[],n=(a("14d9"),a("0fea")),o=a("d370"),l=a("31b1"),r=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"选择沟通人",visible:e.dialogVisible,width:"50%","close-on-click-modal":!1,top:"8vh"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],staticStyle:{width:"320px"},attrs:{placeholder:"请输入账号/用户名",size:"small"},on:{input:e.debounceQueryUserChange},model:{value:e.queryUser.keyWords,callback:function(t){e.$set(e.queryUser,"keyWords",t)},expression:"queryUser.keyWords"}}),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.userLoading,expression:"userLoading"}],attrs:{data:e.userList,height:"300px"},on:{"row-click":e.handleSelectionChange}},[t("el-table-column",{attrs:{width:"50px",align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-radio",{attrs:{label:a.userId},nativeOn:{change:function(t){return e.handleSelectionChange(a)}},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[e._v(" ")])]}}])}),t("el-table-column",{attrs:{property:"userName",label:"姓名"}}),t("el-table-column",{attrs:{property:"cityName",label:"归属地市"}}),t("el-table-column",{attrs:{property:"departmentName",label:"归属部门"}}),t("el-table-column",{attrs:{property:"mobilePhone",label:"手机号码"}})],1),t("el-pagination",{staticClass:"user-pagination",attrs:{"current-page":e.queryUser.current,"page-size":e.queryUser.size,"pager-count":5,layout:"total, prev, pager, next",total:e.userTotal},on:{"current-change":e.handleUserTableCurrentChange}}),e._v(" 转发人意见： "),t("el-input",{attrs:{type:"textarea",maxlength:"500","show-word-limit":"",rows:3},model:{value:e.communicatorForm.desc,callback:function(t){e.$set(e.communicatorForm,"desc",t)},expression:"communicatorForm.desc"}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",loading:e.submitloading},on:{click:e.toCommunication}},[e._v("提 交")])],1)],1)},c=[],p=a("f9ae"),d={props:{approvalType:{type:String,default:""}},data(){return{source:null,dialogVisible:!1,userLoading:!1,submitloading:!1,nodeInfo:{},queryUser:{keyWords:"",current:1,size:10},userTotal:0,userList:[],radio:"",rowInfo:null,communicatorForm:{desc:""}}},methods:{ShowPopup(e){this.dialogVisible=!0,this.nodeInfo=e,this.queryUser.current=1,this.getUserList()},async getUserList(){this.userLoading&&this.source.cancel("取消上次user请求"),this.source=this.$CancelToken.source();try{this.userLoading=!0;const{records:e,total:t}=await Object(n["i"])(l["a"].channel.queryCommunicationUsers,this.queryUser,this.source.token);this.userList=e,this.userTotal=t}catch(e){}finally{this.userLoading=!1}},handleUserTableCurrentChange(e){this.queryUser.current=e,this.getUserList()},debounceQueryUserChange:Object(p["a"])((function(){this.queryUser.current=1,this.getUserList()})),handleSelectionChange(e){this.rowInfo=e},async toCommunication(){if(this.rowInfo)try{this.submitloading=!0;let e={advice:this.communicatorForm.desc,instanceId:this.nodeInfo.instanceId,nodeId:this.nodeInfo.nodeId,approvalUser:this.rowInfo.userId,approvalTimes:1,submitter:sessionStorage.getItem("userId"),serviceType:this.nodeInfo.businessId,processId:this.nodeInfo.processId,systemId:this.approvalType};await Object(n["i"])(l["a"].channel.addCommunicationTask,e),this.$message.success("提交成功"),this.$emit("refresh"),this.dialogVisible=!1}catch(e){}finally{this.submitloading=!1}else this.$message.error("请选择沟通人")}}},u=d,_=(a("2ec76"),a("2877")),m=Object(_["a"])(u,r,c,!1,null,"69aa6c02",null),h=m.exports,v={props:{approvalType:{type:String,default:"IMCD"}},components:{ToCommunicator:h},data(){return{dialogVisible:!1,approveLoading:!1,submitSource:null,ruleForm:{resource:1,desc:"",nextNodesList:[]},ApprovalForm:{},multiApprovelDataList:void 0,rules:{resource:[{required:!0,message:"请选择审批结果",trigger:"change"}]},nextNodesList:{},channelInfo:{CHANNEL:0,IOP:0,customerNum:0,activeNum:0,show:!1},communicationTaskList:[]}},mounted(){},methods:{open2CommunicatorDialog(){this.$refs.toCommunicator.ShowPopup(this.ApprovalForm),this.dialogVisible=!1},clone(){this.ruleForm=Object.assign({},this.ruleForm)},ShowPopup(e,t){this.ApprovalForm=e,this.multiApprovelDataList=t,this.communicationTaskList=[],this.getNextApprovers(),"IMCD"===this.approvalType&&this.getChannelInfo(),this.ruleForm={resource:1,desc:"",nextNodesList:[]},this.nextNodesList={},this.dialogVisible=!0},async getNextApprovers(e=!1){const t={instanceId:this.ApprovalForm.instanceId,nodeId:this.ApprovalForm.nodeId,serviceType:this.ApprovalForm.businessId,approvalType:this.approvalType},a=l["a"].channel.getNextApprovers;try{const e=await Object(n["i"])(a,t,void 0,this.$retryDelay);this.ruleForm.nextNodesList=[],this.nextNodesList=e,this.nextNodesList.nextNodesApprover=this.nextNodesList.nextNodesApprover.filter(e=>2!==e.node.nodeType),this.nextNodesList.nextNodesApprover.map(e=>{var t;this.ruleForm.nextNodesList.push({value:(null===(t=e.approverUser[0])||void 0===t?void 0:t.userId)||""})}),"IMCD"===this.approvalType&&this.queryCommunicationTask()}catch(i){var s;null!==(s=i.message)&&void 0!==s&&s.includes("timeout")&&!0!==e&&this.getNextApprovers(!0)}},async queryCommunicationTask(){try{const e=await Object(n["i"])(l["a"].channel.queryCommunicationTask,{businessId:this.ApprovalForm.businessId,instanceId:this.ApprovalForm.instanceId,nodeId:this.ApprovalForm.nodeId,serviceType:this.ApprovalForm.businessId,submitter:this.ApprovalForm.approver});this.communicationTaskList=e}catch(e){}},async getChannelInfo(){this.channelInfo={CHANNEL:0,IOP:0,customerNum:0,activeNum:0,show:!1};try{const{channelStatis:e,smsCapacity:t}=await Object(n["i"])(o["a"].mpapi.getCampsegStatistics,{campsegRootId:this.ApprovalForm.businessId});this.channelInfo.show=!!e.length,this.channelInfo.IOP=t;for(let a of e)this.channelInfo.CHANNEL+=a.channelCapacity||0,this.channelInfo.customerNum+=a.useCustNum||0,this.channelInfo.activeNum+=a.campsegNum||0}catch(e){}},async processApproveInfo(e=!1){var t=[];0!==this.ruleForm.resource&&this.nextNodesList.nextNodesApprover.filter((e,a)=>{var s=this.ruleForm.nextNodesList[a],i=[];e.approverUser.map(e=>{Array.isArray(s.value)?s.value.map(t=>{t===e.userId&&i.push(e)}):s.value===e.userId&&i.push(e)}),t.push({approverUser:i,node:e.node})});let a={instanceId:this.nextNodesList.instanceId,nodeId:this.nextNodesList.nodeId,businessId:this.ApprovalForm.businessId,childBusinessId:this.ApprovalForm.childBusinessId,submitStatus:this.ruleForm.resource,dealOpinion:this.ruleForm.desc,nextNodesApprover:t,processId:this.nextNodesList.processId,berv:this.nextNodesList.berv,serviceType:this.ApprovalForm.businessId,approvalType:this.approvalType},s=o["a"].mpapi.processApproveInfo;this.multiApprovelDataList&&(s=o["a"].mpapi.batchSubmitProcess,a={...a,businessIds:this.multiApprovelDataList.map(e=>e.businessId),instanceIds:this.multiApprovelDataList.map(e=>e.instanceId)}),this.approveLoading&&this.submitSource.cancel("取消请求"),this.submitSource=this.$CancelToken.source();try{this.approveLoading=!0;await Object(n["i"])(s,a,this.submitSource.token,this.$retryDelay);this.$message.success("审批成功"),this.$emit("refresh"),this.approveLoading=!1,this.$nextTick(()=>{this.dialogVisible=!1})}catch(r){var i,l;if(null!==(i=r.message)&&void 0!==i&&i.includes("timeout")&&!0!==e)return this.processApproveInfo(!0);!0===e&&null!==(l=r.message)&&void 0!==l&&l.includes("timeout")&&this.$message.error("审批超时，请稍后重试"),this.approveLoading=!1}},Submit(){this.$refs["ruleForm"].validate(e=>{e?this.processApproveInfo():this.$message.error("请填写必填项")})},cancel(){this.approveLoading&&this.submitSource.cancel("取消请求"),this.dialogVisible=!1}}},f=v,g=(a("1b3c"),a("d22d"),Object(_["a"])(f,s,i,!1,null,"68db28bb",null));t["a"]=g.exports},f9b4:function(e,t,a){"use strict";a("75c8")},f9cc:function(e,t,a){"use strict";a("ed1e")},fad4:function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"chanel-table"},[t("h3",[e._v("渠道执行情况")]),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableData,stripe:"",border:"","header-cell-class-name":"c-header","cell-class-name":"c-body"}},[t("el-table-column",{attrs:{prop:"channelName",label:"渠道名称"}}),t("el-table-column",{attrs:{prop:"campsegNum",label:"执行中活动数"}}),t("el-table-column",{attrs:{prop:"useCustNum",label:"涉及用户数"}}),t("el-table-column",{attrs:{prop:"channelCapacity",label:"每小时执行用户数"}})],1)],1)},i=[],n=a("0fea"),o=a("d370"),l={name:"ChannelActive",data(){return{loading:!1,tableData:[]}},methods:{async getChannelActiveData(){try{this.loading=!0;const{channelStatis:e}=await Object(n["i"])(o["a"].mpapi.getCampsegStatistics,{campsegRootId:this.$route.query.campsegRootId});this.tableData=e}catch(e){}finally{this.loading=!1}}},created(){this.getChannelActiveData()}},r=l,c=(a("4356"),a("2877")),p=Object(c["a"])(r,s,i,!1,null,"a898505c",null);t["a"]=p.exports}}]);