(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-202f953c","chunk-2bfdb478"],{"0917":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("section",{staticClass:"sub-section"},[t("header",[e._v(e._s(e.title))]),t("main",[e._t("default")],2)])},i=[],n={props:{title:{type:String,default:""}}},l=n,c=(a("ad4e"),a("2877")),r=Object(c["a"])(l,s,i,!1,null,"d5ef0d10",null);t["default"]=r.exports},"0eaf":function(e,t,a){},"139d":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"submit-layout"},[t("header",{staticClass:"title"},[e._v(e._s(e.title))]),t("main",[t("SubSection",{attrs:{title:"活动基础信息"}},[t("el-form",{ref:"baseForm",attrs:{"label-width":"110px","label-suffix":"：",model:e.baseForm,rules:e.baseFormRules}},[t("el-form-item",{attrs:{label:"策略名称",prop:"campsegName"}},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],model:{value:e.baseForm.campsegName,callback:function(t){e.$set(e.baseForm,"campsegName",t)},expression:"baseForm.campsegName"}})],1),t("el-form-item",{attrs:{label:"投放周期",prop:"startDate"}},[t("el-date-picker",{attrs:{type:"daterange","value-format":"yyyy-MM-dd",format:"yyyy-MM-dd","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},on:{change:e.changeDate},model:{value:e.baseForm.dateList,callback:function(t){e.$set(e.baseForm,"dateList",t)},expression:"baseForm.dateList"}})],1),t("el-form-item",{attrs:{label:"执行周期",prop:"dnaUpdateCycle"}},[t("el-radio-group",{model:{value:e.baseForm.dnaUpdateCycle,callback:function(t){e.$set(e.baseForm,"dnaUpdateCycle",t)},expression:"baseForm.dnaUpdateCycle"}},e._l(e.dnaUpdateCycleList,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value}},[e._v(" "+e._s(a.label)+" ")])})),1)],1),t("el-form-item",{attrs:{label:"策略描述",prop:"campsegDesc"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.baseForm.campsegDesc,callback:function(t){e.$set(e.baseForm,"campsegDesc",t)},expression:"baseForm.campsegDesc"}})],1),t("el-form-item",{attrs:{label:"策略类型",prop:"campsegTypeId"}},[t("el-select",{attrs:{placeholder:"请选择策略类型"},model:{value:e.baseForm.campsegTypeId,callback:function(t){e.$set(e.baseForm,"campsegTypeId",t)},expression:"baseForm.campsegTypeId"}},e._l(e.campsegTypeList,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),t("el-form-item",{attrs:{label:"专题"}},[t("el-select",{attrs:{placeholder:"请选择专题"},model:{value:e.baseForm.topicId,callback:function(t){e.$set(e.baseForm,"topicId",t)},expression:"baseForm.topicId"}},e._l(e.topicList,(function(e){return t("el-option",{key:e.topicId,attrs:{label:e.topicName,value:e.topicId}})})),1)],1),t("el-form-item",{attrs:{label:"场景",prop:"campScene"}},[t("SceneSelect",{attrs:{initialData:e.campSceneData,baseForm:e.baseForm}})],1),t("el-form-item",{attrs:{label:"营销模板"}},[t("el-select",{attrs:{placeholder:"请选择营销模板",clearable:""},model:{value:e.baseForm.activityTemplateId,callback:function(t){e.$set(e.baseForm,"activityTemplateId",t)},expression:"baseForm.activityTemplateId"}},e._l(e.activityTemplateList,(function(e){return t("el-option",{key:e.ACTIVITY_TEMPLATE_ID,attrs:{label:e.ACTIVITY_NAME,value:e.ACTIVITY_TEMPLATE_ID}})})),1)],1),t("el-form-item",{attrs:{label:"活动类型",prop:"activityType"}},[t("el-select",{attrs:{placeholder:"请选择活动类型"},model:{value:e.baseForm.activityType,callback:function(t){e.$set(e.baseForm,"activityType",t)},expression:"baseForm.activityType"}},e._l(e.activityTypeList,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),t("el-form-item",{attrs:{label:"活动目的",prop:"activityObjective"}},[t("el-select",{attrs:{placeholder:"请选择营销活动目标"},model:{value:e.baseForm.activityObjective,callback:function(t){e.$set(e.baseForm,"activityObjective",t)},expression:"baseForm.activityObjective"}},e._l(e.activityObjectiveList,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),0==e.isSubmit?t("el-form-item",{attrs:{label:"策略预演",prop:"previewCamp"}},[t("el-select",{attrs:{placeholder:"请选择策略预演"},model:{value:e.baseForm.previewCamp,callback:function(t){e.$set(e.baseForm,"previewCamp",t)},expression:"baseForm.previewCamp"}},e._l(e.previewCampList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),t("el-form-item",{attrs:{label:"敏感用户群",prop:"sensitiveCustId"}},[t("el-select",{attrs:{placeholder:"请选择敏感用户群",multiple:"","collapse-tags":""},on:{change:e.changeSensitiveCust},model:{value:e.baseForm.sensitiveCustIdList,callback:function(t){e.$set(e.baseForm,"sensitiveCustIdList",t)},expression:"baseForm.sensitiveCustIdList"}},e._l(e.sensitiveCustList,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),1==e.isSubmit?e._l(e.approveInfo.nextNodesApprover,(function(a,s){return t("el-form-item",{key:s,attrs:{label:a.node.nodeName,rules:{required:!0}}},[t("el-select",{attrs:{placeholder:"请选择审批人"},model:{value:e.selectedApproverList[s],callback:function(t){e.$set(e.selectedApproverList,s,t)},expression:"selectedApproverList[index]"}},e._l(a.approverUser,(function(e){return t("el-option",{key:e.userId,attrs:{label:e.userName,value:e.userId}})})),1)],1)})):e._e()],2)],1),t("SubSection",{attrs:{title:"0"==e.type?"选择场景":"选择活动"}},["0"==e.type?t("SceneList",{on:{getChannelLines:e.getChannelLines,changeSelection:e.changeSelection}}):t("ActivityList",{on:{getChannelLines:e.getChannelLines,changeSelection:e.changeSelection}})],1)],1),t("footer",[t("el-button",{attrs:{type:"primary",size:"medium",loading:e.saveLoading},on:{click:e.save}},[e._v("确认")]),t("el-button",{attrs:{size:"medium"},on:{click:function(t){return e.$emit("cancel")}}},[e._v("取消")])],1)])},i=[],n=(a("13d5"),a("14d9"),a("0fea")),l=a("31b1"),c=a("5e05"),r=a("d370"),o=(a("d39c"),a("2ef0")),p=a("bdad"),m=a("3623"),d=a("0917"),u=a("db27"),h=function(){var e=this,t=e._self._c;return t("div",{staticClass:"activity-table"},[t("el-table",{ref:"multipleTable",attrs:{border:"","row-key":"channelNodeId",data:e.activityList},on:{"selection-change":e.onSelectionChange}},[t("el-table-column",{attrs:{type:"selection",align:"center",width:"45"}}),e._l(e.columnList,(function(a){return t("el-table-column",{key:a.prop,attrs:{prop:a.prop,label:a.label,"header-align":"center","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t[a.prop]||"-")+" ")]}}],null,!0)})}))],2)],1)},v=[],y=a("8864"),f={data(){return{channelLines:[],activityList:[],columnList:[{label:"推荐产品",prop:"productName"},{label:"推荐客群",prop:"customerName"},{label:"推荐渠道",prop:"channelName"}],selectedList:[]}},methods:{getChannelLine(){const{type:e}=this.$route.query,t=$graph.findAll("node",e=>"Channel"===e.getModel().type),a=t.map(e=>e.getModel()),s=[];a.forEach(t=>{const{nodeLines:a}=t,i=a.filter(e=>"Root"!==e.nodeType),n={},l=[];i.forEach((t,a)=>{var s;const c=$graph.findDataById(t.nodeId);l.push(c),n["channelNodeId"]=c.id;let r=null===(s=i.find(e=>"AiCustomer"===e.nodeType))||void 0===s?void 0:s.nodeId,o=!0,p=!1,m="";var d,u;r||(o=!1,r=null===(d=i.find(e=>"Customer"===e.nodeType))||void 0===d?void 0:d.nodeId,r||(p=!0,r=null===(u=i.find(e=>"AiScene"===e.nodeType))||void 0===u?void 0:u.nodeId));const h=$graph.findDataById(r);if(m=h.businessData.customerInfo.customGroupName,o||(m="手动配置_"+Date.now()+Math.floor(1e3*Math.random()),p&&(h.businessData.customerInfo={customGroupName:m})),n["lastScene"]={activityName:m,sceneName:h.businessData.customerInfo.customGroupName,sceneId:h.id,attrType:"1",customerInfo:{}},"1"===e){var v;const e=null===(v=i.find(e=>"AiHelp"===e.nodeType))||void 0===v?void 0:v.nodeId;if(e){var f;const t=$graph.findDataById(e).businessData;t.initialData.customerSection?"1"===(null===(f=t.initialData.customerSection)||void 0===f?void 0:f.attrType)&&(n["lastScene"]["customerInfo"]={customGroupId:1,customSourceId:"1"}):n["lastScene"]["customerInfo"]={customGroupId:1,customSourceId:"1"}}else{var b;const e=null===(b=i.find(e=>"Customer"===e.nodeType||"AiScene"===e.nodeType))||void 0===b?void 0:b.nodeId,t=$graph.findDataById(e).businessData.customerInfo;n["lastScene"]["customerInfo"]=t}}else{const e=i.find(e=>"AiIntelligent"===e.nodeType).nodeId,t=$graph.findDataById(e).businessData;t.businessData.customSource==y["d"].group&&(n["lastScene"]["customerInfo"]={customGroupId:1,customSourceId:"1"})}switch(n["aitaskId"]=h.businessData.aitaskId,c.type){case"Product":n["productName"]=c.businessData.productList[0].planName;break;case"AiCustomer":n["customerName"]=c.businessData.customerInfo.customGroupName;break;case"AiScene":n["customerName"]=c.businessData.customerInfo.customGroupName||"手动客群范围";break;case"Customer":n["customerName"]=c.businessData.customerInfo.customGroupName;break;case"Channel":n["channelName"]=c.businessData.channelList.map(e=>e.channelName).join(",");break;default:break}}),s.push(l),this.activityList.push(n)}),this.channelLines=Object(o["cloneDeep"])(s),this.$emit("getChannelLines",this.channelLines)},onSelectionChange(e){this.selectedList=e,this.$emit("changeSelection",e)},selectAll(){this.$refs.multipleTable.toggleAllSelection(),this.selectedList=this.activityList,this.$emit("changeSelection",this.selectedList)}},created(){this.getChannelLine()},mounted(){this.selectAll()}},b=f,g=(a("1cf0"),a("2877")),C=Object(g["a"])(b,h,v,!1,null,"7b7d124c",null),I=C.exports,S=a("5310"),D={components:{SceneList:u["a"],SubSection:d["default"],SceneSelect:S["a"],ActivityList:I},props:{isSubmit:{type:Number,default:0}},data(){return{type:this.$route.query.type,saveLoading:!1,baseForm:{activityObjective:"",activityTemplateId:"",activityType:"",campScene:"",campsegDesc:"",campsegId:"",campsegName:"",campsegRootId:"",campsegStatId:"",campsegStatName:"",campsegTypeId:"",endDate:"",dateList:[],previewCamp:"",sensitiveCustIds:"",sensitiveCustIdList:[],startDate:"",tacticsMap:'[{"group":["1","2","3"],"children":[]}]',topicId:"",dnaUpdateCycle:"",custgroupSource:1},baseFormRules:{campsegName:[{required:!0,message:"请输入策略名称",trigger:"blur"}],startDate:[{required:!0,message:"请选择投放周期",trigger:"change"}],dnaUpdateCycle:[{required:!0,message:"请选择执行周期",trigger:"change"}],campsegDesc:[{required:!0,message:"请输入策略描述",trigger:"blur"}],campsegTypeId:[{required:!0,message:"请选择策略类型",trigger:"change"}],campScene:[{required:!0,message:"请选择场景",trigger:"blur"}],activityObjective:[{required:!0,message:"请选择活动目的",trigger:"change"}],activityType:[{required:!0,message:"请选择活动类型",trigger:"change"}],previewCamp:[{required:!0,message:"请选择是否预演",trigger:"change"}]},pickerOptions:{disabledDate(e){return e.getTime()<Date.now()-864e5}},campsegTypeList:[],dnaUpdateCycleList:[{label:"一次性",value:1},{label:"日周期",value:3},{label:"月周期",value:2}],topicList:[],campSceneList:[],campSceneData:{},activityTypeList:[],activityObjectiveList:[],activityTemplateList:[],sensitiveCustList:[],channelLines:[],selectedLines:[],previewCampList:[{value:"1",label:"预演"},{value:"2",label:"批量预演"},{value:"0",label:"不预演"}],allChannelList:[],channelDetailList:[],ifHave9330102:!1,approveInfo:{},selectedApproverList:[]}},computed:{title(){return 1==this.isSubmit?"提交审批":"保存草稿"},productEndDate(){let e="";const t=this.channelLines.filter(e=>this.selectedLines.some(t=>t.channelNodeId===e[e.length-1].id)).map(e=>e.find(e=>"Product"===e.type)).map(e=>e.businessData.productList),a=t.flat().map(e=>e.planEndDate),s=[...new Set(a)].filter(Boolean);return s.length&&(e=s.reduce((e,t)=>t<e?t:e,s[0])),e||(e="2099-12-31 23:59:59"),e}},methods:{echoData(){const{extendData:e={},BUSINESS_DATA:t}=$graph.findDataById(m["e"]),{baseForm:a={}}=e;this.baseForm={...this.baseForm,...a,activityType:t.sceneClass}},getSelectList(){const e=c["a"].common.getSysEnum;Object(n["i"])(e,{enumType:"camp_type_list"}).then(e=>{this.campsegTypeList=e}),Object(n["i"])(e,{enumType:"camp_special_topic"}).then(e=>{this.topicList=e}),Object(n["i"])(l["a"].channel.queryCampScene).then(e=>{this.campSceneData=e}),Object(n["i"])(e,{enumType:"activity_type"}).then(e=>{this.activityTypeList=e}),Object(n["i"])(e,{enumType:"activity_objective"}).then(e=>{this.activityObjectiveList=e}),Object(n["i"])(e,{enumType:"camp_sensitive_cust_list"}).then(e=>{this.sensitiveCustList=e}),Object(n["i"])(r["a"].mpapi.queryIopTemplateSaveUse).then(e=>{this.activityTemplateList=e})},async getApproveTemplate(){if(this.baseForm.hasOwnProperty("approveFlowId")&&null!==this.baseForm.approveFlowId)this.getNextApprovers({approveFlowId:this.baseForm.approveFlowId});else{const e=await Object(n["i"])(l["a"].channel.getTemplateData);this.getNextApprovers(e)}},async getNextApprovers(e){var t;const a=this.allChannelList.map(e=>e.channelId),s=[...new Set(a)],i={berv:e.berv,instanceId:e.approveFlowId,nodeId:"",processId:e.processId,triggerParm:{channelId:s.join(",")}},c=await Object(n["i"])(l["a"].channel.getNextApprovers,i);null===(t=c.nextNodesApprover)||void 0===t||t.forEach(e=>{var t;this.selectedApproverList.push(null===(t=e.approverUser[0])||void 0===t?void 0:t.userId)}),this.approveInfo=c},changeDate(e){if(e){if(e[1]>this.productEndDate)return this.$message.error(`活动结束日期大于产品失效日期${this.productEndDate}，请修改活动结束日期`),void(this.baseForm.dateList=[]);this.baseForm.startDate=e[0]+" 00:00:00",this.baseForm.endDate=e[1]+" 23:59:59"}},changeSensitiveCust(e){e.length>0?this.baseForm.sensitiveCustIds=e.join(","):this.baseForm.sensitiveCustIds=""},getChannelLines(e){this.channelLines=e},changeSelection(e){this.selectedLines=e},getThemeInfo(){const e=$graph.findDataById(m["e"]).BUSINESS_DATA;let t=Object(o["cloneDeep"])($graph.save());if("0"===this.type){const e=this.selectedLines.map(e=>e.lastScene.sceneId);t=Object(p["a"])(e,t)}return{...e,themeId:this.$route.query.isOneClickRef?"":this.$route.query.id||"",themeContent:JSON.stringify(t)}},assembleSceneInfo(){let e=[];return this.selectedLines.forEach(t=>{const a=this.channelLines.find(e=>e[e.length-1].id===t.channelNodeId);let s=null;if(a.some(e=>"LabelOptimize"===e.type)){const e=a.find(e=>"LabelOptimize"===e.type).id;s=$graph.findDataById(e).businessData}let i=a.filter(e=>"Scene"===e.type);i=i.map((e,t)=>{let a=JSON.stringify(e.businessData.conditionParams),n=e.businessData.customerNum;return t===i.length-1&&s&&(a=JSON.stringify(s.finallyParams),n=s.customerNum),{sceneId:e.id,scenePid:e.pId,sceneName:e.businessData.sceneName,sceneCondition:a,sceneCount:n,sceneLevel:t,sceneFissionType:e.businessData.attrType,sceneFissionValue:e.businessData.selectAttrStr,leafSceneFlag:i.length-1===t?1:0,customerInfo:e.businessData.customerInfo||{}}}),e.push(i)}),e},assembleSceneInfoByAI(){let e=[];return this.selectedLines.forEach(t=>{const a=this.channelLines.find(e=>e[e.length-1].id===t.channelNodeId);let s=!1,i=a.filter(e=>"AiCustomer"===e.type);0===i.length&&(i=a.filter(e=>"Customer"===e.type),0===i.length&&(s=!0,i=a.filter(e=>"AiScene"===e.type))),i=i.map((e,t)=>{var a;const{customerInfo:i,attrType:n,conditionParams:l,selectAttrStr:c,customerNum:r}=e.businessData;let o={sceneId:Object(p["c"])(),scenePid:Object(p["c"])(),sceneName:i.customGroupName,sceneCondition:null,sceneCount:null!==(a=i.customerNum)&&void 0!==a?a:i.customNum,sceneLevel:0,sceneFissionType:1,sceneFissionValue:"",leafSceneFlag:1,customerInfo:i};return s&&"1"!=n&&(o={...o,sceneCount:r,sceneName:"手动配置_"+Object(p["c"])(),sceneCondition:JSON.stringify(l),sceneFissionType:+n,sceneFissionValue:c,customerInfo:i.customGroupId?i:{}}),o}),e.push(i)}),e},assembleApproveInfo(){const e=Object(o["cloneDeep"])(this.approveInfo);return e.nextNodesApprover.forEach((e,t)=>{e.approverUser=e.approverUser.filter(e=>e.userId===this.selectedApproverList[t])}),e},assembleBaseInfo(){const e=[];return this.selectedLines.forEach((t,a)=>{const s=Object(o["cloneDeep"])(this.baseForm),{lastScene:i={},aitaskId:n}=t;s.campsegName=i.activityName||i.sceneName,s.lastSceneId=i.sceneId,s.taskIdByAI=n;i.customerInfo;const l={baseCampInfo:s,campSchemes:[],childrenSchemes:[],planExtInfoList:[],type:"1",isSubmit:this.isSubmit,approveUserId:1==this.isSubmit?this.assembleApproveInfo():void 0},c=this.channelLines.find(e=>e[e.length-1].id===t.channelNodeId),r={product:[],customer:[],channels:[]},p={planId:"",planName:"",campSeriesPlan:[],campFusionPlans:[],campExclusivePlan:[]},m=c.find(e=>"Product"===e.type).businessData;r.product=m.productList,p.planId=m.productList[0].planId,p.planName=m.productList[0].planName,p.campSeriesPlan=m.seriesProductList,p.campFusionPlans=m.fusionProductList,p.campExclusivePlan=m.mutexProductList,l.planExtInfoList.push(p),r.customer=[{customerGroupId:null,customGroupName:null,updateCycle:s.isCoc?s.cocUpdateCycle:s.dnaUpdateCycle}];const d=c.find(e=>"Channel"===e.type).businessData;r.channels=d.channelList.map((e,t)=>{const a={...e,channelId:e.channelId,channelName:e.channelName,adivInfo:e.adivInfo.adivId?e.adivInfo:{adivId:e.channelId+"1",adivName:e.channelName+"默认运营位"},channelConf:{execContent:e.marketingWords||e.EXEC_CONTENT||e.execContent||e.SMS_CONTENT,ifHaveVar:e.IF_HAVE_VAR-0,frequency:e.FREQUENCY?e.FREQUENCY.toString()+"_"+e.num:"",updateCycle:null,cepEventId:e.CEP_EVENT_ID,cepSceneName:e.CEP_SCENE_NAME,channelAdivId:e.channelAdivId,wavesChannelPid:e.channelConf.wavesChannelPid,wavesRuleId:e.channelConf.wavesRuleId,wavesNo:e.channelConf.wavesRuleId,wavesNoDesc:e.channelConf.wavesNoDesc,channelExtConf:{...e}}};return this.allChannelList.push(a),l.childrenSchemes.push({data:[m.productList[0].planId,null,a.channelId,a.adivInfo.adivId],wavePid:null,wavesRuleId:null}),a}),l.campSchemes.push(r),e.push(l)}),e},assembleData(){const{query:e}=this.$route,t={themeBaseInfo:this.getThemeInfo(),sceneBaseInfo:"0"==e.type?this.assembleSceneInfo():this.assembleSceneInfoByAI(),campInfo:this.assembleBaseInfo(),isCreateTemplate:0,isOneClickRef:e.isOneClickRef||0,templateId:e.isOneClickRef?e.id:"",isAI:"0"==e.type?0:1};return t},validate(){return 0===this.selectedLines.length?(this.$message.error("请选择场景"),!1):1!=this.isSubmit||0!==this.selectedApproverList.length||(this.$message.error("请选择审批人"),!1)},save(){this.validate()&&this.$refs.baseForm.validate(e=>{if(!e)return;this.saveLoading=!0;const t=this.assembleData();this.$emit("save","save",{params:t,allChannelList:this.allChannelList,baseForm:this.baseForm,campsegTypeList:this.campsegTypeList,topicList:this.topicList,campSceneData:this.campSceneData,activityTypeList:this.activityTypeList,activityObjectiveList:this.activityObjectiveList,activityTemplateList:this.activityTemplateList,sensitiveCustList:this.sensitiveCustList}),this.saveLoading=!1})}},created(){this.getSelectList(),this.echoData(),this.isSubmit&&this.getApproveTemplate()}},L=D,T=(a("ae73"),Object(g["a"])(L,s,i,!1,null,"6150e73f",null));t["default"]=T.exports},"13d5":function(e,t,a){"use strict";var s=a("23e7"),i=a("d58f").left,n=a("a640"),l=a("2d00"),c=a("605d"),r=!c&&l>79&&l<83,o=r||!n("reduce");s({target:"Array",proto:!0,forced:o},{reduce:function(e){var t=arguments.length;return i(this,e,t,t>1?arguments[1]:void 0)}})},"1cf0":function(e,t,a){"use strict";a("2ac0")},"2ac0":function(e,t,a){},"31b1":function(e,t,a){"use strict";const s="/plan-svc/api/action",i="/plan-svc/action",n="/approve-svc/",l="/element-svc/";t["a"]={channel:{queryIopTemplate:s+"/tactics/tacticsCreate/queryIopTemplate",queryTopics:s+"/topic/queryTopics",getTemplateData:n+"jx/cmpApprovalProcessConf/getApproveConfig",getApproveConfig:n+"cmpApprovalProcessConf/getApproveConfig",getNextApprovers:n+"jx/cmpApproveProcessInstance/getNodeApprover",saveChannel:s+"/tactics/tacticsCreate/save",deleteCustom:s+"/custgroup/custGroupManager/deleteCustom",getMoreMyCustom:s+"/custgroup/custGroupManager/getMoreMyCustom",viewCustGroupDetail:s+"/custgroup/custGroupManager/viewCustGroupDetail",queryMmsTemplates:i+"/mmsTemplates/queryMmsTemplates",deleteMmsTemplateLists:i+"/mmsTemplates/createTactics/deleteMmsTemplateLists",updateMmsTemplate:i+"/mmsTemplates/updateMmsTemplate",smsContentBatchDel:s+"/smsTemplates/smsContentBatchDel",smsContentDel:s+"/smsTemplates/smsContentDel",smsContentEdit:s+"/smsTemplates/smsContentEdit",smsContentSaveOrUpdate:s+"/smsTemplates/smsContentSaveOrUpdate",smsTemplateOffline:s+"/smsTemplates/smsTemplateOffline",smsTemplates:s+"/smsTemplates/smsTemplates",smsTemplateSaveOrUpdate:s+"/smsTemplates/smsTemplateSaveOrUpdate",delPlanExclusivity:l+"mcd-plan-exclusivity/delPlanExclusivity",exportPlanExcluTemplate:l+"mcd-plan-exclusivity/exportPlanExcluTemplate",getPlanExclusivityInfo:l+"mcd-plan-exclusivity/getPlanExclusivityInfo",getPlanExclusivityList:l+"mcd-plan-exclusivity/getPlanExclusivityList",queryPlanDefList:l+"mcd-plan-exclusivity/queryPlanDefList",queryPlanExclusivity:l+"mcd-plan-exclusivity/queryPlanExclusivity",saveOrUpdatePlanExclusivity:l+"mcd-plan-exclusivity/saveOrUpdatePlanExclusivity",savePlanExclusivity:l+"mcd-plan-exclusivity/savePlanExclusivity",updatePlanExclusivity:l+"mcd-plan-exclusivity/updatePlanExclusivity",uploadPlanExcluFile:l+"mcd-plan-exclusivity/uploadPlanExcluFile",approveRecord:l+"api/mcdDimMaterialApprove/jx/approveRecord",getMaterialApprover:l+"api/mcdDimMaterialApprove/jx/getMaterialApprover",commitProcess:"/approve-svc/cmpApproveProcessInstance/commitProcess",subMaterialApprove:l+"api/mcdDimMaterialApprove/jx/subMaterialApprove",queryCommunicationUsers:"/plan-svc/api/channelMaterial/jx/queryCommunicationUsers",queryCommunicationTask:"/approve-svc/jx/cmpApproveProcessInstance/queryCommunicationTask",addCommunicationTask:"/approve-svc/jx/cmpApproveProcessInstance/addCommunicationTask",addCommunicationTaskBatch:"/approve-svc/jx/cmpApproveProcessInstance/addCommunicationTaskBatch",communicationAppTask:"/approve-svc/jx/cmpApproveProcessInstance/communicationAppTask",queryChannelExecInfo:"/plan-svc/mcd/camp/channelExec/queryChannelExecInfo",queryChannelExecList:"/plan-svc/mcd/camp/channelExec/queryChannelExecList",deleteChannelPrompt:"/plan-svc/mcd/chan/prompt/deleteChannelPrompt",queryChannelPrompt:"/plan-svc/mcd/chan/prompt/queryChannelPrompt",saveOrUpdateChannelPrompt:"/plan-svc/mcd/chan/prompt/saveOrUpdateChannelPrompt",uploaChanPromptFile:"/plan-svc/mcd/chan/prompt/uploaChanPromptFile",chanAndPlanMarketingHistory:"/plan-svc/mcd/marketing/history/chanAndPlanMarketingHistory",custContactNumMarketingHistory:"/plan-svc/mcd/marketing/history/custContactNumMarketingHistory",custSuccessRateMarketingHistory:"/plan-svc/mcd/marketing/history/custSuccessRateMarketingHistory",planMarketingHistory:"/plan-svc/mcd/marketing/history/planMarketingHistory",caculateContactUserNum:"/pec-timing/mcd/user/contact/caculateContactUserNum",caculateOrderUserNum:"/pec-timing/mcd/user/contact/caculateOrderUserNum",queryCampScene:"/plan-svc/api/action/tactics/tacticsCreate/jx/queryCampScene"}}},5310:function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("el-select",{attrs:{multiple:"",size:e.size||void 0},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},e._l(e.sceneOptions,(function(a){return t("el-option-group",{key:a.label,attrs:{label:a.label}},e._l(a.data,(function(e){return t("el-option",{key:e.CAMP_BUSINESS_TYPE,attrs:{label:e.CAMP_BUSINESS_TYPE,value:e.CAMP_BUSINESS_TYPE,disabled:e.disabled}})})),1)})),1)},i=[],n=a("0fea"),l=a("31b1"),c={props:{baseForm:{type:Object,required:!0},size:{type:void 0|String,default:void 0},initialData:{type:Object,default:()=>({})}},data(){return{selected:[],sceneOptions:[{label:"存量",data:[]},{label:"产品",data:[]},{label:"其他",data:[]}],allSceneList:[]}},watch:{baseForm:{handler(e,t){var a;(null===e||void 0===e?void 0:e.campScene)!==(null===t||void 0===t?void 0:t.campScene)&&(this.selected=(null===(a=this.baseForm.campScene)||void 0===a?void 0:a.split(";"))||[],this.selected=this.selected.filter(e=>e))},deep:!0,immediate:!0},selected:{handler(e,t){if(0===this.allSceneList.length)return this.baseForm.campScene="",void this.$emit("change",this.baseForm.campScene);if(e.length===t.length)return;if(e.length<t.length){const a=t.find(t=>!e.includes(t)),s=this.allSceneList.find(e=>e.CAMP_BUSINESS_TYPE===a);return"其他"===s.type&&(this.allSceneList.forEach(e=>{e.disabled=!1}),this.$forceUpdate()),this.baseForm.campScene=this.selected.join(";"),void this.$emit("change",this.baseForm.campScene)}const a=e[e.length-1],s=this.allSceneList.find(e=>e.CAMP_BUSINESS_TYPE===a),i=this.selected.filter(e=>{const t=this.allSceneList.find(t=>t.CAMP_BUSINESS_TYPE===e);return t.type===s.type}),n=i.map(e=>this.allSceneList.find(t=>t.CAMP_BUSINESS_TYPE===e));switch(s.type){case"存量":if(i.length>1){const e=this.selected.filter(e=>{if(!i.includes(e))return!0;const t=n.find(t=>t.CAMP_BUSINESS_TYPE===e);return(null===t||void 0===t?void 0:t.CAMP_BUSINESS_TYPE)===a});this.selected=e}break;case"产品":if(i.length>1){const e=this.selected.filter(e=>{if(!i.includes(e))return!0;const t=n.find(t=>t.CAMP_BUSINESS_TYPE===e);return(null===t||void 0===t?void 0:t.CAMP_BUSINESS_TYPE)===a});this.selected=e}break;case"其他":this.selected.length>1&&(this.selected=[a]),this.allSceneList.forEach(e=>{"其他"!==e.type&&(e.disabled=!0)}),this.$forceUpdate();break}this.baseForm.campScene=this.selected.join(";"),this.$emit("change",this.baseForm.campScene)},deep:!0}},methods:{querySceneList(){Object(n["i"])(l["a"].channel.queryCampScene).then(e=>{this.sceneOptions.forEach(t=>{t.data=e[t.label]||[],t.data.forEach(e=>{e.type=t.label,e.disabled=!1}),this.allSceneList=this.allSceneList.concat(t.data)})})}},created(){0===Object.keys(this.initialData).length?this.querySceneList():this.sceneOptions.forEach(e=>{e.data=this.initialData[e.label]||[],e.data.forEach(t=>{t.type=e.label,t.disabled=!1}),this.allSceneList=this.allSceneList.concat(e.data)})}},r=c,o=a("2877"),p=Object(o["a"])(r,s,i,!1,null,"fa9c6be6",null);t["a"]=p.exports},"605d":function(e,t,a){"use strict";var s=a("da84"),i=a("c6b6");e.exports="process"===i(s.process)},8864:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"f",(function(){return i})),a.d(t,"d",(function(){return n})),a.d(t,"c",(function(){return l})),a.d(t,"b",(function(){return c})),a.d(t,"e",(function(){return r}));const s={product:"0",customer:"1",helpDoc:"2"},i={auto:-1,exist:1},n={auto:-1,group:0,label:1},l={auto:-1,exist:1},c={default:0,manual:1},r={num:0,score:1}},9512:function(e,t,a){},"9a0e":function(e,t,a){"use strict";a("9512")},a640:function(e,t,a){"use strict";var s=a("d039");e.exports=function(e,t){var a=[][e];return!!a&&s((function(){a.call(null,t||function(){return 1},1)}))}},ad4e:function(e,t,a){"use strict";a("cd63")},ae73:function(e,t,a){"use strict";a("0eaf")},cd63:function(e,t,a){},d39c:function(e,t,a){"use strict";const s="/element-svc/api",i="/preview-svc",n="/mcd-web/action";t["a"]={seapi:{querylistEnumValue:"/element-svc/mcd-plan-label/queryLabelByKey",loadImage:s+"/mcdDimMaterial/loadImage",queryTableList:"/element-svc/api/jx/mcdPlanDef/queryPlanDefPageList",saveStatus:s+"/mcdPlanDef/updatePlanDefStatus",queryDetail:"/element-svc/api/jx/mcdPlanDef/getPlanDetailById",mcdChannelList:s+"/mcdDimMaterial/queryChannel",mcdContList:s+"/mcdDimMaterial/queryContact",mcdPositList:s+"/mcdDimMaterial/queryPosition",getChannels:s+"/mcdDimChannel/pagelistDimChannel",queryContactByChannelId:s+"/iop/operatingPositionManager/queryContactByChannelId.do",queryPosition:s+"/iop/template/queryPosition",getOnlineChannels:s+"/mcdDimChannel/listDimChannel  ",getOnlineChannelsByUser:s+"/mcdDimChannel/jx/listDimChannel",getSysDics:"/plan-svc/action/iop/common/getSysDics",queryDigitalProductContents:s+"/iopDigitalProduct/queryDigitalProductPageList",queryConentDetailById:s+"/iopDigitalProduct/getDigitalProduct",updateDigitalProuctStatus:s+"/iopDigitalProduct/updateDigitalProductStatus",queryMaterialInfo:s+"/mcdDimMaterial/queryMaterialPageList",deleteMaterById:s+"/mcdDimMaterial/deleteMaterial",queryMaterialById:s+"/mcdDimMaterial/getMaterial",saveOrUpdateMaterial:s+"/mcdDimMaterial/saveOrUpdateMaterial",uploadMaterImg:s+"/mcdDimMaterial/uploadMaterialPicture",uploadMaterVideo:s+"/mcdDimMaterial/uploadMaterialVideo",uploadMaterFile:s+"/mcdDimMaterial/uploadMaterialsFile",queryIopContactList:s+"/jx/mcdDimContact/pagelistMcdDimContact",queryContactDetailById:s+"/jx/mcdDimContact/getDimContactDetail",listAllChannelName:s+"/mcdDimChannel/listAllChannelNameAndId",deleteContactById:s+"/mcdDimContact/removeContact",saveOrUpdateContact:s+"/jx/mcdDimContact/saveOrUpdateContact",validateContactName:s+"/mcdDimContact/getValidateContactName",displayChannelList:"/element-svc/api/mcdDimChannel/jx/pagelistDimChannel",validateChannelName:s+"/mcdDimChannel/getValidateChannelName",saveOrUpdateChannel:"/element-svc/api/mcdDimChannel/jx/saveOrUpdateDimChannel",deleteChannelById:s+"/mcdDimChannel/removeDimChannel",channelDetail:s+"/mcdDimChannel/getDimChannel",customerLike:"/preview-svc/jx/chnPre/queryPreData",channelDetail:"/element-svc/mcd-dim-channel-desc/query",uploaChanPromptFile:"/element-svc/api/mcdDimChannel/jx/uploaChanPromptFile",downloadChanPromptFile:"/plan-svc/mcd/chan/prompt/downloadChanPromptFile",queryDimChannelInfo:"/element-svc/api/mcdDimChannel/jx/queryDimChannelInfo",queryChannelEValData:"/groupmarket/enterprise/queryChannelEValData",queryIopOperatingPosition:s+"/mcdDimAdivInfo/pagelistAdivInfo",deleteOperatingPositionById:s+"/mcdDimAdivInfo/removeAdivInfo",queryOperPositionDetail:s+"/mcdDimAdivInfo/getAdivInfo",queryOpelistData:s+"/mcdDimAdivInfo/listChannelInfoAndContactInfo",queryCampsegInfoWithThisPosId:s+"/mcdDimAdivInfo/listpageCampsegInfoWithThisAdivId",getConfigList:s+"/mcdDimAttrConf/queryConfigList",validateOperationName:s+"/mcdDimAdivInfo/getValidateAdivInfoName",getValidateAdivInfoId:s+"/jx/mcdDimAdivInfo/getValidateAdivInfoId",saveOrUpdateOperPosition:s+"/mcdDimAdivInfo/saveOrUpdateAdivInfo",getChannelScheduleList:n+"/channelview/getChannelScheduleList",querySensitiveCust:i+"/mcd-channel-sensitive-cust-conf/querySensitiveCust",saveSensitiveCust:i+"/mcd-channel-sensitive-cust-conf/saveSensitiveCust",deleteSensitiveCust:i+"/mcd-channel-sensitive-cust-conf/deleteSensitiveCust",batchDeleteSensitiveCust:i+"/mcd-channel-sensitive-cust-conf/batchDeleteSensitiveCust",pagelistApproveMaterial:s+"/mcdDimMaterialApprove/pagelistApproveMaterial",approveRecord:s+"/mcdDimMaterialApprove/approveRecord",pagelistMyMaterial:s+"/mcdDimMaterialTemplate/pagelistMyMaterial",pagelistExcellentMaterial:s+"/mcdDimMaterialTemplate/pagelistExcellentMaterial",pagelistHotSpotMaterial:s+"/mcdDimMaterialTemplate/pagelistHotSpotMaterial",updateMaterialStatus:s+"/mcdDimMaterial/updateMaterialStatus",getMaterialApprover:s+"/mcdDimMaterialApprove/getMaterialApprover",getCmpApprovalProcess:s+"/mcdDimMaterialApprove/getCmpApprovalProcess",subMaterialApprove:s+"/mcdDimMaterialApprove/subMaterialApprove",addExcellentMaterialLibrary:s+"/mcdDimMaterialTemplate/addExcellentMaterialLibrary",removeExcellentMaterialLibrary:s+"/mcdDimMaterialTemplate/removeExcellentMaterialLibrary",createExcellentMaterial:s+"/mcdDimMaterialTemplate/createExcellentMaterial",createHotSpotMaterial:s+"/mcdDimMaterialTemplate/createHotSpotMaterial",removeMyMaterial:s+"/mcdDimMaterialTemplate/removeMyMaterial",getIntell:s+"/mcdDimMaterial/getIntelligentMatchingMaterialList"}}},d58f:function(e,t,a){"use strict";var s=a("59ed"),i=a("7b0b"),n=a("44ad"),l=a("07fa"),c=TypeError,r=function(e){return function(t,a,r,o){var p=i(t),m=n(p),d=l(p);s(a);var u=e?d-1:0,h=e?-1:1;if(r<2)while(1){if(u in m){o=m[u],u+=h;break}if(u+=h,e?u<0:d<=u)throw new c("Reduce of empty array with no initial value")}for(;e?u>=0:d>u;u+=h)u in m&&(o=a(o,m[u],u,p));return o}};e.exports={left:r(!1),right:r(!0)}},db27:function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"scene-table"},[t("el-table",{ref:"multipleTable",attrs:{border:"","row-key":"channelNodeId",data:e.sceneList},on:{"selection-change":e.onSelectionChange}},[t("el-table-column",{attrs:{type:"selection",align:"center",width:"45"}}),e._l(e.columnList,(function(a){return t("el-table-column",{key:a.prop,attrs:{prop:a.prop,label:a.label,"header-align":"center","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(t[a.prop]||"-")+" ")]}}],null,!0)})}))],2)],1)},i=[],n=(a("14d9"),a("3623")),l=a("2ef0"),c={data(){return{channelLines:[],sceneList:[],columnList:new Array(n["c"]).fill(null).map((e,t)=>({label:0===t?"主场景":n["b"][t]+"级子场景",prop:0===t?"mainScene":"subScene"+t})),selectedList:[]}},methods:{getChannelLine(){const e=$graph.findAll("node",e=>"Channel"===e.getModel().type),t=e.map(e=>e.getModel()),a=[];t.forEach(e=>{const{nodeLines:t}=e,s=t.filter(e=>"Root"!==e.nodeType),i={},n=[];s.forEach((e,t)=>{const a=$graph.findDataById(e.nodeId);if(n.push(a),i["channelNodeId"]=a.id,"Scene"===a.type){const e=0===t?"mainScene":"subScene"+t;i[e]=a.businessData.sceneName,i["lastScene"]=a.businessData}}),a.push(n),this.sceneList.push(i)}),this.channelLines=Object(l["cloneDeep"])(a),this.$emit("getChannelLines",this.channelLines)},onSelectionChange(e){this.selectedList=e,this.$emit("changeSelection",e)},selectAll(){this.$refs.multipleTable.toggleAllSelection(),this.selectedList=this.sceneList,this.$emit("changeSelection",this.selectedList)}},created(){this.getChannelLine()},mounted(){this.selectAll()}},r=c,o=(a("9a0e"),a("2877")),p=Object(o["a"])(r,s,i,!1,null,"7299b5fa",null);t["a"]=p.exports}}]);