(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-407569b6"],{1239:function(e,t,r){},"18ca":function(e,t,r){},"18fd":function(e,t,r){"use strict";r("8905")},"35b9":function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"flow-template-manage-wrap fe-p-24 fe-m-24 bg"},[t("div",{staticClass:"search_box"},[t("el-input",{staticClass:"input-search",attrs:{placeholder:"请输入流程名称查询"},model:{value:e.search.fuzzy,callback:function(t){e.$set(e.search,"fuzzy",t)},expression:"search.fuzzy"}},[t("i",{staticClass:"el-input__icon el-icon-search cursor-pointer",attrs:{slot:"suffix"},on:{click:e.queryListByKeyword},slot:"suffix"})]),t("div",{staticClass:"btn_box"},[t("el-button",{attrs:{type:"success"},on:{click:e.add}},[e._v("新建")])],1)],1),t("div",{staticClass:"QueryFormCell_box"},[t("QueryFormCell",{attrs:{labelWidth:e.labelWidth,defaultSizeForm:e.sizeForm,list:e.formList},on:{queryForm:e.queryForm}})],1),t("div",{staticClass:"list"},[t("el-table",{attrs:{data:e.tableData,stripe:""}},[t("el-table-column",{attrs:{prop:"processName",label:"流程名称"}}),t("el-table-column",{attrs:{prop:"processDesc",label:"流程描述"}}),t("el-table-column",{attrs:{prop:"processType",label:"审批类型"}}),t("el-table-column",{attrs:{prop:"rejectType",label:"驳回类型"}}),t("el-table-column",{attrs:{prop:"createName",label:"创建人"}}),t("el-table-column",{attrs:{prop:"modifyDate",label:"更新时间"}}),t("el-table-column",{attrs:{fixed:"right",label:"操作",width:"140"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-link",{staticClass:"text-sm mr-16",attrs:{type:"primary",underline:!1},on:{click:function(t){return e.copy(r.row)}}},[e._v("复制 ")]),t("el-link",{staticClass:"text-sm mr-16",attrs:{type:"primary",underline:!1},on:{click:function(t){return e.edit(r)}}},[e._v("编辑 ")]),t("el-popconfirm",{attrs:{placement:"top",icon:"el-icon-warning",iconColor:"#FAAD14",title:"确定删除？","cancel-button-type":"Primary"},on:{confirm:function(t){return e.deletes(r)}}},[t("el-link",{staticClass:"cursor-pointer text-sm",attrs:{slot:"reference",type:"danger",underline:!1},slot:"reference"},[e._v(" 删除")])],1)]}}])})],1)],1),t("div",{staticClass:"pager"},[t("el-pagination",{attrs:{"current-page":e.pageData.currentPage,"page-sizes":e.pageData.pageSizeList,"page-size":e.pageData.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pageData.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e.isCreateVisible?t("el-dialog",{staticClass:"sub-drap",attrs:{title:e.dialogTitle,"before-close":e.handleClose,visible:e.isCreateVisible,width:"910px","close-on-click-modal":!1},on:{"update:visible":function(t){e.isCreateVisible=t}}},[t("CreateTemplateModal",{ref:"createTemplateModal",on:{queryApproveFlowTemplatePageList:e.refreshList,handleCancle:e.handleCancle}})],1):e._e()],1)},s=[],i=r("0fea"),a=r("a454"),l=r("4e3f"),n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"system-template-create-modal-content"},[t("div",{staticClass:"form"},[t("el-form",{ref:"processForm",attrs:{rules:e.processRules,model:e.processForm,"label-width":"100px",size:"small"}},[t("el-form-item",{attrs:{label:"流程名称：",prop:"name"}},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{placeholder:"请输入流程名称",maxlength:"20","show-word-limit":""},model:{value:e.processForm.name,callback:function(t){e.$set(e.processForm,"name","string"===typeof t?t.trim():t)},expression:"processForm.name"}})],1),t("el-form-item",{attrs:{label:"流程描述：",prop:"desc"}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入流程描述",maxlength:"300","show-word-limit":""},model:{value:e.processForm.desc,callback:function(t){e.$set(e.processForm,"desc","string"===typeof t?t.trim():t)},expression:"processForm.desc"}})],1),t("el-row",[t("el-col",[t("el-form-item",{attrs:{label:"审批类型：",prop:"passType"}},[t("el-radio-group",{model:{value:e.processForm.passType,callback:function(t){e.$set(e.processForm,"passType",t)},expression:"processForm.passType"}},[t("el-radio",{attrs:{label:"继续审批",value:0}}),t("el-radio",{attrs:{label:"重新审批",value:1}})],1)],1)],1)],1),t("drop-node",{ref:"dropNode",on:{"init-g6-data":e.initG6Data}}),t("div",{staticClass:"manage-btn-box"},[t("el-button",{on:{click:e.handleClose}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit("processForm")}}},[e._v("确定")])],1)],1)],1)])},d=[],p=(r("14d9"),function(){var e=this,t=e._self._c;return t("div",{staticClass:"container-wrap"},[e._m(0),t("div",{attrs:{id:"container"}}),e.editDialog?t("dropNodeForm",{key:e.refishChild,attrs:{childFormData:e.childFormData}}):e._e()],1)}),c=[function(){var e=this,t=e._self._c;return t("ul",{staticClass:"container-ul"},[t("li",[e._v("1.点击空白处可建立新节点、单击选中任意两个节点即可建立连接")]),t("li",[e._v("2.右键单击节点可对该节点进行编辑和删除、右键单击箭头可对该箭头进行删除")]),t("li",[e._v("3.支持节点拖拽等功能")])])}],m=r("7c3e"),u=r("1aef"),h=r.n(u),g=function(){var e=this,t=e._self._c;return t("div",{staticClass:"editDialog-box"},[t("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,size:"small",rules:e.rules,"label-width":"94px"}},[t("el-form-item",{attrs:{label:"节点名称",prop:"name"}},[t("el-input",{model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name","string"===typeof t?t.trim():t)},expression:"ruleForm.name"}})],1),t("el-form-item",{attrs:{label:"节点类型",prop:"nodeType"}},[t("el-select",{attrs:{placeholder:"请选择节点类型"},on:{change:e.handleNodeType},model:{value:e.ruleForm.nodeType,callback:function(t){e.$set(e.ruleForm,"nodeType",t)},expression:"ruleForm.nodeType"}},e._l(e.ruleFormAll.nodeTypeList,(function(e,r){return t("el-option",{key:r,attrs:{label:e,value:r}})})),1)],1),e.isEventNode?t("el-form-item",{attrs:{label:"事件类型",prop:"eventId"}},[t("el-select",{attrs:{filterable:"",placeholder:"请选择事件类型","value-key":"value"},model:{value:e.ruleForm.eventId,callback:function(t){e.$set(e.ruleForm,"eventId",t)},expression:"ruleForm.eventId"}},e._l(e.ruleFormAll.eventList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})})),1)],1):e._e(),e.isAproveNode?t("el-form-item",{attrs:{label:"审批人类型",prop:"personType"}},[t("el-select",{attrs:{placeholder:"请选择审批人类型"},on:{change:e.fnPersonType},model:{value:e.ruleForm.personType,callback:function(t){e.$set(e.ruleForm,"personType",t)},expression:"ruleForm.personType"}},e._l(e.ruleFormAll.personTypeList,(function(e,r){return t("el-option",{key:r,attrs:{label:e,value:e}})})),1)],1):e._e(),e.isAproveNode?t("el-form-item",{attrs:{label:"审批人",prop:"person"}},[t("el-select",{attrs:{filterable:"",placeholder:"请选择审批人","value-key":"id"},model:{value:e.ruleForm.person,callback:function(t){e.$set(e.ruleForm,"person",t)},expression:"ruleForm.person"}},e._l(e.ruleFormAll.personList,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e}})})),1)],1):e._e(),e.isAproveNode?t("el-form-item",{attrs:{label:"触发条件",prop:"trigger"}},[t("el-select",{attrs:{placeholder:"请选择触发条件"},model:{value:e.ruleForm.trigger,callback:function(t){e.$set(e.ruleForm,"trigger",t)},expression:"ruleForm.trigger"}},e._l(e.ruleFormAll.triggerList,(function(e,r){return t("el-option",{key:r,attrs:{label:e.condition,value:e.triggerId}})})),1)],1):e._e(),e.isAproveNode?t("el-form-item",{attrs:{label:"是否多选",prop:"allowMultSelect"}},[t("el-radio-group",{model:{value:e.ruleForm.allowMultSelect,callback:function(t){e.$set(e.ruleForm,"allowMultSelect",t)},expression:"ruleForm.allowMultSelect"}},[t("el-radio",{attrs:{label:0}},[e._v("不允许")]),t("el-radio",{attrs:{label:1}},[e._v("允许")])],1)],1):e._e(),e.isAproveNode?t("el-form-item",{attrs:{label:"审批模式",prop:"multipleChoiceType"}},[t("el-radio-group",{model:{value:e.ruleForm.multipleChoiceType,callback:function(t){e.$set(e.ruleForm,"multipleChoiceType",t)},expression:"ruleForm.multipleChoiceType"}},[t("el-radio",{attrs:{label:0}},[e._v("并行")]),t("el-radio",{attrs:{label:1}},[e._v("会审")])],1)],1):e._e(),t("el-form-item",[t("el-button",{on:{click:e.cancel}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("保存")])],1)],1)],1)},f=[],y={props:["childFormData"],data(){return{isAproveNode:!1,isEventNode:!1,nodeFormInfo:null,fnItem:function(e){return this.ruleFormAll.triggerList[e].triggerId},ruleForm:{name:"",nodeType:"",eventId:"",personType:"",person:"",trigger:"",allowMultSelect:0,multipleChoiceType:0},ruleFormAll:{nodeTypeList:["起始节点","审批节点","终止节点","事件节点"],personTypeList:["人员","部门","角色","区县","网格"],personList:"",triggerList:[],eventList:[]},ruleFormChooseTrigger:{},rules:{name:[{required:!0,message:"请输入节点名称",trigger:"blur"}],nodeType:[{required:!0,message:"请选择节点类型",trigger:"change"}],personType:[{required:!0,message:"请选择审批人类型",trigger:"change"}],eventId:[{required:!0,message:"请选择事件类型",trigger:"change"}],person:[{required:!0,message:"请选择审批人",trigger:"change"}],trigger:[{required:!1,message:"请选择触发条件",trigger:"change"}],allowMultSelect:[{required:!0,message:"请确定是否多选",trigger:"change"}],multipleChoiceType:[{required:!0,message:"请选择审批模式",trigger:"change"}]}}},created(){this.initForm()},methods:{initForm(){null===this.childFormData||void 0===this.childFormData||0===Object.keys(this.childFormData).length?(this.queryAllTrigger(),this.queryEventList()):(this.ruleForm.name=this.childFormData.name,this.ruleForm.nodeType=this.childFormData.nodeType,this.ruleForm.personType=this.childFormData.personType,this.ruleForm.person=this.childFormData.person,this.ruleForm.eventId=this.childFormData.eventId,this.ruleForm.allowMultSelect=this.childFormData.allowMultSelect,this.ruleForm.multipleChoiceType=this.childFormData.multipleChoiceType,this.ruleForm.trigger=this.childFormData.trigger,this.handleNodeType(Number(this.ruleForm.nodeType)),this.queryAllTrigger(),this.queryEventList(),this.isApproveUserType()),this.isApproveUserType(this.ruleForm.personType)},handleNodeType(e){switch(Number(e)){case 0:case 2:this.isAproveNode=!1,this.isEventNode=!1;break;case 1:this.isAproveNode=!0,this.isEventNode=!1;break;case 3:this.isAproveNode=!1,this.isEventNode=!0;break;default:this.isAproveNode=!0,this.isEventNode=!1}},queryEventList(){Object(i["i"])(a["a"].approveSvc.queryEventList).then(e=>{e?this.ruleFormAll.eventList=e:this.$message({message:"查询事件类型失败",type:"error"})})},isApproveUserType(e){switch(e){case"人员":this.queryAllUsers();break;case"部门":this.queryAllDepartments();break;case"角色":this.queryAllRoles();break;case"区县":this.queryAllCountys();break;case"网格":this.queryAllGrids();break;default:break}},queryAllUsers(){Object(i["i"])(a["a"].role.getRoleBindUserList).then(e=>{if(e){this.ruleFormAll.personList=e;for(let e in this.ruleFormAll.personList)this.ruleFormAll.personList[e]["id"]=this.ruleFormAll.personList[e].userId,this.ruleFormAll.personList[e]["name"]=this.ruleFormAll.personList[e].userName}else this.$message({message:"查询人员失败",type:"error"})})},queryAllDepartments(){Object(i["i"])(a["a"].department.selectDepartmentData).then(e=>{if(e){this.ruleFormAll.personList=e;for(let e in this.ruleFormAll.personList)this.ruleFormAll.personList[e]["id"]=this.ruleFormAll.personList[e].deptId,this.ruleFormAll.personList[e]["name"]=this.ruleFormAll.personList[e].title}else this.$message({message:"查询部门失败",type:"error"})})},queryAllRoles(){Object(i["i"])(a["a"].role.getSelectRoleData).then(e=>{if(e){this.ruleFormAll.personList=e;for(let e in this.ruleFormAll.personList)this.ruleFormAll.personList[e]["id"]=this.ruleFormAll.personList[e].roleId,this.ruleFormAll.personList[e]["name"]=this.ruleFormAll.personList[e].roleName}else this.$message({message:"查询角色失败",type:"error"})})},queryAllCountys(){Object(i["i"])(a["a"].county.selectCountyData).then(e=>{if(e){this.ruleFormAll.personList=e;for(let e in this.ruleFormAll.personList)this.ruleFormAll.personList[e]["id"]=this.ruleFormAll.personList[e].countyId,this.ruleFormAll.personList[e]["name"]=this.ruleFormAll.personList[e].countyName}else this.$message({message:"查询区县失败",type:"error"})})},queryAllGrids(){Object(i["i"])(a["a"].grid.selectGridData).then(e=>{if(e){this.ruleFormAll.personList=e;for(let e in this.ruleFormAll.personList)this.ruleFormAll.personList[e]["id"]=this.ruleFormAll.personList[e].gridId,this.ruleFormAll.personList[e]["name"]=this.ruleFormAll.personList[e].gridName}else this.$message({message:"查询网格失败",type:"error"})})},queryAllTrigger(){Object(i["i"])(a["a"].approveSvc.queryTriggerList).then(e=>{e?(this.ruleFormAll.triggerList=e,this.ruleFormChooseTrigger=e):this.$message({message:"查询触发条件失败",type:"error"})})},fnPersonType(e){this.ruleForm.person="",this.isApproveUserType(e)},submitForm(e){this.$refs[e].validate(e=>{if(e){for(const e in this.ruleFormChooseTrigger)this.ruleFormChooseTrigger[e].condition===this.ruleForm.trigger&&(this.ruleForm.trigger=this.ruleFormChooseTrigger[e].triggerId);return this.$parent.activeNode._cfg.model.label=this.ruleForm.name,this.$parent.activeNode._cfg.model.formInfo=this.ruleForm,this.$parent.initGraph.refreshItem(this.$parent.activeNode),this.$parent.nodeFormInfoData=this.ruleForm,this.$parent.ruleFormChooseTrigger=this.ruleFormChooseTrigger,this.$parent.editDialog=!1,!1}return!1})},cancel(){this.$parent.editDialog=!1}}},v=y,F=r("2877"),b=Object(F["a"])(v,g,f,!1,null,"24b60d6d",null),T=b.exports,N={name:"dropNode",components:{dropNodeForm:T},data(){return{nodeTypeList:["审批节点","起始节点","终止节点","事件节点"],personTypeList:["人员","部门","角色","区县","网格"],ruleFormChooseTrigger:{},refishChild:"",childFormData:null,dropInitNode:"",nodeFormInfoData:{},editDialog:!1,initG6Data:{nodes:[],edges:[]},initGraph:null,activeNode:"",nodeFirst:null,nodeLast:null,evgraph:null,tiggerList:[]}},created(){this.dropInitNode=this.$store.state.SystemManage.dropInitNode},mounted(){this.queryAllTrigger(),void 0===this.dropInitNode||0===Object.keys(this.dropInitNode).length||null===this.dropInitNode?this.initG6():this.initG6(this.dropInitNode)},methods:{getIndex(e,t){for(var r in e)if(e[r]===t)return r;return!1},async queryAllTrigger(){let e=await Object(i["i"])(a["a"].approveSvc.queryTriggerList);e?this.tiggerList=e:this.$message({message:"查询触发条件失败",type:"error"})},initG6(e){let t=this;if(void 0!==e){for(const t in e.nodeList)this.initG6Data.nodes.push({processId:e.nodeList[t].processId,id:e.nodeList[t].nodeId,x:+e.nodeList[t].nodeLocationX,y:+e.nodeList[t].nodeLocationY,label:e.nodeList[t].nodeName,formInfo:{name:e.nodeList[t].nodeName,nodeType:e.nodeList[t].nodeType,person:{id:e.nodeList[t].approver,name:e.nodeList[t].approverName},eventId:e.nodeList[t].eventId,personType:this.personTypeList[e.nodeList[t].approverType],trigger:e.nodeList[t].triggerId,allowMultSelect:e.nodeList[t].allowMultSelect,multipleChoiceType:e.nodeList[t].multipleChoiceType}});for(const t in e.flowList)this.initG6Data.edges.push({id:e.flowList[t].lineId,target:e.flowList[t].endNode,source:e.flowList[t].startNode})}const r=this;h()("\n                .contextMenu1 li:hover {\n                    background-color:rgba(46, 135, 235, 0.5);\n                }\n            ");let o=[];(e?e.nodeList:[]).map(e=>e.nodeId).forEach(e=>{o.push(e.split("-")[1]-0)}),o=o.sort((e,t)=>t-e);let s=e?o[0]+1:0;m["a"].registerBehavior("click-add-node",{getEvents(){return{"canvas:click":"onClick"}},onClick(e){const t=this,r=t.graph;r.addItem("node",{x:e.x,y:e.y,label:"节点"+(s+1),id:"node-"+s}),s++}}),m["a"].registerBehavior("click-add-edge",{getEvents(){return{"node:click":"onClick",mousemove:"onMousemove","edge:click":"onEdgeClick"}},onClick(e){const t=this,o=e.item,s=t.graph,i=o.getModel();if(t.addingEdge&&t.edge){let e=!1;if(this.nodeLast=o._cfg.id,this.graph.cfg.edges.length>1)for(const t in this.graph.cfg.edges)t<this.graph.cfg.edges.length-1&&(this.nodeFirst===this.graph.cfg.edges[t]._cfg.source._cfg.id&&this.nodeLast===this.graph.cfg.edges[t]._cfg.target._cfg.id||this.nodeFirst===this.graph.cfg.edges[t]._cfg.target._cfg.id&&this.nodeLast===this.graph.cfg.edges[t]._cfg.source._cfg.id)&&(e=!0);if(e)return r.$alert("指向已存在或指向不能逆向，点击空白处可取消指向","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;if(this.nodeLast===this.nodeFirst)return r.$alert("不能指向本身，点击空白处可取消指向","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;s.updateItem(t.edge,{target:i.id}),t.edge=null,t.addingEdge=!1,this.nodeLast={},this.nodeFirst={}}else this.nodeFirst=o._cfg.id,t.edge=s.addItem("edge",{source:i.id,target:i.id}),t.addingEdge=!0;return!1},onMousemove(e){const r=this;t.evgraph=e;const o={x:e.x,y:e.y};r.addingEdge&&r.edge&&r.graph.updateItem(r.edge,{target:o})},onEdgeClick(e){const t=this,r=e.item;t.addingEdge&&t.edge===r&&(t.graph.removeItem(t.edge),t.edge=null,t.addingEdge=!1)}});const i=new m["a"].Menu({getContent(e){return'<ul class="contextMenu1">\n                            <li style="cursor: pointer; height:28px;  line-height:28px;text-align: center; cursor: pointer;  width:80px;">编辑节点</li>\n                            <li style="cursor: pointer; height:28px;  line-height:28px;text-align: center; cursor: pointer;  width:80px;">删除节点</li>\n                        </ul>'},handleMenuClick:(e,t)=>{this.activeNode=t,this.nowNodeHtml=t._cfg.model.label,"编辑节点"===e.innerHTML?(this.refishChild=t._cfg.model.label,this.childFormData=t._cfg.model.formInfo,this.editDialog=!0):this.initGraph.removeItem(t)},offsetX:20,offsetY:-70,itemTypes:["node"]}),a=new m["a"].Menu({getContent(e){return'<ul class="contextMenu1">\n                            <li style="cursor: pointer; height:28px;  line-height:28px;text-align: center; cursor: pointer;  width:80px;">删除连线</li>\n                        </ul>'},handleMenuClick:(e,r,o,s)=>{r._cfg.model.target instanceof Object?this.initGraph.emit("edge:click",t.evgraph):this.initGraph.removeItem(r)},offsetX:10,offsetY:-80,itemTypes:["edge"]});document.getElementById("container").scrollWidth,document.getElementById("container").scrollHeight;this.initGraph=new m["a"].Graph({container:"container",width:850,height:500,plugins:[i,a],defaultEdge:{type:"line",style:{endArrow:{path:m["a"].Arrow.vee(8,12,5),d:5,fill:"#F6BD16"},lineAppendWidth:6}},modes:{default:["drag-canvas","drag-node","click-add-node","click-add-edge","click-select"],edit:["click-select"]},defaultNode:{type:"rect",size:[70,25],style:{fill:"#9EC9FF",stroke:"#5B8FF9",lineWidth:1,radius:4,overflow:"hidden"},labelCfg:{style:{fill:"#fff",fontSize:12}},anchorPoints:[[0,.5],[.5,1],[1,.5],[.5,0]]},nodeStateStyles:{selected:{fill:"#9EC9FF",stroke:"#5B8FF9",lineWidth:1}}}),this.initGraph.clear(),this.initGraph.data(this.initG6Data),this.initGraph.render();const l=document.getElementById("container");"undefined"!==typeof window&&(window.onresize=()=>{this.initGraph&&!this.initGraph.get("destroyed")&&l&&l.scrollWidth&&l.scrollHeight&&this.initGraph.changeSize(l.scrollWidth,l.scrollHeight-30)}),this.initGraph.on("node:click",e=>{this.initGraph.findAllByState("node","click");this.initGraph.setItemState(e.item,"click",!0)})},submitDropNode(){const e=this.initGraph.save();if(0===Object.keys(e.nodes).length)return this.$alert("请先创建节点","模板节点校验失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;if(0===Object.keys(e.edges).length)return this.$alert("请先连接对应节点","模板节点校验失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;const t={processId:"",approveFlowBaseInfo:{},nodeList:[],nodeRelationList:[]};t.processId=e.nodes[0].processId?e.nodes[0].processId:"";for(const r in e.nodes){if(void 0===e.nodes[r].formInfo)return this.$alert("请先配置节点信息","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;{const o={processId:""};switch(o.nodeId=e.nodes[r].id,o.nodeName=e.nodes[r].label,o.nodeType=e.nodes[r].formInfo.nodeType,o.eventId=e.nodes[r].formInfo.eventId,o.allowMultSelect=e.nodes[r].formInfo.allowMultSelect,o.multipleChoiceType=e.nodes[r].formInfo.multipleChoiceType,o.triggerId=e.nodes[r].formInfo.trigger,o.triggerName=e.nodes[r].formInfo.trigger?this.tiggerList.filter(t=>t.triggerId===e.nodes[r].formInfo.trigger)[0].condition:null,e.nodes[r].formInfo.personType){case"人员":o.approverType=0;break;case"部门":o.approverType=1;break;case"角色":o.approverType=2;break;case"区县":o.approverType=3;break;case"网格":o.approverType=4;break;default:o.approverType=-1}o.approver=e.nodes[r].formInfo.person.id,o.approverName=e.nodes[r].formInfo.person.name;for(const t in this.ruleFormChooseTrigger)this.ruleFormChooseTrigger[t].triggerId===e.nodes[r].formInfo.trigger&&(o.triggerId=this.ruleFormChooseTrigger[t].triggerId,o.triggerName=this.ruleFormChooseTrigger[t].condition);o.nodeLocationX=e.nodes[r].x,o.nodeLocationY=e.nodes[r].y,t.nodeList.push(o)}}for(const r in e.edges){const o={processId:""};o.flowId=e.edges[r].id,o.startNode=e.edges[r].source,o.endNode=e.edges[r].target,t.nodeRelationList.push(o)}return this.$store.commit("SystemManage/fnDropInitNode",t),!0},cancelDropNode(){this.initGraph.clear()}}},L=N,C=(r("fc0e"),Object(F["a"])(L,p,c,!1,null,"372906ab",null)),D=C.exports,I=r("f9ae"),k={name:"CreateTemplateModal",components:{dropNode:D},data(){return{dropInitNode:null,approveFlowBaseInfo:null,processRules:{name:[{required:!0,message:"请输入流程名称",trigger:"blur"}],desc:[{required:!0,message:"请输入流程描述",trigger:"blur"}],passType:[{required:!0,message:"请选择审批类型",trigger:"change"}]},processForm:{name:"",desc:"",passType:"重新审批"},dropNodeData:{},nodeLists:[],firstNodeLists:[],lastNodeLists:[]}},created(){this.dropInitNode=this.$store.state.SystemManage.dropInitNode,this.fnInit()},methods:{fnInit(){this.dropNodeData=this.dropInitNode,0!==Object.keys(this.dropNodeData).length&&(this.processForm.name=this.dropNodeData.processName,this.processForm.desc=this.dropNodeData.processDesc,this.processForm.passType=0===this.dropNodeData.processType?"继续审批":"重新审批")},saveApproveTemplate(e){Object(i["i"])(a["a"].approveSvc.saveApproveTemplate,e).then(e=>{this.$message({message:"新建审批流程模板成功！",type:"success"}),this.$emit("queryApproveFlowTemplatePageList",1),this.$emit("handleCancle")})},async checkApproveTemplateName(e){const t=await Object(i["i"])(a["a"].approveSvc.checkApproveTemplateName,e);return t},onSubmit:Object(I["a"])((function(e){this.$refs[e].validate(e=>{if(!e)return this.$alert("请先输入必填项！","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;{if(this.$refs.dropNode.submitDropNode(),!1===this.$refs.dropNode.submitDropNode())return!1;this.dropNodeData=this.$store.state.SystemManage.dropInitNode;const e=[],t=[];let r=0,o=0,s=0,i=0;const a=[],l=[],n=[],d=[];for(const p in this.dropNodeData.nodeRelationList)this.dropNodeData.nodeRelationList[p].processId=this.dropNodeData.processId,e.push(this.dropNodeData.nodeRelationList[p].startNode),t.push(this.dropNodeData.nodeRelationList[p].endNode);for(const p in this.dropNodeData.nodeList){switch(this.dropNodeData.nodeList[p].processId=this.dropNodeData.processId,this.dropNodeData.nodeList[p].nodeType){case 0:a.push(this.dropNodeData.nodeList[p]);break;case 1:l.push(this.dropNodeData.nodeList[p]);break;case 2:n.push(this.dropNodeData.nodeList[p]);break;case 3:d.push(this.dropNodeData.nodeList[p]);break;default:}this.dropNodeData.nodeList[p].jtTop=0,this.dropNodeData.nodeList[p].jtBot=0,e.indexOf(this.dropNodeData.nodeList[p].nodeId)>-1&&(this.dropNodeData.nodeList[p].jtTop+=1),t.indexOf(this.dropNodeData.nodeList[p].nodeId)>-1&&(this.dropNodeData.nodeList[p].jtBot+=1)}if(1!==a.length)return this.$alert("请先设置好起始节点，起始节点有且只有一个！","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;if(0!==a[0].jtBot)return this.$alert("不能指向起始节点","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;if(0===a[0].jtTop)return this.$alert("起始节点需要指向至少一个节点","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;if(1!==n.length)return this.$alert("请先设置好终止节点，终止节点有且只有一个！","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;if(0!==n[0].jtTop)return this.$alert("终止节点不能指向别人","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;if(0===n[0].jtBot)return this.$alert("终止节点需要被至少一个节点指向","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;if(0===l.length)return this.$alert("请设置审批节点,需要设置至少一个审批节点！","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;if(0===l[0].jtTop)return this.$alert("审批节点需要指向至少一个节点","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;if(0===l[0].jtBot)return this.$alert("审批节点需要至少一个节点指向","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;if(0!==Object.keys(d).length){if(0===d[0].jtTop)return this.$alert("事件节点需要指向至少一个节点","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;if(0===d[0].jtBot)return this.$alert("事件节点需要至少一个节点指向","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1}for(const p in this.dropNodeData.nodeList)1===this.dropNodeData.nodeList[p].jtTop&&0===this.dropNodeData.nodeList[p].jtBot?r+=1:1===this.dropNodeData.nodeList[p].jtTop&&1===this.dropNodeData.nodeList[p].jtBot?o+=1:0===this.dropNodeData.nodeList[p].jtTop&&1===this.dropNodeData.nodeList[p].jtBot?s+=1:i+=1;if(i>0)return this.$alert("模板节点校验失败：有未连线的节点","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;if(r>1)return this.$alert("模板节点校验失败：存在多个起始节点!","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;if(0===r)return this.$alert("模板节点校验失败：需要有一个起始节点!","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;if(s>1)return this.$alert("模板节点校验失败：存在多个结束节点!","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;if(0===s)return this.$alert("模板节点校验失败：需要有一个结束节点!","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;if(0===o)return this.$alert("模板节点校验失败：至少需要有一个审批节点!","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;if(!(1===r&&1===s&&o>0))return this.$alert("模板节点校验失败：节点连线校验失败","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;{const e=[];for(const t in this.dropNodeData.nodeList){if(this.isFormInfo(this.dropNodeData.nodeList[t]))return this.$alert("节点信息校验失败：请右键【"+this.dropNodeData.nodes[t].label+"】编辑节点信息","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"}),!1;e.push(!0)}e.length===this.dropNodeData.nodeList.length&&(this.initG6Data(this.dropNodeData),this.checkApproveTemplateName({processId:this.dropNodeData.processId,processName:this.dropNodeData.approveFlowBaseInfo.processName}).then(e=>{"SUCCESS"===e.status&&0===Number(e.data)?this.saveApproveTemplate({processName:this.dropNodeData.approveFlowBaseInfo.processName,processDesc:this.dropNodeData.approveFlowBaseInfo.processDesc,processType:this.dropNodeData.approveFlowBaseInfo.processType,processId:this.dropNodeData.processId,nodeList:this.dropNodeData.nodeList,flowList:this.dropNodeData.nodeRelationList}):this.$alert("流程名称校验失败：已存在同名的审批流程模板！","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"})}))}}return!1})})),isFormInfo(e){let t;switch(Number(e.nodeType)){case 0:case 2:t=[e.nodeName,e.nodeType];break;case 1:t=[e.nodeName,e.nodeType,e.approverType,e.approverName,e.allowMultSelect,e.multipleChoiceType];break;case 3:t=[e.nodeName,e.nodeType,e.eventId];break;default:t=[e.nodeName,e.nodeType]}const r=t.some(e=>null===e||void 0===e||""===e);return r},handleClose(){this.$refs.dropNode.cancelDropNode(),this.$emit("handleCancle")},initG6Data(e){this.dropNodeData.approveFlowBaseInfo.processId=this.dropNodeData.processId,this.dropNodeData.approveFlowBaseInfo.processName=this.processForm.name,this.dropNodeData.approveFlowBaseInfo.processDesc=this.processForm.desc,this.dropNodeData.approveFlowBaseInfo.processType="继续审批"===this.processForm.passType?0:1,this.dropNodeData.approveFlowBaseInfo.createUser=window.sessionStorage.getItem("name")}},mounted(){}},x=k,w=(r("18fd"),Object(F["a"])(x,n,d,!1,null,null,null)),A=w.exports;const $=a["a"].approveSvc.queryApproveTemplatePageList,M=a["a"].approveSvc.getApproveTemplateById,_=a["a"].approveSvc.removeApproveTemplate,z=a["a"].approveSvc.approceProscess,B=a["a"].approveSvc.getApproveFlag;var S={name:"FlowTempManage",components:{QueryFormCell:l["a"],CreateTemplateModal:A},data(){return{isCreateVisible:!1,search:{fuzzy:""},labelWidth:"85px",sizeForm:{radioModel:["",""]},formList:[{label:"审批类型",values:[{label:"全部",value:""},{label:"重新审批",value:"1"},{label:"继续审批",value:"0"}],isDate:!1},{label:"驳回类型",values:[{label:"全部",value:""},{label:"全部驳回",value:"1"},{label:"部分驳回",value:"0"}],isDate:!1}],tableData:[],pageData:{currentPage:1,pageSize:10,pageSizeList:[10,20,30,40],total:0},dialogTitle:"新建流程定义",operateType:"",defaultProcessId:"",defaultNodeRelationList:[],defaultNodeList:[],defaultFormData:{flowName:"",flowDesc:"",approveType:"0",rejectType:"0"},lfData:{}}},created(){this.queryList()},methods:{refreshList(){this.defaultNodeList=[],this.pageData.currentPage=1,this.queryList()},queryList(){let e={processName:this.search.fuzzy,current:this.pageData.currentPage,size:this.pageData.pageSize,processType:this.sizeForm.radioModel[0]};Object(i["i"])($,e).then(e=>{let{records:t,total:r}=e;this.pageData.total=r,this.tableData=t.map(e=>{switch(Number(e.processType)){case 0:e.processType="继续审批";break;case 1:e.processType="重新审批";break}return e})})},queryListByKeyword(){this.pageData.currentPage=1,this.queryList()},queryForm(e){this.sizeForm.radioModel=e.form.radioModel,this.queryList()},add(){this.dialogTitle="新建流程定义",this.isCreateVisible=!0,this.$store.commit("SystemManage/fnDropInitNode",{})},async copy(e){await Object(i["i"])(z+"?processId="+e.processId).then(e=>{this.$message.success("复制成功"),this.queryList()})},getApproveFlag(e){Object(i["i"])(B+"?processId="+e).then(e=>e.data)},edit(e){let{processId:t}=e.row,r={processId:t};Object(i["i"])(B+"?processId="+t).then(e=>{e.data?this.$message.error("该模板正在使用中，无法修改"):Object(i["i"])(M,r).then(e=>{this.isCreateVisible=!0,this.$store.commit("SystemManage/fnDropInitNode",e),this.dialogTitle="编辑流程定义"})})},deletes(e){let t=e.row.processId,r={processId:t};Object(i["i"])(B+"?processId="+t).then(e=>{e.data?this.$message.error("该模板正在使用中，无法修改"):Object(i["i"])(_,r).then(e=>{this.$message.success("删除成功"),this.pageData.currentPage=1,this.pageData.pageSize=10,this.queryList()})})},handleClose(){this.$refs.createTemplateModal.$refs.dropNode.cancelDropNode(),this.isCreateVisible=!1},handleCancle(){this.isCreateVisible=!1,this.$forceUpdate()},handleSizeChange(e){this.pageData.pageSize=e,this.queryList()},handleCurrentChange(e){this.pageData.currentPage=e,this.queryList()}}},j=S,q=(r("ca32"),Object(F["a"])(j,o,s,!1,null,"1b89073d",null));t["default"]=q.exports},"4e3f":function(e,t,r){"use strict";var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"query-form-cell-wrap"},[t("el-form",{ref:"form",attrs:{model:e.sizeForm,"label-width":e.labelWidth,"label-position":e.labelPosition,size:"mini"}},e._l(e.list,(function(r,o){return t("el-form-item",{key:o+"list",class:{disabled:r.disabled},attrs:{"label-width":r.labelWidth||e.labelWidth,label:r.label+"："}},[Array.isArray(r.values)?t("div",{staticClass:"fe-d-flex"},[t("div",{staticClass:"radio-box"},[r.dateType?e._e():t("el-radio-group",{attrs:{size:"mini",disabled:r.disabled},on:{change:function(t){return e.radioChange(e.sizeForm.radioModel[o],o)}},model:{value:e.sizeForm.radioModel[o],callback:function(t){e.$set(e.sizeForm.radioModel,o,t)},expression:"sizeForm.radioModel[index]"}},e._l(r.values,(function(r,o){return t("el-radio-button",{key:o+"listValues",attrs:{label:r.value}},[e._v(e._s(r.label)+" ")])})),1)],1),t("div",{staticClass:"date-box"},["date"===r.dateType?t("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd",clearable:!1},on:{change:e.dateChange},model:{value:e.sizeForm.dateModel[o],callback:function(t){e.$set(e.sizeForm.dateModel,o,t)},expression:"sizeForm.dateModel[index]"}}):e._e(),"month"===r.dateType?t("el-date-picker",{attrs:{type:"month",placeholder:"选择月","value-format":"yyyy-MM",clearable:!1},on:{change:e.dateChange},model:{value:e.sizeForm.dateModel[o],callback:function(t){e.$set(e.sizeForm.dateModel,o,t)},expression:"sizeForm.dateModel[index]"}}):e._e(),"daterange"===r.dateType?t("el-date-picker",{attrs:{type:"daterange","value-format":"yyyy-MM-dd","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",clearable:!0},on:{change:e.dateChange},model:{value:e.sizeForm.dateModel[o],callback:function(t){e.$set(e.sizeForm.dateModel,o,t)},expression:"sizeForm.dateModel[index]"}}):e._e(),"datetimerange"===r.dateType?t("el-date-picker",{attrs:{type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",clearable:!1},on:{change:e.dateChange},model:{value:e.sizeForm.dateModel[o],callback:function(t){e.$set(e.sizeForm.dateModel,o,t)},expression:"sizeForm.dateModel[index]"}}):e._e()],1)]):t("div",{staticClass:"input-box"},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{placeholder:"请输入内容"},on:{change:e.inputChange},model:{value:e.sizeForm.radioModel[o],callback:function(t){e.$set(e.sizeForm.radioModel,o,t)},expression:"sizeForm.radioModel[index]"}})],1)])})),1)],1)},s=[],i={name:"QueryFormCell",props:{labelWidth:{type:String,default:()=>"82px"},labelPosition:{type:String,default:()=>"right"},defaultSizeForm:{type:Object,default:()=>({})},list:{type:Array,default:()=>[{label:"数据时间",values:[{label:"不限",value:"1"}],isDate:!0,dateType:"date"},{label:"接口类型",values:[{label:"不限",value:"不限"},{label:"文件接口",value:"文件接口"}],isDate:!1}]}},data(){return{sizeForm:{dateModel:["2021-05-08","",""],radioModel:["自定义","不限","不限","不限"]}}},watch:{defaultSizeForm:{handler:function(e){this.sizeForm=e},deep:!0,immediate:!0}},methods:{radioChange(e,t){this.sizeForm.dateModel&&this.$set(this.sizeForm.dateModel,t,"date"===this.list[t].dateType?"":["",""]),this.$emit("queryForm",{index:t,value:e,form:this.sizeForm})},dateChange(e){e?(this.$set(this.sizeForm.dateModel,0,e),this.$emit("queryForm",{value:e,form:this.sizeForm})):this.$emit("emptyFrom",this.sizeForm)},inputChange(e){e&&this.$emit("queryForm",{value:e,form:this.sizeForm})}}},a=i,l=(r("a28d"),r("2877")),n=Object(l["a"])(a,o,s,!1,null,null,null);t["a"]=n.exports},8905:function(e,t,r){},a28d:function(e,t,r){"use strict";r("cddb")},ca32:function(e,t,r){"use strict";r("18ca")},cddb:function(e,t,r){},fc0e:function(e,t,r){"use strict";r("1239")}}]);