(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4f95df60"],{"00ac":function(e,t,a){},"0d1e":function(e,t,a){"use strict";a("35a8")},"271a":function(e,t,a){"use strict";var l=a("cb2d"),i=a("e330"),r=a("577e"),n=a("d6d6"),s=URLSearchParams,o=s.prototype,c=i(o.getAll),d=i(o.has),p=new s("a=1");!p.has("a",2)&&p.has("a",void 0)||l(o,"has",(function(e){var t=arguments.length,a=t<2?void 0:arguments[1];if(t&&void 0===a)return d(this,e);var l=c(this,e);n(t,1);var i=r(a),s=0;while(s<l.length)if(l[s++]===i)return!0;return!1}),{enumerable:!0,unsafe:!0})},"35a8":function(e,t,a){},5494:function(e,t,a){"use strict";var l=a("83ab"),i=a("e330"),r=a("edd0"),n=URLSearchParams.prototype,s=i(n.forEach);l&&!("size"in n)&&r(n,"size",{get:function(){var e=0;return s(this,(function(){e++})),e},configurable:!0,enumerable:!0})},"88a7":function(e,t,a){"use strict";var l=a("cb2d"),i=a("e330"),r=a("577e"),n=a("d6d6"),s=URLSearchParams,o=s.prototype,c=i(o.append),d=i(o["delete"]),p=i(o.forEach),u=i([].push),h=new s("a=1&a=2&b=3");h["delete"]("a",1),h["delete"]("b",void 0),h+""!=="a=2"&&l(o,"delete",(function(e){var t=arguments.length,a=t<2?void 0:arguments[1];if(t&&void 0===a)return d(this,e);var l=[];p(this,(function(e,t){u(l,{key:t,value:e})})),n(t,1);var i,s=r(e),o=r(a),h=0,m=0,g=!1,b=l.length;while(h<b)i=l[h++],g||i.key===s?(g=!0,d(this,i.key)):m++;while(m<b)i=l[m++],i.key===s&&i.value===o||c(this,i.key,i.value)}),{enumerable:!0,unsafe:!0})},a9d3:function(e,t,a){"use strict";a("00ac")},aa39:function(e,t,a){"use strict";const l="/plan-svc/action";t["a"]={productLib:{},linkLib:{downloadLinkTemplate:l+"/link/linkManage/downloadLinkTemplate",getLinkId:l+"/link/linkManage/getLinkId",getShortUrl:l+"/link/linkManage/getShortUrl",saveOrUpdateLink:l+"/link/linkManage/saveOrUpdateLink",searchAllLink:l+"/link/linkManage/searchAllLink",searchCampsByUrl:l+"/link/linkManage/searchCampsByUrl",uploadBatchLinkFiles:l+"/link/linkManage/uploadBatchLinkFiles",deleteLink:l+"/link/linkManage/deleteLink"}}},d6d6:function(e,t,a){"use strict";var l=TypeError;e.exports=function(e,t){if(e<t)throw new l("Not enough arguments");return e}},ecc4a:function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"template-wrap-content"},[t("div",{staticClass:"top-edit-part"},[t("div",{staticClass:"search-input"},[t("label",[e._v("链接编号：")]),t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],staticStyle:{width:"215px"},attrs:{placeholder:"请输入链接编号",clearable:""},model:{value:e.query_.linkId,callback:function(t){e.$set(e.query_,"linkId","string"===typeof t?t.trim():t)},expression:"query_.linkId"}})],1),t("div",{staticClass:"search-input"},[t("label",[e._v("链接名称：")]),t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],staticStyle:{width:"215px"},attrs:{placeholder:"请输入链接名称",clearable:""},model:{value:e.query_.linkName,callback:function(t){e.$set(e.query_,"linkName","string"===typeof t?t.trim():t)},expression:"query_.linkName"}})],1),t("div",{staticClass:"search-input"},[t("label",[e._v("创建时间：")]),t("el-date-picker",{staticStyle:{width:"215px"},attrs:{type:"daterange","unlink-panels":"","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"yyyy-MM-dd"},on:{change:e.getDates},model:{value:e.queryTime,callback:function(t){e.queryTime=t},expression:"queryTime"}})],1),t("div",{staticClass:"search-input"},[t("label",[e._v("链接地址：")]),t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],staticStyle:{width:"215px"},attrs:{placeholder:"请输入链接地址",clearable:""},model:{value:e.query_.linkUrl,callback:function(t){e.$set(e.query_,"linkUrl","string"===typeof t?t.trim():t)},expression:"query_.linkUrl"}})],1),t("div",{staticClass:"search-input"},[t("label",[e._v("创建人：")]),t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],staticStyle:{width:"215px"},attrs:{placeholder:"请输入创建人",clearable:""},model:{value:e.query_.linkCreator,callback:function(t){e.$set(e.query_,"linkCreator","string"===typeof t?t.trim():t)},expression:"query_.linkCreator"}})],1),t("div",{staticStyle:{"margin-right":"20px"}},[t("el-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:e.searchData}},[e._v("查询")]),t("el-button",{attrs:{type:"success"},on:{click:e.reset}},[e._v("重置")])],1),t("div",{staticClass:"operation"},[t("input",{ref:"uploadLink",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:e.importFile}}),t("el-button",{attrs:{type:"primary"},on:{click:e.downloadTemplate}},[e._v("下载模板")]),t("el-button",{attrs:{type:"warning",loading:e.uploadLoading},on:{click:e.importFile_}},[e._v("批量导入")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.showDialog("新增",null)}}},[e._v("新 增")])],1)]),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tTable",staticClass:"template-table",staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"",height:"100%"}},[t("el-table-column",{attrs:{label:"序号",type:"index","header-align":"center",align:"center",width:"60"}}),t("el-table-column",{attrs:{prop:"id",label:"链接编号",width:"140","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{prop:"name",label:"链接名称",width:"150","header-align":"center",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"url",label:"链接地址",width:"200","header-align":"center",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"description",label:"说明",width:"150","header-align":"center",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"planId",label:"关联产品ID",width:"150","header-align":"center",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"planName",label:"关联产品名称",width:"150","header-align":"center",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"campSize",label:"关联活动","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.campSize>0?t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.showCamp(a.row.id)}}},[e._v(e._s(a.row.campSize))]):t("span",[e._v(e._s(a.row.campSize))])]}}])}),t("el-table-column",{attrs:{prop:"creator",label:"创建人","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{prop:"createDate",label:"创建时间",width:"90","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{label:"操作",width:"90",fixed:"right","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[1==a.row.aswitch&&1==a.row.status?t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.showDialog("修改",a.row)}}},[e._v("修改")]):e._e(),1==a.row.aswitch?t("el-button",{staticStyle:{color:"red"},attrs:{type:"text"},on:{click:function(t){return e.deleteRow(a.row)}}},[e._v("删除")]):e._e()]}}])})],1),t("el-pagination",{attrs:{"current-page":e.query.pageNum,"page-sizes":[10,20,30,40],"page-size":e.query.pageSize,"pager-count":5,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),t("el-dialog",{attrs:{title:"关联活动",visible:e.dialogCampVisible,"close-on-click-modal":!1,"append-to-body":""},on:{"update:visible":function(t){e.dialogCampVisible=t}}},[e.currentLinkId?t("CampTable",{attrs:{linkId:e.currentLinkId}}):e._e(),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogCampVisible=!1}}},[e._v("确定")])],1)],1),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogFormVisible,"close-on-click-modal":!1,"destroy-on-close":"","append-to-body":""},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"链接名称",prop:"linkName"}},[t("el-input",{attrs:{placeholder:"请输入链接名称"},model:{value:e.form.linkName,callback:function(t){e.$set(e.form,"linkName",t)},expression:"form.linkName"}})],1),t("el-form-item",{attrs:{label:"链接类型",prop:"type"}},[t("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择"},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.LinkTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e._v("  "),t("span",{staticStyle:{"font-size":"12px",color:"#2F87EC"}},[e._v("选择短信小程序链接可以在短信小程序平台统计点击量")])],1),t("el-form-item",{attrs:{label:"链接地址",prop:"linkUrl"}},[t("el-input",{staticStyle:{width:"calc(100% - 68px)"},attrs:{disabled:"2"===e.form.type},model:{value:e.form.linkUrl,callback:function(t){e.$set(e.form,"linkUrl",t)},expression:"form.linkUrl"}}),t("el-button",{directives:[{name:"show",rawName:"v-show",value:"1"!==e.form.type,expression:"form.type !== '1'"}],staticStyle:{"margin-left":"10px"},attrs:{type:"primary",disabled:!!e.suc2ShortUrl&&e.suc2ShortUrl==e.form.linkUrl,loading:e.url2ShortLoading},on:{click:e.url2Short}},[e._v("转短")])],1),t("el-form-item",{attrs:{label:"关联产品ID",prop:"planId"}},[t("el-input",{attrs:{placeholder:"请输入关联产品ID"},on:{focus:e.showPlanDialog},model:{value:e.form.planId,callback:function(t){e.$set(e.form,"planId",t)},expression:"form.planId"}})],1),t("el-form-item",{attrs:{label:"关联产品名称",prop:"planName"}},[t("el-input",{attrs:{placeholder:"请输入关联产品名称"},on:{focus:e.showPlanDialog},model:{value:e.form.planName,callback:function(t){e.$set(e.form,"planName",t)},expression:"form.planName"}})],1),t("el-form-item",{attrs:{label:"说明",prop:"linkDescription"}},[t("el-input",{attrs:{type:"textarea",rows:4,placeholder:""},model:{value:e.form.linkDescription,callback:function(t){e.$set(e.form,"linkDescription",t)},expression:"form.linkDescription"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:""},on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary",loading:e.addLoading},on:{click:e.addAndEdit}},[e._v("确定")])],1)],1),e.planVisible?t("el-dialog",{attrs:{title:e.planTitle,visible:e.planVisible,"close-on-click-modal":!1,"append-to-body":"",top:"6vh",width:"75%"},on:{"update:visible":function(t){e.planVisible=t}}},[t("PlanTable",{attrs:{currentProduct:e.currentProduct},on:{select:e.selectProduct}}),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.planVisible=!1}}},[e._v("确定")])],1)],1):e._e(),e.url2ShortVisible?t("el-dialog",{attrs:{title:"转短",visible:e.url2ShortVisible,"close-on-click-modal":!1,"append-to-body":""},on:{"update:visible":function(t){e.url2ShortVisible=t}}},[t("Url2Short",{attrs:{url:e.form.linkUrl},on:{toShortSuccess:e.toShortSuccess}}),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.confirm2Short}},[e._v("确定")])],1)],1):e._e()],1)},i=[],r=(a("d9e2"),a("88a7"),a("271a"),a("5494"),function(){var e=this,t=e._self._c;return t("div",{staticClass:"camp-dialog-table"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"template-table",staticStyle:{width:"100%"},attrs:{data:e.campTableData,stripe:"",height:"100%"}},[t("el-table-column",{attrs:{label:"序号",type:"index","header-align":"center",align:"center",width:"60"}}),t("el-table-column",{attrs:{prop:"campId",label:"活动编号",width:"140","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{prop:"campName",label:"活动名称","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{prop:"endDate",label:"有效期","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(a.row.startDate)+" - "+e._s(a.row.endDate))])]}}])}),t("el-table-column",{attrs:{prop:"statusName",label:"活动状态","header-align":"center",align:"center"}})],1),t("el-pagination",{attrs:{"current-page":e.query.pageNum,"page-size":5,"pager-count":5,total:e.campTableData.length,layout:"prev, pager, next"},on:{"current-change":e.handleCurrentChange}})],1)}),n=[],s=a("0fea"),o=a("aa39"),c={props:["linkId"],data(){return{loading:!1,query:{pageNum:1,pageSize:5,linkId:this.linkId},campTableData:[]}},methods:{async getCampList(){try{this.loading=!0;const{camps:e}=await Object(s["i"])(o["a"].linkLib.searchCampsByUrl,this.query);this.campTableData=e}catch(e){}finally{this.loading=!1}},handleSizeChange(e){this.query.pageSize=e,this.getCampList()},handleCurrentChange(e){this.query.pageNum=e,this.getCampList()}},watch:{linkId:{handler(e,t){this.query.linkId=e,this.getCampList()},immediate:!0}}},d=c,p=(a("0d1e"),a("2877")),u=Object(p["a"])(d,r,n,!1,null,"a1746e78",null),h=u.exports,m=a("7b5c"),g=function(){var e=this,t=e._self._c;return t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"原链接地址",prop:"originUrl"}},[t("el-input",{model:{value:e.form.originUrl,callback:function(t){e.$set(e.form,"originUrl",t)},expression:"form.originUrl"}})],1),t("el-form-item",{attrs:{label:"小程序模板",prop:"templateId"}},[t("el-select",{attrs:{placeholder:"请选择链接模板"},model:{value:e.form.templateId,callback:function(t){e.$set(e.form,"templateId",t)},expression:"form.templateId"}},e._l(e.templateList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:e.url2ShortLoading},on:{click:e.toShortUrl}},[e._v("生成链接")])],1),t("el-form-item",{attrs:{label:"小程序链接"}},[t("el-input",{attrs:{disabled:!0},model:{value:e.shortUrl,callback:function(t){e.shortUrl=t},expression:"shortUrl"}})],1)],1)},b=[],f=(a("14d9"),{props:{url:{type:String,default:""}},data(){return{url2ShortLoading:!1,form:{originUrl:this.url,templateId:""},templateList:[],shortUrl:"",rules:{originUrl:[{required:!0,message:"请输入原始链接",trigger:"blur"}],templateId:[{required:!0,message:"请选择链接模板",trigger:"blur"}]}}},methods:{async getTemplateList(){const e=await Object(s["i"])(o["a"].linkLib.getLinkId);let t=[],a=[];for(let l in e)t.push(l),a.push(e[l]);this.templateList=t.map((e,t)=>({label:e,value:a[t]}))},async toShortUrl(){this.$refs["form"].validate(async e=>{if(e)try{this.url2ShortLoading=!0;const{resStatus:e,result:t}=await Object(s["i"])(o["a"].linkLib.getShortUrl+`?templateId=${this.form.templateId}&originUrl=${this.form.originUrl}`);0==e.resCode?(this.$message({message:"操作成功",type:"success"}),this.shortUrl=t,this.$emit("toShortSuccess",t)):this.$message({message:e.resMsg,type:"error"})}catch(t){}finally{this.url2ShortLoading=!1}})}},created(){this.getTemplateList()}}),y=f,k=Object(p["a"])(y,g,b,!1,null,"01be5865",null),v=k.exports;const{linkLib:{downloadLinkTemplate:w,getLinkId:S,getShortUrl:_,saveOrUpdateLink:L,searchAllLink:U,uploadBatchLinkFiles:q,deleteLink:C}}=o["a"];var D={name:"Linkbases",components:{CampTable:h,PlanTable:m["a"],Url2Short:v},data(){return{loading:!1,uploadLoading:!1,url2ShortLoading:!1,addLoading:!1,query:{aswitch:"1",linkId:"",linkName:"",linkUrl:"",linkCreator:"",createDateS:"",createDateE:"",pageNum:1,pageSize:10},query_:{linkId:"",linkName:"",linkUrl:"",linkCreator:"",createDateS:"",createDateE:""},queryTime:null,LinkTypes:[{value:"1",label:"普通链接"},{value:"2",label:"短信小程序链接"}],total:0,tableData:[],multipleSelection:[],dialogFormVisible:!1,dialogCampVisible:!1,planVisible:!1,url2ShortVisible:!1,suc2ShortUrl:"",currentLinkId:"",dialogTitle:"新增链接",tempUrl:"",currentProduct:{},form:{aswitch:"1",linkId:"",linkName:"",type:"2",linkUrl:"",planId:"",planName:"",linkDescription:"",status:"0"},rules:{linkName:[{required:!0,message:"请输入链接名称",trigger:"blur"}],linkUrl:[{validator:this.validateUrl,trigger:"blur"}],planId:[{required:!0,message:"请输入关联产品ID",trigger:"change"}],planName:[{required:!0,message:"请输入关联产品名称",trigger:"change"}]}}},methods:{validateUrl(e,t,a){""===t&&"1"===this.form.type?a(new Error("请输入链接地址")):a()},searchData(){this.query.pageNum=1,this.query={...this.query,...this.query_},this.getTableData()},async getTableData(){try{this.loading=!0;const{data:e}=await Object(s["i"])(U,this.query);this.tableData=e.list,this.total=e.totalSize}catch(e){}finally{this.loading=!1}},getDates(){this.queryTime?(this.query_.createDateS=this.queryTime[0],this.query_.createDateE=this.queryTime[1]):(this.query_.createDateS="",this.query_.createDateE="")},reset(){this.queryTime=null,this.query_.linkId="",this.query_.linkName="",this.query_.linkUrl="",this.query_.linkCreator="",this.query_.createDateS="",this.query_.createDateE="",this.query={...this.query,...this.query_},this.getTableData()},downloadTemplate(){Object(s["d"])(w).then(({data:e})=>{const t=new Blob([e],{type:e.type}),a="链接模板.xlsx",l=document.createElement("a");l.download=a,l.style.display="none",l.href=URL.createObjectURL(t),document.body.appendChild(l),l.click(),URL.revokeObjectURL(l.href),document.body.removeChild(l)})},importFile_(){this.$refs.uploadLink.files.length>0&&(this.$refs.uploadLink.value=null),this.$refs.uploadLink.click()},importFile(e){let t=e.target.files[0];if(!t)return;let a=new FormData;a.append("file",t),this.uploadLoading=!0,Object(s["j"])(q,a).then(e=>{this.uploadLoading=!1,!1!==e.data?(this.$message({message:"导入成功",type:"success"}),this.getTableData()):this.$message.error("导入失败")}).catch(e=>{this.uploadLoading=!1})},showCamp(e){this.currentLinkId=e,this.dialogCampVisible=!0},async showDialog(e,t){this.dialogTitle=e,this.dialogFormVisible=!0,this.suc2ShortUrl="",this.form=t?{aswitch:"1",linkId:t.id,linkName:t.name,type:"2",linkUrl:t.url,planId:t.planId,planName:t.planName,linkDescription:t.description,status:"3"}:{aswitch:"1",linkId:"",linkName:"",type:"2",linkUrl:"",planId:"",planName:"",linkDescription:"",status:"0"}},addAndEdit(){this.$refs["form"].validate(async e=>{if(e){this.addLoading=!0;try{let e={...this.form};delete e.type;const t=await Object(s["i"])(L,e);t.status>0&&2!=t.status?(this.$message({message:"操作成功",type:"success"}),this.dialogFormVisible=!1,this.getTableData()):2==t.status?this.$message({message:"该链接已存在！",type:"warning"}):0==t.status&&this.$message({message:"新增或修改异常!",type:"error"})}catch(t){}finally{this.addLoading=!1}}})},showPlanDialog(){this.form.planId?(this.planTitle="当前关联产品："+this.form.planName,this.currentProduct={planId:this.form.planId,planName:this.form.planName}):(this.planTitle="请选择关联产品",this.currentProduct={}),this.planVisible=!0},selectProduct(e){this.currentProduct=e,this.planTitle="当前关联产品："+e.planName,this.form.planId=e.planId,this.form.planName=e.planName},url2Short(){this.url2ShortVisible=!0},toShortSuccess(e){this.suc2ShortUrl=e},confirm2Short(){this.url2ShortVisible=!1,this.form.linkUrl=this.suc2ShortUrl},handleSizeChange(e){this.query.pageNum=1,this.query.pageSize=e,this.getTableData()},handleCurrentChange(e){this.query.pageNum=e,this.getTableData()},deleteRow(e){this.$confirm("此操作将永久删除该链接, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Object(s["i"])(C,{linkId:e.id,linkUrl:e.url});this.$message({message:"删除成功",type:"success"}),this.getTableData()}catch(t){}}).catch(()=>{})}},mounted(){this.getTableData()}},I=D,x=(a("a9d3"),Object(p["a"])(I,l,i,!1,null,"4140f5a6",null));t["default"]=x.exports},edd0:function(e,t,a){"use strict";var l=a("13d2"),i=a("9bf2");e.exports=function(e,t,a){return a.get&&l(a.get,t,{getter:!0}),a.set&&l(a.set,t,{setter:!0}),i.f(e,t,a)}}}]);