(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4fadee42"],{3591:function(e,t,a){},"447b":function(e,t,a){"use strict";a("b650c")},8737:function(e,t,a){"use strict";a("88da")},"88da":function(e,t,a){},"89ff":function(e,t,a){"use strict";t["a"]={bigSrceenConfig:{queryFrontSecondScreens:"/plan-svc/mcd/front/secondScreen/queryFrontSecondScreens",updateFrontSecondScreens:"/plan-svc/mcd/front/secondScreen/updateFrontSecondScreens"},blackList:{deleBlackList:"/plan-svc/customer/black/list/deleBlackList",downloadImpOrDelBlacklistTemplate:"/plan-svc/customer/black/list/downloadImpOrDelBlacklistTemplate",impOrDelBlacklistFile:"/plan-svc/customer/black/list/impOrDelBlacklistFile",queryBlackList:"/plan-svc/customer/black/list/queryBlackList",queryAllCitys:"/plan-svc/customer/black/list/queryAllCitys",createOrUpdate:"/plan-svc/mcd-hmh5-blacklist-task/createOrUpdate",delete:"/plan-svc/mcd-hmh5-blacklist-task/delete",listTask:"/plan-svc/mcd-hmh5-blacklist-task/listTask",getTaskDetailByTaskId:"/plan-svc/mcd-hmh5-blacklist-task/getTaskDetailByTaskId",submitBlacklist:"/plan-svc/mcd-hmh5-blacklist-task/submitBlacklist",getBlacklistApprover:"/plan-svc/mcd-hmh5-blacklist-task/getBlacklistApprover",approveBlacklistRecord:"/plan-svc/mcd-hmh5-blacklist-task/approveBlacklistRecord"},careRelation:{queryChannelByCityAndCounty:"/plan-svc/mcd/front/guardList/queryChannelByCityAndCounty",exportGuardUserList:"/plan-svc/mcd/front/guardList/exportGuardUserList",queryGuardUserList:"/plan-svc/mcd/front/guardList/queryGuardUserList"},messageTemplate:{approveSmsTemplateRecord:"/plan-svc/sms/template/approveSmsTemplateRecord",delCareSmsTemplate:"/plan-svc/sms/template/delCareSmsTemplate",deleteTemplateLabel:"/plan-svc/sms/template/deleteTemplateLabel",getCareSmsTemplate:"/plan-svc/sms/template/getCareSmsTemplate",getCareSmsTemplateApprover:"/plan-svc/sms/template/getCareSmsTemplateApprover",getCareSmsTemplateDetail:"/plan-svc/sms/template/getCareSmsTemplateDetail",getCustGroupVars:"/plan-svc/sms/template/getCustGroupVars",getLabelListDaiwei:"/plan-svc/sms/template/getLabelListDaiwei",getRelaLabels:"/plan-svc/sms/template/getRelaLabels",saveCareSmsTemplate:"/plan-svc/sms/template/saveCareSmsTemplate",saveOrUpdateRela:"/plan-svc/sms/template/saveOrUpdateRela",subCareSmsTemplateApprove:"/plan-svc/sms/template/subCareSmsTemplateApprove"},labelConfig:{mcdCustomLabelDefGet:"/plan-svc/mcdCustomLabelDef",mcdCustomLabelDefPut:"/plan-svc/mcdCustomLabelDef",commitProcess:"/plan-svc/mcdCustomLabelDef/commitProcess",getNodeApprover:"/plan-svc/mcdCustomLabelDef/getNodeApprover",modifySelfDefinedLabelConf:"/plan-svc/mcdCustomLabelDef/modifySelfDefinedLabelConf",selectSelfDefinedLabelConf:"/plan-svc/mcdCustomLabelDef/selectSelfDefinedLabelConf",selectSelfDefinedLabelConfDetail:"/plan-svc/mcdCustomLabelDef/selectSelfDefinedLabelConfDetail",mcdCustomLabelDef:"/plan-svc/mcdCustomLabelDef"},warningConfig:{mcdAppAlarmInfoGet:"/plan-svc/mcdAppAlarmInfo",mcdAppAlarmInfoPost:"/plan-svc/mcdAppAlarmInfo",mcdAppAlarmInfoPut:"/plan-svc/mcdAppAlarmInfo",mcdAppAlarmInfoDelete:"/plan-svc/mcdAppAlarmInfo",batchImportAutoClearAlarm:"/plan-svc/mcdAppAlarmInfo/batchImportAutoClearAlarm",commitProcess:"/plan-svc/mcdAppAlarmInfo/commitProcess",getNodeApprover:"/plan-svc/mcdAppAlarmInfo/getNodeApprover",queryDataSourceList:"/plan-svc/mcdAppAlarmInfo/queryDataSourceList",queryDataTableList:"/plan-svc/mcdAppAlarmInfo/queryDataTableList",querySourceTable:"/plan-svc/mcdAppAlarmInfo/querySourceTable",selectAlarmDetailById:"/plan-svc/mcdAppAlarmInfo/selectAlarmDetailById",selectAlarmType:"/plan-svc/mcdAppAlarmInfo/selectAlarmType",terminateAlarm:"/plan-svc/mcdAppAlarmInfo/terminateAlarm",queryHasRole:"/plan-svc/mcdAppAlarmInfo/queryHasRole",updateAlarmThreshold:"/plan-svc/mcdAppAlarmInfo/updateAlarmThreshold",queryAllCitys:"/plan-svc/mcdAppAlarmInfo/queryAllCitys"},customerCommunicationUseCondition:{exportCampsegHandleDetail:"/plan-svc/action/jx/onlinelChannel/exportCampsegHandleDetail",exportCampsegHandleSummary:"/plan-svc/action/jx/onlinelChannel/exportCampsegHandleSummary",exportChannelUsageList:"/plan-svc/action/jx/onlinelChannel/exportChannelUsageList",exportCityUsageList:"/plan-svc/action/jx/onlinelChannel/exportCityUsageList",exportCountyUsageList:"/plan-svc/action/jx/onlinelChannel/exportCountyUsageList",exportGridUsageList:"/plan-svc/action/jx/onlinelChannel/exportGridUsageList",exportOppoCampCityHandle:"/plan-svc/action/jx/onlinelChannel/exportOppoCampCityHandle",queryCampsegHandleDetail:"/plan-svc/action/jx/onlinelChannel/queryCampsegHandleDetail",queryCampsegHandleSummary:"/plan-svc/action/jx/onlinelChannel/queryCampsegHandleSummary",queryChannelUsageList:"/plan-svc/action/jx/onlinelChannel/queryChannelUsageList",queryCityUsageList:"/plan-svc/action/jx/onlinelChannel/queryCityUsageList",queryCountyUsageList:"/plan-svc/action/jx/onlinelChannel/queryCountyUsageList",queryGridUsageList:"/plan-svc/action/jx/onlinelChannel/queryGridUsageList",queryOppoCampCityHandle:"/plan-svc/action/jx/onlinelChannel/queryOppoCampCityHandle"},customerContactMaintainCondition:{reportSmsMessage:"/plan-svc/reportSmsMessage",export:"/plan-svc/reportSmsMessage/export"},customerCommunicationWarningCondition:{reportYjCityDetailNew:"/plan-svc/reportYjCityDetailNew",reportYjCityDetailNewExport:"/plan-svc/reportYjCityDetailNew/export",reportYjCountyDetailNew:"/plan-svc/reportYjCountyDetailNew",reportYjCountyDetailNewExport:"/plan-svc/reportYjCountyDetailNew/export",reportYjDetailInfo:"/plan-svc/reportYjDetailInfo",reportYjDetailInfoExport:"/plan-svc/reportYjDetailInfo/export",reportYjGridDetailNew:"/plan-svc/reportYjGridDetailNew",reportYjGridDetailNewExport:"/plan-svc/reportYjGridDetailNew/export",reportYjStaffDetailNew:"/plan-svc/reportYjStaffDetailNew",reportYjStaffDetailNewExport:"/plan-svc/reportYjStaffDetailNew/export"},jobNoQuery:{queryFrontStafferList:"/plan-svc/mcd/front/staffer/queryFrontStafferList"},problemFeedback:{addNewReply:"/plan-svc/mcdFeedbackQa/addNewReply",addNewReplyPicture:"/plan-svc/mcdFeedbackQa/addNewReplyPicture",downloadImage:"/plan-svc/mcdFeedbackQa/downloadImage",getAllRepliesByBusinessId:"/plan-svc/mcdFeedbackQa/getAllRepliesByBusinessId",getRecentlyReplyFeedback:"/plan-svc/mcdFeedbackQa/getRecentlyReplyFeedback",mcdManagerFeedback:"/plan-svc/mcdManagerFeedback"},proxyCustomerLabel:{mcdFrontCareSmsLabelGet:"/plan-svc/mcdFrontCareSmsLabel",mcdFrontCareSmsLabelPost:"/plan-svc/mcdFrontCareSmsLabel",mcdFrontCareSmsLabelPut:"/plan-svc/mcdFrontCareSmsLabel",mcdFrontCareSmsLabelDelete:"/plan-svc/mcdFrontCareSmsLabel"},noticeBoard:{mcdBulletinBoardGet:"/plan-svc/mcdBulletinBoard",mcdBulletinBoardPost:"/plan-svc/mcdBulletinBoard",mcdBulletinBoardPut:"/plan-svc/mcdBulletinBoard",mcdBulletinBoardDelete:"/plan-svc/mcdBulletinBoard",deleteImage:"/plan-svc/mcdBulletinBoard/deleteImage",downloadImage:"/plan-svc/mcdBulletinBoard/downloadImage",modifyBulletinStatus:"/plan-svc/mcdBulletinBoard/modifyBulletinStatus",uploadBulletinPictures:"/plan-svc/mcdBulletinBoard/uploadBulletinPictures"},mainPackageConfig:{queryFrontMainOffers:"/plan-svc/mcd/front/mainOfferInfo/queryFrontMainOffers",deleteMainOfferInfo:"/plan-svc/mcd/front/mainOfferInfo/deleteMainOfferInfo",getMainOfferInfoDetail:"/plan-svc/mcd/front/mainOfferInfo/getMainOfferInfoDetail",saveOrUpdateMainOffer:"/plan-svc/mcd/front/mainOfferInfo/saveOrUpdateMainOffer",updateMainOfferInfoStatus:"/plan-svc/mcd/front/mainOfferInfo/updateMainOfferInfoStatus"},keyMonitoring:{queryFrontKeyMonitors:"/plan-svc/mcd/front/keyMonitor/queryFrontKeyMonitors"}}},"946d":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{width:"60%",top:"9vh","append-to-body":!0,title:e.title,visible:e.dialogVisible,"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("i",{staticClass:"el-icon-close",on:{click:function(t){return e.$emit("update:dialogVisible",!1)}}}),t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ruleForm",class:{"is-disabled":!e.isEdit},attrs:{model:e.form,rules:e.rules,"label-width":"95px",inline:""}},[t("el-form-item",{attrs:{label:"预警名称：",prop:"alarmName",size:"mini"}},[t("el-input",{attrs:{disabled:!e.isEdit,placeholder:"请输入预警名称"},model:{value:e.form.alarmName,callback:function(t){e.$set(e.form,"alarmName",t)},expression:"form.alarmName"}})],1),t("el-form-item",{attrs:{label:"预警类型：",prop:"alarmType",size:"mini"}},[t("el-select",{attrs:{placeholder:"请选择预警类型",disabled:!e.isEdit},model:{value:e.form.alarmType,callback:function(t){e.$set(e.form,"alarmType",t)},expression:"form.alarmType"}},e._l(e.alarmTypeList,(function(e){return t("el-option",{key:e.typeId,attrs:{label:e.typeName,value:e.typeId}})})),1),"gwyj"===e.form.alarmType?t("el-checkbox",{attrs:{disabled:!e.isEdit},model:{value:e.checked,callback:function(t){e.checked=t},expression:"checked"}},[e._v("自动解警")]):e._e()],1),t("el-form-item",{attrs:{label:"数据源库：",prop:"sourceDb",size:"mini"}},[t("el-select",{attrs:{placeholder:"请选择数据源库",disabled:!e.isEdit},model:{value:e.form.sourceDb,callback:function(t){e.$set(e.form,"sourceDb",t)},expression:"form.sourceDb"}},e._l(e.dataSourceList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"输入表名：",prop:"sourceTable",size:"mini"}},[t("el-input",{attrs:{disabled:!e.isEdit,placeholder:"请输入表名"},model:{value:e.form.sourceTable,callback:function(t){e.$set(e.form,"sourceTable",t)},expression:"form.sourceTable"}}),t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.form.sourceTable&&e.form.sourceDb&&e.isEdit,expression:"form.sourceTable && form.sourceDb && isEdit"}],staticStyle:{"margin-left":"5px"},attrs:{type:"primary",size:"mini",loading:e.valLoading},on:{click:e.validateTableName}},[e._v("表名验证")])],1),t("br"),e.showTable?e._e():t("el-form-item",{attrs:{label:"表必填字段：","label-width":"100px"}},[t("RequiredField")],1),e.showTable?[t("el-form-item",{attrs:{label:"字段定义："}}),t("el-table",{attrs:{data:e.customTableData,border:""}},e._l(e.colums,(function(a){return t("el-table-column",{key:a.prop,attrs:{prop:a.prop,label:a.label,"min-width":10*a.prop.length+15,align:"center","show-overflow-tooltip":""}},[t("template",{slot:"header"},[t("span",{class:{"click-header":e.isEdit},attrs:{title:"点击添加预警下发条件"},on:{click:function(t){return e.addWarningCondition(a.prop)}}},[e._v(e._s(a.label))])])],2)})),1)]:e._e(),t("br"),t("el-form-item",{attrs:{label:"预警下发筛选：","label-width":"110px"}}),t("br"),t("el-form-item",{attrs:{label:"","label-width":"0"}},[e.dialogVisible&&e.reRenderCondition?t("Condition",{attrs:{isEdit:e.isEdit,conditions:e.conditions},on:{"update-condition":e.updateCondition,remove:e.removeCondition}}):e._e()],1),t("br"),t("el-form-item",{staticClass:"secondary-heading",attrs:{label:"阈值设置"}}),t("div",{staticClass:"line"}),t("Threshold",{attrs:{thresholdList:e.form.alarmThreshold,isEdit:e.isEditThreshold}}),t("el-form-item",{staticClass:"secondary-heading",attrs:{label:"信息录入",rules:[{required:!0}]}}),t("div",{staticClass:"line"}),t("el-form-item",{attrs:{label:"变量：",size:"mini"}},[t("div",{staticClass:"attr-div"},[e._l(e.attrList,(function(a){return t("el-tag",{key:a.field,attrs:{closable:!a.freeze&&e.isEdit,"disable-transitions":!1},on:{close:function(t){return e.closeAttrTag(a)}}},[e._v(" "+e._s(a.name)+" ")])})),0===e.tagState&&e.isEdit&&e.colums.length?t("el-dropdown",{attrs:{trigger:"click"},on:{command:e.selectAttrField}},[t("el-button",{attrs:{type:"mini"}},[e._v("添加变量 + ")]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.colums,(function(a){return t("el-dropdown-item",{key:a.prop,attrs:{command:a.prop,disabled:e.attrList.some(e=>e.field===a.prop)}},[e._v(e._s(a.label))])})),1)],1):e._e(),1===e.tagState?t("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",on:{blur:e.addAttr},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addAttr.apply(null,arguments)}},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}}):e._e()],2)]),t("br"),t("el-form-item",{attrs:{label:"预警内容：",prop:"alarmInfo",size:"mini"}},[t("el-input",{ref:"alarmInfoRef",staticClass:"textarea",attrs:{disabled:!e.isEdit,type:"textarea",maxlength:"500","show-word-limit":"",autosize:{minRows:3,maxRows:6}},model:{value:e.form.alarmInfo,callback:function(t){e.$set(e.form,"alarmInfo",t)},expression:"form.alarmInfo"}})],1),t("br"),t("el-form-item",{attrs:{label:"替换变量：",size:"mini"}},e._l(e.attrList,(function(a){return t("el-button",{key:a.field,on:{click:function(t){return e.replaceVal("alarmInfo",a.field)}}},[e._v(e._s(a.name))])})),1),t("br"),t("el-form-item",{attrs:{label:"关怀用语：",size:"mini",prop:"alarmMessage"}},[t("el-input",{ref:"alarmMessageRef",staticClass:"textarea",attrs:{disabled:!e.isEdit,type:"textarea",maxlength:"500","show-word-limit":"",rows:3},model:{value:e.form.alarmMessage,callback:function(t){e.$set(e.form,"alarmMessage",t)},expression:"form.alarmMessage"}})],1),t("br"),t("el-form-item",{attrs:{label:"替换变量：",size:"mini"}},e._l(e.attrList,(function(a){return t("el-button",{key:a.field,on:{click:function(t){return e.replaceVal("alarmMessage",a.field)}}},[e._v(e._s(a.name))])})),1),t("br"),t("el-form-item",{attrs:{label:"有效期：",prop:"startTime",size:"mini"}},[t("el-date-picker",{attrs:{disabled:!e.isEdit,type:"daterange","value-format":"yyyy-MM-dd","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:e.dateChange},model:{value:e.effectTime,callback:function(t){e.effectTime=t},expression:"effectTime"}})],1),t("br"),t("el-form-item",{attrs:{label:"更新周期：",prop:"alarmCycle",size:"mini"}},[t("el-select",{attrs:{disabled:!e.isEdit},on:{change:e.changeCycle},model:{value:e.form.alarmCycle,callback:function(t){e.$set(e.form,"alarmCycle",t)},expression:"form.alarmCycle"}},[t("el-option",{attrs:{label:"每时",value:0}}),t("el-option",{attrs:{label:"每天",value:1}}),t("el-option",{attrs:{label:"每月",value:2}})],1),t("el-select",{directives:[{name:"show",rawName:"v-show",value:0==e.form.alarmCycle,expression:"form.alarmCycle == 0"}],attrs:{disabled:!e.isEdit},model:{value:e.form.alarmCycleTime,callback:function(t){e.$set(e.form,"alarmCycleTime",t)},expression:"form.alarmCycleTime"}},[t("el-option",{attrs:{value:"1",label:"1"}})],1),t("el-select",{directives:[{name:"show",rawName:"v-show",value:1==e.form.alarmCycle,expression:"form.alarmCycle == 1"}],attrs:{disabled:!e.isEdit},model:{value:e.form.alarmCycleTime,callback:function(t){e.$set(e.form,"alarmCycleTime",t)},expression:"form.alarmCycleTime"}},e._l(13,(function(e,a){return t("el-option",{key:a,attrs:{label:a+5+"点",value:a+5+""}})})),1),t("el-select",{directives:[{name:"show",rawName:"v-show",value:2==e.form.alarmCycle,expression:"form.alarmCycle == 2"}],attrs:{disabled:!e.isEdit},model:{value:e.form.alarmCycleTime,callback:function(t){e.$set(e.form,"alarmCycleTime",t)},expression:"form.alarmCycleTime"}},e._l(31,(function(e){return t("el-option",{key:e,attrs:{label:e+"日",value:e+""}})})),1)],1),t("br"),t("el-form-item",{attrs:{label:"是否预演：",prop:"isPreviewFilter",size:"mini"}},[t("el-select",{attrs:{disabled:!e.isEdit},model:{value:e.form.isPreviewFilter,callback:function(t){e.$set(e.form,"isPreviewFilter",t)},expression:"form.isPreviewFilter"}},[t("el-option",{attrs:{label:"是",value:"1"}}),t("el-option",{attrs:{label:"否",value:"0"}})],1)],1),t("br"),t("el-form-item",{attrs:{label:"预警执行期限：",prop:"alarmExecDealtime",size:"mini","label-width":"120px"}},[t("el-select",{attrs:{disabled:!e.isEdit},on:{change:e.changeExecTime},model:{value:e.form.alarmExecDealtime,callback:function(t){e.$set(e.form,"alarmExecDealtime",t)},expression:"form.alarmExecDealtime"}},e._l(e.dealTimeList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e.form.isDefineTime?t("el-input",{staticClass:"input-definetime",attrs:{disabled:!e.isEdit},on:{input:e.changeDefineTime},model:{value:e.defineTime.time,callback:function(t){e.$set(e.defineTime,"time",t)},expression:"defineTime.time"}},[t("template",{slot:"append"},[t("el-select",{model:{value:e.defineTime.unit,callback:function(t){e.$set(e.defineTime,"unit",t)},expression:"defineTime.unit"}},[t("el-option",{attrs:{label:"小时",value:"h"}}),t("el-option",{attrs:{label:"天",value:"d"}})],1)],1)],2):e._e()],1)],2),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.isEdit||e.isEditThreshold?[t("el-button",{on:{click:function(t){return e.$emit("update:dialogVisible",!1)}}},[e._v("取 消")]),e.isEdit?t("el-button",{attrs:{type:"primary",loading:e.saveLoading},on:{click:e.submitForm}},[e._v("保 存")]):t("el-button",{attrs:{type:"primary",loading:e.saveLoading},on:{click:e.updateThreshold}},[e._v("保 存")])]:t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$emit("update:dialogVisible",!1)}}},[e._v("关 闭")])],2)],1)},l=[],s=(a("14d9"),a("0fea")),n=a("89ff"),r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"condition-content"},[e._l(e.conditions,(function(a,i){return t("div",{key:a.field+Date.now(),staticClass:"m_item"},[t("div",{staticClass:"c_item"},[t("span",[e._v(" "+e._s(a.field)+" ")]),t("span",{class:[a.condition?"resolved":"pending"],on:{click:function(t){return e.openDialog(a.field)}}},[e._v(" "+e._s(a.condition?e.showCondition(a.condition):"点击设置")+" ")]),e.isEdit?t("i",{staticClass:"el-icon-close",on:{click:function(t){return e.remove(a,i)}}}):e._e()]),i<e.conditions.length-1?t("div",{staticClass:"logic"},[t("el-select",{attrs:{size:"mini"},model:{value:e.conditions[i].logicValue,callback:function(t){e.$set(e.conditions[i],"logicValue",t)},expression:"conditions[i].logicValue"}},[t("el-option",{attrs:{label:"且",value:"and"}}),t("el-option",{attrs:{label:"或",value:"or"}})],1)],1):e._e()])})),t("BaseDialog",{attrs:{title:"条件筛选",width:"700px","confirm-button-text":"保 存"},on:{confirm:e.saveCondition,close:function(t){e.visible=!1}},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("el-radio-group",{model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},e._l(e.filterConditions,(function(a,i){return t("el-row",{key:i},[t("el-col",{attrs:{span:4}},[t("el-radio",{attrs:{label:e.filterConditions[i].key}},[e._v(e._s(a.label))])],1),t("el-col",{attrs:{span:8}},["1"!=a.key?t("el-select",{attrs:{size:"mini"},model:{value:e.filterConditions[i].conditionValue,callback:function(t){e.$set(e.filterConditions[i],"conditionValue",t)},expression:"filterConditions[i].conditionValue"}},e._l(e.filterConditions[i].condition,(function(e,a){return t("el-option",{key:a,attrs:{label:e,value:e}})})),1):e._e(),t("el-input",{class:{precise:"1"==a.key},attrs:{size:"mini"},model:{value:e.filterConditions[i].value,callback:function(t){e.$set(e.filterConditions[i],"value",t)},expression:"filterConditions[i].value"}})],1),0===i?[t("el-col",{attrs:{span:10}},[t("span",{staticStyle:{"font-size":"14px","margin-right":"20px"}},[e._v("且")]),t("el-select",{attrs:{size:"mini"},model:{value:e.filterConditions[i].conditionValue2,callback:function(t){e.$set(e.filterConditions[i],"conditionValue2",t)},expression:"filterConditions[i].conditionValue2"}},e._l(e.filterConditions[i].condition,(function(e,a){return t("el-option",{key:a,attrs:{label:e,value:e}})})),1),t("el-input",{attrs:{size:"mini"},model:{value:e.filterConditions[i].value2,callback:function(t){e.$set(e.filterConditions[i],"value2",t)},expression:"filterConditions[i].value2"}})],1)]:e._e()],2)})),1)],1)],2)},o=[],c=a("ea45");const d=[{label:"间隔筛选",key:"0",value:"",value2:"",condition:["=","<",">","<=",">="],conditionValue:"",conditionValue2:""},{label:"精确筛选",key:"1",value:"",condition:["包含","不包含"],conditionValue:"等于"},{label:"模糊筛选",key:"2",value:"",condition:["包含","不包含"],conditionValue:""}];var m={components:{BaseDialog:c["a"]},props:{conditions:{type:Array,default:()=>[]},isEdit:{type:Boolean,default:!1}},watch:{visible(e){var t;if(!e)return;let a=(null===(t=this.conditions.find(e=>e.field===this.currentField))||void 0===t?void 0:t.condition)||{};this.filterConditions=d.map(e=>a.key===e.key?JSON.parse(JSON.stringify({...e,...a})):JSON.parse(JSON.stringify(e))),this.radio=a.key||""}},data(){return{visible:!1,currentField:"",radio:"",filterConditions:[{label:"间隔筛选",key:"0",value:"",value2:"",condition:["=","<",">","<=",">="],conditionValue:"",conditionValue2:""},{label:"精确筛选",key:"1",value:"",condition:["包含","不包含"],conditionValue:""},{label:"模糊筛选",key:"2",value:"",condition:["包含","不包含"],conditionValue:""}]}},methods:{openDialog(e){this.visible=!0,this.currentField=e},remove(e,t){this.$emit("remove",e,t)},saveCondition(){if(""===this.radio)return void this.$message.error("请选择筛选条件");let e=this.filterConditions.find(e=>e.key===this.radio);if("0"===e.key){if(""===e.value||""===e.value2||""===e.conditionValue||""===e.conditionValue2)return void this.$message.error("请填写完整的筛选条件")}else if("1"===e.key){if(""===e.value)return void this.$message.error("请填写完整的筛选条件")}else if(""===e.value||""===e.conditionValue)return void this.$message.error("请填写完整的筛选条件");let t=this.conditions.findIndex(e=>e.field===this.currentField);this.$emit("update-condition",t,e),this.visible=!1},showCondition(e){return"0"===e.key?`${e.conditionValue} ${e.value} 且 ${e.conditionValue2} ${e.value2}`:`${e.conditionValue} ${e.value}`}}},u=m,p=(a("447b"),a("2877")),f=Object(p["a"])(u,r,o,!1,null,"35a242ce",null),h=f.exports,v=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{padding:"10px 0"}},[t("div",{staticClass:"threshold-table"},e._l(e.thresholdList,(function(a,i){return t("div",{key:a.alarmCityCode,staticClass:"c_item",class:{"is-disabled":!e.isEdit}},[t("span",[e._v(" "+e._s(a.alarmCityName)+" ")]),"999"==e.cityId?[t("span",{staticClass:"input"},[t("el-input",{attrs:{size:"mini",placeholder:"未设置"},on:{input:t=>e.input(t,i)},model:{value:e.thresholdList[i].alarmThrashValue,callback:function(t){e.$set(e.thresholdList[i],"alarmThrashValue",t)},expression:"thresholdList[i].alarmThrashValue"}})],1)]:[e.cityId==a.alarmCityCode?[t("span",{staticClass:"input"},[t("el-input",{attrs:{size:"mini",placeholder:"未设置"},on:{input:t=>e.input(t,i)},model:{value:e.thresholdList[i].alarmThrashValue,callback:function(t){e.$set(e.thresholdList[i],"alarmThrashValue",t)},expression:"thresholdList[i].alarmThrashValue"}})],1)]:t("span",[e._v(" **** ")])]],2)})),0)])},b=[],y={props:{thresholdList:{type:Array,default:()=>[]},isEdit:{type:Boolean,default:!1}},data(){return{cityId:sessionStorage.getItem("cityId")}},methods:{input(e,t){e=e.replace(/[^\d]/g,""),e>1e9&&(e=1e9),this.thresholdList[t].alarmThrashValue=e}}},g=y,C=(a("8737"),Object(p["a"])(g,v,b,!1,null,"275f4c20",null)),T=C.exports,k=function(){var e=this;e._self._c;return e._m(0)},A=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"table"},[t("div",[t("span",[e._v("字段名称")]),t("span",[e._v("属性名称")]),t("span",[e._v("数据类型")]),t("span",[e._v("示例")])]),t("div",[t("span",[e._v("账期日")]),t("span",[e._v("STAT_DATE")]),t("span",[e._v("STRING")]),t("span",[e._v("YYYYMMDD")])]),t("div",[t("span",[e._v("手机号")]),t("span",[e._v("PHONE_NO")]),t("span",[e._v("STRING")]),t("span",{staticStyle:{color:"#fff","user-select":"none"}},[e._v(".")])]),t("div",[t("span",[e._v("是否解警")]),t("span",[e._v("IS_CLEAR_WARNING")]),t("span",[e._v("INT")]),t("span",[e._v("0否，1是")])]),t("div",[t("span",[e._v("解警原因")]),t("span",[e._v("REA_CLEAR_WARNING")]),t("span",[e._v("STRING")]),t("span",[e._v("格式")])]),t("div",[t("span",[e._v("解警时间")]),t("span",[e._v("CLEAR_WARNING_DATE")]),t("span",[e._v("STRING")]),t("span",[e._v("YYYYMMDD")])]),t("div",[t("span",[e._v("预警时间")]),t("span",[e._v("WARNING_DATE")]),t("span",[e._v("STRING")]),t("span",[e._v("YYYYMMDD")])])])}],_={data(){return{}}},L=_,x=(a("b58f"),Object(p["a"])(L,k,A,!1,null,"3253834e",null)),D=x.exports;const S=n["a"].warningConfig;var w={components:{Condition:h,Threshold:T,RequiredField:D},props:{dialogVisible:{type:Boolean,default:!1},title:{type:String,default:"预警配置"},id:{type:String|Number,default:""},isEdit:{type:Boolean,default:!1},isEditThreshold:{type:Boolean,default:!0}},watch:{dialogVisible(e){e&&this.id?this.getDetail():e&&!this.id?(this.getAttrList(),this.setFormAlarmThreshold()):e||this.$nextTick(()=>{this.tableNameValRes=null,this.showTable=!1,this.conditions=[],this.attrList=[...this.attrListDefault],this.colums=[],this.customTableData=[],this.tagState=0,this.defineTime={time:"",unit:"h"},this.resetForm()})},"form.sourceTable"(e){this.tableNameValRes=null},"form.alarmType"(e){this.form.autoClearAlarmStatus="gwyj"!==e?null:this.checked?"1":"0"},checked(e){this.form.autoClearAlarmStatus=e?"1":"0"}},data(){return{loading:!1,valLoading:!1,saveLoading:!1,reRenderCondition:!0,getDataTableSource:null,alarmTypeList:[],dataSourceList:[],effectTime:null,form:{alarmAttr:"",alarmName:"",alarmType:"",autoClearAlarmStatus:null,sourceDb:"",sourceTable:"",sourceField:"",executeCondition:"",executeConditionVal:"",alarmThreshold:[],alarmInfo:"",alarmMessage:"",startTime:"",endTime:"",alarmCycle:1,alarmCycleTime:"5",isPreviewFilter:"",alarmExecDealtime:"",alarmExecDealtimeUnit:"h",isDefineTime:!1},oldAlarmThreshold:[],requiredFields:["stat_date","STAT_DATE","phone_no","PHONE_NO","is_clear_warning","IS_CLEAR_WARNING","rea_clear_warning","REA_CLEAR_WARNING","clear_warning_date","CLEAR_WARNING_DATE","warning_date","WARNING_DATE"],checked:!1,tableNameValRes:null,conditions:[],cityList:[],dealTimeList:[{label:"2小时",value:"2",unit:"h"},{label:"24小时",value:"24",unit:"h"},{label:"48小时",value:"48",unit:"h"},{label:"3天",value:"3",unit:"d"},{label:"5天",value:"5",unit:"d"},{label:"自选",value:"自选"}],defineTime:{time:"",unit:1},rules:{alarmName:[{required:!0,message:"请输入预警名称",trigger:"blur"}],alarmType:[{required:!0,message:"请选择预警类型",trigger:"change"}],sourceDb:[{required:!0,message:"请选择数据源库",trigger:"change"}],sourceTable:[{required:!0,message:"请输入表名",trigger:"blur"}],sourceField:[{required:!0,message:"请选择数据源字段",trigger:"change"}],alarmInfo:[{required:!0,message:"请输入预警内容",trigger:"blur"}],alarmMessage:[{required:!0,message:"请输入关怀用语",trigger:"blur"}],startTime:[{required:!0,message:"请选择有效期",trigger:"change"}],alarmCycle:[{required:!0,message:"请选择预警周期",trigger:"change"}],alarmCycleTime:[{required:!0,message:"请选择预警周期时间",trigger:"change"}],isPreviewFilter:[{required:!0,message:"请选择是否预演",trigger:"change"}],alarmExecDealtime:[{required:!0,message:"请选择预警执行期限",trigger:"change"}]},showTable:!1,customTableData:[],colums:[],attrListDefault:Object.freeze([{field:"PHONE_NO",name:"手机号码",freeze:!0}]),attrList:[],tagState:0,colSelectValue:"",inputValue:""}},methods:{async getDetail(){try{this.loading=!0;const t=await Object(s["g"])(S.selectAlarmDetailById+"?alarmId="+this.id);let a={...this.form,...t};for(let i in a)if(null===a[i]&&(a[i]=""),"startTime"===i)this.effectTime=[a[i],a.endTime];else if("alarmType"===i)"gwyj"===a[i]&&(this.checked="1"===a.autoClearAlarmStatus);else if("executeConditionVal"===i)this.conditions=a[i]?JSON.parse(a[i]):[];else if("alarmThreshold"===i){var e;null!==(e=a[i])&&void 0!==e&&e.length?(this.oldAlarmThreshold=JSON.parse(JSON.stringify(a[i])),a[i].forEach(e=>{null==e.alarmThrashValue&&(e.alarmThrashValue="")})):(this.oldAlarmThreshold=JSON.parse(JSON.stringify(this.cityList)),a[i]=JSON.parse(JSON.stringify(this.cityList)))}else"isDefineTime"===i&&(a[i]="true"==a[i],a[i]&&(this.defineTime={time:a.alarmExecDealtime,unit:a.alarmExecDealtimeUnit||"h"},this.form.alarmExecDealtime="自选"));this.form=a,this.getAttrList(),this.validateTableName(!1),this.isEdit||this.$refs["ruleForm"].clearValidate()}catch(t){}finally{this.loading=!1}},async setFormAlarmThreshold(){if(this.cityList.length)this.form.alarmThreshold=JSON.parse(JSON.stringify(this.cityList));else try{this.form.alarmThreshold=await this.getCityList()}catch(e){this.form.alarmThreshold=[]}},async getCityList(){try{const e=await Object(s["i"])(S.queryAllCitys);this.cityList=e.map(e=>({alarmCityCode:e.cityId,alarmCityName:e.cityName,alarmThrashValue:""}));const t=sessionStorage.getItem("cityId");let a=this.cityList.findIndex(e=>e.alarmCityCode==t);if(-1!==a){let e=this.cityList.splice(a,1);this.cityList.unshift(e[0])}return this.cityList}catch(e){}},getAttrList(){var e;let t=(null===(e=this.form.alarmAttr)||void 0===e?void 0:e.split(","))||[];t=t.filter(e=>e),this.attrList=t.map(e=>{if(e)return{field:e.split("@")[1],name:e.split("@")[0]}}).filter(e=>"PHONE_NO"!==(null===e||void 0===e?void 0:e.field)),this.attrList=[...this.attrListDefault,...this.attrList]},async getAlarmType(){try{const e=await Object(s["g"])(S.selectAlarmType);this.alarmTypeList=e}catch(e){}},async validateTableName(e=!0){e&&(this.conditions=[]);try{this.valLoading=!0;const e=await Object(s["g"])(S.querySourceTable,{dataSourceName:this.form.sourceDb,tableName:this.form.sourceTable},{timeout:15e3});if(null!==e&&void 0!==e&&e.length){this.tableNameValRes=!0;let t=[];e.forEach(e=>{t.some(t=>t.ATTR_NAME===e.ATTR_NAME)||t.push(e)}),t=t.sort((e,t)=>this.requiredFields.includes(e.ATTR_NAME)?-1:1),this.colums=t.map(e=>({prop:e.ATTR_NAME,label:e.ATTR_NAME}));let a={};t.forEach(e=>{a[e.ATTR_NAME]=e.DATA_VALUE}),this.customTableData=[a],this.showTable=!0}else this.tableNameValRes=!0,this.$message.error(e.message||"表名验证失败"),this.showTable=!1,this.colums=[],this.customTableData=[]}catch(t){this.tableNameValRes=null,this.showTable=!1,this.customTableData=[],this.colums=[]}finally{this.valLoading=!1}},async getDataSource(){try{const e=await Object(s["g"])(S.queryDataSourceList);for(let t in e)this.dataSourceList.push({value:t,label:e[t]})}catch(e){}},addWarningCondition(e){this.isEdit&&(5!==this.conditions.length?this.conditions.some(t=>t.field===e)||this.conditions.push({field:e,logicValue:"and",condition:null}):this.$message.warning("最多添加5个预警下发条件"))},removeCondition(e,t){this.conditions.splice(t,1)},updateCondition(e,t){this.$set(this.conditions[e],"condition",t),this.reRenderCondition=!1,this.$nextTick(()=>{this.reRenderCondition=!0})},joinConditionSql(e){let t="";e.forEach((a,i)=>{let l=a.condition;"0"===l.key?t+=`(${a.field} ${l.conditionValue} '${l.value}' AND ${a.field} ${l.conditionValue2} '${l.value2}')`:"1"===l.key?t+=`(${a.field} = '${l.value}')`:"2"===l.key&&(t+=`(${a.field} ${"包含"===l.conditionValue?"like":"not like"} '%${l.value}%')`),i<e.length-1&&(t+=` ${a.logicValue} `)});let a="",i=t.split(" or ");if(i.length>1)a=i.map(e=>{let t=e.split(" and ");return t.length>1?`(${t.join(" and ")})`:e}).join(" or ");else{let e=t.split(" and ");a=e.length>1?`(${e.join(" and ")})`:t}return a},closeAttrTag(e){this.attrList.splice(this.attrList.indexOf(e),1)},selectAttrField(e){this.colSelectValue=e,this.tagState++,this.$nextTick(()=>{this.$refs.saveTagInput.$refs.input.focus()})},addAttr(){const e=this.inputValue;e&&this.attrList.push({field:this.colSelectValue,name:e}),this.tagState=0,this.colSelectValue="",this.inputValue=""},replaceVal(e,t){this.form[e]+=`$${t}$`,this.$nextTick(()=>{this.$refs[e+"Ref"].focus()})},dateChange(e){e?(this.form.startTime=e[0],this.form.endTime=e[1]):(this.form.startTime="",this.form.endTime="")},changeCycle(){this.form.alarmCycleTime=null},changeExecTime(e){this.form.isDefineTime="自选"===e,this.defineTime.time="",this.defineTime.unit="h";const t=this.dealTimeList.find(t=>t.value===e);this.form.alarmExecDealtimeUnit=t.unit||"d"},changeDefineTime(e){e=e.replace(/[^\d]/g,""),0>=Number(e)&&(e=""),this.defineTime.time=e},async updateThreshold(){try{this.saveLoading=!0;await Object(s["i"])(S.updateAlarmThreshold,{alarmId:this.id,newAlarmThreshold:this.form.alarmThreshold,oldAlarmThreshold:this.oldAlarmThreshold,userId:sessionStorage.getItem("userId"),cityId:sessionStorage.getItem("cityId")});this.$message.success("更新预警阈值成功"),this.$emit("update:dialogVisible",!1)}catch(e){}finally{this.saveLoading=!1}},resetForm(){for(let e in this.form)this.form[e]="alarmCycle"===e?1:"alarmCycleTime"===e?"5":"alarmThreshold"===e?[]:"alarmExecDealtimeUnit"===e?"h":"";this.effectTime=null,this.$refs["ruleForm"].resetFields()},submitForm(){this.isEdit?this.$refs["ruleForm"].validate(async e=>{if(e)if(!0===this.tableNameValRes){if(this.conditions.length>0){let e=this.conditions.some(e=>!e.condition);if(e)return void this.$message.error("请填写预警下发条件")}try{this.saveLoading=!0;let e={},t={...this.form};t.alarmAttr=this.attrList.map(e=>`${e.name}@${e.field}`).join(","),t.executeConditionVal=this.conditions.length?JSON.stringify(this.conditions):null,t.executeCondition=this.joinConditionSql(this.conditions),t.isDefineTime&&(t.alarmExecDealtime=this.defineTime.time,t.alarmExecDealtimeUnit=this.defineTime.unit),e=this.form.alarmId?await Object(s["m"])(S.mcdAppAlarmInfoPut,t):await Object(s["i"])(S.mcdAppAlarmInfoPost,t),this.$message.success(e.message),this.$emit("refresh"),this.$emit("update:dialogVisible",!1)}catch(t){}finally{this.saveLoading=!1}}else this.$message.error(this.tableNameValRes||"请先验证表名")}):this.$emit("update:dialogVisible",!1)}},created(){this.getAlarmType(),this.getDataSource(),this.getCityList()}},N=w,I=(a("f95b"),Object(p["a"])(N,i,l,!1,null,"47695ca1",null));t["a"]=I.exports},b58f:function(e,t,a){"use strict";a("b678")},b62e:function(e,t,a){"use strict";a("bb6e")},b650c:function(e,t,a){},b678:function(e,t,a){},bb6e:function(e,t,a){},ea45:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("el-dialog",{class:{"title-center":e.titleCenter},attrs:{title:e.title,visible:void 0===e.value?e.visible:e.value,width:e.width,top:e.top,"append-to-body":"","show-close":!1,"close-on-click-modal":!1,"destroy-on-close":e.destroyOnClose},on:{"update:visible":function(t){void 0===e.value?e.visible:e.value=t}}},[t("i",{staticClass:"el-icon-close",on:{click:e.close}}),e._t("default"),t("div",{style:{textAlign:e.footerPosition},attrs:{slot:"footer"},slot:"footer"},[e.showCancelButton?t("el-button",{on:{click:e.close}},[e._v(e._s(e.cancelButtonText))]):e._e(),e._t("footerBtn"),t("el-button",{attrs:{type:"primary",loading:e.confirmLoading},on:{click:e.confirm}},[e._v(e._s(e.confirmButtonText))])],2)],2)},l=[],s={model:{prop:"value",event:"change"},props:{value:{type:void 0|Boolean},visible:{type:void 0|Boolean},titleCenter:{type:Boolean,default:!1},title:{type:String,required:!0},width:{type:String,default:"50%"},top:{type:void 0|String,default:void 0},confirmLoading:{type:Boolean,default:!1},confirmButtonText:{type:String,default:"确 认"},cancelButtonText:{type:String,default:"取 消"},showCancelButton:{type:Boolean,default:!0},footerPosition:{type:String,default:"center"},destroyOnClose:{type:Boolean,default:!0}},methods:{close(){void 0===this.value?this.$emit("close"):this.$emit("change",!1)},confirm(){this.$emit("confirm")}}},n=s,r=(a("b62e"),a("2877")),o=Object(r["a"])(n,i,l,!1,null,"1be2cb38",null);t["a"]=o.exports},f95b:function(e,t,a){"use strict";a("3591")}}]);