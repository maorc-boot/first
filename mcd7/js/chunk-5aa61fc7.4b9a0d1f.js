(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5aa61fc7"],{"68fd":function(e,t,a){},9499:function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogLoading,expression:"dialogLoading"}],attrs:{title:"预演计划详情",visible:e.visible,width:"960px",top:"5vh","before-close":e.handleClose,"append-to-body":"","destroy-on-close":!0},on:{"update:visible":function(t){e.visible=t}}},[t("el-form",{ref:"formRef",staticClass:"plan-detail",attrs:{model:e.previewDetail,"label-position":"right","label-width":"150px",size:"mini"}},[t("div",{staticClass:"information"},[t("div",{staticClass:"information__label"},[e._v("预演基础信息")])]),t("el-form-item",{attrs:{label:"预演ID:"}},[t("div",{staticClass:"plan-detail__value"},[e._v(e._s(e.previewDetail.code))])]),t("el-form-item",{attrs:{label:"预演名称:"}},[t("div",{staticClass:"plan-detail__value"},[e._v(e._s(e.previewDetail.name))])]),t("el-form-item",{attrs:{label:"创建人:"}},[t("div",{staticClass:"plan-detail__value"},[e._v(e._s(e.previewDetail.createUserName))])]),t("el-form-item",{attrs:{label:"创建时间:"}},[t("div",{staticClass:"plan-detail__value"},[e._v(e._s(e.previewDetail.createTime))])]),t("el-form-item",{attrs:{label:"预演策略数:"}},[t("div",{staticClass:"plan-detail__value"},[e._v(e._s(e.previewDetail.campsegNum)+" 个")])]),t("el-form-item",{attrs:{label:"预演客户规模:"}},[t("div",{staticClass:"plan-detail__value"},[e._v(e._s(e.previewDetail.previewCustomNum)+" 人")])]),t("el-form-item",{attrs:{label:"预演时间:"}},[t("div",{staticClass:"plan-detail__value"},[e._v(e._s(e.dateLabel))])]),t("div",{staticClass:"information"},[t("div",{staticClass:"information__label"},[e._v("预演结果")])]),t("el-button",{staticClass:"info-btn",attrs:{type:e.statusDetail.type}},[e._v(e._s(e.statusDetail.label))]),t("div",{staticClass:"information"},[t("div",{staticClass:"information__label"},[e._v("预演规则信息")])]),t("el-form-item",{attrs:{label:"特殊名单:"}},[t("el-checkbox-group",{staticClass:"plan-detail__value",attrs:{size:"mini"},model:{value:e.specialInfo,callback:function(t){e.specialInfo=t},expression:"specialInfo"}},e._l(e.previewDetail.specialInfoAll,(function(a,l){return t("el-checkbox",{key:l,attrs:{label:a.specialJsonStr,disabled:""}},[e._v(e._s(a.name))])})),1)],1),t("el-form-item",{attrs:{label:"业务规则:"}},[t("div",{staticClass:"plan-detail__value"},[t("el-checkbox",{attrs:{label:"频次过滤","true-label":1,"false-label":0,disabled:""},model:{value:e.previewDetail.fqc,callback:function(t){e.$set(e.previewDetail,"fqc",t)},expression:"previewDetail.fqc"}}),t("el-checkbox",{attrs:{label:"已订购","true-label":1,"false-label":0,disabled:""},model:{value:e.previewDetail.orderedFilter,callback:function(t){e.$set(e.previewDetail,"orderedFilter",t)},expression:"previewDetail.orderedFilter"}}),t("el-checkbox",{attrs:{label:"产品互斥","true-label":1,"false-label":0,disabled:""},model:{value:e.previewDetail.planExclusion,callback:function(t){e.$set(e.previewDetail,"planExclusion",t)},expression:"previewDetail.planExclusion"}})],1)]),t("el-form-item",{attrs:{label:"模型分析类型:"}},[t("div",{staticClass:"plan-detail__value"},[e._v(e._s(e.previewDetail.modelName||"-"))])]),t("div",{staticStyle:{"margin-top":"20px",width:"100%"}},[t("div",{staticClass:"information"},[t("div",{staticClass:"information__label"},[e._v("预演结果详情")])]),t("div",{staticClass:"info-title"},[e._v("触达量统计")]),t("el-table",{staticStyle:{width:"100%"},attrs:{data:[e.previewDetail]}},[t("el-table-column",{attrs:{label:"目标客户群规模",prop:"previewCustomNum",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"可营销用户数",prop:"targetCustomNum",align:"center","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(2===e.previewDetail.status?t.targetCustomNum:"-")+" ")]}}])})],1),t("div",{staticClass:"info-title"},[e._v("未触达分析")]),t("div",{staticClass:"plan-detail__filter-list"},e._l(e.filterList,(function(a,l){return t("div",{key:l,staticClass:"filter-item"},[t("div",{staticClass:"filter-item__label"},[e._v(e._s(a.label))]),t("div",{staticClass:"filter-item__value"},[e._v(e._s(e.filterListShow(e.previewDetail,a.prop)))])])})),0),e.previewDetail.modelInfos&&e.previewDetail.modelName?[t("div",{staticClass:"info-title"},[e._v(e._s(e.previewDetail.modelName)+"(用户数:万)")]),t("div",{staticClass:"plan-detail__filter-list"},e._l(e.previewDetail.modelInfos||[],(function(a,l){return t("div",{key:l,staticClass:"filter-item"},[t("div",{staticClass:"filter-item__label"},[e._v(e._s(a.name))]),t("div",{staticClass:"filter-item__value"},[e._v(e._s(2===e.previewDetail.status?a.num/1e4:"-"))])])})),0)]:e._e()],2),t("div",{staticStyle:{"margin-top":"20px",width:"100%"}},[t("div",{staticClass:"information no-after"},[t("div",{staticClass:"information__label"},[e._v("预演策略清单")])]),t("el-table",{staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:e.previewDetail.previewCampsegs||[],"row-key":"campsegId"},on:{"expand-change":e.handleExpandChange}},[t("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function({$index:a}){return[t("div",{staticClass:"inner-table"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.innerTableLoading,expression:"innerTableLoading"}],staticStyle:{width:"100%"},attrs:{data:e.innerTableData[a]}},e._l(e.innerColumns,(function(e){return t("el-table-column",{key:e.type,attrs:{prop:e.prop,label:e.label,width:e.width,"min-width":e.minWidth,"show-overflow-tooltip":""}})})),1)],1)]}}])}),t("el-table-column",{attrs:{formatter:e.campsegName,label:"策略编码及名称","min-width":"200",align:"left","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{formatter:e.executionCycle,label:"执行周期",width:"180",align:"left","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"campsegStatName",label:"策略状态",width:"70",align:"left"}}),t("el-table-column",{attrs:{prop:"customTotal",label:"目标客户数",width:"100",align:"left"}}),t("el-table-column",{attrs:{prop:"targetCustomTotal",label:"可营销客户数",width:"100",align:"left"},scopedSlots:e._u([{key:"default",fn:function({row:t}){return[e._v(" "+e._s(2===e.previewDetail.status?t.targetCustomTotal:"-")+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"70",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.goPage(a.row)}}},[e._v("预演结果")])]}}])})],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.closeDialog}},[e._v("关 闭")]),[0].includes(e.statusDetail.value)?t("el-button",{attrs:{disabled:!e.previewDetail.previewCampsegs,type:"primary"},on:{click:e.startPreview}},[e._v("开始预演")]):e._e(),[2,4].includes(e.statusDetail.value)?t("el-button",{attrs:{type:"primary"},on:{click:e.restartPreview}},[e._v("重新预演")]):e._e()],1)],1)},i=[],s=(a("14d9"),a("2b0e")),n=a("0fea"),r=a("5c96"),o=a("4ddc");function c(e,t){const a=Object(s["ref"])([]),l=Object(s["ref"])(!1),i=Object(s["ref"])([{prop:"id_name",label:"子策略编码及名称",minWidth:200},{prop:"channelName",label:"渠道",minWidth:100},{prop:"previewCustomNum",label:"客户群规模",minWidth:100},{prop:"targetCustomNum",label:"可营销客户",minWidth:100}]),r=Object(s["ref"])([]);function c(i){l.value=!0,Object(n["i"])("/preview-svc-group/api/fivePeriod/preview/previewResult",{campsegId:i,previewId:e,oldRecord:0}).then(e=>{const l=e.map(e=>({...e,targetCustomNum:2===t.value.status?e.targetCustomNum:"-",id_name:Object(o["c"])(e.childCampsegId,e.campsegName),executionCycle:Object(o["d"])(e.startTime,e.endTime)})),s=t.value.previewCampsegs.findIndex(e=>e.campsegId===i);a.value.splice(s,1,l)}).finally(()=>{l.value=!1})}function u(e,t){t.length<r.value.length?r.value=t:(r.value=t,c(e.campsegId))}return{innerTableData:a,innerColumns:i,innerTableLoading:l,currExpandedRows:r,getInnerTableData:c,handleExpandChange:u}}function u(){const e=Object(s["ref"])([]);function t(e){const t=e.toLowerCase().split("_"),a=t.map((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1));return a.join("")}function a(a){e.value=[];const l=a.specialInfoAll.map(e=>{const a=t(JSON.parse(e.specialJsonStr).field);return{label:e.name,prop:a}});e.value.push(...l);const i=[];for(let e=1;e<=10;e++)a[`defExtNum${e}Name`]&&i.push({prop:"defExtNum"+e,label:a[`defExtNum${e}Name`]});e.value.push(...i),e.value.length%3===2?e.value.push({}):e.value.length%3===1&&e.value.push({},{});const s=[{label:"频次过滤剔除",prop:"fqcNum"},{label:"已订购剔除",prop:"orderedFilterNum"},{label:"产品互斥剔除",prop:"planExclusionNum"}];e.value.push(...s)}function l(e,t){return t?2===e.status?e[t]:"-":""}return{filterList:e,handleFilterList:a,filterListShow:l}}var p=Object(s["defineComponent"])({name:"PlanDetail",props:{previewId:{type:Number||String,default:""}},setup(e,{emit:t}){const a=Object(s["ref"])(!1),l=Object(s["ref"])(null),i=Object(s["ref"])(!1);function p(e){e(),d()}function d(e){a.value=!1,setTimeout(()=>{t("closeDialog",e)},300)}const v=Object(s["ref"])({}),m=[{label:"待预演",type:"primary",value:0},{label:"预演中",type:"warning",value:1},{label:"预演完成",type:"success",value:2},{label:"预演中止",type:"info",value:3},{label:"预演失败",type:"danger",value:4}],f=Object(s["computed"])(()=>m.find(e=>e.value===v.value.status)||m[0]),b=Object(s["computed"])(()=>Object(o["d"])(v.value.startTime,v.value.endTime)),w=Object(s["computed"])(()=>v.value.specialInfo?JSON.parse(v.value.specialInfo).map(e=>JSON.stringify(e)):[]),{filterList:_,handleFilterList:g,filterListShow:h}=u();function C(){i.value=!0,Object(n["g"])("/preview-svc-group/api/jx/fivePeriod/preview/previewDetail/"+e.previewId).then(e=>{var t;const a=(null===(t=e.previewCampsegs)||void 0===t?void 0:t.length)||0;j.value=new Array(a).fill([]),v.value=e,g(e)}).finally(()=>{i.value=!1})}function D(e){return Object(o["c"])(e.campsegId,e.campsegName)}function x(e){return Object(o["f"])(e.startDate,e.endDate)}function y(e){d(),this.$router.push({path:"/MarketingPlanning/MarketingDetails",query:{campsegRootId:e.campsegId,backName:this.$router.currentRoute.name,goPreview:!0,tab:4}})}function N(){const e="确定要开始预演?";I(e)}function k(){const e="确定要重新预演?";I(e)}function I(t){i.value=!0,r["MessageBox"].confirm(t,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Object(n["g"])("/preview-svc-group/api/jx/fivePeriod/preview/restartPreviewPlan/"+e.previewId).then(()=>{r["Message"].success("预演成功"),setTimeout(()=>{d("refresh")},500)})}).finally(()=>{i.value=!1})}const{innerTableData:j,innerColumns:O,innerTableLoading:T,currExpandedRows:L,getInnerTableData:S,handleExpandChange:P}=c(e.previewId,v);return Object(s["onMounted"])(()=>{C(),Object(s["nextTick"])(()=>{a.value=!0})}),{dialogLoading:i,visible:a,formRef:l,handleClose:p,closeDialog:d,previewDetail:v,statusDetail:f,dateLabel:b,specialInfo:w,filterList:_,handleFilterList:g,filterListShow:h,campsegName:D,executionCycle:x,goPage:y,startPreview:N,restartPreview:k,innerTableData:j,innerColumns:O,innerTableLoading:T,currExpandedRows:L,getInnerTableData:S,handleExpandChange:P}}}),d=p,v=(a("dc9a"),a("2877")),m=Object(v["a"])(d,l,i,!1,null,"bff791a8",null);t["default"]=m.exports},dc9a:function(e,t,a){"use strict";a("68fd")}}]);