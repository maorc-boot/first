(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-69319d7a"],{"1d8a":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"avoid-bother-customer-wrap fe-m-24 fe-p-24 bg"},[t("div",{staticClass:"search_box"},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],staticClass:"input-search",attrs:{placeholder:"请输入角色名称查询",size:"small"},on:{change:function(t){return e.queryListByKeyword()}},model:{value:e.queryFrom.keyWords,callback:function(t){e.$set(e.queryFrom,"keyWords",t)},expression:"queryFrom.keyWords"}},[t("i",{staticClass:"el-input__icon el-icon-search cursor-pointer",attrs:{slot:"suffix"},on:{click:e.queryListByKeyword},slot:"suffix"})]),t("el-button",{attrs:{type:"success"},on:{click:e.roleAdd}},[e._v("新建")])],1),t("div",{staticClass:"list"},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[t("el-table-column",{attrs:{type:"index",label:"序号"}}),t("el-table-column",{attrs:{prop:"roleName",label:"角色名称","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"enName",label:"角色英文名称","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"roleDesc",label:"角色描述","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"department",label:"部门","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"delFlag",label:"删除标记","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"remarks",label:"备注","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-link",{staticClass:"text-sm mr-16",attrs:{type:"primary",underline:!1},on:{click:function(t){return e.lookHanlder(a.row)}}},[e._v("查看 ")]),t("el-link",{staticClass:"text-sm mr-16",attrs:{type:"primary",underline:!1},on:{click:function(t){return e.copyHanlder(a.row)}}},[e._v("复制角色 ")]),t("el-link",{staticClass:"text-sm mr-16",attrs:{type:"primary",underline:!1},on:{click:function(t){return e.editHanlder(a.row)}}},[e._v("编辑 ")]),t("el-link",{staticClass:"text-sm mr-16",attrs:{type:"primary",underline:!1},on:{click:function(t){return e.permissionHanlder(a.row)}}},[e._v("权限设置 ")]),t("el-popconfirm",{attrs:{placement:"top",icon:"el-icon-warning",iconColor:"#FAAD14",title:"确定删除？","cancel-button-type":"Primary"},on:{confirm:function(t){return e.deleteHanlder(a.row)}}},[t("el-link",{staticClass:"cursor-pointer text-sm",attrs:{slot:"reference",type:"danger",underline:!1},slot:"reference"},[e._v(" 删除")])],1)]}}])})],1)],1),t("div",{staticClass:"pager"},[t("el-pagination",{attrs:{"current-page":e.pageData.currentPage,"page-sizes":e.pageData.pageSizeList,"page-size":e.pageData.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pageData.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e.rowDialogVisible?t("role-dialog",{attrs:{dialogVisible:e.rowDialogVisible,dialogTitle:e.roleDialogTitle,operationType:e.operationType,rowData:e.rowData},on:{"update:dialogVisible":function(t){e.rowDialogVisible=t},"update:dialog-visible":function(t){e.rowDialogVisible=t},getRoleListData:e.getRoleListData}}):e._e(),e.permissionDialogVisible?t("permission-set-dialog",{attrs:{dialogVisible:e.permissionDialogVisible,dialogTitle:"权限设置",rowData:e.rowData,permissionData:e.permissionData},on:{"update:dialogVisible":function(t){e.permissionDialogVisible=t},"update:dialog-visible":function(t){e.permissionDialogVisible=t},getRoleListData:e.getRoleListData}}):e._e()],1)},i=[],l=a("0fea"),s=a("a454"),r=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,"before-close":e.closeHandler,width:"500px","append-to-body":""}},[t("div",{staticClass:"Contact-mtp"},[t("el-form",{ref:"roleFrom",staticStyle:{width:"400px"},attrs:{model:e.formData,"label-width":"100px",rules:e.rules}},[t("el-form-item",{attrs:{label:"角色名称",prop:"roleName"}},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{maxlength:"16",disabled:"look"===e.operationType},model:{value:e.formData.roleName,callback:function(t){e.$set(e.formData,"roleName",t)},expression:"formData.roleName"}})],1),t("el-form-item",{attrs:{label:"角色英文名称",prop:"enName"}},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{maxlength:"16",disabled:"look"===e.operationType},model:{value:e.formData.enName,callback:function(t){e.$set(e.formData,"enName",t)},expression:"formData.enName"}})],1),t("el-form-item",{attrs:{label:"部门",prop:"departmentId"}},[t("el-select",{attrs:{filterable:"",disabled:"look"===e.operationType,placeholder:"请选择"},model:{value:e.formData.departmentId,callback:function(t){e.$set(e.formData,"departmentId",t)},expression:"formData.departmentId"}},e._l(e.departmentArr,(function(e,a){return t("el-option",{key:a,attrs:{label:e.title,value:e.deptId}})})),1)],1),t("el-form-item",{staticClass:"remarks",attrs:{label:"角色描述",prop:"roleDesc"}},[t("el-input",{attrs:{type:"textarea",maxlength:"500",placeholder:"您可以输入500个字",disabled:"look"===e.operationType},model:{value:e.formData.roleDesc,callback:function(t){e.$set(e.formData,"roleDesc",t)},expression:"formData.roleDesc"}})],1),t("el-form-item",{staticClass:"remarks",attrs:{label:"备注",prop:"remark"}},[t("el-input",{attrs:{type:"textarea",maxlength:"500",placeholder:"您可以输入500个字",disabled:"look"===e.operationType},model:{value:e.formData.remarks,callback:function(t){e.$set(e.formData,"remarks",t)},expression:"formData.remarks"}})],1)],1)],1),"look"!=this.operationType?t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.closeHandler}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("保 存")])],1):e._e()])],1)},n=[],d={name:"RoleDialog",props:{dialogTitle:{type:String},dialogVisible:{type:Boolean,default:!1},operationType:{type:String,default:()=>"add"},rowData:{type:Object}},data(){return{formData:{},departmentArr:[],delFlagConfig:[{id:0,name:"正常"},{id:1,name:"逻辑删除"}],rules:{roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}],delFlag:[{required:!0,message:"请选择是否可用",trigger:"blur"}]}}},methods:{closeHandler(){this.$emit("update:dialogVisible",!1)},getSelectDepartmentData(){Object(l["i"])(s["a"].department.selectDepartmentData,{}).then(e=>{this.departmentArr=e})},getRoleInfo(){Object(l["i"])(s["a"].role.lookRoleInfo,{id:this.rowData.roleId}).then(e=>{e.delFlag=Number(e.delFlag),this.formData=e})},async addRoleInfo(){this.$refs["roleFrom"].validate(async e=>{e?await Object(l["i"])(s["a"].role.addRoleInfo,this.formData).then(e=>{this.$message.success("新增成功"),this.$emit("getRoleListData"),this.closeHandler()}):this.$alert("请填写必填项","校验失败",{confirmButtonText:"确定",customClass:"errorPrompt"})})},async copyRoleInfo(){this.$refs["roleFrom"].validate(async e=>{e?await Object(l["i"])(s["a"].role.addRoleInfo,this.formData).then(e=>{this.$message.success("复制成功"),this.$emit("getRoleListData"),this.closeHandler()}):this.$alert("请填写必填项","校验失败",{confirmButtonText:"确定",customClass:"errorPrompt"})})},async editRoleInfo(){this.$refs["roleFrom"].validate(async e=>{e?(this.formData.roleId=this.rowData.roleId,await Object(l["i"])(s["a"].role.editRoleInfo,this.formData).then(e=>{this.$message.success("编辑成功"),this.$emit("getRoleListData"),this.closeHandler()})):this.$alert("请填写必填项","校验失败",{confirmButtonText:"确定",customClass:"errorPrompt"})})},submit(){"add"===this.operationType?this.addRoleInfo():"copy"===this.operationType?this.copyRoleInfo():this.editRoleInfo()}},created(){this.getSelectDepartmentData(),"look"!==this.operationType&&"edit"!==this.operationType||this.getRoleInfo()}},c=d,p=(a("e7c2"),a("2877")),m=Object(p["a"])(c,r,n,!1,null,"1d0fc69d",null),h=m.exports,u=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,"before-close":e.closeHandler,width:"700px","append-to-body":""}},[t("div",{staticClass:"Contact-mtp"},[t("p",{staticClass:"title"},[t("span",{staticClass:"span1"},[e._v("名称")]),t("span",{staticClass:"span2"},[e._v("权限标识")]),t("span",{staticClass:"span3"},[e._v("权限类型")])]),t("el-tree",{ref:"organizationTree",staticStyle:{width:"100%"},attrs:{data:e.permissionData,"show-checkbox":"","node-key":"id","default-checked-keys":e.defaultKeys,"default-expand-all":!1,"render-content":e.renderContent},on:{"check-change":e.handleCheckChange}})],1),"look"!=this.operationType?t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.closeHandler}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("保 存")])],1):e._e()])],1)},f=[],g=(a("14d9"),a("f9ae")),y={name:"PermissionSetDialog",props:{dialogTitle:{type:String},dialogVisible:{type:Boolean,default:!1},operationType:{type:String,default:()=>"add"},rowData:{type:Object},permissionData:{type:Array}},data(){return{checkedIds:"",showCheckedIds:[],data:[],defaultKeys:[]}},watch:{showCheckedIds(e){this.defaultKeys=[],e.forEach(e=>{this.defaultKeys.push(String(e))})}},mounted(){},methods:{closeHandler(){this.$emit("update:dialogVisible",!1)},renderContent(e,{node:t,data:a,store:o}){return e("span",{class:"custom-tree-node"},[e("span",{style:"width:120px;display:block;"},[t.label]),e("el-tooltip",{attrs:{effect:"dark",placement:"top-start"}},[e("template",{slot:"content"},[a.perm]),e("span",{style:"width:130px;display:block;white-space: nowrap;text-overflow: ellipsis;overflow: hidden;"},[a.perm])]),e("span",{style:"width:80px;display:block;"},[1===a.type?"接口":2===a.type?"按钮":"菜单"])])},fomatter(e,t){const a=[];return e.forEach(e=>{t.forEach(o=>{e.children?this.fomatter(e.children,t):e.id===o.id&&a.push(e.id)})}),a},async getPermissionDataByRole(){await Object(l["i"])(s["a"].menu.getPermissionDataByRole,{id:this.rowData.roleId}).then(e=>{let t=[],a=[];for(let i in e)0===e[i].length?a.push(i):t.push(e[i]);t.push(a);var o=[].concat.apply([],t);this.$nextTick(()=>{let e=[];o.forEach(t=>{e.push(String(t))}),this.defaultKeys=e}),this.$forceUpdate()})},findAllParentId(e){let t=[];function a(e,t){let o=null;return t.forEach(t=>{if(t.id===e)o=t;else if(t.children&&t.children.length){let i=a(e,t.children);i&&(o=i)}}),o}function o(e,i){let l=a(e,i);l&&(t.push(l.id),l.pid&&o(l.pid,i))}return t.push(e.pid),o(e.pid,this.permissionData),t},handleCheckChange:function(e,t,a){let o=this.$refs.organizationTree.getCheckedNodes(),i=[],l=[];o.length&&o.forEach(e=>{i.push(e.id),l=l.concat(this.findAllParentId(e))}),l=Array.from(new Set(l)),this.showCheckedIds=i,this.checkedIds=[...new Set(i.concat(l))].join(",")},submit:Object(g["a"])((function(){Object(l["i"])(s["a"].menu.saveRolePermission,{id:this.rowData.roleId,permissionIds:this.checkedIds}).then(e=>{this.$message.success("设置成功"),this.closeHandler()})}))},created(){this.getPermissionDataByRole()}},b=y,D=(a("84c1"),Object(p["a"])(b,u,f,!1,null,"56ce83ba",null)),w=D.exports,k={name:"RoleManage",components:{RoleDialog:h,PermissionSetDialog:w},data(){return{operationType:"add",rowDialogVisible:!1,permissionDialogVisible:!1,rowData:{},queryFrom:{keyWords:""},pageData:{currentPage:1,pageSize:10,pageSizeList:[10,20,30,40],total:0},total:0,loading:!1,roleDialogTitle:"",tableData:[],permissionData:[],options:[]}},created(){this.getRoleListData(),this.getPermissionTree()},methods:{initializationFrom(){this.queryFrom.current=1},queryApproveInfo(){this.getRoleListData()},queryListByKeyword(){this.pageData.currentPage=1,this.queryApproveInfo()},async getRoleListData(){this.loading=!0,await Object(l["i"])(s["a"].role.getRoleList,{keyWords:this.queryFrom.keyWords,current:this.pageData.currentPage,size:this.pageData.pageSize}).then(e=>{this.tableData=e.records,this.pageData.total=e.total,this.loading=!1,this.initializationFrom()})},roleAdd(){this.rowDialogVisible=!0,this.roleDialogTitle="添加角色",this.operationType="add"},copyHanlder(e){this.rowDialogVisible=!0,this.roleDialogTitle="复制角色",this.operationType="copy",this.rowData={mids:e.mids,pids:e.pids}},lookHanlder(e){this.rowDialogVisible=!0,this.roleDialogTitle="查看角色",this.operationType="look",this.rowData=e},editHanlder(e){this.rowDialogVisible=!0,this.roleDialogTitle="编辑角色",this.operationType="edit",this.rowData=e},permissionHanlder(e){this.permissionDialogVisible=!0,this.rowData=e},deleteHanlder(e){Object(l["i"])(s["a"].role.deleteRoleList,{id:e.roleId}).then(e=>{this.$message({type:"success",message:"删除成功!"}),this.getRoleListData()})},getPermissionTree(){Object(l["i"])(s["a"].menu.getPermissionTree).then(e=>{this.permissionData=e})},handleSizeChange(e){this.pageData.pageSize=e,this.queryApproveInfo()},handleCurrentChange(e){this.pageData.currentPage=e,this.queryApproveInfo()}},mounted(){}},v=k,C=Object(p["a"])(v,o,i,!1,null,"7dd53d9a",null);t["default"]=C.exports},"59fa":function(e,t,a){},"84c1":function(e,t,a){"use strict";a("da0a")},da0a:function(e,t,a){},e7c2:function(e,t,a){"use strict";a("59fa")}}]);