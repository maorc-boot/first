(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7df54beb"],{"0301":function(e,t,a){},"0918":function(e,t,a){},"0d9a":function(e,t,a){"use strict";a("d51e")},"0ed7":function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){return o}));var i=a("0fea"),s=a("cdbb");async function l(e){return Object(i["i"])(s["a"].getScriptPreview+"?scriptId="+e)}async function r(e){return Object(i["i"])(s["a"].clickScript+"?scriptId="+e)}async function o(){const e=await Object(i["g"])(s["a"].getTermRule);return e}},"0f53":function(e,t,a){},1574:function(e,t,a){},"17e3":function(e,t,a){},"1b3c":function(e,t,a){"use strict";a("8fc5")},"1bd8":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("BaseDialog",{attrs:{title:"话术预览",visible:e.dialogVisible,width:"1000px",top:"5vh","confirm-button-text":"关 闭","show-cancel-button":!1},on:{confirm:e.close,close:e.close},scopedSlots:e._u([e.enableEvaluate&&e.form.scriptId?{key:"footerBtn",fn:function(){return[t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.evaluteVisible=!0}}},[e._v("评价")]),t("el-button",{attrs:{type:"warning",loading:e.likeLoading},on:{click:e.like}},[e._v("点赞")])]},proxy:!0}:null],null,!0)},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"label-width":"120px"}},[t("el-form-item",{attrs:{label:"话术名称："}},[e._v(" "+e._s(e.form.scriptName)+" ")]),t("el-form-item",{attrs:{label:"产品编码/名称："}},[e.form.planId?t("span",[e._v(" "+e._s(e.form.planId+" "+e.form.planName)+" ")]):e._e()]),t("el-form-item",{attrs:{label:"话术类型："}},[e._v(" "+e._s(e.form.scriptTypeName)+" ")]),t("el-form-item",{attrs:{label:"应用渠道："}},[e._v(" "+e._s(e.form.channelName)+" ")]),t("el-form-item",{attrs:{label:"运营位："}},[e._v(" "+e._s(e.form.adivName)+" ")]),"2"===e.form.scriptType?t("el-form-item",{attrs:{label:"应用地市："}},[e._v(" "+e._s(e.form.cityName)+" ")]):e._e(),t("el-form-item",{attrs:{label:"内容类型："}},[e._v(" "+e._s(e.form.contentTypeName)+" ")]),t("el-form-item",{attrs:{label:"话术内容："}},[t("MarketingWordsPreview",{attrs:{marketingWords:e.form.marketingWords||[]}})],1)],1),e.enableEvaluate?t("EvaluateDialog",{attrs:{currentRow:e.form,dialogVisible:e.evaluteVisible},on:{"update:dialogVisible":function(t){e.evaluteVisible=t},"update:dialog-visible":function(t){e.evaluteVisible=t}}}):e._e()],1)},s=[],l=a("ea45"),r=a("2102"),o=a("571b"),n=a("0ed7"),c=a("5a4a"),p=a("ac7c"),d={components:{BaseDialog:l["a"],MarketingWordsPreview:r["a"],EvaluateDialog:o["a"]},props:{dialogVisible:{type:Boolean,default:!1},id:{type:String|Number,default:""},enableEvaluate:{type:Boolean,default:!1}},watch:{dialogVisible(e){e?this.getScriptInfo():this.$nextTick(()=>{this.form={}})}},data(){return{loading:!1,form:{},evaluteVisible:!1,likeLoading:!1}},methods:{async getScriptInfo(){try{var e,t;this.loading=!0;const a=await Object(n["b"])(this.id);a.contentTypeName=null===(e=p["a"].find(e=>e.value==a.contentType))||void 0===e?void 0:e.label,a.scriptTypeName=null===(t=p["j"].find(e=>e.value==a.scriptType))||void 0===t?void 0:t.label,this.form=Object(c["c"])(a)}catch(a){this.form={}}finally{this.loading=!1}},async like(){try{this.likeLoading=!0;const e=await Object(n["c"])(this.form.scriptId);this.$message.success(e.message)}catch(e){}finally{this.likeLoading=!1}},close(){this.$emit("update:dialogVisible",!1)}}},u=d,m=(a("c0ec"),a("2877")),h=Object(m["a"])(u,i,s,!1,null,"836eb7b0",null);t["a"]=h.exports},"1c81":function(e,t,a){"use strict";a("5ebf")},"1d25":function(e,t,a){},"1f58":function(e,t,a){"use strict";a("1574")},2102:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"script-container"},[t("el-form",e._l(e.marketingWords,(function(a,i){var s;return t("el-form-item",{key:i,attrs:{label:e.marketingWords.length>1?a.typeName+"：":"","label-width":e.marketingWords.length>1?"100px":"10px"}},[a.list&&a.list.length?e._l(a.list,(function(a){return t("div",{key:a.name},[t("header",[e._v("【"+e._s(a.name)+"】")]),t("div",{domProps:{innerHTML:e._s(a.content)}})])})):e._e(),a.uploadType||null!==(s=a.list)&&void 0!==s&&s.length?e._e():t("span",[e._v(e._s(a.content))]),a.uploadType?[t("Upload",{attrs:{"is-view":!0,type:"1"==a.uploadType?"image":"2"==a.uploadType?"video":"3"==a.uploadType?"audio":"image"},model:{value:e.marketingWords[i],callback:function(t){e.$set(e.marketingWords,i,t)},expression:"marketingWords[i]"}}),t("div",{staticClass:"link"},[t("span",[e._v("跳转链接：")]),t("el-link",{attrs:{underline:!1,href:a.linkUrl,target:"_blank"}},[e._v(e._s(a.linkUrl))])],1)]:e._e()],2)})),1)],1)},s=[],l=a("eae4"),r={components:{Upload:l["a"]},props:{marketingWords:{type:Array,default:()=>[]}}},o=r,n=(a("327a"),a("2877")),c=Object(n["a"])(o,i,s,!1,null,"4a48a557",null);t["a"]=c.exports},"24a9":function(e,t,a){"use strict";a("2df0")},"26f4":function(e,t,a){},"2c43":function(e,t,a){},"2cf1":function(e,t,a){},"2df0":function(e,t,a){},"2ec76":function(e,t,a){"use strict";a("d946")},"319d":function(e,t,a){},"327a":function(e,t,a){"use strict";a("0918")},3382:function(e,t,a){"use strict";a("8144")},3923:function(e,t,a){"use strict";a("0301")},4927:function(e,t,a){},"4b3d":function(e,t,a){"use strict";a("26f4")},"4ce3":function(e,t,a){"use strict";a("1d25")},"4d78":function(e,t,a){"use strict";a("2cf1")},"571b":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("BaseDialog",{attrs:{title:`话术评价【${e.currentRow.scriptName}】`,visible:e.dialogVisible,width:"500px",top:"25vh","confirm-button-text":"提 交","show-cancel-button":!1,"confirm-loading":e.loading},on:{confirm:e.submit,close:e.close}},[t("el-form",{ref:"ruleForm",attrs:{model:e.form}},e._l(e.form,(function(a,i){return t("el-form-item",{key:i,attrs:{label:e.keyMap.get(i),prop:i,rules:[{required:!0,validator:e.validate,trigger:"change"}]}},[t("el-rate",{attrs:{"show-text":"",max:5,colors:e.colors,texts:e.texts},model:{value:e.form[i],callback:function(t){e.$set(e.form,i,t)},expression:"form[key]"}})],1)})),1)],1)},s=[],l=(a("d9e2"),a("0fea")),r=a("cdbb"),o=a("ea45"),n={components:{BaseDialog:o["a"]},props:{dialogVisible:{type:Boolean,default:!1},currentRow:{type:Object,default:()=>({})}},watch:{dialogVisible(e){if(!e){this.$refs.ruleForm.clearValidate();for(const e in this.form)this.form.hasOwnProperty(e)&&(this.form[e]=null)}}},data(){return{loading:!1,keyMap:new Map([["syxStarNumber","实用性"],["tyxStarNumber","通用性"],["zqxStarNumber","准确性"]]),form:{syxStarNumber:null,tyxStarNumber:null,zqxStarNumber:null},colors:["#99A9BF","#67a6e7","#2F87EC"],texts:["很差","差","一般","满意","优秀"]}},methods:{validate(e,t,a){const i=this.keyMap.get(e.field);t<1?a(new Error(`请对${i}进行星级评价`)):a()},submit(){this.$refs.ruleForm.validate(async e=>{if(e)try{this.loading=!0;const e={...this.form,scriptId:this.currentRow.scriptId,scriptName:this.currentRow.scriptName};await Object(l["i"])(r["a"].getScriptAppraise,e);this.$message.success("评价成功"),this.$emit("refresh"),this.$nextTick(()=>{this.close()})}catch(t){}finally{this.loading=!1}})},close(){this.$emit("update:dialogVisible",!1)}}},c=n,p=(a("d6bd"),a("2877")),d=Object(p["a"])(c,i,s,!1,null,"3b927ad5",null);t["a"]=d.exports},"5ebf":function(e,t,a){},"72ae":function(e,t,a){"use strict";const i="/mcd-cep-web/action",s="/evt-svc/api";t["a"]={ecapi:{queryEventClass:i+"/cep/rule/nx/queryEventClass.do",queryEventDictByDictCode:i+"/cep/rule/nx/queryEventDictByDictCode.do",queryParentDictByDictCode:i+"/cep/rule/nx/queryParentDictByDictCode.do",queryConfigDict:i+"/cep/rule/nx/queryConfigDict.do",queryEventClassLevel:i+"/cep/rule/queryEventClass.do",queryCepRuleNum:i+"/cep/rule/queryCepRuleNum.do",createRule:i+"/cep/rule/nx/createRule.do",manageList:s+"/event/list",manageUpdateStatus:s+"/event/updateStatus",manageDelete:s+"/event",manageListByParent:s+"/businessCategory/listByParent",manageListByLevel:s+"/businessCategory/listByLevel",manageCategoryList:s+"/businessCategory/list",manageGetDetail:s+"/event",eventSave:s+"/event/save",eventListByLevel:s+"/category/listByLevel",eventListByParent:s+"/category/listByParent",areaList:s+"/area/list",areaGetDetail:s+"/area",areaDelete:s+"/area",areaSave:s+"/area/save",areaStationList:s+"/area/stationList",stationList:s+"/station/list",listByCategory:s+"/categoryValue/listByCategory",queryEventsByUserId:"/plan-svc/api/action/cep/event/eventManager/queryEventsByUserId",queryShareById:"/plan-svc/cepRuleShare/queryShareById",saveOrUpdate:"/plan-svc/cepRuleShare/saveOrUpdate",delCampCoordinationTaskList:"/plan-svc/mcd/strategic/coordination/delCampCoordinationTaskList",exportExampleFile:"/plan-svc/mcd/strategic/coordination/exportExampleFile",pushCampCoordinationFile:"/plan-svc/mcd/strategic/coordination/pushCampCoordinationFile",queryCampCoordinationTask:"/plan-svc/mcd/strategic/coordination/queryCampCoordinationTask",queryStrategicCoordination:"/plan-svc/mcd/strategic/coordination/queryStrategicCoordination",saveStrategicCoordinationTask:"/plan-svc/mcd/strategic/coordination/saveStrategicCoordinationTask",selectAllStrategicCoordination:"/plan-svc/mcd/strategic/coordination/selectAllStrategicCoordination",recountCampTask:"/plan-svc/mcd/strategic/coordination/recountCampTask",queryCampCoordinationTaskDetail:"/plan-svc/mcd/strategic/coordination/queryCampCoordinationTaskDetail",childTaskRecord:"/plan-svc/mcd/strategic/coordination/childTaskRecord",approveTaskRecord:"/plan-svc/api/campCoordinate/taskApprove/approveTaskRecord",approveChildTaskRecord:"/plan-svc/api/campCoordinate/taskApprove/approveChildTaskRecord",subTaskApprove:"/plan-svc/api/campCoordinate/taskApprove/subTaskApprove",updateTaskStatus:"/plan-svc/api/campCoordinate/taskApprove/updateTaskStatus",queryAppTypeList:"/approve-svc/jx/cmpApprovalProcessConf/queryAppTypeList",getApproveConfig:"/approve-svc/jx/cmpApprovalProcessConf/getApproveConfig?systemId=",getNodeApprover:"/approve-svc/jx/cmpApproveProcessInstance/getNodeApprover",submitProcess:"/approve-svc/jx/cmpApproveProcessInstance/submitProcess",delPlanConfList:"/plan-svc/mcd/strategic/coordination/delPlanConfList",qryNotCfgPlanTypeAndPri:"/plan-svc/mcd/strategic/coordination/qryNotCfgPlanTypeAndPri",qryPlanConfList:"/plan-svc/mcd/strategic/coordination/qryPlanConfList",qryPlanConfListByPlanTypeOnSave:"/plan-svc/mcd/strategic/coordination/qryPlanConfListByPlanTypeOnSave",qryPlanConfListByPlanTypeOnUpdate:"/plan-svc/mcd/strategic/coordination/qryPlanConfListByPlanTypeOnUpdate",qryPlanTypeList:"/plan-svc/mcd/strategic/coordination/qryPlanTypeList",savePlanConf:"/plan-svc/mcd/strategic/coordination/savePlanConf",updatePriority:"/plan-svc/mcd/strategic/coordination/updatePriority",getSysDics:"/plan-svc/action/iop/common/getSysDics",delTagConfig:"/plan-svc/orchestrate/tag/delTagConfig",queryAccessLabel:"/plan-svc/orchestrate/tag/queryAccessLabel",queryTag:"/plan-svc/orchestrate/tag/queryTag",queryTagType:"/plan-svc/orchestrate/tag/queryTagType",saveTag:"/plan-svc/orchestrate/tag/saveTag",updateTagOrderBy:"/plan-svc/orchestrate/tag/updateTagOrderBy",queryAllTag:"/plan-svc/orchestrate/tag/queryAllTag"}}},"75c8":function(e,t,a){},"7f64":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"沟通",visible:e.dialogVisible,width:"502px","append-to-body":"","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"communicationForm",attrs:{model:e.form,"label-width":"110px"}},[t("el-form-item",{attrs:{label:"沟通人意见：",prop:"advice",rules:[{required:!0,message:"请输入沟通人意见",trigger:"blur"}]}},[t("el-input",{attrs:{type:"textarea",rows:4},model:{value:e.form.advice,callback:function(t){e.$set(e.form,"advice",t)},expression:"form.advice"}})],1),t("el-form-item",{attrs:{label:"转发人意见："}},e._l(e.communicationTaskList,(function(a){return t("div",{staticClass:"communication"},[t("div",{staticClass:"title"},[t("span",[e._v(e._s(a.approverName||"-"))]),e._v("   "),t("span",[e._v(e._s(a.dealTime))])]),t("div",{staticClass:"content"},[t("span",[e._v(e._s(a.dealOpinion))])])])})),0)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:e.submit}},[e._v("提 交")])],1)],1)},s=[],l=a("0fea"),r=a("31b1"),o={name:"CommunicationApprove",props:{approvalType:{type:String,default:""}},data(){return{dialogVisible:!1,form:{advice:"",approvalUser:"",approvalUserName:"",instanceId:"",nodeId:"",processId:"",serviceType:""},ApprovalForm:{},nodeInfo:{},communicationTaskList:[],submitLoading:!1}},methods:{ShowPopup(e){this.ApprovalForm=e,this.communicationTaskList=[],this.queryCommunicationTask(),this.form={...this.form,advice:""},this.nodeInfo={},this.dialogVisible=!0},async getNodeInfo(){try{const e=await Object(l["i"])(r["a"].channel.getNextApprovers,{instanceId:this.ApprovalForm.instanceId,nodeId:this.ApprovalForm.nodeId,serviceType:this.ApprovalForm.businessId});this.nodeInfo=e,this.queryCommunicationTask()}catch(e){}},async queryCommunicationTask(){try{const e=await Object(l["i"])(r["a"].channel.queryCommunicationTask,{businessId:this.ApprovalForm.businessId,instanceId:this.ApprovalForm.instanceId,nodeId:this.ApprovalForm.nodeId,serviceType:this.ApprovalForm.businessId,submitter:this.ApprovalForm.approver});this.communicationTaskList=e}catch(e){}},submit(){this.$refs["communicationForm"].validate(async e=>{if(e){this.form.approvalUser=sessionStorage.getItem("userId"),this.form.approvalUserName=sessionStorage.getItem("userNameCn"),this.form.instanceId=this.ApprovalForm.instanceId,this.form.nodeId=this.ApprovalForm.nodeId,this.form.processId=this.ApprovalForm.processId,this.form.serviceType=this.ApprovalForm.businessId,this.form.systemId=this.approvalType,this.submitLoading=!0;try{await Object(l["i"])(r["a"].channel.communicationAppTask,this.form);this.$message.success("提交成功"),this.dialogVisible=!1,this.$emit("refresh")}catch(t){}finally{this.submitLoading=!1}}})}}},n=o,c=(a("4ce3"),a("2877")),p=Object(c["a"])(n,i,s,!1,null,"122cf13c",null);t["a"]=p.exports},8144:function(e,t,a){},8436:function(e,t,a){"use strict";a("ea90")},8504:function(e,t,a){},"855e":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{top:"8vh",width:"50%",title:e.dialogTitle,visible:e.dialogVisible,"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("i",{staticClass:"el-icon-close",on:{click:function(t){return e.$emit("update:dialogVisible",!1)}}}),t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ruleForm",attrs:{model:e.form,rules:e.rules,"label-width":"140px"}},[t("el-form-item",{attrs:{label:"消息类型：",prop:"msgSmsPlat"}},[t("el-select",{attrs:{disabled:"",placeholder:"请选择消息类型"},model:{value:e.form.msgSmsPlat,callback:function(t){e.$set(e.form,"msgSmsPlat",t)},expression:"form.msgSmsPlat"}},[t("el-option",{attrs:{value:"hmh5",label:"普通短信"}}),t("el-option",{attrs:{value:"daiwei",label:"代维短信"}})],1)],1),t("el-form-item",{attrs:{label:"模板类型：",prop:"templateType"}},[t("el-select",{attrs:{placeholder:"请选择模板类型",disabled:!e.isEdit},model:{value:e.form.templateType,callback:function(t){e.$set(e.form,"templateType",t)},expression:"form.templateType"}},[t("el-option",{attrs:{value:"生日祝福",label:"生日祝福"}}),t("el-option",{attrs:{value:"佳节祝福",label:"佳节祝福"}}),t("el-option",{attrs:{value:"友情提醒",label:"友情提醒"}}),t("el-option",{attrs:{value:"紧急通知",label:"紧急通知"}}),"hmh5"==e.form.msgSmsPlat?t("el-option",{attrs:{value:"作战地图",label:"作战地图"}}):e._e()],1)],1),t("el-form-item",{attrs:{label:"模板内容：",prop:"templateContent"}},[t("el-input",{ref:"inputRef",attrs:{disabled:!e.isEdit,type:"textarea",maxlength:"500","show-word-limit":"",rows:6},on:{blur:e.locatingPosition},model:{value:e.form.templateContent,callback:function(t){e.$set(e.form,"templateContent",t)},expression:"form.templateContent"}})],1),t("el-form-item",{attrs:{label:"营销用语替换变量："}},[t("div",{staticClass:"var-operation"},e._l(e.varList,(function(a){return t("div",{key:a.attrCol,class:["tag",{active:a.active},{disabled:a.disabled}],attrs:{title:a.attrCol},on:{click:function(t){return e.replaceVariable(a)}}},[e._v(e._s(a.attrColName))])})),0)]),"daiwei"===e.form.msgSmsPlat?[t("el-form-item",{attrs:{label:"关联客群标签："}},[e.isEdit?t("el-select",{attrs:{multiple:"",placeholder:"请选择关联客群标签"},model:{value:e.labelCodeList,callback:function(t){e.labelCodeList=t},expression:"labelCodeList"}},e._l(e.tagList,(function(e){return t("el-option",{key:e.labelCode+e.labelName,attrs:{value:e.labelCode,label:e.labelName}})})),1):t("span",[e._v(e._s(e.labelNames||"-"))])],1)]:e._e(),t("el-form-item",{attrs:{label:"有效期：",prop:"validDeadLine"}},[t("el-date-picker",{attrs:{disabled:!e.isEdit,type:"date",placeholder:"请选择日期",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd"},model:{value:e.form.validDeadLine,callback:function(t){e.$set(e.form,"validDeadLine",t)},expression:"form.validDeadLine"}})],1)],2),e.showApproveRecord?t("div",{staticClass:"approve-content"},[t("div",{staticClass:"approval-title"},[e._v("审批流程")]),20==e.form.approvalStatus?t("el-empty",{attrs:{description:"暂无审批记录"}}):t("Approve",{attrs:{businessId:e.templateCode,type:"作战地图"===e.form.templateType?"BATTLE_MAP":"MESSAGE_TEMPLATE"}})],1):e._e(),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.isEdit?t("el-button",{on:{click:function(t){return e.$emit("update:dialogVisible",!1)}}},[e._v("取 消")]):e._e(),t("el-button",{attrs:{type:"primary",loading:e.saveLoading},on:{click:e.submitForm}},[e._v(e._s(e.isEdit?"确 认":"关 闭"))])],1)],1)},s=[],l=(a("14d9"),a("0fea")),r=a("89ff"),o=a("8331"),n={props:{dialogVisible:{type:Boolean,default:!1},templateCode:{type:String,default:""},isEdit:{type:Boolean,default:!1}},components:{Approve:o["a"]},data(){return{dialogTitle:"新增模板",loading:!1,saveLoading:!1,source:null,form:{templateContent:"尊敬的$GLOBAL_LEVEL$客户，",msgSmsPlat:sessionStorage.getItem("roleIds").includes("888")?"daiwei":"hmh5",templateType:"生日祝福",validDeadLine:""},rules:{templateContent:[{required:!0,message:"请输入短信模板内容",trigger:"change"}],msgSmsPlat:[{required:!0,message:"请选择消息类型",trigger:"change"}],templateType:[{required:!0,message:"请选择模板类型",trigger:"change"}],validDeadLine:[{required:!0,message:"请选择有效期",trigger:"change"}]},varList:[],tagList:[],labelCodeList:[],labelNames:"",showApproveRecord:!1,wordPosition:0}},watch:{dialogVisible(e){e?(this.varList.length||this.getVarList(),this.tagList.length||this.getTagList(),this.templateCode?(this.dialogTitle=this.isEdit?"编辑模板":"查看模板",this.getDetail()):(this.dialogTitle="新增模板",this.$nextTick(()=>{this.$refs.inputRef.$el.querySelector("textarea").focus()}))):(this.form={templateContent:"尊敬的$GLOBAL_LEVEL$客户，",msgSmsPlat:sessionStorage.getItem("roleIds").includes("888")?"daiwei":"hmh5",templateType:"生日祝福",validDeadLine:""},this.labelCodeList=[],this.labelNames="",this.$refs.ruleForm.resetFields(),this.showApproveRecord=!1,this.saveLoading&&this.source.cancel("取消请求"))},"form.templateType"(e,t){e&&t&&("作战地图"!==e&&"作战地图"!==t||this.getVarList())}},methods:{async getDetail(){try{this.loading=!0;const e=await Object(l["i"])(r["a"].messageTemplate.getCareSmsTemplateDetail,{id:this.templateCode});"daiwei"===e.msgSmsPlat&&this.getLabelListByTemplateId(),this.showApproveRecord=!0,this.form=e,this.varList.length&&(this.varList.forEach(e=>{e.active=this.form.templateContent.includes("$"+e.attrCol+"$")}),this.$forceUpdate())}catch(e){}finally{this.loading=!1}},async getLabelListByTemplateId(){try{const e=await Object(l["g"])(r["a"].messageTemplate.getRelaLabels,{smsTemplateCode:this.templateCode});this.labelCodeList=e.map(e=>e.labelCode),this.labelNames=e.map(e=>e.labelName).join("，")}catch(e){}},async getVarList(){try{this.varList=[];const e=await Object(l["i"])(r["a"].messageTemplate.getCustGroupVars,{templateType:this.form.templateType||"生日祝福",smsType:this.form.msgSmsPlat});let t=[];this.form.templateCode&&(t=this.form.templateContent.split("$").filter(e=>e)),this.varList=e.map(e=>({attrCol:e.attrCol,attrColName:e.attrColName,disabled:"CUSTOMER_TITLE"===e.attrCol,active:t.some(t=>t===e.attrCol)}))}catch(e){}finally{this.varList.length>0&&this.varList.push({attrCol:"GLOBAL_LEVEL",attrColName:"全球通等级",disabled:!0,active:!0})}},locatingPosition(){this.wordPosition=this.$refs.inputRef.$el.querySelector("textarea").selectionStart},delay(e){return new Promise(t=>{setTimeout(()=>{t()},e)})},async replaceVariable(e){if(!this.isEdit)return;if(e.disabled)return;const t=e.attrCol;await this.delay(50),this.wordPosition?this.form.templateContent=this.form.templateContent.slice(0,this.wordPosition)+"$"+t+"$"+this.form.templateContent.slice(this.wordPosition):this.form.templateContent+="$"+t+"$",e.active=!0,this.wordPosition=this.wordPosition+t.length+2;const a=this.$refs.inputRef.$el.querySelector("textarea");a.focus(),this.$nextTick(()=>{a.setSelectionRange(this.wordPosition,this.wordPosition)})},async getTagList(){try{const e=await Object(l["i"])(r["a"].messageTemplate.getLabelListDaiwei);this.tagList=e}catch(e){}},submitForm(){this.isEdit?this.$refs["ruleForm"].validate(async e=>{if(e){this.source=this.$CancelToken.source();try{this.saveLoading=!0;const e=await Object(l["i"])(r["a"].messageTemplate.saveCareSmsTemplate,this.form,this.source.token);"daiwei"===this.form.msgSmsPlat&&await Object(l["i"])(r["a"].messageTemplate.saveOrUpdateRela,{smsTemplateCode:this.form.templateCode||e,labelCodes:this.labelCodeList.join(",")},this.source.token),this.$message.success(this.isEdit?"修改成功":"新增成功"),this.$emit("refresh"),this.$emit("update:dialogVisible",!1)}catch(t){}finally{this.saveLoading=!1}}}):this.$emit("update:dialogVisible",!1)}}},c=n,p=(a("ee24"),a("2877")),d=Object(p["a"])(c,i,s,!1,null,"0072d5e7",null);t["a"]=d.exports},"8fc5":function(e,t,a){},"9d33":function(e,t,a){},a85a:function(e,t,a){"use strict";a("8504")},bf66:function(e,t,a){"use strict";a("319d")},c0ec:function(e,t,a){"use strict";a("17e3")},d212:function(e,t,a){"use strict";const i="/mcd-eval/action",s="/plan-svc/api",l="/element-svc/api";t["a"]={effectAppraisal:{queryActServiceTypeInfo:i+"/effectEvaluate/activity/queryActServiceTypeInfo.do",queryUserCityInfo:i+"/effectEvaluate/activity/queryUserCityInfo.do",queryChannelInfo:i+"/effectEvaluate/activity/queryChannelInfo.do",queryPlanTypeInfo:i+"/effectEvaluate/activity/queryPlanTypeInfo.do",queryActServiceTypeIndicatorInfo:i+"/effectEvaluate/activity/queryActServiceTypeIndicatorInfo.do",saveViewIndicatorInfo:i+"/effectEvaluate/activity/saveViewIndicatorInfo.do",listCampInfo:i+"/effectEvaluate/activity/listCampInfo.do",listPlanInfo:i+"/effectEvaluate/product/listPlanInfo.do",channelOrSceneAppraise:i+"/appraisal/channelOrSceneAppraise.do",pagelist:s+"/singleUser/pagelist",queryPage:"/eval-svc/eval5g/queryPage",export:"/eval-svc/eval5g/export",queryPageCloud:"/eval-svc/eval/5gcloud/queryPage",export5gCloudEvalListData:"/eval-svc/eval/5gcloud/export5gCloudEvalListData",exportIvr:"/eval-svc/reportIvr/export",queryPageIvr:"/eval-svc/reportIvr/queryPage",querySystemUsageCityList:s+"/action/systemUsage/querySystemUsageCityList",querySystemUsageDeptList:s+"/action/systemUsage/querySystemUsageDeptList",querySystemUsagePersonageList:s+"/action/systemUsage/querySystemUsagePersonageList",getUsageCityDetailList:s+"/action/systemUsage/getUsageCityDetailList",getUsageDeptDetailList:s+"/action/systemUsage/getUsageDeptDetailList",getUsagePersonageDetailList:s+"/action/systemUsage/getUsagePersonageDetailList",exportReport:"/eval-svc/report/export",queryPageReport:"/eval-svc/report/queryPage",batchDeleteMaterial:l+"/mcdDimMaterial/jx/batchDeleteMaterial",deleteMaterial:l+"/mcdDimMaterial/jx/deleteMaterial",getIntelligentMatchingMaterialList:l+"/mcdDimMaterial/jx/getIntelligentMatchingMaterialList",getMaterial:l+"/mcdDimMaterial/jx/getMaterial",loadImage:l+"/mcdDimMaterial/jx/loadImage",materialImportTemplateDownload:l+"/mcdDimMaterial/jx/materialImportTemplateDownload",queryChannel:l+"/mcdDimMaterial/jx/queryChannel",queryContact:l+"/mcdDimMaterial/jx/queryContact",queryMaterialPageList:l+"/mcdDimMaterial/jx/queryMaterialPageList",queryPosition:l+"/mcdDimMaterial/jx/queryPosition",removeMaterialById:l+"/mcdDimMaterial/jx/removeMaterialById",saveOrUpdateMaterial:l+"/mcdDimMaterial/jx/saveOrUpdateMaterial",updateMaterialStatus:l+"/mcdDimMaterial/jx/updateMaterialStatus",uploadMaterialPicture:l+"/mcdDimMaterial/jx/uploadMaterialPicture",uploadMaterialsFile:l+"/mcdDimMaterial/jx/uploadMaterialsFile",uploadMaterialVideo:l+"/mcdDimMaterial/jx/uploadMaterialVideo",exportMaterialsFile:l+"/mcdDimMaterial/jx/exportMaterialsFile",queryChart:"/eval-svc/home/eval/queryChart",monthEffect:"/eval-svc/home/eval/month/effect",dayEffect:"/eval-svc/home/eval/day/effect",getTacticsListByCityId:"/eval-svc/home/eval/getTacticsListByCityId",queryChannelRadarMap:"/eval-svc/eval/queryChannelRadarMap",queryMonitor:"/plan-svc/api/monitor/queryMonitor",getCaliberInfo:"/plan-svc/api/kpi/getCaliberInfo",updateCaliberInfo:"/plan-svc/api/kpi/updateCaliberInfo",queryChannelEval:"/eval-svc/evaluate/channel/jx/list",exportChannelEval:"/eval-svc/evaluate/channel/jx/exportChannelEval",campEval:"/eval-svc/eval/campEval",exportActivityEval:"/eval-svc/eval/export",exportEffectEval:"/eval-svc/effect/eval/exportEffectEval",getDetailByDrillDownType:"/eval-svc/effect/eval/getDetailByDrillDownType",queryEffectEvalAllCount:"/eval-svc/effect/eval/queryEffectEvalAllCount",gridExport:"/eval-svc/smart/grid/eval/export",gridEval:"/eval-svc/smart/grid/eval/gridEval",exportSmsSendHistory:"/plan-svc/mcd/sms/send/exportSmsSendHistory",querySmsSendHistory:"/plan-svc/mcd/sms/send/querySmsSendHistory",querySmsSendMonitory:"/plan-svc/mcd/sms/send/querySmsSendMonitory",smsSendHistoryTask:"/plan-svc/mcd/sms/send/smsSendHistoryTask",smsSendMonitorTask:"/plan-svc/mcd/sms/send/smsSendMonitorTask",smsSendTaskPause:"/plan-svc/mcd/sms/send/smsSendTaskPause",queryTask:"/plan-svc/mcd-camp-import-task/queryTask",batchImportCamp:"/plan-svc/mcd-camp-import-task/batchImportCamp",successRate:"/eval-svc/eval/home/successRate",sucess:"/eval-svc/eval/home/sucess",total:"/eval-svc/eval/home/total",dw88Camp:"/eval-svc/mcd/onlinel/report/dw88Camp",dwHeigh88City:"/eval-svc/mcd/onlinel/report/dwHeigh88City",getDateTime:"/eval-svc/mcd/onlinel/report/getDateTime",onlineReportDataExport:"/eval-svc/mcd/onlinel/report/onlineReportDataExport",stCamp85CityDm:"/eval-svc/mcd/onlinel/report/stCamp85CityDm",stCamp85HdDm:"/eval-svc/mcd/onlinel/report/stCamp85HdDm",stCamp86CityDm:"/eval-svc/mcd/onlinel/report/stCamp86CityDm",stCamp86HdDm:"/eval-svc/mcd/onlinel/report/stCamp86HdDm",qryTermEval:"/mkt-term-svc/api/qryTermEval"}}},d22d:function(e,t,a){"use strict";a("4927")},d51e:function(e,t,a){},d6bd:function(e,t,a){"use strict";a("9d33")},d946:function(e,t,a){},e274:function(e,t,a){"use strict";a("0f53")},ea90:function(e,t,a){},eae4:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("transition-group",{attrs:{name:"top-from"}},[e.fileInfo.uploadFileUrl||e.isView?t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],key:"2",staticClass:"file-container"},[e.isView?e._e():t("i",{staticClass:"el-icon-close",on:{click:e.removeFile}}),t("div",{staticClass:"file-info"},[t("el-row",[t("span",[e._v("名称：")]),t("span",{staticClass:"text"},[e._v(e._s(e.fileInfo.uploadFileName))])]),t("el-row",[t("span",[e._v("尺寸：")]),t("span",[e._v(e._s(e.fileInfo.fileSize))])])],1),t("div",{staticClass:"file-view"},["image"===e.type?t("el-image",{attrs:{src:e.fileInfo.fileSrc,"preview-src-list":[e.fileInfo.fileSrc],fit:"fill"}}):e._e()],1)]):t("div",{key:"1",staticClass:"script-upload"},[t("el-upload",{attrs:{action:"/",accept:e.typeInfo.accept,multiple:e.multiple,"show-file-list":!1,"before-upload":e.beforeUpload,"http-request":e.uploadFile}},[t("div",{staticClass:"upload-content"},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v("点击上传"+e._s(e.typeInfo.typeName))]),t("div",{staticClass:"el-upload__info"},[e._v(e._s(e.typeInfo.tip))])])]),e.showProgress?[t("el-progress",{staticClass:"upload-progress",attrs:{percentage:e.progress,"stroke-width":2,status:e.uploadStatus,"text-inside":""}}),t("span",[e._v(e._s(e.progress+"%"))])]:e._e()],2)])},s=[],l=(a("88a7"),a("271a"),a("5494"),a("0fea")),r=a("d39c"),o={model:{prop:"fileObj",event:"change"},props:{isView:{type:Boolean,default:!1},type:{type:String,validator(e){return-1!==["image","video","audio"].indexOf(e)},default:"image"},action:{type:String,default:"/mkt-term-svc/api/uploadScriptMaterial"},multiple:{type:Boolean,default:!1},fileObj:{type:Object,default:()=>{}}},computed:{typeInfo(){switch(this.type){case"image":return{accept:"image/*",typeName:"图片",size:10485760,tip:"文件大小不能超过10M，支持jpg、jpeg、png格式"};case"video":return{accept:"video/*",typeName:"视频",size:104857600,tip:"文件大小不能超过100M，支持mp4、avi、rmvb格式"};case"audio":return{accept:"audio/*",typeName:"音频",size:10485760,tip:"文件大小不能超过10M，支持mp3、wav格式"}}}},data(){return{loading:!1,fileInfo:{uploadFileName:"",uploadFileUrl:"",fileSrc:"",fileSize:""},showProgress:!1,progress:0,uploadStatus:null}},methods:{handleFile(e){if("image"===this.type){const t=new Image;t.src=window.URL.createObjectURL(e),t.onload=()=>{this.fileInfo.fileSize=`${t.width} × ${t.height}`,this.fileInfo.uploadFileName=e.name,this.fileInfo.fileSrc=window.URL.createObjectURL(e)}}if("video"===this.type||"audio"===this.type){this.fileInfo.uploadFileName=e.name,this.fileInfo.fileSrc=window.URL.createObjectURL(e);const t=document.createElement(this.type);t.preload="metadata",t.onloadedmetadata=()=>{window.URL.revokeObjectURL(t.src),this.fileInfo.fileSize=Math.floor(t.duration)+"s"}}},beforeUpload(e){if(e.size>this.typeInfo.size)return this.$message.error(`${this.typeInfo.typeName}大小不能超过${this.typeInfo.size/1024/1024}M, 请重新选择${this.typeInfo.typeName}`),!1;this.handleFile(e)},async uploadFile(e){try{this.showProgress=!0,this.progress=0,this.uploadStatus=null;const t=new FormData;t.append("file",e.file);const{resourceUrl:a}=await Object(l["j"])(this.action,t,this.uploadProgressEvent);this.fileInfo.uploadFileUrl=a;let i={...this.fileInfo};delete i.fileSrc,this.$emit("change",i),this.showProgress=!1,this.progress=0}catch(t){this.uploadStatus="exception",setTimeout(()=>{this.showProgress=!1},1e3)}},uploadProgressEvent(e){this.progress=Math.floor(100*e.loaded/e.total)},removeFile(){this.fileInfo.uploadFileUrl="",this.fileInfo.uploadFileName="",this.fileInfo.fileSrc="",this.fileInfo.fileSize="",this.$emit("change",this.fileInfo)},async setFileInfo(){try{this.loading=!0;const{data:e}=await Object(l["b"])(r["a"].seapi.downloadChanPromptFile,{fileUrlAndName:this.fileInfo.uploadFileUrl}),t=new Blob([e],{type:e.type});this.fileInfo.fileSrc=URL.createObjectURL(t);const a=new File([t],this.fileInfo.uploadFileName||this.fileInfo.uploadFileName||"",{type:e.type});this.handleFile(a)}catch(e){}finally{this.loading=!1}}},created(){this.fileInfo={...this.fileInfo,...this.fileObj},this.fileInfo.uploadFileUrl&&this.setFileInfo()}},n=o,c=(a("f9b4"),a("2877")),p=Object(c["a"])(n,i,s,!1,null,"73835c26",null);t["a"]=p.exports},ee24:function(e,t,a){"use strict";a("2c43")},ee72:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"product-container"},[t("el-tabs",{attrs:{type:"card"},model:{value:e.tabActive,callback:function(t){e.tabActive=t},expression:"tabActive"}},[t("el-tab-pane",{attrs:{label:"审批",name:"approve",lazy:!0}},[t("Approve1")],1),e.showYuezhi?t("el-tab-pane",{attrs:{label:"阅知",name:"content",lazy:!0}},[t("ReadAbout")],1):e._e(),t("el-tab-pane",{attrs:{label:"预警",name:"scene",lazy:!0}},[t("EarlyWarning")],1),t("el-tab-pane",{attrs:{label:"驳回",name:"reject",lazy:!0}},[t("RejectList")],1)],1)],1)},s=[],l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"template-wrap-content"},[t("div",{staticClass:"top-edit-part"},[t("div",{staticClass:"search-input"},[t("label",[e._v("审批类型：")]),t("el-select",{staticStyle:{width:"160px"},attrs:{placeholder:"请选择",filterable:""},on:{change:e.changeApprovalType},model:{value:e.query.approvalType,callback:function(t){e.$set(e.query,"approvalType",t)},expression:"query.approvalType"}},e._l(e.appTypeList,(function(e){return t("el-option",{key:e.enumKey,attrs:{label:e.enumValue,value:e.enumKey}})})),1)],1),t("div",{staticClass:"search-input"},[t("label",[e._v("业务对象：")]),t("el-input",{staticStyle:{width:"160px !important"},attrs:{placeholder:"请输入业务对象"},on:{input:e.debounceQueryChange},model:{value:e.query.keyWords,callback:function(t){e.$set(e.query,"keyWords",t)},expression:"query.keyWords"}})],1),e.query.approvalType.includes("_")?e._e():t("div",{staticClass:"search-input"},[t("label",[e._v("渠道：")]),t("el-select",{staticStyle:{width:"160px"},attrs:{placeholder:"请选择",filterable:"",clearable:"",disabled:"TASK"===e.query.approvalType},on:{change:e.changeChannel},model:{value:e.query.channelId,callback:function(t){e.$set(e.query,"channelId",t)},expression:"query.channelId"}},e._l(e.channelList,(function(e){return t("el-option",{key:e.channelId,attrs:{label:e.channelName,value:e.channelId}})})),1)],1),"IMCD"===e.query.approvalType?t("div",{staticClass:"search-input"},[t("label",[e._v("节点：")]),t("el-select",{staticStyle:{width:"160px"},attrs:{placeholder:"请选择",filterable:"",clearable:""},on:{change:e.changeNode},model:{value:e.nodeId_processId,callback:function(t){e.nodeId_processId=t},expression:"nodeId_processId"}},e._l(e.nodeList,(function(e){return t("el-option",{key:e.nodeId+e.processId,attrs:{label:e.nodeName,value:e.nodeId+"_"+e.processId}})})),1)],1):e._e(),t("div",{staticClass:"search-input"},[t("label",[e._v("创建人：")]),t("el-input",{staticStyle:{width:"160px"},attrs:{placeholder:"请输入创建人"},on:{input:e.debounceQueryChange},model:{value:e.query.creator,callback:function(t){e.$set(e.query,"creator",t)},expression:"query.creator"}})],1),"MATERIAL"===e.query.approvalType?t("div",{staticClass:"search-input"},[t("label",[e._v("素材类型：")]),t("el-select",{staticStyle:{width:"160px"},attrs:{placeholder:"请选择"},on:{change:e.searchData},model:{value:e.query.materialType,callback:function(t){e.$set(e.query,"materialType",t)},expression:"query.materialType"}},[t("el-option",{attrs:{label:"图片",value:"0"}}),t("el-option",{attrs:{label:"文字",value:"1"}}),t("el-option",{attrs:{label:"视频",value:"2"}})],1)],1):e._e(),"IMCD"===e.query.approvalType?t("div",{staticClass:"search-input"},[t("label",[e._v("场景：")]),t("el-input",{staticStyle:{width:"160px !important"},attrs:{placeholder:"请输入场景编号或名称"},on:{input:e.debounceQueryChange},model:{value:e.query.sceneKey,callback:function(t){e.$set(e.query,"sceneKey",t)},expression:"query.sceneKey"}})],1):e._e(),t("div",{staticClass:"btn-op"},["IMCD"===e.query.approvalType&&e.canBatch?t("el-button",{attrs:{plain:"",type:"primary"},on:{click:e.batchApprove}},[e._v("批量审批")]):e._e(),t("el-button",{attrs:{icon:"el-icon-refresh"},on:{click:e.reset}},[e._v("重置")]),t("el-button",{attrs:{type:"primary"},on:{click:e.searchData}},[e._v("查询")])],1)]),"IMCD"===e.query.approvalType?t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"imcdTableRef",staticClass:"template-table",staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"",height:500,"row-key":"id"},on:{select:e.selectCamp,"select-all":e.selectCampListCurrentPage}},[e.canBatch?t("el-table-column",{attrs:{type:"selection",selectable:e.selectableHandle,width:"55"}}):e._e(),t("el-table-column",{attrs:{type:"index",label:"序号"}}),t("el-table-column",{attrs:{prop:"serviceName",label:"待审批活动",width:"450","header-align":"center","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-link",{attrs:{type:"primary"},on:{click:function(t){return e.goDetail(a.row.campsegId)}}},[e._v(" "+e._s(a.row.campsegId)+" "+e._s(a.row.campsegName)+" ")])]}}],null,!1,593328040)}),t("el-table-column",{attrs:{prop:"nodeName",label:"节点名称","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{prop:"type",label:"类型","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{prop:"sceneName",label:"所属场景","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{prop:"createUserId",label:"提交人","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{prop:"createTime",label:"提交时间","header-align":"center",align:"center","show-overflow-tooltip":!0}}),t("el-table-column",{attrs:{label:"操作",width:"150",align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.Approval(a.row)}}},[e._v(" "+e._s(0==a.row.communicationState?"沟通":"审批")+" ")])]}}],null,!1,3399253891)})],1):e._e(),"MATERIAL"===e.query.approvalType?t("MaterialTable",{attrs:{tableData:e.tableData,loading:e.loading}}):e._e(),"TERM"===e.query.approvalType?t("ScriptTable",{attrs:{tableData:e.tableData,loading:e.loading,channelList:e.channelList}}):e._e(),"TASK"===e.query.approvalType?t("TongchouTable",{attrs:{tableData:e.tableData,loading:e.loading}}):e._e(),"APP_ALARM"===e.query.approvalType||"CUSTOM_LABEL"===e.query.approvalType?t("CustomWarnTable",{attrs:{tableData:e.tableData,loading:e.loading}}):e._e(),"MESSAGE_TEMPLATE"===e.query.approvalType||"BATTLE_MAP"===e.query.approvalType?t("MessageTemplateTable",{attrs:{tableData:e.tableData,loading:e.loading}}):e._e(),"HMH5_BLACKLIST"===e.query.approvalType?t("BlackListTable",{attrs:{tableData:e.tableData,loading:e.loading}}):e._e(),t("el-pagination",{attrs:{"current-page":e.query.current,"page-sizes":[10,20,30,40],"page-size":e.query.size,"pager-count":5,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),t("approval-dialog",{ref:"approval",attrs:{approvalType:e.query.approvalType},on:{refresh:e.refresh}}),t("CommunicationApprove",{ref:"communicationApprove",attrs:{approvalType:e.query.approvalType},on:{refresh:e.refresh}}),t("BatchApprove",{ref:"batchApp",attrs:{approvalType:e.query.approvalType},on:{refresh:e.refresh}})],1)},r=[],o=(a("14d9"),a("0fea")),n=a("d370"),c=a("d212"),p=a("31b1"),d=a("72ae"),u=a("cdbb"),m=a("89ff"),h=a("f9ae"),v=a("efed"),g=function(){var e=this,t=e._self._c;return t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tTable",staticClass:"template-table",staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"",height:500}},[t("el-table-column",{attrs:{type:"index",label:"序号"}}),t("el-table-column",{attrs:{prop:"materialName",label:"素材名称",width:"120","header-align":"center",align:"center","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-link",{attrs:{type:"primary",href:"#/ProductPolicy/MaterialDetail?materialId="+a.row.materialId}},[e._v(" "+e._s(a.row.materialName)+" ")])]}}])}),t("el-table-column",{attrs:{label:"类型","header-align":"center",align:"center"}},[[t("span",[e._v("素材")])]],2),t("el-table-column",{attrs:{prop:"nodeName",label:"节点名称",align:"center"}}),t("el-table-column",{attrs:{prop:"userName",label:"提交人",align:"center"}}),t("el-table-column",{attrs:{prop:"createTime",label:"提交时间",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.$parent.Approval(a.row)}}},[e._v("审批")])]}}])})],1)},y=[],f={name:"MaterialTable",props:["loading","tableData"],data(){return{}},methods:{}},b=f,I=(a("0d9a"),a("2877")),T=Object(I["a"])(b,g,y,!1,null,"8707cc84",null),C=T.exports,w=function(){var e=this,t=e._self._c;return t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tTable",staticClass:"template-table",staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"",height:500}},[t("el-table-column",{attrs:{type:"expand"},on:{"expand-change":e.handleExpandChange},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("div",{staticStyle:{padding:"0 10px"}},[t("InnerTable",{ref:"innerTable"+a.taskId,attrs:{id:a.taskId},on:{"selection-change":e.onSelectionChange,"destory-child":e.destoryChild,approve:e.approve}})],1)]}}])}),t("el-table-column",{attrs:{type:"index",label:"序号"}}),t("el-table-column",{attrs:{prop:"taskName",label:"任务名称",width:"120",align:"center","show-overflow-tooltip":!0}}),t("el-table-column",{attrs:{prop:"customTotalNum",label:"客户总数",align:"center"}}),t("el-table-column",{attrs:{prop:"planTotalNum",label:"产品总数",align:"center"}}),t("el-table-column",{attrs:{prop:"approverName",label:"提交人",align:"center"}}),t("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.batchApprove(a.row)}}},[e._v("批量审批")])]}}])})],1)},k=[],q=function(){var e=this,t=e._self._c;return t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",attrs:{data:e.tableData},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"60"}}),e._l(e.columnList,(function(e){return t("el-table-column",{key:e.prop,attrs:{prop:e.prop,label:e.label,width:e.width||"auto","min-width":e.minWidth||"auto",align:"center","show-overflow-tooltip":""}})})),t("el-table-column",{attrs:{label:"操作",width:"170",align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.approve(a)}}},[e._v("审批")])]}}])})],2)},_=[],L={props:{id:{type:Number|String}},watch:{refresh(){this.getTableData()}},data(){return{loading:!1,columnList:[{prop:"taskId",label:"任务子编号"},{prop:"tagName",label:"标签名称"},{prop:"tagId",label:"标签编号"},{prop:"custTypeName",label:"客户类型"},{prop:"customTotalNum",label:"客户数"},{prop:"planTotalNum",label:"产品数"},{prop:"orderBy",label:"优先级"}],tableData:[],multipleSelection:[]}},methods:{async getTableData(){try{this.loading=!0;const e=await Object(o["i"])(d["a"].ecapi.approveChildTaskRecord,{id:this.id});this.tableData=e}catch(e){}finally{this.loading=!1}},handleSelectionChange(e){this.multipleSelection=e,this.$emit("selection-change",this.multipleSelection,this.id)},clearSelection(){this.$refs.multipleTable.clearSelection()},approve(e){this.$emit("approve",e)}},created(){this.getTableData()},destroyed(){this.$emit("destory-child",this.id)}},D=L,x=Object(I["a"])(D,q,_,!1,null,"3e9f41a8",null),S=x.exports,N={name:"TongchouTable",props:["loading","tableData"],components:{InnerTable:S},data(){return{expandedRows:[],selectChildren:{}}},methods:{approve(e){let t=this.tableData.find(t=>t.taskId==e.taskPId),a=e.taskId,i={...t,childBusinessId:a};this.$parent.Approval(i)},handleExpandChange(e,t){this.expandedRows=t},onSelectionChange(e,t){this.selectChildren[t]=e;for(let a of this.expandedRows)if(a.taskId!=t){let e="innerTable"+a.taskId;this.$refs[e].clearSelection(),this.selectChildren[a.taskId]=[]}},batchApprove(e){let t=this.selectChildren[e.taskId]||[];if(0==t.length)return void this.$message({message:"请先选择子任务",type:"warning"});let a=t.map(e=>e.taskId).join(","),i={...e,childBusinessId:a};this.$parent.Approval(i)},destoryChild(e){this.onSelectionChange([],e)}}},A=N,F=(a("1f58"),Object(I["a"])(A,w,k,!1,null,"55a65d6c",null)),$=F.exports,P=function(){var e=this,t=e._self._c;return t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tTable",staticClass:"template-table",staticStyle:{width:"100%"},attrs:{data:e.tableList,stripe:"",height:500}},[t("el-table-column",{attrs:{type:"index",label:"序号"}}),e._l(e.columnList,(function(a){return t("el-table-column",{key:a.prop,attrs:{label:a.label,width:a.width||"auto","min-width":a.minWidth||"auto",align:"center","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function({row:i}){return["scriptName"!==a.prop?t("span",[e._v(e._s(i[a.prop]))]):t("el-link",{attrs:{type:"primary",underline:!1},on:{click:function(t){return e.showDialog(i.scriptId)}}},[e._v(e._s(i.scriptName))])]}}],null,!0)})})),t("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.$parent.Approval(a.row)}}},[e._v("审批")])]}}])}),t("ScriptViewDialog",{attrs:{"dialog-visible":e.dialogVisible,id:e.scriptId},on:{"update:dialogVisible":function(t){e.dialogVisible=t},"update:dialog-visible":function(t){e.dialogVisible=t}}})],2)},M=[],j=a("ac7c"),O=a("1bd8"),E={props:["loading","tableData","channelList"],components:{ScriptViewDialog:O["a"]},watch:{tableData:{handler(e){this.tableList=e.map(e=>{var t,a,i;return{...e,scriptTypeName:null===(t=j["j"].find(t=>t.value==e.scriptType))||void 0===t?void 0:t.label,contentTypeName:null===(a=j["a"].find(t=>t.value==e.contentType))||void 0===a?void 0:a.label,channelName:null===(i=j["f"].find(t=>t.value==e.channelId))||void 0===i?void 0:i.label}})},deep:!0}},data(){return{columnList:[{label:"话术名称",prop:"scriptName"},{label:"话术类型",prop:"scriptTypeName"},{label:"产品名称",prop:"planName"},{label:"应用渠道",prop:"channelName"},{label:"内容类型",prop:"contentTypeName"},{label:"提交人",prop:"createUserName"},{label:"提交时间",prop:"createDate"}],tableList:[],scriptId:"",dialogVisible:!1}},methods:{showDialog(e){this.scriptId=e,this.dialogVisible=!0}}},R=E,U=(a("e274"),Object(I["a"])(R,P,M,!1,null,"55f9675c",null)),V=U.exports,z=a("7f64"),B=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"批量审批",visible:e.dialogVisible,width:"500px","append-to-body":"","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{attrs:{"label-width":"120px"}},[t("el-form-item",{attrs:{label:"审批结果：",prop:"submitStatus"}},[t("el-radio-group",{model:{value:e.form.submitStatus,callback:function(t){e.$set(e.form,"submitStatus",t)},expression:"form.submitStatus"}},[t("el-radio",{attrs:{label:1}},[e._v("通过")]),t("el-radio",{attrs:{label:0}},[e._v("驳回")])],1)],1),t("el-form-item",{attrs:{label:"审批意见：",rules:[{required:0==e.form.submitStatus,message:"请输入审批意见",trigger:"blur"}]}},[t("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入审批意见"},model:{value:e.form.dealOpinion,callback:function(t){e.$set(e.form,"dealOpinion",t)},expression:"form.dealOpinion"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",loading:e.approveLoading},on:{click:function(t){return e.submit(!1)}}},[e._v("提 交")])],1)],1)},W=[],K={props:{approvalType:{type:String,default:""}},data(){return{dialogVisible:!1,approveLoading:!1,source:null,form:{submitStatus:1,dealOpinion:""},approveList:[]}},methods:{openDialog(e){this.approveList=e,this.dialogVisible=!0,this.form.dealOpinion=""},async submit(e=!1){const t=sessionStorage.getItem("userId"),a=this.approveList.map(e=>({createUser:t,nodeId:e.nodeId,businessId:e.businessId,instanceId:e.instanceId,processId:e.processId,recordId:e.id,systemId:this.approvalType,status:this.form.submitStatus,dealOpinion:this.form.dealOpinion}));this.approveLoading&&this.source.cancel("取消请求"),this.source=this.$CancelToken.source();try{this.approveLoading=!0;await Object(o["i"])(n["a"].mpapi.batchSubmit,a,this.source.token,this.$retryDelay);this.$message.success("审批成功"),this.$emit("refresh"),this.dialogVisible=!1}catch(s){var i;null!==(i=s.message)&&void 0!==i&&i.includes("timeout")&&!0!==e&&this.submit(!0)}finally{this.approveLoading=!1}},cancel(){this.approveLoading&&this.source.cancel("取消请求"),this.dialogVisible=!1}}},H=K,Q=Object(I["a"])(H,B,W,!1,null,"1371f1c3",null),G=Q.exports,J=function(){var e=this,t=e._self._c;return t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tTable",staticClass:"template-table",staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"",height:500}},[t("el-table-column",{attrs:{type:"index",label:"序号"}}),t("el-table-column",{attrs:{label:"预警ID及名称",width:"450",align:"center","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-link",{attrs:{type:"primary"},on:{click:function(t){return e.openDialog(a.businessId)}}},[e._v(" "+e._s(a.businessId)+" "+e._s(a.campsegName)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"nodeName",label:"节点名称",align:"center"}}),t("el-table-column",{attrs:{label:"类型","header-align":"center",align:"center"}},[[t("span",[e._v("预警")])]],2),t("el-table-column",{attrs:{prop:"userName",label:"提交人",align:"center"}}),t("el-table-column",{attrs:{prop:"createTime",label:"提交时间",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.$parent.Approval(a.row)}}},[e._v("审批")])]}}])}),t("AddEdit",{attrs:{title:"自定义预警详情",dialogVisible:e.showDetailDialog,id:e.alarmId,isEdit:!1,isEditThreshold:!1},on:{"update:dialogVisible":function(t){e.showDetailDialog=t},"update:dialog-visible":function(t){e.showDetailDialog=t}}})],1)},Y=[],X=a("946d"),Z={name:"CustomWarnTable",components:{AddEdit:X["a"]},props:["loading","tableData"],data(){return{showDetailDialog:!1,alarmId:null}},methods:{openDialog(e){this.alarmId=e,this.$nextTick(()=>{this.showDetailDialog=!0})}}},ee=Z,te=(a("3382"),Object(I["a"])(ee,J,Y,!1,null,"e400562c",null)),ae=te.exports,ie=function(){var e=this,t=e._self._c;return t("div",[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tTable",staticClass:"template-table",staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"",height:"calc(100vh - 300px)"}},[t("el-table-column",{attrs:{type:"index",label:"序号"}}),t("el-table-column",{attrs:{label:"模版编码",width:"120","header-align":"center",align:"center","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.openDialog(a)}}},[e._v(e._s(a.templateCode))])]}}])}),t("el-table-column",{attrs:{prop:"type",label:"模板类型","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{prop:"nodeName",label:"节点名称",align:"center"}}),t("el-table-column",{attrs:{prop:"userName",label:"提交人",align:"center"}}),t("el-table-column",{attrs:{prop:"createTime",label:"提交时间",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.$parent.Approval(a.row)}}},[e._v("审批")])]}}])})],1),t("AddEdit",{attrs:{templateCode:e.currentRow.businessId,isEdit:!1,dialogVisible:e.showAddDialog},on:{"update:dialogVisible":function(t){e.showAddDialog=t},"update:dialog-visible":function(t){e.showAddDialog=t}}})],1)},se=[],le=a("855e"),re={name:"MessageTemplateTable",props:["loading","tableData"],components:{AddEdit:le["a"]},data(){return{currentRow:{},showAddDialog:!1}},methods:{openDialog(e){this.currentRow=e,this.showAddDialog=!0}}},oe=re,ne=(a("4d78"),Object(I["a"])(oe,ie,se,!1,null,"169cc9ec",null)),ce=ne.exports,pe=function(){var e=this,t=e._self._c;return t("div",{staticClass:"black-table"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tTable",staticClass:"template-table",staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"",height:"calc(100vh - 300px)"}},[t("el-table-column",{attrs:{type:"index",label:"序号"}}),t("el-table-column",{attrs:{label:"任务编号",width:"165","header-align":"center",align:"center","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.openDialog(a.row)}}},[e._v(e._s(a.row.taskId))])]}}])}),t("el-table-column",{attrs:{label:"任务名称",prop:"taskName","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{prop:"nodeName",label:"节点名称",align:"center"}}),t("el-table-column",{attrs:{prop:"userName",label:"提交人",align:"center"}}),t("el-table-column",{attrs:{prop:"createTime",label:"提交时间",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.$parent.Approval(a.row)}}},[e._v("审批")])]}}])})],1),t("BaseDialog",{attrs:{title:"黑名单导入任务详情",width:"600px",showCancelButton:!1,confirmButtonText:"关闭"},on:{confirm:function(t){e.visible=!1}},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.detailLoading,expression:"detailLoading"}],attrs:{"label-width":"120px","label-suffix":"："}},[t("el-form-item",{attrs:{label:"任务编号"}},[t("span",[e._v(e._s(e.form.taskId))])]),t("el-form-item",{attrs:{label:"任务名称"}},[t("span",[e._v(e._s(e.form.taskName))])]),t("el-form-item",{attrs:{label:"导入人数"}},[t("span",[e._v(e._s(e.form.userNum))])]),t("el-form-item",{attrs:{label:"创建人"}},[t("span",[e._v(e._s(e.form.createUserName))])]),t("el-form-item",{attrs:{label:"导入附件"}},[t("el-link",{attrs:{type:"primary",underline:!1},on:{click:e.downloadFile}},[e._v(e._s(e.form.taskFileName))])],1)],1)],1)],1)},de=[],ue=a("5af3"),me=a("ea45"),he={name:"BlackListTable",props:["loading","tableData"],components:{BaseDialog:me["a"]},data(){return{visible:!1,detailLoading:!1,form:{}}},methods:{openDialog(e){this.visible=!0,this.detailLoading=!0,this.form={taskId:e.taskId,taskName:e.taskName,createUserName:e.userName},Object(o["i"])(m["a"].blackList.getTaskDetailByTaskId,{id:e.taskId}).then(e=>{this.form=e}).catch(()=>{}).finally(()=>{this.detailLoading=!1})},downloadFile(){Object(ue["b"])(this.form.taskFileName,this.form.taskFileName)}}},ve=he,ge=(a("bf66"),Object(I["a"])(ve,pe,de,!1,null,"435d09f9",null)),ye=ge.exports,fe={components:{ApprovalDialog:v["a"],MaterialTable:C,TongchouTable:$,ScriptTable:V,CommunicationApprove:z["a"],BatchApprove:G,CustomWarnTable:ae,MessageTemplateTable:ce,BlackListTable:ye},data(){return{loading:!1,source:null,timer:null,query:{approvalType:"IMCD",keyWords:"",sceneKey:"",nodeId:"",processId:"",channelId:"",materialType:"",creator:"",current:1,size:10},nodeId_processId:"",selectionImcdData:[],isBatchApprove:!1,tableData:[],total:0,channelList:[],nodeList:[],appTypeList:[],options:[],communicatorForm:{keyWords:"",desc:""},userLoading:!1,queryUser:{keyWords:"",current:1,size:10},gridData:[],userTotal:0,selectUser:{},dialogTableVisible:!1,submitloading:!1}},computed:{canBatch(){const e=sessionStorage.getItem("roleIds").split(",");return e.includes("10831")}},methods:{async getAppTypeList(e){const t=2e3;try{const e=await Object(o["i"])(d["a"].ecapi.queryAppTypeList,{},void 0,t);e.sort((e,t)=>e.enumOrder-t.enumOrder),this.appTypeList=e}catch(a){a.message.includes("timeout")&&!e&&this.getAppTypeList(!0)}},changeApprovalType(e){this.tableData=[],this.query.current=1,"MATERIAL"!=e&&(this.query.materialType=""),this.query.channelId="TASK"==e?"802":"",this.searchData()},async getChannelList(){try{const{channelNameAndIdList:e}=await Object(o["i"])(c["a"].effectAppraisal.queryChannel);this.channelList=e}catch(e){}},changeChannel(e){this.query.nodeId="",this.query.processId="",this.nodeId_processId="",this.nodeList=[],this.getNodeList(),this.searchData()},async getNodeList(){try{const e=`?userId=${sessionStorage.getItem("userId")}&channelId=${this.query.channelId}`,t=await Object(o["i"])(n["a"].mpapi.queryApproveNodes+e);this.nodeList=t}catch(e){this.nodeList=[]}},changeNode(e){if(e){const t=e.split("_");this.query.nodeId=t[0],this.query.processId=t[1]}else this.query.nodeId="",this.query.processId="";this.searchData()},async getTableData(e){this.loading&&this.source.cancel("取消上次请求"),this.source=this.$CancelToken.source();try{let t,a;this.loading=!0,"IMCD"===this.query.approvalType?(t={current:this.query.current,size:this.query.size,campsegName:this.query.keyWords,channelId:this.query.channelId,creator:this.query.creator,nodeId:this.query.nodeId,processId:this.query.processId,sceneKey:this.query.sceneKey},a=n["a"].mpapi.approveRecordNew):"MATERIAL"===this.query.approvalType?(t={current:this.query.current,size:this.query.size,materialName:this.query.keyWords,materialType:this.query.materialType,channelId:this.query.channelId,creator:this.query.creator},a=p["a"].channel.approveRecord):"TASK"===this.query.approvalType?(t={taskIdOrName:this.query.keyWords,createUserOrName:this.query.creator,channelId:this.query.channelId,current:this.query.current,size:this.query.size},a=d["a"].ecapi.approveTaskRecord):"TERM"===this.query.approvalType?(t={current:this.query.current,size:this.query.size,termIdOrName:this.query.keyWords,channelId:this.query.channelId,creator:this.query.creator},a=u["a"].approveRecord):"APP_ALARM"===this.query.approvalType||"CUSTOM_LABEL"===this.query.approvalType?(t={current:this.query.current,size:this.query.size,creator:this.query.creator,channelId:this.query.channelId,campsegName:this.query.keyWords,dicKey:"",enumKey:this.query.approvalType,userId:sessionStorage.getItem("userId")},a=n["a"].mpapi.approveRecordC):"MESSAGE_TEMPLATE"===this.query.approvalType||"BATTLE_MAP"===this.query.approvalType?(t={approvalType:this.query.approvalType,current:this.query.current,size:this.query.size,templateCode:this.query.keyWords,userName:this.query.creator},a=m["a"].messageTemplate.approveSmsTemplateRecord):"HMH5_BLACKLIST"===this.query.approvalType&&(t={approvalType:this.query.approvalType,current:this.query.current,size:this.query.size,taskId:this.query.keyWords,userName:this.query.creator},a=m["a"].blackList.approveBlacklistRecord);const{records:i,total:s}=await Object(o["i"])(a,t,this.source.token,!0===e?1e4:5e3);this.tableData=i,this.total=s,this.loading=!1}catch(a){var t;if(null!==(t=a.message)&&void 0!==t&&t.includes("timeout")&&1!=e)return this.getTableData(!0);this.loading=!1,this.total=0,this.tableData=[]}finally{this.selectionImcdData=[],this.timer&&clearTimeout(this.timer),this.$forceUpdate()}},searchData(){this.query.current=1,this.getTableData()},debounceQueryChange:Object(h["a"])((function(){this.searchData()})),selectableHandle(e){return 0!=e.communicationState},selectCamp(e,t){const a=this.selectionImcdData.some(e=>e.id===t.id);a?this.selectionImcdData=this.selectionImcdData.filter(e=>e.id!==t.id):this.selectionImcdData.push(t)},selectCampListCurrentPage(e){0!==e.length?e.forEach(e=>{const t=this.selectionImcdData.some(t=>t.id===e.id);t||0==e.communicationState||this.selectionImcdData.push(e)}):this.tableData.forEach(e=>{this.selectionImcdData=this.selectionImcdData.filter(t=>t.id!==e.id)})},echoSelected(){"IMCD"===this.query.approvalType&&this.selectionImcdData.length>0&&this.$nextTick(()=>{this.tableData.forEach(e=>{this.selectionImcdData.some(t=>t.id===e.id)&&this.$refs.imcdTableRef.toggleRowSelection(e)})})},batchApprove(){if(0===this.selectionImcdData.length)return this.$message.warning("请选择待审批策略！");this.$refs["batchApp"].openDialog(this.selectionImcdData)},reset(){this.query={approvalType:"IMCD",keyWords:"",channelId:"",materialType:"",current:1,size:10},this.searchData()},handelSelectTable(e,t){this.$refs.multipleTable.clearSelection(),0!==e.length?(this.selectUser=t,this.$refs.multipleTable.toggleRowSelection(t,!0)):this.selectUser={}},selectAll(e,t){this.selectUser={},this.$refs.multipleTable.clearSelection()},Approval(e,t){0==e.communicationState?this.$refs["communicationApprove"].ShowPopup(e):this.$refs["approval"].ShowPopup(e,t)},handleSizeChange(e){this.query.current=1,this.query.size=e,this.getTableData()},handleCurrentChange(e){this.query.current=e,this.getTableData()},delay(e){return new Promise(t=>{setTimeout(()=>{t()},e)})},async refresh(){this.selectionImcdData=[],this.getTableData(),this.timer=setTimeout(()=>{this.loading?this.getTableData():clearTimeout(this.timer)},this.$retryDelay)},goDetail(e){this.$router.push({path:"/MarketingPlanning/MarketingDetails",query:{campsegRootId:e,backName:this.$router.currentRoute.name,queryParams:JSON.stringify(this.query)}})}},created(){this.$route.params.queryParams&&(this.query={...this.query,...JSON.parse(this.$route.params.queryParams)}),this.getTableData(),this.getChannelList(),this.getAppTypeList(),this.getNodeList()}},be=fe,Ie=(a("1c81"),Object(I["a"])(be,l,r,!1,null,"56c13760",null)),Te=Ie.exports,Ce=function(){var e=this,t=e._self._c;return t("div",{staticClass:"product-container"},[t("div",[t("div",{staticClass:"selech-panel"},[t("el-form",{ref:"queryForm",attrs:{model:e.queryForm,"label-width":"120px"}},[t("el-row",[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"业务对象：","label-width":"120px"}},[t("el-input",{staticStyle:{"min-width":"100px"},attrs:{placeholder:"请输入业务对象"},model:{value:e.queryForm.businessKey,callback:function(t){e.$set(e.queryForm,"businessKey",t)},expression:"queryForm.businessKey"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"创建人：","label-width":"110px"}},[t("el-input",{staticStyle:{"min-width":"100px"},attrs:{placeholder:"请输入创建人"},model:{value:e.queryForm.submitter,callback:function(t){e.$set(e.queryForm,"submitter",t)},expression:"queryForm.submitter"}})],1)],1),t("el-col",{attrs:{span:12}},[t("div",{staticStyle:{float:"right","margin-right":"10px"}},[t("el-button",{attrs:{icon:"el-icon-refresh"},on:{click:e.resetQueryForm}},[e._v("重置")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.getDataList(e.queryForm)}}},[e._v("查询")])],1)])],1)],1)],1),t("div",[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,height:"calc(100vh - 400px)"}},[t("el-table-column",{attrs:{type:"index",label:"序号"}}),t("el-table-column",{attrs:{prop:"readTodoName",label:"待审批信息"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-link",{attrs:{type:"primary"},on:{click:function(t){return e.goDetail(a.row.businessId)}}},[e._v(" "+e._s(a.row.businessId)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"businessType",label:"类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(1===t.row.businessType?"策略":"")+" ")]}}])}),t("el-table-column",{attrs:{prop:"submitUserName",label:"创建人",width:"250px"}}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间"}}),t("el-table-column",{attrs:{label:"操作",fixed:"right",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.readAbout(a)}}},[e._v("阅知")])]}}])})],1)],1)]),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{"current-page":e.queryForm.current,"page-sizes":e.pageSizeList,layout:"total, prev, pager, next, jumper,sizes",total:e.Total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1),t("el-dialog",{attrs:{visible:e.delVisible,width:"40%",title:"阅知"},on:{"update:visible":function(t){e.delVisible=t}}},[t("div",{staticClass:"centerText"},[e._v(" 是否确定完成编号为"),t("span",{staticClass:"code"},[e._v(e._s(e.dealForm.businessId))]),e._v("活动的阅知， 确定后该条活动的阅知待办将关闭不显示 ")]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.delVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.dealAbout()}}},[e._v("确 定")])],1)])],1)},we=[],ke={data(){return{queryForm:{current:1,size:10,submitter:"",type:"",businessKey:""},pageSizeList:[10,20,30,40,50],Total:0,options:[],tableData:[],loading:!1,delVisible:!1,dealForm:{}}},created(){this.getDataList(this.queryForm)},methods:{resetQueryForm(){this.queryForm={...this.queryForm,submitter:"",type:"",businessKey:""},this.getDataList(this.queryForm)},handleCurrentChange(e){this.queryForm={...this.queryForm,current:e},this.getDataList(this.queryForm)},handleSizeChange(e){this.queryForm={...this.queryForm,size:e},this.getDataList(this.queryForm)},async getDataList(e){this.loading=!0,await Object(o["i"])(n["a"].mpapi.queryReadAboutList,e).then(e=>{this.tableData=e.records,this.Total=e.total,this.loading=!1})},readAbout(e){this.dealForm=e.row,this.delVisible=!0},async dealAbout(){await Object(o["i"])(n["a"].mpapi.queryDealRead,this.dealForm).then(e=>{this.delVisible=!1,this.getDataList(this.queryForm),this.$message.success("操作成功")})},goDetail(e){this.$router.push({path:"/MarketingPlanning/MarketingDetails",query:{campsegRootId:e,backName:this.$router.currentRoute.name,tab:2}})}}},qe=ke,_e=(a("8436"),Object(I["a"])(qe,Ce,we,!1,null,"4b1c6858",null)),Le=_e.exports,De=function(){var e=this,t=e._self._c;return t("div",{staticClass:"product-container"},[t("div",[t("div",{staticClass:"selech-panel"},[t("el-form",{ref:"queryForm",attrs:{model:e.queryForm,"label-width":"100px",inline:""}},[t("el-form-item",{attrs:{label:"业务对象："}},[t("el-input",{attrs:{placeholder:"请输入业务名称或编码"},model:{value:e.queryForm.campsegKey,callback:function(t){e.$set(e.queryForm,"campsegKey",t)},expression:"queryForm.campsegKey"}})],1),t("div",{staticClass:"btn"},[t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.selectQuery()}}},[e._v("批量处理")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.getDataList(e.queryForm)}}},[e._v("查询")]),t("el-button",{attrs:{icon:"el-icon-refresh"},on:{click:e.resetQueryForm}},[e._v("重置")])],1)],1)],1),t("div",[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,height:"calc(100vh - 400px)"},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),t("el-table-column",{attrs:{type:"index",label:"序号"}}),t("el-table-column",{attrs:{prop:"campsegName",label:"策略名称"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-link",{attrs:{type:"primary"},on:{click:function(t){return e.goDetail(a.row)}}},[e._v(" "+e._s(a.row.campsegName)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"campsegId",label:"策略编号"}}),t("el-table-column",{attrs:{prop:"issuedCustomerNum",label:"下发数"}}),t("el-table-column",{attrs:{prop:"contactRate",label:"接触数"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.contactRate+"%")+" ")]}}])}),t("el-table-column",{attrs:{prop:"marketSuccessRate",label:"营销成功率"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.marketSuccessRate+"%")+" ")]}}])}),t("el-table-column",{attrs:{prop:"warningTime",label:"预警时间"}}),t("el-table-column",{attrs:{label:"操作",fixed:"right",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.warnAbout(a)}}},[e._v("处理")])]}}])})],1)],1)]),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{"current-page":e.queryForm.current,"page-sizes":e.pageSizeList,layout:"total, sizes, prev, pager, next, jumper",total:e.Total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1),t("el-dialog",{attrs:{visible:e.delVisible,width:"40%",title:"处理"},on:{"update:visible":function(t){e.delVisible=t}}},[t("div",{staticClass:"centerText"},[e._v(" 是否确定完成编号为"),t("span",{staticClass:"code"},[e._v(e._s(e.currentRow.campsegId))]),e._v("预警的处理，确定后该条预警将关闭不显示。 ")]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.delVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.dealWarnAbout()}}},[e._v("确 定")])],1)])],1)},xe=[],Se={data(){return{queryForm:{current:1,size:10,campsegKey:""},options:[],tableData:[],loading:!1,delVisible:!1,Total:0,pageSizeList:[10,20,30,40,50],uniqueIdentifierId:"",currentRow:{},multipleSelection:[]}},created(){this.getDataList(this.queryForm)},methods:{handleSelectionChange(e){this.multipleSelection=e},resetQueryForm(){this.queryForm={...this.queryForm,campsegKey:""},this.getDataList(this.queryForm)},handleCurrentChange(e){this.queryForm={...this.queryForm,current:e},this.getDataList(this.queryForm)},handleSizeChange(e){this.queryForm={...this.queryForm,size:e},this.getDataList(this.queryForm)},async getDataList(e){this.loading=!0,await Object(o["i"])(n["a"].mpapi.queryWarnList,e).then(e=>{this.tableData=e.records,this.Total=e.total,this.loading=!1})},warnAbout(e){this.uniqueIdentifierId=e.row.uniqueIdentifierId,this.delVisible=!0,this.currentRow=e.row},async dealWarn(e){await Object(o["i"])(n["a"].mpapi.queryDealWarn,{uniqueIdentifierId:e}).then(e=>{this.delVisible=!1,this.getDataList(this.queryForm),this.$message.success("操作成功")})},async dealWarnAbout(){this.dealWarn(this.uniqueIdentifierId)},async selectQuery(){const e=this.multipleSelection.map(e=>e.uniqueIdentifierId).join(",");this.dealWarn(e)},goDetail(e){const{campsegId:t,campsegPId:a}=e;this.$router.push({path:"/MarketingPlanning/MarketingDetails",query:{campsegRootId:a,campsegId:t,backName:this.$router.currentRoute.name,tab:3}})}}},Ne=Se,Ae=(a("3923"),Object(I["a"])(Ne,De,xe,!1,null,"651585da",null)),Fe=Ae.exports,$e=function(){var e=this,t=e._self._c;return t("div",{staticClass:"template-wrap-content"},[t("div",{staticClass:"top-edit-part"},[t("div",{staticClass:"search-input"},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{size:"mini",placeholder:"请输入策略名称或编码"},model:{value:e.keyword,callback:function(t){e.keyword="string"===typeof t?t.trim():t},expression:"keyword"}},[t("i",{staticClass:"el-input__icon el-icon-search cursor-pointer",attrs:{slot:"suffix"},on:{click:e.searchTable},slot:"suffix"})])],1)]),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"template-table",staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"",height:600}},[t("el-table-column",{attrs:{type:"index",label:"序号"}}),t("el-table-column",{attrs:{prop:"serviceName",label:"驳回信息",width:"450","header-align":"center","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-link",{attrs:{type:"primary"},on:{click:function(t){return e.goWhere(a,!1)}}},[e._v(" "+e._s(a.id)+" "+e._s(a.name)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"submitUser",label:"提交人",align:"center"}}),t("el-table-column",{attrs:{prop:"createTime",label:"提交时间",align:"center","show-overflow-tooltip":!0}}),t("el-table-column",{attrs:{label:"操作",width:"100",align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.confirm(a)}}},[e._v(" 前往修改 ")])]}}])})],1),t("el-pagination",{attrs:{"current-page":e.query.current,"page-sizes":[10,20,30,40],"page-size":e.query.size,"pager-count":5,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),t("WarnDetail",{attrs:{dialogVisible:e.showDetailDialog,id:e.alarmId,isEdit:!1,isEditThreshold:!1},on:{"update:dialogVisible":function(t){e.showDetailDialog=t},"update:dialog-visible":function(t){e.showDetailDialog=t}}})],1)},Pe=[],Me={components:{WarnDetail:X["a"]},data(){return{loading:!1,tableData:[],query:{keyWords:"",current:1,size:10},total:0,keyword:"",showDetailDialog:!1,alarmId:""}},methods:{searchTable(){this.query.current=1,this.query.keyWords=this.keyword,this.getTableData()},async getTableData(){try{this.loading=!0;const{records:e,total:t}=await Object(o["i"])(n["a"].mpapi.queryRejectList,this.query);this.tableData=e,this.total=t}catch(e){}finally{this.loading=!1}},handleSizeChange(e){this.query.size=e,this.getTableData()},handleCurrentChange(e){this.query.current=e,this.getTableData()},confirm(e){this.$confirm("<p>是否跳转进入创建详情页进行修改?</p><p>确认跳转后该条通知会关闭不显示。</p>","提示",{confirmButtonText:"确定",cancelButtonText:"取消",dangerouslyUseHTMLString:!0,type:"warning"}).then(async()=>{await Object(o["i"])(n["a"].mpapi.updateRejectEmisReadTask,e),this.goWhere(e,!0)}).catch(()=>{})},goWhere(e,t=!0){const{businessId:a,businessType:i}=e;1==i||3==i?t?this.goCamgEdit(a):this.goDetail(a):2==i&&(t?this.goWarnDetail(a):(this.showDetailDialog=!0,this.alarmId=a))},goWarnDetail(e){this.$router.push({name:"CustomWarning",params:{id:e,backName:this.$router.currentRoute.name,queryParams:JSON.stringify(this.query),tab:4}})},goDetail(e){this.$router.push({path:"/MarketingPlanning/MarketingDetails",query:{campsegRootId:e,backName:this.$router.currentRoute.name,queryParams:JSON.stringify(this.query),tab:4}})},goCamgEdit(e){this.$router.push({path:"/MarketingPlanning/MpHome",query:{campId:e}})}},created(){"4"===this.$route.params.tab&&(this.query=JSON.parse(this.$route.params.queryParams),this.keyword=this.query.keyWords),this.getTableData()}},je=Me,Oe=(a("24a9"),Object(I["a"])(je,$e,Pe,!1,null,"7f32e3ca",null)),Ee=Oe.exports,Re={components:{Approve1:Te,ReadAbout:Le,EarlyWarning:Fe,RejectList:Ee},computed:{showYuezhi(){var e;const t=null===(e=sessionStorage.getItem("roleIds"))||void 0===e?void 0:e.split(",");return null===t||void 0===t?void 0:t.includes("10002")}},data(){return{tabActive:"approve"}},methods:{jump(){const{redirectURL:e,campsegId:t}=this.$route.query;switch(e){case"tacticsApprove":this.tabActive="approve";break;case"tacticsRead":this.tabActive="content";break;case"tacticsWarnTodoDeal":this.tabActive="scene";break;case"tacticsInfo":this.$router.replace({path:"/MarketingPlanning/MarketingDetails",query:{campsegRootId:t}});break;case"tacticsRejectRead":this.tabActive="reject";break;default:break}}},created(){var e;if(null!==(e=this.$route.params)&&void 0!==e&&e.tab)switch(this.$route.params.tab){case"2":this.tabActive="content";break;case"3":this.tabActive="scene";break;case"4":this.tabActive="reject";break;default:this.tabActive="approve";break}this.$route.query.redirectURL&&this.jump()}},Ue=Re,Ve=(a("a85a"),a("4b3d"),Object(I["a"])(Ue,i,s,!1,null,"f5721d96",null));t["default"]=Ve.exports},efed:function(e,t,a){"use strict";var i=function(){var e,t,a=this,i=a._self._c;return i("div",[i("el-dialog",{attrs:{title:"审批",visible:a.dialogVisible,width:"502px","append-to-body":"","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(e){a.dialogVisible=e}}},[i("div",{staticClass:"Contact-mtp"},[i("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:a.ruleForm,rules:a.rules,"label-width":"110px"}},[i("el-form-item",{attrs:{label:"审批结果：",prop:"resource"}},[i("el-radio-group",{model:{value:a.ruleForm.resource,callback:function(e){a.$set(a.ruleForm,"resource",e)},expression:"ruleForm.resource"}},[i("el-radio",{attrs:{label:1}},[a._v("通过")]),i("el-radio",{attrs:{label:0}},[a._v("驳回")])],1)],1),i("el-form-item",{attrs:{label:"审批意见：",prop:"desc"}},[i("el-input",{attrs:{type:"textarea",maxlength:"500","show-word-limit":"",rows:4},model:{value:a.ruleForm.desc,callback:function(e){a.$set(a.ruleForm,"desc",e)},expression:"ruleForm.desc"}})],1),0==(null===(e=a.nextNodesList.nextNodesApprover)||void 0===e?void 0:e.length)&&"IMCD"===a.approvalType?i("div",{staticClass:"Description"},[i("span",{staticClass:"all"},[a._v("审批通过后，策略将开始执行")]),a.channelInfo.show?i("div",{staticClass:"tip"},[i("span",[a._v("*")]),i("span",[a._v(a._s(`当前短信渠道发送任务执行中活动${a.channelInfo.activeNum}个，涉及${a.channelInfo.customerNum}用户请做好发送流量控制，IOP每小时约执行${a.channelInfo.IOP/1e4}万发送任务。`))])]):a._e()]):a._e(),0!==a.ruleForm.resource&&"{}"!==JSON.stringify(a.nextNodesList)?i("div",{staticClass:"nextNodesList"},a._l(a.nextNodesList.nextNodesApprover,(function(e,t){return i("el-form-item",{key:e.node.id,attrs:{"label-width":"auto",label:e.node.nodeName+"：",prop:"nextNodesList["+t+"].value",rules:{required:!0,message:"审批人不能为空",trigger:"blur"}}},[i("el-select",{on:{change:a.clone},model:{value:a.ruleForm.nextNodesList[t].value,callback:function(e){a.$set(a.ruleForm.nextNodesList[t],"value",e)},expression:"ruleForm.nextNodesList[index].value"}},a._l(e.approverUser,(function(e){return i("el-option",{key:e.id,attrs:{label:e.userName,value:e.userId}})})),1)],1)})),1):a._e(),a.communicationTaskList.length?i("el-form-item",{attrs:{label:"沟通人意见："}},a._l(a.communicationTaskList,(function(e){return i("div",{staticClass:"communication"},[i("div",{staticClass:"title"},[i("span",[a._v(a._s(e.approverName||"-"))]),a._v("   "),i("span",[a._v(a._s(e.dealTime))])]),i("div",{staticClass:"content"},[i("span",[a._v(a._s(e.dealOpinion))])])])})),0):a._e()],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},["IMCD"!==a.approvalType||null!==(t=a.multiApprovelDataList)&&void 0!==t&&t.length?a._e():i("el-button",{on:{click:a.open2CommunicatorDialog}},[a._v("转至沟通人")]),i("el-button",{on:{click:a.cancel}},[a._v("取 消")]),i("el-button",{attrs:{type:"primary",loading:a.approveLoading},on:{click:a.Submit}},[a._v("提 交")])],1)]),i("ToCommunicator",{ref:"toCommunicator",attrs:{approvalType:a.approvalType},on:{refresh:function(e){return a.$emit("refresh")}}})],1)},s=[],l=(a("14d9"),a("0fea")),r=a("d370"),o=a("31b1"),n=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"选择沟通人",visible:e.dialogVisible,width:"50%","close-on-click-modal":!1,top:"8vh"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],staticStyle:{width:"320px"},attrs:{placeholder:"请输入账号/用户名",size:"small"},on:{input:e.debounceQueryUserChange},model:{value:e.queryUser.keyWords,callback:function(t){e.$set(e.queryUser,"keyWords",t)},expression:"queryUser.keyWords"}}),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.userLoading,expression:"userLoading"}],attrs:{data:e.userList,height:"300px"},on:{"row-click":e.handleSelectionChange}},[t("el-table-column",{attrs:{width:"50px",align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-radio",{attrs:{label:a.userId},nativeOn:{change:function(t){return e.handleSelectionChange(a)}},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[e._v(" ")])]}}])}),t("el-table-column",{attrs:{property:"userName",label:"姓名"}}),t("el-table-column",{attrs:{property:"cityName",label:"归属地市"}}),t("el-table-column",{attrs:{property:"departmentName",label:"归属部门"}}),t("el-table-column",{attrs:{property:"mobilePhone",label:"手机号码"}})],1),t("el-pagination",{staticClass:"user-pagination",attrs:{"current-page":e.queryUser.current,"page-size":e.queryUser.size,"pager-count":5,layout:"total, prev, pager, next",total:e.userTotal},on:{"current-change":e.handleUserTableCurrentChange}}),e._v(" 转发人意见： "),t("el-input",{attrs:{type:"textarea",maxlength:"500","show-word-limit":"",rows:3},model:{value:e.communicatorForm.desc,callback:function(t){e.$set(e.communicatorForm,"desc",t)},expression:"communicatorForm.desc"}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",loading:e.submitloading},on:{click:e.toCommunication}},[e._v("提 交")])],1)],1)},c=[],p=a("f9ae"),d={props:{approvalType:{type:String,default:""}},data(){return{source:null,dialogVisible:!1,userLoading:!1,submitloading:!1,nodeInfo:{},queryUser:{keyWords:"",current:1,size:10},userTotal:0,userList:[],radio:"",rowInfo:null,communicatorForm:{desc:""}}},methods:{ShowPopup(e){this.dialogVisible=!0,this.nodeInfo=e,this.queryUser.current=1,this.getUserList()},async getUserList(){this.userLoading&&this.source.cancel("取消上次user请求"),this.source=this.$CancelToken.source();try{this.userLoading=!0;const{records:e,total:t}=await Object(l["i"])(o["a"].channel.queryCommunicationUsers,this.queryUser,this.source.token);this.userList=e,this.userTotal=t}catch(e){}finally{this.userLoading=!1}},handleUserTableCurrentChange(e){this.queryUser.current=e,this.getUserList()},debounceQueryUserChange:Object(p["a"])((function(){this.queryUser.current=1,this.getUserList()})),handleSelectionChange(e){this.rowInfo=e},async toCommunication(){if(this.rowInfo)try{this.submitloading=!0;let e={advice:this.communicatorForm.desc,instanceId:this.nodeInfo.instanceId,nodeId:this.nodeInfo.nodeId,approvalUser:this.rowInfo.userId,approvalTimes:1,submitter:sessionStorage.getItem("userId"),serviceType:this.nodeInfo.businessId,processId:this.nodeInfo.processId,systemId:this.approvalType};await Object(l["i"])(o["a"].channel.addCommunicationTask,e),this.$message.success("提交成功"),this.$emit("refresh"),this.dialogVisible=!1}catch(e){}finally{this.submitloading=!1}else this.$message.error("请选择沟通人")}}},u=d,m=(a("2ec76"),a("2877")),h=Object(m["a"])(u,n,c,!1,null,"69aa6c02",null),v=h.exports,g={props:{approvalType:{type:String,default:"IMCD"}},components:{ToCommunicator:v},data(){return{dialogVisible:!1,approveLoading:!1,submitSource:null,ruleForm:{resource:1,desc:"",nextNodesList:[]},ApprovalForm:{},multiApprovelDataList:void 0,rules:{resource:[{required:!0,message:"请选择审批结果",trigger:"change"}]},nextNodesList:{},channelInfo:{CHANNEL:0,IOP:0,customerNum:0,activeNum:0,show:!1},communicationTaskList:[]}},mounted(){},methods:{open2CommunicatorDialog(){this.$refs.toCommunicator.ShowPopup(this.ApprovalForm),this.dialogVisible=!1},clone(){this.ruleForm=Object.assign({},this.ruleForm)},ShowPopup(e,t){this.ApprovalForm=e,this.multiApprovelDataList=t,this.communicationTaskList=[],this.getNextApprovers(),"IMCD"===this.approvalType&&this.getChannelInfo(),this.ruleForm={resource:1,desc:"",nextNodesList:[]},this.nextNodesList={},this.dialogVisible=!0},async getNextApprovers(e=!1){const t={instanceId:this.ApprovalForm.instanceId,nodeId:this.ApprovalForm.nodeId,serviceType:this.ApprovalForm.businessId,approvalType:this.approvalType},a=o["a"].channel.getNextApprovers;try{const e=await Object(l["i"])(a,t,void 0,this.$retryDelay);this.ruleForm.nextNodesList=[],this.nextNodesList=e,this.nextNodesList.nextNodesApprover=this.nextNodesList.nextNodesApprover.filter(e=>2!==e.node.nodeType),this.nextNodesList.nextNodesApprover.map(e=>{var t;this.ruleForm.nextNodesList.push({value:(null===(t=e.approverUser[0])||void 0===t?void 0:t.userId)||""})}),"IMCD"===this.approvalType&&this.queryCommunicationTask()}catch(s){var i;null!==(i=s.message)&&void 0!==i&&i.includes("timeout")&&!0!==e&&this.getNextApprovers(!0)}},async queryCommunicationTask(){try{const e=await Object(l["i"])(o["a"].channel.queryCommunicationTask,{businessId:this.ApprovalForm.businessId,instanceId:this.ApprovalForm.instanceId,nodeId:this.ApprovalForm.nodeId,serviceType:this.ApprovalForm.businessId,submitter:this.ApprovalForm.approver});this.communicationTaskList=e}catch(e){}},async getChannelInfo(){this.channelInfo={CHANNEL:0,IOP:0,customerNum:0,activeNum:0,show:!1};try{const{channelStatis:e,smsCapacity:t}=await Object(l["i"])(r["a"].mpapi.getCampsegStatistics,{campsegRootId:this.ApprovalForm.businessId});this.channelInfo.show=!!e.length,this.channelInfo.IOP=t;for(let a of e)this.channelInfo.CHANNEL+=a.channelCapacity||0,this.channelInfo.customerNum+=a.useCustNum||0,this.channelInfo.activeNum+=a.campsegNum||0}catch(e){}},async processApproveInfo(e=!1){var t=[];0!==this.ruleForm.resource&&this.nextNodesList.nextNodesApprover.filter((e,a)=>{var i=this.ruleForm.nextNodesList[a],s=[];e.approverUser.map(e=>{Array.isArray(i.value)?i.value.map(t=>{t===e.userId&&s.push(e)}):i.value===e.userId&&s.push(e)}),t.push({approverUser:s,node:e.node})});let a={instanceId:this.nextNodesList.instanceId,nodeId:this.nextNodesList.nodeId,businessId:this.ApprovalForm.businessId,childBusinessId:this.ApprovalForm.childBusinessId,submitStatus:this.ruleForm.resource,dealOpinion:this.ruleForm.desc,nextNodesApprover:t,processId:this.nextNodesList.processId,berv:this.nextNodesList.berv,serviceType:this.ApprovalForm.businessId,approvalType:this.approvalType},i=r["a"].mpapi.processApproveInfo;this.multiApprovelDataList&&(i=r["a"].mpapi.batchSubmitProcess,a={...a,businessIds:this.multiApprovelDataList.map(e=>e.businessId),instanceIds:this.multiApprovelDataList.map(e=>e.instanceId)}),this.approveLoading&&this.submitSource.cancel("取消请求"),this.submitSource=this.$CancelToken.source();try{this.approveLoading=!0;await Object(l["i"])(i,a,this.submitSource.token,this.$retryDelay);this.$message.success("审批成功"),this.$emit("refresh"),this.approveLoading=!1,this.$nextTick(()=>{this.dialogVisible=!1})}catch(n){var s,o;if(null!==(s=n.message)&&void 0!==s&&s.includes("timeout")&&!0!==e)return this.processApproveInfo(!0);!0===e&&null!==(o=n.message)&&void 0!==o&&o.includes("timeout")&&this.$message.error("审批超时，请稍后重试"),this.approveLoading=!1}},Submit(){this.$refs["ruleForm"].validate(e=>{e?this.processApproveInfo():this.$message.error("请填写必填项")})},cancel(){this.approveLoading&&this.submitSource.cancel("取消请求"),this.dialogVisible=!1}}},y=g,f=(a("1b3c"),a("d22d"),Object(m["a"])(y,i,s,!1,null,"68db28bb",null));t["a"]=f.exports},f9b4:function(e,t,a){"use strict";a("75c8")}}]);