(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8eefce92","chunk-7a3acc7a"],{"113b":function(e,t,n){"use strict";n("9cf7")},2283:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"scene"},[t("header",[t("div",{staticClass:"customer"},[t("span",[t("span",[e._v(e._s(e.isFission?e.title:e.form.sceneName)+"：")]),null!==e.form.customerNum?t("span",[e._v(" "+e._s(e.form.customerNum)+"人"+e._s(e.customerNumRate)+" ")]):e._e()]),e.calcLoading?t("span",{staticClass:"tip"},[t("i",{staticClass:"el-icon-loading"}),e._v("计算中")]):e._e(),e.calcLoading||e.calcResult?e._e():t("span",{staticClass:"tip-error"},[t("i",{staticClass:"el-icon-warning-outline"}),e._v("客群计算失败 ")]),e.aiHelp&&!e.calcLoading&&e.form.customerNum&&!e.form.finalExpression?t("span",{staticClass:"tip-error"},[t("i",{staticClass:"el-icon-warning-outline"}),e._v("不支持该客群范围 ")]):e._e()]),t("div",[e.aiHelp&&e.form.customerNum>0?t("el-button",{attrs:{size:"mini",type:"success",plain:""},on:{click:e.openOptimizeDialog}},[e._v(" AI瘦身 ")]):e._e(),e.isFission?t("el-button",{attrs:{type:"text",size:"medium"},on:{click:e.remove}},[e._v(" "+e._s(e.aiHelp?"删除客群规则":"删除场景")+" ")]):e._e()],1)]),t("div",{staticClass:"scene__container"},[t("el-form",{ref:"formRef",attrs:{"label-width":e.labelWidth,"label-suffix":"：",model:e.form,rules:e.rules}},[e._e(),e.aiHelp?e._e():t("el-form-item",{attrs:{label:"场景名称",prop:"sceneName"}},[t("el-input",{attrs:{maxlength:25,placeholder:"请输入场景名称","show-word-limit":""},model:{value:e.form.sceneName,callback:function(t){e.$set(e.form,"sceneName",t)},expression:"form.sceneName"}})],1),"2"==e.form.attrType?t("el-form-item",{attrs:{label:"基础客群",prop:"customerGroupId"}},[t("el-select",{staticStyle:{width:"400px"},attrs:{filterable:"",placeholder:"请选择基础客群"},on:{change:e.changeBaseCustomer},model:{value:e.form.customerGroupId,callback:function(t){e.$set(e.form,"customerGroupId",t)},expression:"form.customerGroupId"}},e._l(e.form.selectCustomerList,(function(e){return t("el-option",{key:e.customGroupId,attrs:{label:e.customGroupName,value:e.customGroupId}})})),1)],1):e._e(),t("el-form-item",{attrs:{label:e.aiHelp?"客群范围":"场景条件",prop:"validateC"}},e._l(e.conditions,(function(n,i){return t("div",{key:n.id+i,staticClass:"c-branch"},[t("el-select",{staticStyle:{width:"150px"},attrs:{filterable:"",placeholder:"请选择标签"},on:{change:function(t){return e.onColumnChange(t,i)}},model:{value:e.conditions[i].columnNum,callback:function(t){e.$set(e.conditions[i],"columnNum",t)},expression:"conditions[index].columnNum"}},e._l(e.selectedColumns,(function(e){return t("el-option",{key:e.columnNum,attrs:{label:e.columnName,value:e.columnNum}})})),1),2!=e.conditions[i].valueType?[t("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"计算方式"},model:{value:e.conditions[i].calType,callback:function(t){e.$set(e.conditions[i],"calType",t)},expression:"conditions[index].calType"}},e._l(e.conditionList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("el-select",{staticClass:"tags-select-input",staticStyle:{width:"200px"},attrs:{"value-key":"value","collapse-tags":"",multiple:"",filterable:""},model:{value:e.conditions[i].selectedValues,callback:function(t){e.$set(e.conditions[i],"selectedValues",t)},expression:"conditions[index].selectedValues"}},e._l(n.valueList,(function(e){return t("el-option",{key:e.id,attrs:{label:e.label,value:e.value}})})),1)]:[t("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"计算方式"},on:{change:function(t){return e.changeCalType(t,i)}},model:{value:e.conditions[i].calType,callback:function(t){e.$set(e.conditions[i],"calType",t)},expression:"conditions[index].calType"}},e._l(e.conditionListNum,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e.between.includes(e.conditions[i].calType)?[t("el-input-number",{staticStyle:{width:"87px"},model:{value:e.conditions[i].numVal1,callback:function(t){e.$set(e.conditions[i],"numVal1",t)},expression:"conditions[index].numVal1"}}),t("span",[e._v("-")]),t("el-input-number",{staticStyle:{width:"87px"},model:{value:e.conditions[i].numVal2,callback:function(t){e.$set(e.conditions[i],"numVal2",t)},expression:"conditions[index].numVal2"}})]:t("el-input-number",{staticStyle:{width:"200px"},model:{value:e.conditions[i].value,callback:function(t){e.$set(e.conditions[i],"value",t)},expression:"conditions[index].value"}})],t("i",{directives:[{name:"show",rawName:"v-show",value:0!==i,expression:"index !== 0"}],staticClass:"el-icon-remove-outline icon",on:{click:function(t){return e.removeCondition(i)}}}),i==e.conditions.length-1?t("div",{staticClass:"branch__add",on:{click:e.addCondition}},[t("i",{staticClass:"el-icon-circle-plus-outline icon"})]):e._e()],2)})),0)],1)],1),t("LabelOptimizeDialog",{ref:"optimizeRef",on:{save:e.changeRule}})],1)},l=[],s=(n("14d9"),n("0fea")),o=n("afd9"),a=n("82be"),c=n("bdad"),u={components:{LabelOptimizeDialog:()=>n.e("chunk-ef31e722").then(n.bind(null,"cdae"))},props:{childIndex:{type:Number,default:0},aiHelp:{type:Boolean,default:!1},title:{type:String,default:""},labelWidth:{type:String,default:"120px"},selectedColumns:{type:Array,default:()=>[]},echoData:{type:Object,default:()=>{}},node:{type:Object,default:()=>({})},isFission:{type:Boolean,default:!0}},computed:{customerNumRate(){if(this.aiHelp)return null;let e;e=this.isFission?this.node:$graph.findDataById(this.node.pId);const t=e.businessData.customerNum;return t?" | "+((this.form.customerNum||0)/t*100).toFixed(2)+"% 占比":null}},data(){return{form:{sceneId:"",sceneName:"",attrType:"0",selectCustomerList:[],customerGroupId:void 0,customerInfo:{},selectAttrList:[],selectAttrStr:"",customerNum:null,finalExpression:null,conditionDesc:"",conditionParams:[],conditions:[],validateC:null},conditions:[{id:Object(c["c"])(),type:"",columnNum:null,columnName:null,valueType:null,calType:null,conditionValue:null,valueList:[],selectedValues:[],value:void 0,numVal1:void 0,numVal2:void 0,conditionDesc:""}],conditionList:a["a"],between:["()","(]","[)","[]"],conditionListNum:a["b"],rules:{customerGroupId:[{required:!0,message:"请选择基础客群",trigger:"change"}],sceneName:[{required:!0,message:"请输入场景名称",trigger:"blur"}],validateC:[{required:!0,message:"请填写规则条件",trigger:"blur"}]},ancestorConditions:[],source:null,calcLoading:!1,calcResult:!0,isNeedCalc:!0}},watch:{conditions:{handler(e){if(!this.isNeedCalc)return;let t=this.validateCondition();if(!t)return this.form.customerNum=null,this.form.finalExpression=null,void(this.calcLoading&&(this.source.cancel("取消未完成的请求"),this.calcLoading=!1));this.$refs.formRef.clearValidate("validateC"),this.calcSceneCount()},deep:!0}},methods:{echoForm(){const{conditions:e}=this.echoData;null!==e&&void 0!==e&&e.length&&(this.conditions=JSON.parse(JSON.stringify(e))),this.echoData.sceneId&&(this.form=this.echoData),this.$delete(this.form,"conditions"),this.isNeedCalc=!1,this.$nextTick(()=>{this.isNeedCalc=!0})},changeBaseCustomer(e){const t=this.form.selectCustomerList.find(t=>t.customGroupId===e);this.form.customerInfo=t;const n=this.validateCondition();n&&this.calcSceneCount()},onColumnChange(e,t){var n;this.$set(this.conditions[t],"calType",null),this.$set(this.conditions[t],"value",void 0),this.$set(this.conditions[t],"numVal1",void 0),this.$set(this.conditions[t],"numVal2",void 0),this.$set(this.conditions[t],"selectedValues",[]),this.$set(this.conditions[t],"valueList",[]);const i=this.selectedColumns.find(t=>t.columnNum===e);if(this.$set(this.conditions[t],"columnName",i.columnName),this.$set(this.conditions[t],"valueType",i.valueType),null===(n=i.valueList)||void 0===n||!n.length)return;let l=i.valueList.map(e=>({...e,label:Object(a["c"])(e)}));this.$set(this.conditions[t],"valueList",l)},changeCalType(e,t){this.between.includes(e)?this.$set(this.conditions[t],"value",void 0):(this.$set(this.conditions[t],"numVal1",void 0),this.$set(this.conditions[t],"numVal2",void 0))},addCondition(){this.conditions.push({id:Object(c["c"])(),type:"",columnNum:null,columnName:null,valueType:null,calType:null,conditionValue:null,valueList:[],selectedValues:[],value:void 0,numVal1:void 0,numVal2:void 0,conditionDesc:""})},getConditionDesc(){this.conditions.forEach(e=>{var t;let n,i=null===(t=this.selectedColumns.find(t=>t.columnNum===e.columnNum))||void 0===t?void 0:t.columnName,l="";var s,o;2!=e.valueType?(n=null===(s=this.conditionList.find(t=>t.value===e.calType))||void 0===s?void 0:s.label,e.selectedValues.forEach((t,n)=>{var i;let s=null===(i=e.valueList.find(e=>e.value===t))||void 0===i?void 0:i.label;l+=n>0?"，"+s:s}),l=`【${l}】`):(n=null===(o=this.conditionListNum.find(t=>t.value===e.calType))||void 0===o?void 0:o.label,n.includes("介于")?(n="介于",l=`${e.numVal1} - ${e.numVal2}`):l=e.value);let a=i+" "+n+l;this.$set(e,"conditionDesc",a)}),this.form.conditionDesc=this.conditions.map(e=>e.conditionDesc).join(" & ")},removeCondition(e){this.conditions.splice(e,1)},validateCondition(){let e=!0;for(let t=0;t<this.conditions.length;t++){let n=this.conditions[t];if(null===n.columnNum||null===n.calType){e=null;break}if(1==n.valueType&&!n.selectedValues.length){e=null;break}if(2==n.valueType)if(this.between.includes(n.calType)){let t="number"===typeof n.numVal1,i="number"===typeof n.numVal2;if(!t||!i){e=null;break}}else if("number"!==typeof n.value){e=null;break}}return e},validate(){let e=this.validateCondition();return this.form.validateC=e,this.getConditionDesc(),new Promise((e,t)=>{this.$refs.formRef.validate(n=>{if(this.calcLoading)return this.$message({message:"请等待客群数量计算完成！",type:"warning",duration:3e3}),t(!1);if(n){if(!this.form.customerNum)return this.$message({message:"客群数量不能等于0！请重新选择条件",type:"error"}),t({type:"scroll",childIndex:this.childIndex});e({...this.form,conditions:this.conditions})}else t({type:"scroll",childIndex:this.childIndex})})})},remove(){this.$emit("remove")},assembleParams(){var e;let t=[];const n=(null===(e=this.node)||void 0===e||null===(e=e.nodeLines)||void 0===e?void 0:e.filter(e=>"Scene"===e.nodeType))||[];this.isFission||n.pop(),n.forEach(e=>{const n=$graph.findDataById(e.nodeId);t=t.concat(n.businessData.conditions||[])});const i=[...t,...this.conditions],l=Object(a["e"])(i,this.form);return this.form.conditionParams=Object(a["f"])(i,this.form),l},async calcSceneCount(){const e=this.assembleParams();this.calcLoading&&this.source.cancel("取消未完成的请求"),this.source=this.$CancelToken.source();try{this.form.customerNum=null,this.form.finalExpression=null,this.calcLoading=!0;const{count:t,finalExpression:n}=await Object(s["i"])(o["a"].getTargetUserCount,e,this.source.token,12e4);this.form.customerNum=t,this.form.finalExpression=n,this.aiHelp&&!n&&(this.form.customerNum=null,this.form.finalExpression=null),this.form.validateC=!0,this.calcLoading=!1,this.calcResult=!0}catch(t){if("取消未完成的请求"===t.message)return;this.calcLoading=!1,this.calcResult=!1}},openOptimizeDialog(){var e;this.getConditionDesc();const t=null===(e=this.node.nodeLines.find(e=>"Product"===e.nodeType))||void 0===e?void 0:e.nodeId,n=$graph.findDataById(t),i=n.businessData.productList[0].planId,l={conditionList:this.conditions,form:this.form,planId:i,custColumnNum:this.form.customerInfo.columnNum||null};this.$refs.optimizeRef.open(JSON.parse(JSON.stringify(l)))},changeRule(e){const{conditionList:t,customerNum:n,finalExpression:i}=e;this.form.customerNum=n,this.form.finalExpression=i,this.conditions.splice(0,this.conditions.length),t.forEach(e=>{e.id=Object(c["c"])(),this.selectedColumns.some(t=>t.columnNum===e.columnNum)||this.selectedColumns.push({id:e.id,columnNum:e.columnNum,columnName:e.columnName,valueType:e.valueType,valueList:e.valueList}),this.conditions.push(e)}),this.isNeedCalc=!1,this.$nextTick(()=>{this.isNeedCalc=!0})}},created(){this.echoForm()}},r=u,d=(n("113b"),n("2877")),m=Object(d["a"])(r,i,l,!1,null,"baa1964e",null);t["default"]=m.exports},"82be":function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return r})),n.d(t,"e",(function(){return d})),n.d(t,"f",(function(){return m})),n.d(t,"d",(function(){return p}));n("d9e2"),n("14d9");var i=n("c1df"),l=n.n(i);const s=[{label:"=",value:"="},{label:">",value:">"},{label:"<",value:"<"},{label:">=",value:">="},{label:"<=",value:"<="},{label:"( ) 介于，左右不包括",value:"()"},{label:"( ] 介于，左不包括右包括",value:"(]"},{label:"[ ) 介于，左包括右不包括",value:"[)"},{label:"[ ] 介于，左右都包括",value:"[]"}],o=[{label:"等于",value:"="},{label:"不等于",value:"!="}],a={up:"提升",down:"降低",any:"任何变化",exact:"变成","=":"等于:","!=":"不等于:",">":"大于:","<":"小于:",">=":"大于等于:","<=":"小于等于:","[]":"介于:","()":"介于:","(]":"介于:","[)":"介于:",IN:"包含:",LK:"LIKE:"},c=sessionStorage.getItem("userId"),u=sessionStorage.getItem("userNameCn");function r(e){const t=["=","!=",">","<",">=","<="],n=["[]","()","(]","[)"],i=function(e){return"number"===typeof e?e:e||""},l=function(e){return e.condition=e.condition||e.conditions,"e="===e.condition?"非规范值":t.indexOf(e.condition)>=0?a[e.condition]+i(e["stringVal"])+(i(e["remark"])||i(e["startValue"])?i(e["startValue"])+""+i(e["remark"]):""):n.indexOf(e.condition)>=0?e["remark"]?a[e.condition]+`${e["startValue"]}-${e["endValue"]}`+e["remark"]:a[e.condition]+e["startValue"]+"至"+e["endValue"]:a[e.condition]+i(e["stringVal"])+(i(e["remark"])?i(e["remark"]):"")};return l(e)}function d(e,t){var n;return{sign:"",requestNo:"",version:"",pageIndex:0,pageSize:0,customerVo:{treeDetails:[{id:1,parentId:0,type:"root",calType:"=",columnName:null,columnNum:+(null===(n=t.customerInfo)||void 0===n?void 0:n.columnNum)||0,selectedValues:["Y"],updateCycle:null},...e.map((e,t)=>{var n;return{id:t+2,parentId:t+1,type:"normal",isFission:0,calType:e.calType,columnName:e.columnName,columnNum:e.columnNum,selectedValues:e.selectedValues,numVal1:null!==(n=e.numVal1)&&void 0!==n?n:e.value,numVal2:e.numVal2,updateCycle:null}})]}}}function m(e,t){var n;return[{id:1,parentId:0,type:"root",calType:"=",columnName:null,columnNum:+(null===(n=t.customerInfo)||void 0===n?void 0:n.columnNum)||0,selectedValues:["Y"],updateCycle:null},...e.map((e,t)=>{var n;return{id:t+2,parentId:t+1,type:"normal",isFission:0,calType:e.calType,columnName:e.columnName,columnNum:e.columnNum,selectedValues:e.selectedValues,numVal1:null!==(n=e.numVal1)&&void 0!==n?n:e.value,numVal2:e.numVal2,updateCycle:null}})]}function p(e){const{crossJoin:t=!1,taskType:n,productList:i,channelId:s,ruleList:o,scoreRange:a,isManualPerfection:r=1,peopleCnt:d=null}=e;let m=[];if(!d&&!a||!d&&2!==a.length)throw this.$message.error("请正确填写客群规模或得分区间！"),new Error("参数异常");if(t||1===n){if(o.length)for(let l=0;l<i.length;l++)for(let e=0;e<o.length;e++)m.push({ruleList:[o[e]],planId:i[l].planId,priority:0,custgroupList:[]})}else m=i.map(e=>{const t={ruleList:o,planId:e.planId,priority:0,custgroupList:[]};return 0===o.length&&delete t.ruleList,t});const p=o.length?{prodCustGroupList:m}:{};return{isManualPerfection:r,resByAIReqVO:{taskType:0,channelId:s,coordinationSwitch:0,executeType:0,hotSwitch:0,marketGoal:"1,3",recommendGoal:0,recommendProdNum:-1,taskEffectTime:l()().format("yyyy-MM-DD"),taskFailTime:"2099-12-31",taskId:"",taskName:"task_"+Date.now()+parseInt(1e3*Math.random()),execFlag:"0",createUserId:c,createUserName:u,downshiftFilter:"1",...p,prodPriorityList:i.map(e=>({peopleCnt:d,planId:e.planId,priority:0,planDescribe:e.planDesc,limitScore:d?null:a[0],maxScore:d?null:a[1],recommendMode:1,presetCustName:""}))}}}},"9cf7":function(e,t,n){},afd9:function(e,t,n){"use strict";t["a"]={search0:"/plan-svc/api/intellpushprism/column/search0",valuePage:"/plan-svc/api/intellpushprism/column/valuePage",getTargetUserCount:"/plan-svc/api/intellpushprism/column/getTargetUserCount",batchImportProduct:"/plan-svc/api/intellpushprism/batchImportProduct",batchImpPlanTmpDownload:"/plan-svc/api/intellpushprism/batchImpPlanTmpDownload",saveScene:"/plan-svc/api/intellpushprism/saveScene",batchImportCust:"/plan-svc/api/intellpushprism/batchImportCust",batchImpCustTmpDownload:"/plan-svc/api/intellpushprism/batchImpCustTmpDownload",batchImportLabel:"/plan-svc/api/intellpushprism/batchImportLabel",batchImpLabelTmpDownload:"/plan-svc/api/intellpushprism/batchImpLabelTmpDownload",queryScoreRangeBatch:"/plan-svc/api/intellpushprism/ai/queryScoreRangeBatch",downloadChanPromptFile:"/plan-svc/mcd/chan/prompt/downloadChanPromptFile",getInferenceResByAI:"/plan-svc/api/intellpushprism/ai/getInferenceResByAI",queryScoreRange:"/plan-svc/api/intellpushprism/ai/queryScoreRange",queryAICustLoseWeightRes:"/plan-svc/api/intellpushprism/ai/queryAICustLoseWeightRes",OperationWorkshop:{queryMyAttentionPlan:"/plan-svc/api/intellpushprism/ai/queryMyAttentionPlan",addMyAttentionPlan:"/plan-svc/api/intellpushprism/ai/addMyAttentionPlan",getCampEvalTop5ByPlan:"/plan-svc/api/intellpushprism/ai/getCampEvalTop5ByPlan",getAITagTop10ByPlan:"/plan-svc/api/intellpushprism/ai/getAITagTop10ByPlan",removeMyAttentionPlan:"/plan-svc/api/intellpushprism/ai/removeMyAttentionPlan"}}}}]);