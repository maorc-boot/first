(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b13f1178"],{"0033":function(e,t,a){"use strict";a("5aeb")},"0789":function(e,t,a){"use strict";a("f37e")},"123d":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"clientele-content"},[t("el-tabs",{attrs:{type:"card"},model:{value:e.tabActive,callback:function(t){e.tabActive=t},expression:"tabActive"}},[t("el-tab-pane",{attrs:{label:"产品配置",name:"product",lazy:!0}},[t("ProductConfig")],1),t("el-tab-pane",{attrs:{label:"标签配置",name:"label",lazy:!0}},[t("LabelConfig")],1)],1)],1)},s=[],l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"wrap-pool-content"},[t("div",{staticClass:"top-search-edit"},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{size:"mini",placeholder:"请输入产品名称或产品编号"},model:{value:e.keyword,callback:function(t){e.keyword="string"===typeof t?t.trim():t},expression:"keyword"}},[t("i",{staticClass:"el-input__icon el-icon-search cursor-pointer",attrs:{slot:"suffix"},on:{click:e.searchTable},slot:"suffix"})])],1),t("div",{staticClass:"query-content"},[t("QueryFormCell",{attrs:{list:e.QueryFormList,defaultSizeForm:e.defaultSizeForm},on:{queryForm:e.queryForm}})],1),t("div",{staticStyle:{position:"relative",height:"0",width:"100%"}},[t("el-button",{staticStyle:{position:"absolute",right:"10px","z-index":"1",transform:"translateY(-115%)"},attrs:{type:"primary",size:"mini"},on:{click:e.openAddDialog}},[e._v("新增")])],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableData,stripe:"",height:"100%"}},[t("el-table-column",{attrs:{type:"index",label:"序号",align:"center"}}),t("el-table-column",{attrs:{label:"产品名称","min-width":"150",align:"center","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.gotoDetail(a)}}},[e._v(e._s(a.planName))])]}}])}),t("el-table-column",{attrs:{label:"产品编号",prop:"planId",align:"center"}}),t("el-table-column",{attrs:{label:"产品系列",prop:"typeName",align:"center"}}),t("el-table-column",{attrs:{label:"生效时间",prop:"startDate",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"失效时间",prop:"endDate",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"操作人",prop:"operator",align:"center"}}),t("el-table-column",{attrs:{label:"优先级",prop:"priority",align:"center"}}),t("el-table-column",{attrs:{label:"操作",align:"center",width:"90"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.openEditDialog(a)}}},[e._v("修改")]),t("el-button",{staticStyle:{color:"red"},attrs:{type:"text"},on:{click:function(t){return e.deleteData(a.planId)}}},[e._v("删除")])]}}])})],1),t("el-pagination",{attrs:{size:"mini","current-page":e.searchForm.current,"page-sizes":[10,20,30,40],"page-size":e.searchForm.size,"pager-count":5,total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),t("div",{staticClass:"edit-part",class:e.editVisible?"edit-show":""},[t("Edit",{attrs:{visible:e.editVisible,"current-row":e.currentRow},on:{"update:visible":function(t){e.editVisible=t},refresh:e.getTableData}})],1),t("div",{staticClass:"add-part",class:e.addVisible?"add-show":""},[t("Add",{attrs:{visible:e.addVisible},on:{"update:visible":function(t){e.addVisible=t},refresh:e.getTableData}})],1)],1)},r=[],n=(a("14d9"),a("0fea")),o=a("72ae"),c=a("4e3f"),p=function(){var e=this,t=e._self._c;return t("div",{staticClass:"edit-table-content"},[t("div",{staticClass:"top"},[t("QueryFormCell",{attrs:{list:e.QueryFormList,defaultSizeForm:e.defaultSizeForm}}),t("i",{staticClass:"el-icon-close",on:{click:e.closeDialog}})],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableData,"row-class-name":e.getRowClass,stripe:"",height:"350px"}},[t("el-table-column",{attrs:{type:"index",label:"序号"}}),t("el-table-column",{attrs:{label:"产品名称",prop:"planName",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"产品编号",prop:"planId",align:"center"}}),t("el-table-column",{attrs:{label:"产品系列",prop:"typeName",align:"center"}}),t("el-table-column",{attrs:{label:"生效时间",prop:"startDate",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"失效时间",prop:"endDate",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"优先级",align:"center",fixed:"right",width:"150"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-input-number",{attrs:{disabled:a.planId!=e.currentRow.planId,size:"mini",min:1,max:3e4,step:1},on:{change:function(t){return e.changePriority(t,a)}},model:{value:a.priority,callback:function(t){e.$set(a,"priority",t)},expression:"row.priority"}})]}}])})],1),t("el-pagination",{attrs:{size:"mini","current-page":e.current,"page-sizes":[5,10,20,40],"page-size":e.size,"pager-count":5,layout:"total, sizes, prev, pager, next, jumper",total:e.totalData.length||0},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),t("footer",[t("el-button",{attrs:{type:"primary",size:"medium",loading:e.saveLoading},on:{click:e.done}},[e._v("完 成")])],1)],1)},d=[],u={components:{QueryFormCell:c["a"]},props:{visible:{type:Boolean,default:!1},currentRow:{type:Object,default:()=>({})}},watch:{visible(){this.visible&&(this.$set(this.QueryFormList[0].values,0,{label:this.currentRow.typeName,value:""}),this.getTableData())}},computed:{tableData(){const e=(this.current-1)*this.size,t=this.current*this.size;return this.totalData.slice(e,t)}},data(){return{loading:!1,saveLoading:!1,defaultSizeForm:{radioModel:[""]},QueryFormList:[{label:"产品系列",values:[{label:"不限",value:""}]}],current:1,size:10,totalData:[],form:{planId:"",priority:""}}},methods:{async getTableData(){try{this.loading=!0;const e=await Object(n["i"])(o["a"].ecapi.qryPlanConfListByPlanTypeOnSave,{planType:this.currentRow.typeId||"1"});e.forEach((e,t)=>{e.timestamp=t+1}),this.totalData=e||[];const t=this.totalData.findIndex(e=>e.planId==this.currentRow.planId);this.current=Math.ceil((t+1)/this.size)}catch(e){}finally{this.loading=!1}},getRowClass({row:e,rowIndex:t}){return e.planId==this.currentRow.planId?"current-row-custom":""},handleSizeChange(e){this.size=e,this.current=1},handleCurrentChange(e){this.current=e},changePriority(e,t){this.form.planId=t.planId,this.form.priority=e,void 0===e&&(this.form.priority=t.priority),t.timestamp=(new Date).getTime(),this.$nextTick(()=>{this.totalData.sort((e,t)=>e.priority==t.priority?t.timestamp-e.timestamp:e.priority-t.priority);const e=this.totalData.findIndex(e=>e.planId==this.currentRow.planId);this.current=Math.ceil((e+1)/this.size)})},closeDialog(){this.$emit("update:visible",!1)},done(){this.form.planId?this.$confirm("是否确认保存配置操作？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{this.saveLoading=!0;const e=await Object(n["i"])(o["a"].ecapi.updatePriority,this.form);"SUCCESS"==e.status?(this.$message.success(e.message),this.$emit("refresh"),this.closeDialog()):this.$message.error(e.message)}catch(e){}finally{this.saveLoading=!1}}).catch(()=>{}):this.closeDialog()}}},h=u,m=(a("5d60"),a("2877")),g=Object(m["a"])(h,p,d,!1,null,"5da3e21a",null),y=g.exports,b=function(){var e=this,t=e._self._c;return t("section",{staticClass:"add-content"},[t("header",[t("el-steps",{attrs:{space:200,active:e.active,"align-center":"","finish-status":"success"}},[t("el-step",{attrs:{title:"添加产品"}}),t("el-step",{attrs:{title:"配置产品系列"}}),t("el-step",{attrs:{title:"配置优先级"}})],1),t("i",{staticClass:"el-icon-close",on:{click:e.closeDialog}})],1),t("main",[t("transition-group",{attrs:{name:"fade"}},[t("StepOne",{directives:[{name:"show",rawName:"v-show",value:0===e.active,expression:"active === 0"}],key:"StepOne",ref:"stepOne",on:{change:e.selectPlan}}),t("StepTwo",{directives:[{name:"show",rawName:"v-show",value:1===e.active,expression:"active === 1"}],key:"StepTwo",ref:"stepTwo",attrs:{planList:e.planList,active:e.active},on:{change:e.getPlanSeries}}),t("StepThree",{directives:[{name:"show",rawName:"v-show",value:2===e.active,expression:"active === 2"}],key:"StepThree",ref:"stepThree",attrs:{active:e.active,planSeries:e.planSeries}})],1)],1),t("footer",[0==e.active?t("portal-target",{attrs:{name:"next-part"}}):e._e(),t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.active>0,expression:"active > 0"}],attrs:{type:"primary",size:"medium"},on:{click:function(t){return e.nextStep(-1)}}},[e._v("上一步")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.active<2,expression:"active < 2"}],attrs:{type:"primary",size:"medium"},on:{click:function(t){return e.nextStep(1)}}},[e._v("下一步")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.active,expression:"active == 2"}],attrs:{type:"primary",size:"medium",loading:e.saveLoading},on:{click:e.done}},[e._v("完 成")])],1)])},v=[],f=function(){var e=this,t=e._self._c;return t("div",{staticClass:"step-content"},[t("div",{staticClass:"top-search-edit"},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{size:"mini",placeholder:"请输入产品名称或产品编号"},model:{value:e.keyword,callback:function(t){e.keyword="string"===typeof t?t.trim():t},expression:"keyword"}},[t("i",{staticClass:"el-input__icon el-icon-search cursor-pointer",attrs:{slot:"suffix"},on:{click:e.searchTable},slot:"suffix"})])],1),t("div",{staticClass:"query-content"},[t("QueryFormCell",{attrs:{labelWidth:"110px",list:e.QueryFormList,defaultSizeForm:e.defaultSizeForm},on:{queryForm:e.queryForm}})],1),t("div",{staticStyle:{position:"relative",height:"0",width:"100%"}},[t("el-button",{staticStyle:{position:"absolute",right:"10px","z-index":"1",transform:"translateY(-115%)"},attrs:{type:"primary",size:"mini",loading:e.searchLoading},on:{click:e.selectAllOrCancel}},[e._v(e._s(e.isSelectAll?"全部取消":"全部选择"))])],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableData,stripe:"",height:"100%"}},[t("el-table-column",{attrs:{type:"index",label:"序号",align:"center"}}),t("el-table-column",{attrs:{prop:"planName",label:"产品名称","min-width":"150",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"产品编号",prop:"planId",align:"center"}}),t("el-table-column",{attrs:{label:"产品业务分类",prop:"prodClassBusi",align:"center"}}),t("el-table-column",{attrs:{label:"生效时间",prop:"planStartDate",align:"center"}}),t("el-table-column",{attrs:{label:"失效时间",prop:"planEndDate",align:"center"}}),t("el-table-column",{attrs:{label:"操作",align:"center",width:"90"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[e.selectTableData.some(e=>e.planId==a.planId)?t("el-button",{staticStyle:{color:"#999"},attrs:{type:"text",size:"mini"},on:{click:function(t){return e.cancelData(a)}}},[e._v("取消")]):t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.selectData(a)}}},[e._v("选择")])]}}])})],1),t("el-pagination",{attrs:{size:"mini","current-page":e.searchForm.current,"page-sizes":[10,20,30,40],"page-size":e.searchForm.size,"pager-count":5,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),t("portal",{attrs:{to:"next-part"}},[t("div",{staticClass:"shopping-cart"},[t("span",{staticClass:"icon",on:{click:function(t){e.showSelectTable=!e.showSelectTable}}},[t("i",{staticClass:"el-icon-shopping-cart-full"})]),t("span",{staticClass:"desc",on:{click:function(t){e.showSelectTable=!e.showSelectTable}}},[e._v("已选产品"+e._s(e.selectTableData.length+" / "+e.PLAN_COORDINATE_UP_LIMIT)+"个")])])]),t("div",{staticClass:"footer-table",class:{show:e.showSelectTable}},[t("SelectTable",{attrs:{totalData:e.selectTableData},on:{cancelData:e.cancelData,close:()=>e.showSelectTable=!1,cancelAll:e.cancelAll}})],1)],1)},w=[],T=a("d370"),C=function(){var e=this,t=e._self._c;return t("div",{staticClass:"select-table-content"},[t("div",{staticClass:"top"},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{size:"mini",placeholder:"请输入产品名称或产品编号"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchTable.apply(null,arguments)}},model:{value:e.keyword,callback:function(t){e.keyword="string"===typeof t?t.trim():t},expression:"keyword"}},[t("i",{staticClass:"el-input__icon el-icon-search cursor-pointer",attrs:{slot:"suffix"},on:{click:e.searchTable},slot:"suffix"})]),t("span",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$emit("cancelAll")}}},[e._v("全部取消")]),t("i",{staticClass:"el-icon-close",on:{click:function(t){return e.$emit("close")}}})],1)],1),t("el-table",{attrs:{data:e.tableData,stripe:"",height:"100%"}},[t("el-table-column",{attrs:{type:"index",label:"序号",align:"center"}}),t("el-table-column",{attrs:{label:"产品名称",prop:"planName","min-width":"150",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"产品编号",prop:"planId",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"产品业务分类",prop:"prodClassBusi",align:"center"}}),t("el-table-column",{attrs:{label:"生效时间",prop:"planStartDate",align:"center"}}),t("el-table-column",{attrs:{label:"失效时间",prop:"planEndDate",align:"center"}}),t("el-table-column",{attrs:{label:"操作",align:"center",fixed:"right",width:"80"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.$emit("cancelData",a.row)}}},[e._v("取消")])]}}])})],1),t("el-pagination",{attrs:{size:"mini","current-page":e.pageNum,"page-sizes":[10,20,30,40],"page-size":e.pageSize,"pager-count":5,layout:"total, sizes, prev, pager, next, jumper",total:e.totalData.length},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},S=[],D={props:["totalData"],computed:{tableData(){const e=this.totalData.filter(e=>e.planName.includes(this.keyword)||String(e.planId).includes(this.keyword));return e.slice((this.pageNum-1)*this.pageSize,this.pageNum*this.pageSize)}},data(){return{temp:"",keyword:"",pageNum:1,pageSize:10}},methods:{searchTable(){this.keyword=this.temp,this.pageNum=1},handleSizeChange(e){this.pageSize=e,this.pageNum=1},handleCurrentChange(e){this.pageNum=e}}},z=D,x=(a("91a3"),Object(m["a"])(z,C,S,!1,null,"064d659e",null)),k=x.exports,F={components:{QueryFormCell:c["a"],SelectTable:k},data(){return{loading:!1,searchLoading:!1,searchForm:{keyWords:"",prodClassBusi:"",current:1,size:10},keyword:"",defaultSizeForm:{radioModel:[""]},QueryFormList:[{label:"产品业务分类",values:[{label:"不限",value:""}]}],tableData:[],total:0,allData:[],showSelectTable:!1,PLAN_COORDINATE_UP_LIMIT:100,selectTableData:[]}},watch:{"selectTableData.length"(e){this.$emit("change",this.selectTableData)}},computed:{isSelectAll(){return!1}},methods:{init(){this.keyword="",this.defaultSizeForm={radioModel:[""]},this.searchForm.prodClassBusi="",this.searchTable(),this.selectTableData=[]},async getTypeList(){try{const e=await Object(n["g"])(T["a"].mpapi.querylistEnumValue,{labelKey:"PROD_CLASS_BUSI"}),t=e.map(e=>({label:e.labelValue,value:e.labelValue}));this.$set(this.QueryFormList[0],"values",[...this.QueryFormList[0].values,...t])}catch(e){}},async getShopCartMax(){try{const e=await Object(n["i"])(o["a"].ecapi.getSysDics,{dicKeys:["PLAN_COORDINATE_UP_LIMIT"]});this.PLAN_COORDINATE_UP_LIMIT=Number(e[0])||100}catch(e){}},queryForm(e){this.searchForm.prodClassBusi=e.value,this.searchTable()},searchTable(){this.searchForm.keyWords=this.keyword,this.searchForm.current=1,this.getTableData(!0)},handleSizeChange(e){this.searchForm.current=1,this.searchForm.size=e,this.getTableData()},handleCurrentChange(e){this.searchForm.current=e,this.getTableData()},async getTableData(e=!1){try{this.loading=!0;const{records:e,total:t}=await Object(n["i"])(o["a"].ecapi.qryNotCfgPlanTypeAndPri,this.searchForm);this.tableData=e,this.total=t}catch(t){}finally{this.loading=!1}},selectData(e){this.selectTableData.push(e)},cancelData(e){this.selectTableData=this.selectTableData.filter(t=>t.planId!=e.planId)},async selectAllOrCancel(){try{this.searchLoading=!0;const{records:e}=await Object(n["i"])(o["a"].ecapi.qryNotCfgPlanTypeAndPri,{...this.searchForm,current:1,size:this.PLAN_COORDINATE_UP_LIMIT}),t=[...this.selectTableData,...e];this.selectTableData=t.filter((e,t,a)=>a.findIndex(t=>t.planId==e.planId)==t),this.selectTableData.length>this.PLAN_COORDINATE_UP_LIMIT&&(this.$message.warning(`最多只能选择${this.PLAN_COORDINATE_UP_LIMIT}条数据，已过滤超出的数据`),this.selectTableData=this.selectTableData.slice(0,this.PLAN_COORDINATE_UP_LIMIT))}catch(e){}finally{this.searchLoading=!1}},cancelAll(){this.selectTableData=[]}},created(){this.getTypeList(),this.getShopCartMax(),this.init()}},L=F,N=(a("26e4"),Object(m["a"])(L,f,w,!1,null,"4406d6bf",null)),I=N.exports,_=function(){var e=this,t=e._self._c;return t("div",{staticClass:"step-content"},[t("div",{staticClass:"left"},[t("div",{staticClass:"top"},[t("span",[e._v("待选产品")]),t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{size:"mini",placeholder:"请输入产品名称或产品编号"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchTable.apply(null,arguments)}},model:{value:e.temp,callback:function(t){e.temp="string"===typeof t?t.trim():t},expression:"temp"}},[t("i",{staticClass:"el-input__icon el-icon-search cursor-pointer",attrs:{slot:"suffix"},on:{click:e.searchTable},slot:"suffix"})])],1),t("el-table",{key:"table",attrs:{data:e.tableData,stripe:"",height:"100%"},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),t("el-table-column",{attrs:{type:"index",label:"序号",align:"center"}}),t("el-table-column",{attrs:{label:"产品名称",prop:"planName",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"产品编号",prop:"planId",align:"center","show-overflow-tooltip":""}})],1),t("el-pagination",{attrs:{size:"mini","current-page":e.pageNum,"page-sizes":[10,20,50,100],"page-size":e.pageSize,"pager-count":5,total:e.searchDataTotal,layout:"total, sizes, prev, pager, next"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("div",{staticClass:"middle"},[t("div",{staticClass:"circle",on:{click:e.sortPlan}},[t("i",{staticClass:"el-icon-arrow-right"})])]),t("div",{staticClass:"right"},[e._m(0),t("el-collapse",{attrs:{accordion:""},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.planSeries,(function(a,i){return t("el-collapse-item",{key:a.id,attrs:{title:a.name,name:i}},[t("ul",{staticClass:"plan-ul"},[t("transition-group",{attrs:{name:"fade-li"}},e._l(a.value,(function(a){return t("li",{key:a.planId},[t("span",[e._v(e._s(a.planName))]),t("span",[e._v(e._s(a.planId))]),t("i",{staticClass:"el-icon-close",on:{click:function(t){return e.removePlan(a.planId)}}})])})),0),0===a.value.length?t("div",{key:"empty",staticClass:"empty"},[t("span",[e._v("暂无数据")])]):e._e()],1)])})),1)],1)])},P=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"top"},[t("span",[e._v("产品系列")])])}],O={name:"StepTwo",props:{planList:{type:Array,default:()=>[]},active:{type:Number,default:0}},watch:{active(e){1===e&&0===this.planSeries.length&&this.getProductList()}},computed:{tableData(){let e=this.planList.filter(e=>e.planName.includes(this.keyword)||String(e.planId).includes(this.keyword));return e=e.filter(e=>!this.planSeriesPlanList.some(t=>t.planId===e.planId)),this.searchDataTotal=e.length,e.slice((this.pageNum-1)*this.pageSize,this.pageNum*this.pageSize)},planSeriesPlanList(){let e=[];return this.planSeries.forEach(t=>{e=e.concat(t.value)}),e}},data(){return{temp:"",keyword:"",pageNum:1,pageSize:10,selectTableData:[],searchDataTotal:0,planSeries:[],activeName:0,preActiveName:0}},methods:{async getProductList(){try{const e=await Object(n["i"])(o["a"].ecapi.qryPlanTypeList),t=e.map(e=>({name:e.typeName,id:e.typeId,value:[]}));this.planSeries=t}catch(e){}},searchTable(){this.pageNum=1,this.keyword=this.temp},handleSizeChange(e){this.pageSize=e,this.pageNum=1},handleCurrentChange(e){this.pageNum=e},handleSelectionChange(e){this.selectTableData=e},sortPlan(){if(0!==this.tableData.length&&0!==this.planSeries.length){if(0===this.selectTableData.length)return this.$message.warning("请选择产品");if(""===this.activeName)return this.$message.warning("请选择产品系列");this.$set(this.planSeries[this.activeName],"value",[...this.planSeries[this.activeName].value,...this.selectTableData]),this.selectTableData=[],this.$nextTick(()=>{this.$emit("change",this.planSeries)})}},removePlan(e){const t=this.planSeries[this.activeName].value.findIndex(t=>t.planId===e);this.planSeries[this.activeName].value.splice(t,1)},clear(){this.temp="",this.keyword="",this.pageNum=1,this.pageSize=10,this.planSeries.forEach(e=>{e.value=[]})}}},$=O,A=(a("c562"),Object(m["a"])($,_,P,!1,null,"8038810e",null)),q=A.exports,B=function(){var e,t=this,a=t._self._c;return a("div",{staticClass:"step-content"},[""!==t.defaultSizeForm.radioModel[0]?a("QueryFormCell",{attrs:{list:t.QueryFormList,defaultSizeForm:t.defaultSizeForm},on:{queryForm:t.queryForm}}):t._e(),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.tableData,"row-class-name":t.getRowClass,stripe:"",height:"350px"}},[a("el-table-column",{attrs:{type:"index",label:"序号",align:"center"}}),a("el-table-column",{attrs:{label:"产品名称",prop:"planName",align:"center","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"产品编号",prop:"planId",align:"center"}}),a("el-table-column",{attrs:{label:"产品系列",prop:"typeName",align:"center"}}),a("el-table-column",{attrs:{label:"生效时间",prop:"startDate",align:"center","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"失效时间",prop:"endDate",align:"center","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"优先级",align:"center",width:"180"},scopedSlots:t._u([{key:"default",fn:function({row:e}){return[a("el-input-number",{attrs:{size:"mini",min:1,max:3e4,step:1,precision:0},on:{change:function(a){return t.changePriority(...arguments,e)}},model:{value:e.priority,callback:function(a){t.$set(e,"priority",a)},expression:"row.priority"}})]}}])})],1),a("el-pagination",{attrs:{size:"mini","current-page":t.current,"page-sizes":[5,10,20,40],"page-size":t.size,"pager-count":5,layout:"total, prev, pager, next",total:(null===(e=t.copyPlanSeries[t.currentPlanIndex])||void 0===e||null===(e=e.value)||void 0===e?void 0:e.length)||0},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)},j=[],M={components:{QueryFormCell:c["a"]},props:{active:{type:Number,default:0},planSeries:{type:Array,default:()=>[]}},computed:{defaultSizeForm(){let e="";for(let t=0;t<this.planSeries.length;t++)if(this.planSeries[t].value.length>0)return e=this.planSeries[t].id,this.planType=e,{radioModel:[e]};return this.planType="",{radioModel:[""]}},QueryFormList(){const e=this.planSeries.filter(e=>e.value.length>0);return[{label:"产品系列",isDate:!1,values:e.map(e=>({label:e.name,value:e.id}))}]},tableData(){const{value:e}=this.copyPlanSeries[this.currentPlanIndex]||{};return e&&0!==e.length?e.slice((this.current-1)*this.size,this.current*this.size):[]}},watch:{active(e,t){if(2===e){this.planType=this.defaultSizeForm.radioModel[0];let e=this.planSeries.filter(e=>e.value.length>0);this.copyPlanSeries=e.map(e=>({id:e.id,name:e.name,value:JSON.parse(JSON.stringify(e.value)),apiData:[]})),this.copyPlanSeries.forEach(e=>{e.value=e.value.map(t=>({planId:t.planId,planName:t.planName,typeId:e.id,typeName:e.name,startDate:t.planStartDate,endDate:t.planEndDate,add:!0}))}),this.getTableData(!0)}}},data(){return{loading:!1,planType:"",current:1,size:10,copyPlanSeries:[{value:[],apiData:[]}],currentPlanIndex:0}},methods:{queryForm(e){this.planType=e.value,this.getTableData()},async getTableData(){this.currentPlanIndex=this.copyPlanSeries.findIndex(e=>e.id==this.planType),-1===this.currentPlanIndex&&(this.currentPlanIndex=0);let{value:e,apiData:t}=this.copyPlanSeries[this.currentPlanIndex]||{value:[],apiData:[]};const a=JSON.parse(JSON.stringify(e));if(t.length>0)this.current=Math.ceil((t.length+1)/this.size);else try{var i;this.loading=!0;const e=await Object(n["i"])(o["a"].ecapi.qryPlanConfListByPlanTypeOnSave,{planType:this.planType});this.copyPlanSeries[this.currentPlanIndex].apiData=JSON.parse(JSON.stringify(e)),e.forEach((e,t)=>{e.timestamp=t+1});const t=+(null===(i=e[e.length-1])||void 0===i?void 0:i.priority)||0,s=a.map((e,a)=>({...e,timestamp:t+a+1,priority:t+a+1}));this.$set(this.copyPlanSeries[this.currentPlanIndex],"value",[...e,...s]),0===a.length?this.current=1:this.current=Math.ceil((e.length+1)/this.size)}catch(s){}finally{this.loading=!1}},getRowClass({row:e,rowIndex:t}){return e.add?"edit-row-custom":""},handleSizeChange(e){this.size=e,this.current=1},handleCurrentChange(e){this.current=e},changePriority(e,t,a){if(e!=t){if(void 0===e)return this.$message.warning("优先级不能为空");a.timestamp=(new Date).getTime(),this.sortTable(a)}},sortTable(e){this.$nextTick(()=>{this.copyPlanSeries[this.currentPlanIndex].value.sort((e,t)=>e.priority==t.priority?t.timestamp-e.timestamp:e.priority-t.priority),this.current=Math.ceil((this.copyPlanSeries[this.currentPlanIndex].value.findIndex(t=>t.planId===e.planId)+1)/this.size||1)})}}},E=M,R=(a("b530"),Object(m["a"])(E,B,j,!1,null,"2603376a",null)),Q=R.exports,V={components:{StepOne:I,StepTwo:q,StepThree:Q},props:{visible:{type:Boolean,default:!1}},watch:{visible(e){e?this.$refs.stepOne.init():this.$refs.stepOne.showSelectTable=!1},active(){this.$refs.stepOne.showSelectTable=!1}},data(){return{active:0,saveLoading:!1,planList:[],planSeries:[]}},computed:{currentStep(){switch(this.active){case 0:return"StepOne";case 1:return"StepTwo";case 2:return"StepThree"}},canThree(){}},methods:{selectPlan(e){this.planList=e},getPlanSeries(e){this.planSeries=e},nextStep(e){if(0===this.active){if(0===this.planList.length)return this.$alert("请先选择产品！","提示",{confirmButtonText:"确定",type:"warning"}).catch(()=>{})}else if(1===this.active&&1===e){let e=[];if(this.planSeries.forEach(t=>{e=e.concat(t.value)}),0===e.length)return this.$alert("请先完成产品系列配置！","提示",{confirmButtonText:"确定",type:"warning"}).catch(()=>{})}this.active+=e},done(){const e=this.$refs.stepThree.copyPlanSeries,t=[];let a=!0;if(e.forEach(e=>{let i=e.value.filter(t=>!e.apiData.some(e=>t.planId===e.planId&&t.priority==e.priority));i.forEach(e=>{e.priority||0===e.priority||(a=!1),t.push(e)})}),!a)return this.$alert("请先完成优先级配置！","提示",{confirmButtonText:"确定",type:"warning"}).catch(()=>{});this.$confirm("是否确认保存配置操作","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{this.saveLoading=!0;await Object(n["i"])(o["a"].ecapi.savePlanConf,t);this.$message({type:"success",message:"保存成功！",duration:1e3}),this.$emit("refresh"),this.closeDialog(!1)}catch(e){}finally{this.saveLoading=!1}}).catch(()=>{})},closeDialog(e=!0){e?this.$confirm("关闭后配置操作将不会保存，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$emit("update:visible",!1),this.$nextTick(()=>{this.active=0,this.planList=[],this.planSeries=[],this.planSeriesConfigList=[],this.$refs.stepTwo.clear()})}).catch(()=>{}):(this.$emit("update:visible",!1),this.$nextTick(()=>{this.active=0,this.planList=[],this.planSeries=[],this.planSeriesConfigList=[],this.$refs.stepTwo.clear()}))}}},U=V,W=(a("addf"),Object(m["a"])(U,b,v,!1,null,"1b378b9c",null)),J=W.exports,Y={components:{QueryFormCell:c["a"],Edit:y,Add:J},data(){return{loading:!1,searchLoading:!1,searchForm:{keyWords:"",planType:"",current:1,size:10},keyword:"",defaultSizeForm:{radioModel:[""]},QueryFormList:[{label:"产品系列",values:[{label:"不限",value:""}]}],tableData:[],total:0,editVisible:!1,addVisible:!1,currentRow:{}}},computed:{},methods:{async getProductList(){try{const e=await Object(n["i"])(o["a"].ecapi.qryPlanTypeList),t=e.map(e=>({label:e.typeName,value:e.typeId}));this.$set(this.QueryFormList[0],"values",[...this.QueryFormList[0].values,...t])}catch(e){}},queryForm(e){this.searchForm.planType=e.form.radioModel[0],this.searchTable()},gotoDetail(e){this.$router.push({path:"/ProductPolicy/ProDetail",query:{planId:e.planId,backName:this.$router.currentRoute.name}})},searchTable(){this.searchForm.keyWords=this.keyword,this.searchForm.current=1,this.getTableData(!0)},handleSizeChange(e){this.searchForm.current=1,this.searchForm.size=e,this.getTableData()},handleCurrentChange(e){this.searchForm.current=e,this.getTableData()},async getTableData(){try{this.loading=!0;const{records:e,total:t}=await Object(n["i"])(o["a"].ecapi.qryPlanConfList,this.searchForm);this.tableData=e,this.total=t}catch(e){}finally{this.loading=!1}},deleteData(e){this.$confirm("是否确认将该产品从产品配置中删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Object(n["i"])(o["a"].ecapi.delPlanConfList,{id:e}),this.$message({type:"success",message:"删除成功!"}),this.getTableData()}catch(t){}}).catch(()=>{})},openAddDialog(e){this.addVisible=!0},openEditDialog(e){this.currentRow=e,this.editVisible=!0}},created(){this.getProductList(),this.searchTable()}},G=Y,H=(a("3111"),Object(m["a"])(G,l,r,!1,null,"2320f222",null)),K=H.exports,X=function(){var e=this,t=e._self._c;return t("div",{staticClass:"wrap-pool-content"},[t("div",{staticClass:"top-search-edit"},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{size:"mini",placeholder:"请输入标签名称或标签编号"},model:{value:e.keyword,callback:function(t){e.keyword="string"===typeof t?t.trim():t},expression:"keyword"}},[t("i",{staticClass:"el-input__icon el-icon-search cursor-pointer",attrs:{slot:"suffix"},on:{click:e.searchTable},slot:"suffix"})])],1),t("div",{staticClass:"query-content"},[t("QueryFormCell",{attrs:{list:e.QueryFormList,defaultSizeForm:e.defaultSizeForm},on:{queryForm:e.queryForm}})],1),t("div",{staticStyle:{position:"relative",height:"0",width:"100%"}},[t("el-button",{staticStyle:{position:"absolute",right:"10px","z-index":"1",transform:"translateY(-115%)"},attrs:{type:"primary",size:"mini"},on:{click:e.openAddDialog}},[e._v("新增")])],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableData,stripe:"",height:"100%"}},[t("el-table-column",{attrs:{type:"index",label:"序号",align:"center"}}),t("el-table-column",{attrs:{label:"标签名称",prop:"tagName","min-width":"150",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"标签编号",prop:"tagId",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"客户类型",prop:"custTypeName",align:"center"}}),t("el-table-column",{attrs:{label:"优先级",prop:"orderBy",align:"center"}}),t("el-table-column",{attrs:{label:"操作人",prop:"operator",align:"center"}}),t("el-table-column",{attrs:{label:"创建时间",prop:"createTime",align:"center"}}),t("el-table-column",{attrs:{label:"操作",align:"center",width:"90"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.openEditDialog(a)}}},[e._v("修改")]),t("el-button",{staticStyle:{color:"red"},attrs:{type:"text"},on:{click:function(t){return e.deleteData(a.tagId)}}},[e._v("删除")])]}}])})],1),t("el-pagination",{attrs:{size:"mini","current-page":e.searchForm.current,"page-sizes":[10,20,30,40],"page-size":e.searchForm.size,"pager-count":5,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),t("div",{staticClass:"edit-part",class:e.editVisible?"edit-show":""},[t("Edit",{attrs:{visible:e.editVisible,"current-row":e.currentRow},on:{"update:visible":function(t){e.editVisible=t},refresh:e.getTableData}})],1),t("div",{staticClass:"add-part",class:e.addVisible?"add-show":""},[t("Add",{attrs:{visible:e.addVisible,QueryFormList:e.QueryFormList},on:{"update:visible":function(t){e.addVisible=t},refresh:e.getTableData}})],1)],1)},Z=[],ee=function(){var e=this,t=e._self._c;return t("div",{staticClass:"edit-table-content"},[t("div",{staticClass:"top"},[t("i",{staticClass:"el-icon-close",on:{click:e.closeDialog}})]),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableData,"row-class-name":e.getRowClass,stripe:"",height:"350px"}},[t("el-table-column",{attrs:{type:"index",label:"序号"}}),t("el-table-column",{attrs:{label:"标签编号",prop:"tagId",align:"center"}}),t("el-table-column",{attrs:{label:"标签名称",prop:"tagName",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"客户类型",prop:"custTypeName",align:"center"}}),t("el-table-column",{attrs:{label:"优先级",align:"center",fixed:"right",width:"150"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-input-number",{attrs:{disabled:a.tagId!=e.currentRow.tagId,size:"mini",min:1,max:3e3,step:1},on:{change:function(t){return e.changePriority(t,a)}},model:{value:a.orderBy,callback:function(t){e.$set(a,"orderBy",t)},expression:"row.orderBy"}})]}}])})],1),t("el-pagination",{attrs:{size:"mini","current-page":e.pageNum,"page-sizes":[5,10,20,40],"page-size":e.pageSize,"pager-count":5,layout:"total, sizes, prev, pager, next, jumper",total:e.totalData.length},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),t("footer",[t("el-button",{attrs:{type:"primary",size:"medium",loading:e.saveLoading},on:{click:e.done}},[e._v("完 成")])],1)],1)},te=[],ae={name:"CalcConfigDialog",components:{QueryFormCell:c["a"]},props:{visible:{type:Boolean,default:!1},currentRow:{type:Object,default:()=>({})}},watch:{visible(){this.visible&&this.getTotalData()}},computed:{tableData(){return this.totalData.slice((this.pageNum-1)*this.pageSize,this.pageNum*this.pageSize)}},data(){return{loading:!1,saveLoading:!1,pageNum:1,pageSize:10,totalData:[]}},methods:{async getTotalData(){try{this.loading=!0;const e=await Object(n["i"])(o["a"].ecapi.queryAllTag);e.forEach((e,t)=>{e.timestamp=t+1}),this.totalData=e,this.pageNum=Math.ceil(this.totalData.findIndex(e=>e.tagId===this.currentRow.tagId)/this.pageSize||1)}catch(e){}finally{this.loading=!1}},getRowClass({row:e,rowIndex:t}){return e.tagId==this.currentRow.tagId?"current-row-custom":""},handleSizeChange(e){this.pageSize=e,this.pageNum=1},handleCurrentChange(e){this.pageNum=e},changePriority(e,t){t.timestamp=(new Date).getTime(),this.$nextTick(()=>{this.totalData.sort((e,t)=>e.orderBy==t.orderBy?t.timestamp-e.timestamp:e.orderBy-t.orderBy),this.pageNum=Math.ceil((this.totalData.findIndex(e=>e.tagId===t.tagId)+1)/this.pageSize||1)})},closeDialog(){this.$emit("update:visible",!1)},done(){this.$confirm("是否确认保存配置操作？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{this.saveLoading=!0;const e=this.totalData.find(e=>e.tagId===this.currentRow.tagId),t=await Object(n["i"])(o["a"].ecapi.updateTagOrderBy,{tagId:e.tagId,orderBy:e.orderBy});this.$message({type:"SUCCESS"==t.status?"success":"error",message:t.message,duration:500}),this.$emit("refresh"),this.$emit("update:visible",!1),this.closeDialog()}catch(e){}finally{this.saveLoading=!1}}).catch(()=>{})}}},ie=ae,se=(a("6bd4"),Object(m["a"])(ie,ee,te,!1,null,"74c8c08e",null)),le=se.exports,re=function(){var e=this,t=e._self._c;return t("section",{staticClass:"add-content"},[t("header",[t("el-steps",{attrs:{space:200,active:e.active,"align-center":"","finish-status":"success"}},[t("el-step",{attrs:{title:"添加标签"}}),t("el-step",{attrs:{title:"配置优先级"}})],1),t("i",{staticClass:"el-icon-close",on:{click:e.closeDialog}})],1),t("main",[t("transition-group",{attrs:{name:"fade"}},[t("StepOne",{directives:[{name:"show",rawName:"v-show",value:0===e.active,expression:"active === 0"}],key:"StepOne",ref:"stepOne",attrs:{QueryFormList:e.QueryFormList},on:{change:e.selectLabel}}),t("StepTwo",{directives:[{name:"show",rawName:"v-show",value:1===e.active,expression:"active === 1"}],key:"StepTwo",ref:"stepTwo",attrs:{active:e.active,labelList:e.labelList}})],1)],1),t("footer",[0==e.active?t("portal-target",{attrs:{name:"next-part-2"}}):e._e(),t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.active>0,expression:"active > 0"}],attrs:{type:"primary",size:"medium"},on:{click:function(t){return e.nextStep(-1)}}},[e._v("上一步")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.active<1,expression:"active < 1"}],attrs:{type:"primary",size:"medium"},on:{click:function(t){return e.nextStep(1)}}},[e._v("下一步")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.active,expression:"active == 1"}],attrs:{type:"primary",size:"medium",loading:e.saveLoading},on:{click:e.done}},[e._v("完 成")])],1)])},ne=[],oe=function(){var e=this,t=e._self._c;return t("div",{staticClass:"step-content"},[t("div",{staticClass:"top-search-edit"},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{size:"mini",placeholder:"请输入标签名称或标签编号"},model:{value:e.keyword,callback:function(t){e.keyword="string"===typeof t?t.trim():t},expression:"keyword"}},[t("i",{staticClass:"el-input__icon el-icon-search cursor-pointer",attrs:{slot:"suffix"},on:{click:e.searchTable},slot:"suffix"})])],1),t("div",{staticClass:"query-content"},[t("QueryFormCell",{attrs:{list:e.QueryFormList,defaultSizeForm:e.defaultSizeForm},on:{queryForm:e.queryForm}})],1),t("div",{staticStyle:{position:"relative",height:"0",width:"100%"}},[e.total>0?t("el-button",{staticStyle:{position:"absolute",right:"10px","z-index":"1",transform:"translateY(-115%)"},attrs:{type:"primary",size:"mini",loading:e.searchLoading},on:{click:e.selectAllOrCancel}},[e._v(e._s(e.isSelectAll?"全部取消":"全部选择"))]):e._e()],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableData,stripe:"",height:"100%"}},[t("el-table-column",{attrs:{type:"index",label:"序号",align:"center"}}),t("el-table-column",{attrs:{label:"标签名称",prop:"tagName","min-width":"150",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"标签编号",prop:"tagId",align:"center"}}),t("el-table-column",{attrs:{label:"客户类型",prop:"custTypeName",align:"center"}}),t("el-table-column",{attrs:{label:"操作",align:"center",width:"90"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[e.selectTableData.some(e=>e.tagId==a.tagId)?t("el-button",{staticStyle:{color:"#999"},attrs:{type:"text",size:"mini"},on:{click:function(t){return e.cancelData(a)}}},[e._v("取消")]):t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.selectData(a)}}},[e._v("选择")])]}}])})],1),t("el-pagination",{attrs:{size:"mini","current-page":e.searchForm.current,"page-sizes":[10,20,30,40],"page-size":e.searchForm.size,"pager-count":5,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),t("portal",{attrs:{to:"next-part-2"}},[t("div",{staticClass:"shopping-cart"},[t("span",{staticClass:"icon",on:{click:function(t){e.showSelectTable=!e.showSelectTable}}},[t("i",{staticClass:"el-icon-shopping-cart-full"})]),t("span",{staticClass:"desc",on:{click:function(t){e.showSelectTable=!e.showSelectTable}}},[e._v("已选标签"+e._s(e.selectTableData.length)+"个")])])]),t("div",{staticClass:"footer-table",class:{show:e.showSelectTable}},[t("SelectTable",{attrs:{totalData:e.selectTableData},on:{cancelData:e.cancelData,close:()=>e.showSelectTable=!1,cancelAll:e.cancelAll}})],1)],1)},ce=[],pe=function(){var e=this,t=e._self._c;return t("div",{staticClass:"select-table-content"},[t("div",{staticClass:"top"},[t("i",{staticClass:"el-icon-close",on:{click:function(t){return e.$emit("close")}}}),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$emit("cancelAll")}}},[e._v("全部取消")])],1),t("el-table",{attrs:{data:e.tableData,stripe:"",height:"100%"}},[t("el-table-column",{attrs:{type:"index",label:"序号"}}),t("el-table-column",{attrs:{label:"标签名称",prop:"tagName","min-width":"150",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"标签编号",prop:"tagId",align:"center"}}),t("el-table-column",{attrs:{label:"客户类型",prop:"custTypeName",align:"center"}}),t("el-table-column",{attrs:{label:"操作",align:"center",fixed:"right",width:"80"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.$emit("cancelData",a.row)}}},[e._v("取消")])]}}])})],1),t("el-pagination",{attrs:{size:"mini","current-page":e.pageNum,"page-sizes":[10,20,30,40],"page-size":e.pageSize,"pager-count":5,layout:"total, sizes, prev, pager, next, jumper",total:e.totalData.length},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},de=[],ue={props:["totalData"],computed:{tableData(){return this.totalData.slice((this.pageNum-1)*this.pageSize,this.pageNum*this.pageSize)}},data(){return{pageNum:1,pageSize:10}},methods:{handleSizeChange(e){this.pageSize=e,this.pageNum=1},handleCurrentChange(e){this.pageNum=e}}},he=ue,me=(a("2605"),Object(m["a"])(he,pe,de,!1,null,"2f614406",null)),ge=me.exports,ye={components:{QueryFormCell:c["a"],SelectTable:ge},props:{QueryFormList:{type:Array,default:()=>[]}},data(){return{loading:!1,searchLoading:!1,searchForm:{keyWords:"",custTypeId:"",current:1,size:10},keyword:"",defaultSizeForm:{radioModel:[""]},total:0,allData:[],showSelectTable:!1,selectTableData:[]}},watch:{"selectTableData.length"(e){this.$emit("change",this.selectTableData)}},computed:{isSelectAll(){return this.allData.every(e=>this.selectTableData.some(t=>t.tagId==e.tagId))},tableData(){return this.allData.slice((this.searchForm.current-1)*this.searchForm.size,this.searchForm.current*this.searchForm.size)}},methods:{init(){this.keyword="",this.defaultSizeForm={radioModel:[""]},this.searchForm={keyWords:"",custTypeId:"",current:1,size:10},this.searchTable(),this.selectTableData=[]},queryForm(e){this.searchForm.custTypeId=e.value,this.searchTable()},searchTable(){this.searchForm.keyWords=this.keyword,this.searchForm.current=1,this.getAllData(!0)},handleSizeChange(e){this.searchForm.current=1,this.searchForm.size=e},handleCurrentChange(e){this.searchForm.current=e},async getAllData(){try{this.loading=!0;const e=await Object(n["i"])(o["a"].ecapi.queryAccessLabel,{custTypeId:this.searchForm.custTypeId,keyWords:this.searchForm.keyWords});this.allData=e,this.total=e.length}catch(e){}finally{this.loading=!1}},selectData(e){this.selectTableData.push(e)},cancelData(e){this.selectTableData=this.selectTableData.filter(t=>t.tagId!=e.tagId)},async selectAllOrCancel(){this.isSelectAll?this.selectTableData=[]:(this.selectTableData=[...this.selectTableData,...this.allData],this.selectTableData=this.selectTableData.filter((e,t,a)=>a.findIndex(t=>t.tagId==e.tagId)==t))},cancelAll(){this.selectTableData=[]}}},be=ye,ve=(a("a1f4"),Object(m["a"])(be,oe,ce,!1,null,"aeca2c86",null)),fe=ve.exports,we=function(){var e=this,t=e._self._c;return t("div",{staticClass:"step-content"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableData,"row-class-name":e.getRowClass,stripe:"",height:"350px"}},[t("el-table-column",{attrs:{type:"index",label:"序号",align:"center"}}),t("el-table-column",{attrs:{label:"标签名称",prop:"tagName","min-width":"150",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"标签编号",prop:"tagId",align:"center"}}),t("el-table-column",{attrs:{label:"客户类型",prop:"custTypeName",align:"center"}}),t("el-table-column",{attrs:{label:"优先级",align:"center",fixed:"right",width:"150"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-input-number",{attrs:{size:"mini",min:1,max:3e3,step:1,precision:0},on:{change:function(t){return e.changePriority(...arguments,a)}},model:{value:a.orderBy,callback:function(t){e.$set(a,"orderBy",t)},expression:"row.orderBy"}})]}}])})],1),t("el-pagination",{attrs:{size:"mini","current-page":e.pageNum,"page-sizes":[5,10,20,40],"page-size":e.pageSize,"pager-count":5,layout:"total, prev, pager, next",total:e.totalData.length},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},Te=[],Ce={props:{active:{type:Number,default:0},labelList:{type:Array,default:()=>[]}},computed:{tableData(){return this.totalData.slice((this.pageNum-1)*this.pageSize,this.pageNum*this.pageSize)}},watch:{active(){1===this.active&&this.getTableData()},labelList:{handler(){const e=JSON.parse(JSON.stringify(this.labelList));this.copyLabelList=e.map(e=>({...e,add:!0}))},deep:!0}},data(){return{loading:!1,pageNum:1,pageSize:10,copyLabelList:[],preData:[],totalData:[]}},methods:{async getTableData(){try{this.loading=!0;let e=await Object(n["i"])(o["a"].ecapi.queryAllTag);this.preData=JSON.parse(JSON.stringify(e)),e.forEach((e,t)=>{e.timestamp=t+1});const t=e.length?e[e.length-1].orderBy:0;this.copyLabelList.forEach((e,a)=>{e.orderBy=t+a+1,e.timestamp=t+a+1}),this.totalData=[...e,...this.copyLabelList],this.pageNum=Math.ceil((e.length+1)/this.pageSize)}catch(e){this.copyLabelList.forEach((e,t)=>{e.orderBy=t+1,e.timestamp=lastPriority+t+1}),this.totalData=this.copyLabelList}finally{this.loading=!1}},getRowClass({row:e,rowIndex:t}){return e.add?"edit-row-custom":""},handleSizeChange(e){this.pageSize=e,this.pageNum=1},handleCurrentChange(e){this.pageNum=e},changePriority(e,t,a){a.timestamp=(new Date).getTime(),this.$nextTick(()=>{this.totalData.sort((e,t)=>e.orderBy==t.orderBy?t.timestamp-e.timestamp:e.orderBy-t.orderBy),this.pageNum=Math.ceil((this.totalData.findIndex(e=>e.tagId===a.tagId)+1)/this.pageSize||1)})},clear(){this.copyLabelList=[],this.totalData=[],this.pageNum=1,this.pageSize=10}}},Se=Ce,De=(a("57779"),Object(m["a"])(Se,we,Te,!1,null,"a7c04c48",null)),ze=De.exports,xe={components:{StepOne:fe,StepTwo:ze},props:{visible:{type:Boolean,default:!1},QueryFormList:{type:Array,default:()=>[]}},watch:{visible(e){e?this.$nextTick(()=>{this.$refs.stepOne.init(),this.$refs.stepTwo.clear()}):(this.active=0,this.$refs.stepOne.showSelectTable=!1)},active(){this.$refs.stepOne.showSelectTable=!1}},data(){return{active:0,labelList:[],saveLoading:!1}},computed:{currentStep(){switch(this.active){case 0:return"StepOne";case 1:return"StepTwo";case 2:return"StepThree"}},canThree(){}},methods:{selectLabel(e){this.labelList=e},nextStep(e){if(0===this.active&&0===this.labelList.length)return this.$alert("请先选择标签！","提示",{confirmButtonText:"确定",type:"warning"}).catch(()=>{});this.active+=e},done(){this.$confirm("是否确认保存配置操作","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const e=this.$refs.stepTwo.totalData,t=this.$refs.stepTwo.preData,a=[];e.forEach(e=>{delete e.startDate,delete e.endDate,delete e.createTime,t.some(t=>t.tagId===e.tagId&&t.orderBy==e.orderBy)||a.push(e)});try{this.saveLoading=!0;const e=await Object(n["i"])(o["a"].ecapi.saveTag,a);"SUCCESS"===e.status?(this.$message({type:"success",message:e.message,duration:500}),this.$emit("refresh"),this.$emit("update:visible",!1),this.$nextTick(()=>{this.$refs.stepTwo.clear()})):this.$message({type:"error",message:e.message,duration:1e3})}catch(i){}finally{this.saveLoading=!1}}).catch(()=>{})},closeDialog(){this.$confirm("关闭后配置操作将不会保存，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$emit("update:visible",!1),this.$nextTick(()=>{this.$refs.stepTwo.clear()})}).catch(()=>{})}}},ke=xe,Fe=(a("0789"),Object(m["a"])(ke,re,ne,!1,null,"d0904982",null)),Le=Fe.exports,Ne={components:{QueryFormCell:c["a"],Edit:le,Add:Le},data(){return{loading:!1,searchLoading:!1,searchForm:{keyWords:"",custTypeId:"",current:1,size:10},keyword:"",defaultSizeForm:{radioModel:[""]},QueryFormList:[{label:"客户类型",values:[{label:"不限",value:""}]}],tableData:[],total:0,editVisible:!1,addVisible:!1,currentRow:{}}},methods:{async getCustomType(){try{const e=await Object(n["i"])(o["a"].ecapi.queryTagType);this.$set(this.QueryFormList[0],"values",[...this.QueryFormList[0].values,...e.map(e=>({label:e.custTypeName,value:e.custTypeId}))])}catch(e){}},queryForm(e){this.searchForm.custTypeId=e.value,this.searchTable()},searchTable(){this.searchForm.keyWords=this.keyword,this.searchForm.current=1,this.getTableData()},handleSizeChange(e){this.searchForm.current=1,this.searchForm.size=e,this.getTableData()},handleCurrentChange(e){this.searchForm.current=e,this.getTableData()},async getTableData(){try{this.loading=!0;const{records:e,total:t}=await Object(n["i"])(o["a"].ecapi.queryTag,this.searchForm);this.tableData=e,this.total=t}catch(e){}finally{this.loading=!1}},deleteData(e){this.$confirm("是否确认将该标签从标签配置中删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Object(n["i"])(o["a"].ecapi.delTagConfig,{tagId:e}),this.$message({type:"success",message:"删除成功!"}),this.getTableData()}catch(t){}}).catch(()=>{})},openAddDialog(e){this.addVisible=!0},openEditDialog(e){this.currentRow=e,this.editVisible=!0}},created(){this.getCustomType(),this.searchTable()}},Ie=Ne,_e=(a("0033"),Object(m["a"])(Ie,X,Z,!1,null,"79b4ae1a",null)),Pe=_e.exports,Oe={components:{ProductConfig:K,LabelConfig:Pe},data(){return{tabActive:"product"}}},$e=Oe,Ae=(a("9651"),Object(m["a"])($e,i,s,!1,null,"6e14ae31",null));t["default"]=Ae.exports},"1bb8":function(e,t,a){},2605:function(e,t,a){"use strict";a("4547")},"26e4":function(e,t,a){"use strict";a("bca9")},"2fe0":function(e,t,a){},3111:function(e,t,a){"use strict";a("2fe0")},4547:function(e,t,a){},"4e3f":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"query-form-cell-wrap"},[t("el-form",{ref:"form",attrs:{model:e.sizeForm,"label-width":e.labelWidth,"label-position":e.labelPosition,size:"mini"}},e._l(e.list,(function(a,i){return t("el-form-item",{key:i+"list",class:{disabled:a.disabled},attrs:{"label-width":a.labelWidth||e.labelWidth,label:a.label+"："}},[Array.isArray(a.values)?t("div",{staticClass:"fe-d-flex"},[t("div",{staticClass:"radio-box"},[a.dateType?e._e():t("el-radio-group",{attrs:{size:"mini",disabled:a.disabled},on:{change:function(t){return e.radioChange(e.sizeForm.radioModel[i],i)}},model:{value:e.sizeForm.radioModel[i],callback:function(t){e.$set(e.sizeForm.radioModel,i,t)},expression:"sizeForm.radioModel[index]"}},e._l(a.values,(function(a,i){return t("el-radio-button",{key:i+"listValues",attrs:{label:a.value}},[e._v(e._s(a.label)+" ")])})),1)],1),t("div",{staticClass:"date-box"},["date"===a.dateType?t("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd",clearable:!1},on:{change:e.dateChange},model:{value:e.sizeForm.dateModel[i],callback:function(t){e.$set(e.sizeForm.dateModel,i,t)},expression:"sizeForm.dateModel[index]"}}):e._e(),"month"===a.dateType?t("el-date-picker",{attrs:{type:"month",placeholder:"选择月","value-format":"yyyy-MM",clearable:!1},on:{change:e.dateChange},model:{value:e.sizeForm.dateModel[i],callback:function(t){e.$set(e.sizeForm.dateModel,i,t)},expression:"sizeForm.dateModel[index]"}}):e._e(),"daterange"===a.dateType?t("el-date-picker",{attrs:{type:"daterange","value-format":"yyyy-MM-dd","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",clearable:!0},on:{change:e.dateChange},model:{value:e.sizeForm.dateModel[i],callback:function(t){e.$set(e.sizeForm.dateModel,i,t)},expression:"sizeForm.dateModel[index]"}}):e._e(),"datetimerange"===a.dateType?t("el-date-picker",{attrs:{type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",clearable:!1},on:{change:e.dateChange},model:{value:e.sizeForm.dateModel[i],callback:function(t){e.$set(e.sizeForm.dateModel,i,t)},expression:"sizeForm.dateModel[index]"}}):e._e()],1)]):t("div",{staticClass:"input-box"},[t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{placeholder:"请输入内容"},on:{change:e.inputChange},model:{value:e.sizeForm.radioModel[i],callback:function(t){e.$set(e.sizeForm.radioModel,i,t)},expression:"sizeForm.radioModel[index]"}})],1)])})),1)],1)},s=[],l={name:"QueryFormCell",props:{labelWidth:{type:String,default:()=>"82px"},labelPosition:{type:String,default:()=>"right"},defaultSizeForm:{type:Object,default:()=>({})},list:{type:Array,default:()=>[{label:"数据时间",values:[{label:"不限",value:"1"}],isDate:!0,dateType:"date"},{label:"接口类型",values:[{label:"不限",value:"不限"},{label:"文件接口",value:"文件接口"}],isDate:!1}]}},data(){return{sizeForm:{dateModel:["2021-05-08","",""],radioModel:["自定义","不限","不限","不限"]}}},watch:{defaultSizeForm:{handler:function(e){this.sizeForm=e},deep:!0,immediate:!0}},methods:{radioChange(e,t){this.sizeForm.dateModel&&this.$set(this.sizeForm.dateModel,t,"date"===this.list[t].dateType?"":["",""]),this.$emit("queryForm",{index:t,value:e,form:this.sizeForm})},dateChange(e){e?(this.$set(this.sizeForm.dateModel,0,e),this.$emit("queryForm",{value:e,form:this.sizeForm})):this.$emit("emptyFrom",this.sizeForm)},inputChange(e){e&&this.$emit("queryForm",{value:e,form:this.sizeForm})}}},r=l,n=(a("a28d"),a("2877")),o=Object(n["a"])(r,i,s,!1,null,null,null);t["a"]=o.exports},5676:function(e,t,a){},57779:function(e,t,a){"use strict";a("1bb8")},"5aeb":function(e,t,a){},"5d60":function(e,t,a){"use strict";a("6883")},6883:function(e,t,a){},"6a09":function(e,t,a){},"6bd4":function(e,t,a){"use strict";a("d376")},"72ae":function(e,t,a){"use strict";const i="/mcd-cep-web/action",s="/evt-svc/api";t["a"]={ecapi:{queryEventClass:i+"/cep/rule/nx/queryEventClass.do",queryEventDictByDictCode:i+"/cep/rule/nx/queryEventDictByDictCode.do",queryParentDictByDictCode:i+"/cep/rule/nx/queryParentDictByDictCode.do",queryConfigDict:i+"/cep/rule/nx/queryConfigDict.do",queryEventClassLevel:i+"/cep/rule/queryEventClass.do",queryCepRuleNum:i+"/cep/rule/queryCepRuleNum.do",createRule:i+"/cep/rule/nx/createRule.do",manageList:s+"/event/list",manageUpdateStatus:s+"/event/updateStatus",manageDelete:s+"/event",manageListByParent:s+"/businessCategory/listByParent",manageListByLevel:s+"/businessCategory/listByLevel",manageCategoryList:s+"/businessCategory/list",manageGetDetail:s+"/event",eventSave:s+"/event/save",eventListByLevel:s+"/category/listByLevel",eventListByParent:s+"/category/listByParent",areaList:s+"/area/list",areaGetDetail:s+"/area",areaDelete:s+"/area",areaSave:s+"/area/save",areaStationList:s+"/area/stationList",stationList:s+"/station/list",listByCategory:s+"/categoryValue/listByCategory",queryEventsByUserId:"/plan-svc/api/action/cep/event/eventManager/queryEventsByUserId",queryShareById:"/plan-svc/cepRuleShare/queryShareById",saveOrUpdate:"/plan-svc/cepRuleShare/saveOrUpdate",delCampCoordinationTaskList:"/plan-svc/mcd/strategic/coordination/delCampCoordinationTaskList",exportExampleFile:"/plan-svc/mcd/strategic/coordination/exportExampleFile",pushCampCoordinationFile:"/plan-svc/mcd/strategic/coordination/pushCampCoordinationFile",queryCampCoordinationTask:"/plan-svc/mcd/strategic/coordination/queryCampCoordinationTask",queryStrategicCoordination:"/plan-svc/mcd/strategic/coordination/queryStrategicCoordination",saveStrategicCoordinationTask:"/plan-svc/mcd/strategic/coordination/saveStrategicCoordinationTask",selectAllStrategicCoordination:"/plan-svc/mcd/strategic/coordination/selectAllStrategicCoordination",recountCampTask:"/plan-svc/mcd/strategic/coordination/recountCampTask",queryCampCoordinationTaskDetail:"/plan-svc/mcd/strategic/coordination/queryCampCoordinationTaskDetail",childTaskRecord:"/plan-svc/mcd/strategic/coordination/childTaskRecord",approveTaskRecord:"/plan-svc/api/campCoordinate/taskApprove/approveTaskRecord",approveChildTaskRecord:"/plan-svc/api/campCoordinate/taskApprove/approveChildTaskRecord",subTaskApprove:"/plan-svc/api/campCoordinate/taskApprove/subTaskApprove",updateTaskStatus:"/plan-svc/api/campCoordinate/taskApprove/updateTaskStatus",queryAppTypeList:"/approve-svc/jx/cmpApprovalProcessConf/queryAppTypeList",getApproveConfig:"/approve-svc/jx/cmpApprovalProcessConf/getApproveConfig?systemId=",getNodeApprover:"/approve-svc/jx/cmpApproveProcessInstance/getNodeApprover",submitProcess:"/approve-svc/jx/cmpApproveProcessInstance/submitProcess",delPlanConfList:"/plan-svc/mcd/strategic/coordination/delPlanConfList",qryNotCfgPlanTypeAndPri:"/plan-svc/mcd/strategic/coordination/qryNotCfgPlanTypeAndPri",qryPlanConfList:"/plan-svc/mcd/strategic/coordination/qryPlanConfList",qryPlanConfListByPlanTypeOnSave:"/plan-svc/mcd/strategic/coordination/qryPlanConfListByPlanTypeOnSave",qryPlanConfListByPlanTypeOnUpdate:"/plan-svc/mcd/strategic/coordination/qryPlanConfListByPlanTypeOnUpdate",qryPlanTypeList:"/plan-svc/mcd/strategic/coordination/qryPlanTypeList",savePlanConf:"/plan-svc/mcd/strategic/coordination/savePlanConf",updatePriority:"/plan-svc/mcd/strategic/coordination/updatePriority",getSysDics:"/plan-svc/action/iop/common/getSysDics",delTagConfig:"/plan-svc/orchestrate/tag/delTagConfig",queryAccessLabel:"/plan-svc/orchestrate/tag/queryAccessLabel",queryTag:"/plan-svc/orchestrate/tag/queryTag",queryTagType:"/plan-svc/orchestrate/tag/queryTagType",saveTag:"/plan-svc/orchestrate/tag/saveTag",updateTagOrderBy:"/plan-svc/orchestrate/tag/updateTagOrderBy",queryAllTag:"/plan-svc/orchestrate/tag/queryAllTag"}}},"91a3":function(e,t,a){"use strict";a("5676")},9651:function(e,t,a){"use strict";a("e1d0")},"9bf6":function(e,t,a){},a06e:function(e,t,a){},a1f4:function(e,t,a){"use strict";a("9bf6")},a28d:function(e,t,a){"use strict";a("cddb")},addf:function(e,t,a){"use strict";a("e2f0")},b530:function(e,t,a){"use strict";a("a06e")},bca9:function(e,t,a){},c562:function(e,t,a){"use strict";a("6a09")},cddb:function(e,t,a){},d376:function(e,t,a){},e1d0:function(e,t,a){},e2f0:function(e,t,a){},f37e:function(e,t,a){}}]);