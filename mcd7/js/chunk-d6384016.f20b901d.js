(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d6384016"],{"384d":function(e,t,s){"use strict";s("8972")},8972:function(e,t,s){},"8f8e":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"scene-layout"},[t("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"场景裂变",name:"scene"}},[1!=e.form.attrType?t("SelectView",{attrs:{title:"已选标签",option:{label:"columnName",value:"columnNum"},list:e.form.selectAttrList}}):e._e(),2==e.form.attrType?t("div",{staticStyle:{height:"2px"}}):e._e(),0!=e.form.attrType?t("SelectView",{attrs:{title:"已选客群",option:{label:"customGroupName",value:"customGroupId"},list:e.form.selectCustomerList}}):e._e(),t("el-form",{ref:"outFormRef",attrs:{"label-width":"120px","label-suffix":"：",model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:"选择标签/客群",prop:"attrType","label-width":"140px"}},[t("el-radio-group",{on:{change:e.clearChildren},model:{value:e.form.attrType,callback:function(t){e.$set(e.form,"attrType",t)},expression:"form.attrType"}},[t("el-radio",{attrs:{label:"0"}},[e._v("标签")]),t("el-radio",{attrs:{label:"1",disabled:!e.isMainScene}},[e._v("客群")]),t("el-radio",{attrs:{label:"2",disabled:!e.isMainScene}},[e._v("基础客群 + 标签")])],1)],1),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"1"!==e.form.attrType,expression:"form.attrType !== '1'"}],attrs:{label:"标签"}},[t("LabelSelect",{ref:"labelSelectRef",on:{add:e.addLabel}})],1),t("CustomerList",{directives:[{name:"show",rawName:"v-show",value:"0"!==e.form.attrType,expression:"form.attrType !== '0'"}],ref:"customerListRef",attrs:{isValidateNotComplete:"2"===e.form.attrType,multiple:!0,selectList:e.form.selectCustomerList},on:{select:e.selectCustomer}}),e.node.businessData.sceneName&&!e.modify?t("span",{staticClass:"cur-info"},[e.node.businessData.customerInfo.customGroupName?t("el-form-item",{attrs:{label:"基础客群"}},[t("span",[e._v(e._s(e.node.businessData.customerInfo.customGroupName))])]):e._e(),t("el-form-item",{attrs:{label:"场景客群数"}},[t("span",[e._v(e._s(e.node.businessData.customerNum)+"人")])]),t("el-form-item",{attrs:{label:"场景条件"}},[t("span",{domProps:{innerHTML:e._s(e.allConditionDesc)}})])],1):e._e(),e.modify?[t("div",{ref:"editRef",staticClass:"edit-current"},[e.isMainScene&&"1"===e.form.attrType?t("CustomerChild",{ref:"fissionCustomerSceneRef",attrs:{title:e.form.sceneName,echoData:e.form,node:e.node,isFission:!1}}):t("SceneChild",{ref:"fissionSceneRef",attrs:{title:e.form.sceneName,selectedColumns:e.form.selectAttrList,echoData:e.form,node:e.node,isFission:!1}})],1)]:e._e(),e.modify?e._e():[e._l(e.form.children,(function(s,i){return t("div",{key:s.sceneId,ref:"fissionRef"+i,refInFor:!0},[e.isMainScene&&"1"===e.form.attrType?t("CustomerChild",{ref:"fissionCustomerSceneRef"+i,refInFor:!0,attrs:{childIndex:i,title:"裂变场景"+(i+1),echoData:s,node:e.node},on:{remove:function(t){return e.removeScene(i)}}}):t("SceneChild",{ref:"fissionSceneRef"+i,refInFor:!0,attrs:{childIndex:i,title:"裂变场景"+(i+1),selectedColumns:e.form.selectAttrList,echoData:s,node:e.node},on:{remove:function(t){return e.removeScene(i)}}})],1)})),t("div",{staticClass:"add_scene_btn"},[t("span",{on:{click:e.addScene}},[e._v("+添加裂变场景")])])]],2)],1)],1),t("div",{staticClass:"fission_bottom__button"},[t("el-button",{attrs:{type:"primary",size:"medium"},on:{click:e.save}},[e._v("确定")]),t("el-button",{attrs:{size:"medium"},on:{click:e.cancel}},[e._v("取消")])],1)],1)},r=[],o=(s("14d9"),s("bdad")),n=s("2ef0");const a={sceneId:"",sceneName:"",attrType:"0",selectCustomerList:[],customerInfo:{},customerGroupId:void 0,selectAttrList:[],selectAttrStr:"",customerNum:null,finalExpression:"",conditionDesc:"",conditionParams:[],conditions:[],validateC:null,children:[]};var l={components:{SelectView:()=>s.e("chunk-67a56326").then(s.bind(null,"dec5")),SceneChild:()=>s.e("chunk-8eefce92").then(s.bind(null,"2283")),LabelSelect:()=>s.e("chunk-f35bd188").then(s.bind(null,"a9b1")),CustomerList:()=>s.e("chunk-3839fbc3").then(s.bind(null,"67a1")),CustomerChild:()=>s.e("chunk-6d7f6016").then(s.bind(null,"9357"))},props:{node:{type:Object,default:()=>({})},modify:{type:Boolean,default:!1}},computed:{isMainScene(){const e=this.node.nodeLines.filter(e=>"Scene"===e.nodeType).length;return this.modify?1===e:0===e},allConditionDesc(){const e=this.node.nodeLines.filter(e=>"Scene"===e.nodeType),t=e.map(e=>$graph.findDataById(e.nodeId)),s=t.map((e,s)=>{let i=t.length>1?s+1+"、":"";return"<p>"+i+e.businessData.conditionDesc+"</p>"}).join("\n");return s}},watch:{},data(){return{activeName:"scene",form:Object(n["cloneDeep"])(a),rules:{attrType:[{required:!0,message:"请选择标签/客群",trigger:"change"}]}}},methods:{echoData(){const{businessData:e}=this.node;e&&(this.form={...this.form,...e,sceneId:e.sceneId||Object(o["c"])()},this.isMainScene||this.modify||(this.form.attrType="0"),this.form.children=[])},clearChildren(){this.form.children=[],this.modify&&(this.form.customerGroupId=void 0,this.form.customerInfo={})},selectCustomer(e){this.form.selectCustomerList=e},addLabel(e){let t=this.form.selectAttrList.find(t=>t.columnNum===e.columnNum);t?t.valueList||(this.form.selectAttrList=this.form.selectAttrList.map(t=>t.columnNum===e.columnNum?e:t)):this.form.selectAttrList.push(e),this.form.selectAttrStr=this.form.selectAttrList.map(e=>e.columnNum).join(",")},addScene(){const e={...Object(n["cloneDeep"])(a),sceneId:Object(o["c"])(),selectCustomerList:this.form.selectCustomerList,customerInfo:JSON.parse(JSON.stringify(this.form.customerInfo))};this.isMainScene&&(e.attrType=this.form.attrType),this.form.children.push(e)},removeScene(e){this.form.children.splice(e,1)},async validateFissionScene(){if(await this.$refs.outFormRef.validate(),!this.form.children.length)return this.$message.error("请添加裂变场景"),Promise.reject("裂变场景不能为空");let e=[];for(let s=0;s<this.form.children.length;s++){const t="1"===this.form.attrType?this.$refs["fissionCustomerSceneRef"+s][0]:this.$refs["fissionSceneRef"+s][0];e.push(t.validate())}const t=await Promise.all(e);return t},async validateScene(){await this.$refs.outFormRef.validate();const e="1"===this.form.attrType?this.$refs.fissionCustomerSceneRef:this.$refs.fissionSceneRef;return e.validate()},clearCache(){this.isMainScene&&("0"===this.form.attrType?this.form.selectCustomerList=[]:"1"===this.form.attrType?(this.form.selectAttrList=[],this.form.selectAttrStr=""):this.form.attrType)},async save(){try{if(this.modify){const e=await this.validateScene();this.clearCache(),this.$emit("save","scene",{...e,attrType:this.form.attrType,selectAttrList:this.form.selectAttrList,selectAttrStr:this.form.selectAttrStr,selectCustomerList:this.form.selectCustomerList,validateC:null})}else{const e=await this.validateFissionScene();this.clearCache(),e.forEach(e=>{e.selectAttrList=this.form.selectAttrList,e.selectAttrStr=this.form.selectAttrStr,e.selectCustomerList=this.form.selectCustomerList,e.validateC=null}),this.form.children=e,this.$emit("save","scene",this.form)}}catch(t){var e;if("scroll"===t.type)if(this.modify)this.$refs["editRef"].scrollIntoView({behavior:"smooth"});else null===(e=this.$refs["fissionRef"+t.childIndex][0])||void 0===e||e.scrollIntoView({behavior:"smooth"})}},cancel(){this.$emit("cancel")}},created(){this.echoData()}},c=l,m=(s("384d"),s("2877")),f=Object(m["a"])(c,i,r,!1,null,"0791fef2",null);t["default"]=f.exports}}]);