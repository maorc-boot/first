(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e59cd518"],{"16f9":function(e,a,t){"use strict";t("fa28")},"39b5":function(e,a,t){"use strict";t("7922")},"471a":function(e,a,t){"use strict";t.r(a);var i=function(){var e=this,a=e._self._c;return a("div",{staticClass:"UnifiedStrate"},[a("el-row",{staticStyle:{width:"100%"}},[a("el-col",{attrs:{span:5}},[a("div",{staticClass:"UnifiedTree"},[a("div",{staticClass:"UnifiedTree-channels"},[a("div",{staticClass:"sub-channels",class:{active:"1"===e.channelIndex},on:{click:function(a){return e.changeChannel("1")}}},[e._v(" 线上渠道 ")]),a("div",{staticClass:"sub-channels",class:{active:"0"===e.channelIndex},on:{click:function(a){return e.changeChannel("0")}}},[e._v(" 线下渠道 ")])]),a("el-tree",{ref:"vueTree",attrs:{props:e.props,data:e.channelList,"node-key":"id",accordion:"","highlight-current":"","icon-class":"iconfont icongonggongtubiao-shouqi Treecolor"},on:{"node-click":e.TreeNodeClick},scopedSlots:e._u([{key:"default",fn:function({node:t,data:i}){return a("div",{staticClass:"custom-tree-node"},[a("span",[e._v(e._s(t.label))]),a("span",[e._v(e._s(i.num))])])}}])})],1)]),a("el-col",{attrs:{span:19}},[a("div",{staticClass:"MaterHome"},[a("div",{staticClass:"search_box"},[a("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],staticClass:"input-search",attrs:{placeholder:"请输入产品编号或名称"},model:{value:e.queryFrom.keyWords,callback:function(a){e.$set(e.queryFrom,"keyWords","string"===typeof a?a.trim():a)},expression:"queryFrom.keyWords"}},[a("i",{staticClass:"el-input__icon el-icon-search cursor-pointer",attrs:{slot:"suffix"},on:{click:function(a){return e.querySysCampPriorityList()}},slot:"suffix"})])],1),a("div",{staticClass:"priority"},[a("span",[e._v("优先级规则说明: 优先级同档次之间优先级编码越大优先级越高")])]),a("div",{staticClass:"Table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-key":"campsegId",height:"calc(100vh - 241px)"}},[a("el-table-column",{attrs:{type:"index",label:"序号"}}),a("el-table-column",{attrs:{prop:"campsegId",label:"策略编号",width:"200px"}}),a("el-table-column",{attrs:{prop:"campsegName",label:"策略名称"}}),a("el-table-column",{attrs:{prop:"customNum",label:"客户群规模"}}),a("el-table-column",{attrs:{prop:"priorityOrder",label:"优先级",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input-number",{attrs:{step:.01,min:0,max:1.001},on:{change:function(a){return e.changepriority(t.row)}},model:{value:t.row.priorityOrder,callback:function(a){e.$set(t.row,"priorityOrder",a)},expression:"scope.row.priorityOrder"}})]}}])})],1),a("div",{staticClass:"pager"},[a("el-pagination",{attrs:{"current-page":e.pageData.currentPage,"page-sizes":e.pageData.pageSizeList,"page-size":e.pageData.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pageData.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)])])],1)],1)},s=[],n=t("aa47"),r=t("0fea"),l=t("d370"),c=t("b893"),o={data(){return{tableData:[],props:{label:"label",children:"children",num:"num"},queryFrom:{channelId:"",adivId:"",keyWords:""},pageData:{currentPage:1,pageSize:10,pageSizeList:[10,20,30,40],total:0},channelList:[],channelIndex:"1"}},mounted(){this.SortableDragDropAdd(),this.initChannel(this.channelIndex)},methods:{changeChannel(e){this.channelIndex=e,this.initChannel(e)},async querySysCampPriorityList(){await Object(r["i"])(l["a"].mpapi.querySysCampPriorityList,{...this.queryFrom,current:this.pageData.currentPage,size:this.pageData.pageSize}).then(e=>{this.tableData=e.records,this.pageData.total=e.total})},async reorderCampseg(e,a,t){let i={campsegIds:e+","+a,channelId:t};await Object(r["i"])(l["a"].mpapi.reorderCampseg,i).then(e=>{"200"===e.status&&(this.$message.success("优先级调整成功"),this.querySysCampPriorityList())})},async initChannel(e){await Object(r["i"])(l["a"].mpapi.initChannel,{channelType:e}).then(e=>{this.initAdivInfo(e)})},async initAdivInfo(e){let a=e.map(e=>({id:e.channelId,label:e.channelName,num:e.campNum,channelId:"0",children:e.priorityAdivs}));a.forEach(e=>{e.children=e.children.map(a=>({id:a.adivId,adivId:a.adivId,label:a.adivName,channelId:e.id,num:a.campNum}))}),this.channelList=Object(c["f"])(a,"id","channelId","children","0"),0!==this.channelList.length&&(this.$nextTick(()=>{this.$refs.vueTree.setCurrentKey(this.channelList[0].id)}),this.queryFrom.channelId=this.channelList[0].id,this.querySysCampPriorityList())},TreeNodeClick(e){"0"!==e.channelId?(this.queryFrom.channelId=e.channelId,this.queryFrom.adivId=e.adivId):(this.queryFrom.channelId=e.id,this.queryFrom.adivId=e.adivId),this.pageData.currentPage=1,this.querySysCampPriorityList()},changepriority(e){let a={campsegId:e.campsegId,orderNum:e.priorityOrder};Object(r["i"])(l["a"].mpapi.reorderCampseg,a).then(e=>{this.querySysCampPriorityList()})},SortableDragDropAdd(){const e=document.querySelectorAll(".el-table__body-wrapper > table > tbody")[0];let a=this;n["a"].create(e,{animation:150,draggable:".el-table__row",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",onEnd({newIndex:e,oldIndex:t}){if(e===t)return;const i=a.tableData.splice(t,1)[0];a.tableData.splice(e,0,i),a.tableData[e].campsegLevel===a.tableData[t].campsegLevel?a.reorderCampseg(a.tableData[e].campsegId,a.tableData[t].campsegId,a.tableData[t].channelId):a.$alert("只有同档次才能拖动调整优先级！","操作失败",{confirmButtonText:"确定",customClass:"errorPrompt"})}})},TableMoveUp(e,a){0!==a?(this.tableData.splice(a,1),this.tableData.splice(a-1,0,e)):this.$message.error("无法上移")},MoveDown(e,a){a!==this.tableData.length-1?(this.tableData.splice(a,1),this.tableData.splice(a+1,0,e)):this.$message.error("无法下移")},async gradeLevelChange(e){let a={campsegId:e.campsegId,campsegLevel:e.campsegLevel,channelId:e.channelId};await Object(r["i"])(l["a"].mpapi.updateCampLevel,a).then(e=>{"200"===e.status&&(this.$message.success("等级调整成功"),this.querySysCampPriorityList())})},handleSizeChange(e){this.pageData.pageSize=e,this.querySysCampPriorityList()},handleCurrentChange(e){this.pageData.currentPage=e,this.querySysCampPriorityList()}}},d=o,h=(t("39b5"),t("f408"),t("16f9"),t("2877")),p=Object(h["a"])(d,i,s,!1,null,"f68296dc",null);a["default"]=p.exports},7922:function(e,a,t){},cf07:function(e,a,t){},f408:function(e,a,t){"use strict";t("cf07")},fa28:function(e,a,t){}}]);