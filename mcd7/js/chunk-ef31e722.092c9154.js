(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ef31e722"],{"2af1":function(i,s,t){"use strict";t("d26af")},cdae:function(i,s,t){"use strict";t.r(s);var n=function(){var i=this,s=i._self._c;return s("AiDialog",{attrs:{title:"AI客群瘦身",top:"12vh",width:"700px"},on:{confirm:i.confirm},model:{value:i.visible,callback:function(s){i.visible=s},expression:"visible"}},[s("div",{staticClass:"optimize-layout"},[s("SubSection",{attrs:{title:"已选客群标签："}},[s("div",{staticClass:"customer-num"},[s("span",[i._v(i._s(i.customerNum)+i._s(null!==i.customerNum?"人":""))]),i.calcLoading?s("span",{staticClass:"tip"},[s("i",{staticClass:"el-icon-loading"}),i._v("计算中")]):i._e(),i.calcError?s("span",{staticStyle:{color:"red"}},[i._v(i._s(i.calcError))]):i._e()]),s("div",{staticClass:"label-content"},[i._l(i.originConditionList,(function(t,n){return s("div",{key:t.id,staticClass:"col",class:{del:i.addConditionList.some(i=>i.id==t.id)}},[s("p",[i._v(i._s(n+1)+"、")]),s("p",[i._v(i._s(t.conditionDesc))])])})),i._l(i.addConditionList.filter(s=>!i.originConditionList.some(i=>i.id==s.id)),(function(t,n){return s("div",{key:t.id+t.columnNum,staticClass:"col new"},[s("p",[i._v(i._s(n+1+i.originConditionList.length)+"、")]),s("p",[i._v(i._s(t.conditionDesc))])])}))],2)]),s("SubSection",{attrs:{title:"AI客群瘦身分析结果："}},[i.visible?s("Analysis",{attrs:{rulesList:i.originConditionList,params:i.analysisParams,addList:i.addConditionList},on:{add:i.addOrRemove,remove:i.addOrRemove}}):i._e()],1)],1)])},o=[],e=(t("14d9"),t("0fea")),a=t("afd9"),c=t("82be"),r=t("94d5f"),l={components:{AiDialog:r["a"],SubSection:()=>t.e("chunk-2bfdb478").then(t.bind(null,"0917")),Analysis:()=>t.e("chunk-63c4a000").then(t.bind(null,"1988"))},data(){return{visible:!1,calcLoading:!1,calcError:null,source:null,originConditionList:[],addConditionList:[],finnalConditionList:[],analysisParams:{},customerInfo:{},customerNum:null,finalExpression:null}},watch:{visible(i){i||(this.calcLoading&&this.source.cancel("取消未完成的请求"),this.customerNum=null,this.finalExpression=null,this.calcError=null,this.originConditionList=[],this.addConditionList=[],this.finnalConditionList=[],this.analysisParams={},this.customerInfo={})}},methods:{open({conditionList:i,form:s,planId:t,custColumnNum:n}){this.customerInfo=s.customerInfo,this.customerNum=s.customerNum,this.finalExpression=s.finalExpression,this.originConditionList=i,this.analysisParams=this.getAnalysisParams(s,this.originConditionList,t,n),this.visible=!0},getAnalysisParams(i,s,t,n){const o=Object(c["f"])(s,i);return o.splice(0,1),o.forEach((i,t)=>{let n=s[t];i.id=n.id,i.selectedConditions=n.selectedValues.map(i=>{const s=n.valueList.find(s=>s.value==i);return s})}),{planId:t,treeDetails:o,custColumnNum:n}},getParams(){const i=this.addConditionList.filter(i=>1==i.isExtend),s=this.addConditionList.filter(i=>0==i.isExtend);let t=[];return this.originConditionList.forEach(i=>{s.some(s=>s.id==i.id)||t.push(i)}),this.finnalConditionList=[...t,...i],Object(c["e"])(t,{customerInfo:this.customerInfo})},async calcCustomerNum(){this.calcLoading&&this.source.cancel("取消未完成的请求"),this.source=this.$CancelToken.source(),this.calcError=null;const i=this.getParams();try{this.calcLoading=!0;const{count:s,finalExpression:t}=await Object(e["i"])(a["a"].getTargetUserCount,i,this.source.token,12e4);this.customerNum=s,this.finalExpression=t,this.calcLoading=!1}catch(s){if("取消未完成的请求"===s.message)return;this.calcError=s.message,this.calcLoading=!1,this.customerNum=null,this.finalExpression=null}},addOrRemove(i,s){if(1===s){const s=JSON.parse(JSON.stringify(i));this.addConditionList.push(s)}else{const s=this.addConditionList.findIndex(s=>s.id==i.id);this.addConditionList.splice(s,1)}this.calcCustomerNum()},confirm(){if(this.calcLoading)return this.$mesage.warning("请等待计算完成");if(!this.customerNum)return this.$mesage.warning("客群数不能为0，请更新标签规则！");if(0===this.addConditionList.length)return void(this.visible=!1);const i=[];this.originConditionList.forEach(s=>{this.addConditionList.some(i=>i.id!=s.id)&&i.push(s)});const s=this.addConditionList.filter(i=>1==i.isExtend);if(i.push(...s),0===i.length)return this.$message.error("标签规则不能为空！");this.$emit("save",{customerNum:this.customerNum,finalExpression:this.finalExpression,conditionList:i}),this.visible=!1}}},d=l,u=(t("2af1"),t("2877")),h=Object(u["a"])(d,n,o,!1,null,"315520ac",null);s["default"]=h.exports},d26af:function(i,s,t){}}]);