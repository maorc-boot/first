(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f373d86c"],{1586:function(e,t,i){},"210d":function(e,t,i){"use strict";i("1586")},"875d":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"clientele-content"},[t("el-tabs",{attrs:{type:"card"},model:{value:e.tabActive,callback:function(t){e.tabActive=t},expression:"tabActive"}},[t("el-tab-pane",{attrs:{label:"预警规则配置",name:"warningRuleConfig",lazy:!0}},[t("List")],1)],1)],1)},l=[],s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"warning-config-content"},[t("div",{staticClass:"top-edit-part"},[t("el-button",{attrs:{type:"primary"},on:{click:e.add}},[e._v("新增")])],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"warning-config",staticStyle:{width:"100%"},attrs:{data:e.ruleList,stripe:"",height:500}},[t("el-table-column",{attrs:{label:"序号",type:"index","header-align":"center",align:"center",width:"60"}}),t("el-table-column",{attrs:{label:"预警规则","header-align":"center",align:"center","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(i){return[t("span",[e._v(e._s(i.row.indicatorName+i.row.sign+i.row.threshold)+"%")])]}}])}),t("el-table-column",{attrs:{prop:"cycleType",label:"周期设置","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("span",[e._v(e._s(1==i.row.cycleType?"一次性":"周期性")+e._s(i.row.cycleDays)+"天")])]}}])}),t("el-table-column",{attrs:{prop:"createUserName",label:"创建人","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{prop:"createTime",label:"时间","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{label:"操作",width:"150",fixed:"right","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-button",{attrs:{type:"text",loading:i.row.loading},on:{click:function(t){return e.onoffline(i.row)}}},[e._v(e._s(1==i.row.isOnling?"下线":"上线"))]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.edit(i.row)}}},[e._v("编辑")]),t("el-button",{staticStyle:{color:"red"},attrs:{type:"text"},on:{click:function(t){return e.handleDelete(i.row.ruleId)}}},[e._v("删除")])]}}])})],1),t("el-pagination",{attrs:{"current-page":e.query.current,"page-sizes":[10,20,30,40],"page-size":e.query.size,"pager-count":5,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),t("el-dialog",{attrs:{title:e.title,visible:e.dialogFormVisible,"close-on-click-modal":!1,"destroy-on-close":"","append-to-body":"",width:"500px"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[t("el-form",{ref:"form",attrs:{model:e.form,"label-width":"100px",rules:e.rules}},[t("el-form-item",{attrs:{label:"预警规则：",prop:"threshold"}},[t("el-select",{staticClass:"w150 f15",attrs:{placeholder:"",size:"mini"},on:{change:e.changeIndicator},model:{value:e.form.indicatorId,callback:function(t){e.$set(e.form,"indicatorId",t)},expression:"form.indicatorId"}},e._l(e.indicatorList,(function(e){return t("el-option",{key:e.enumId,attrs:{label:e.enumValue,value:e.enumKey}})})),1),t("el-select",{staticClass:"f15",attrs:{placeholder:"",size:"mini"},model:{value:e.form.sign,callback:function(t){e.$set(e.form,"sign",t)},expression:"form.sign"}},[t("el-option",{attrs:{value:"<",label:"<"}}),t("el-option",{attrs:{value:">",label:">"}}),t("el-option",{attrs:{value:"≤",label:"≤"}}),t("el-option",{attrs:{value:"≥",label:"≥"}})],1),t("el-input",{attrs:{size:"mini"},on:{input:e.toNumFloat},model:{value:e.form.threshold,callback:function(t){e.$set(e.form,"threshold",t)},expression:"form.threshold"}}),t("span",[e._v("%")])],1),t("el-form-item",{attrs:{label:"周期设置：",prop:"cycleDays"}},[t("el-radio-group",{on:{change:e.changeCycle},model:{value:e.form.cycleType,callback:function(t){e.$set(e.form,"cycleType",t)},expression:"form.cycleType"}},[t("el-radio",{attrs:{label:1}},[t("span",[e._v("一次性")]),t("el-input",{staticClass:"mini",attrs:{size:"mini",disabled:1!=e.form.cycleType},on:{input:e.toNum},model:{value:e.cycleDaysOnce,callback:function(t){e.cycleDaysOnce=t},expression:"cycleDaysOnce"}}),t("span",[e._v("天")])],1),t("el-radio",{attrs:{label:0}},[t("span",[e._v("周期性")]),t("el-input",{staticClass:"mini",attrs:{size:"mini",disabled:0!=e.form.cycleType},on:{input:e.toNum},model:{value:e.cycleDaysMuti,callback:function(t){e.cycleDaysMuti=t},expression:"cycleDaysMuti"}}),t("span",[e._v("天")])],1)],1)],1)],1),t("div",{staticClass:"tip"},[e._v("注意：周期设置天数 ≤ 90天")]),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",loading:e.saveLoading},on:{click:e.save}},[e._v("确 定")])],1)],1)],1)},n=[],r=i("0fea"),c=i("d370"),o=i("5e05"),u={props:{type:{type:String}},data(){return{loading:!1,saveLoading:!1,query:{current:1,size:10},total:0,indicatorList:[],ruleList:[],dialogFormVisible:!1,title:"新增",form:{},cycleDaysOnce:null,cycleDaysMuti:null,rules:{cycleDays:[{required:!0,message:"请填写完整周期设置",trigger:"blur"}],threshold:[{required:!0,message:"请填写完整预警规则",trigger:"blur"}]}}},methods:{async getWarnTypeList(){try{const e=await Object(r["i"])(o["a"].common.getSysEnum,{enumType:"warn_rule_indicator"});this.indicatorList=e}catch(e){}},async getList(){try{this.loading=!0,this.startPage&&(this.query.current=1);const{records:e,total:t}=await Object(r["i"])(c["a"].mpapi.listRule,this.query);this.total=t,this.ruleList=e;for(let i of this.ruleList)this.$set(i,"loading",!1)}catch(e){}finally{this.loading=!1,this.startPage=!1}},handleSizeChange(e){this.query.current=1,this.query.size=e,this.getList()},handleCurrentChange(e){this.query.current=e,this.getList()},add(){this.dialogFormVisible=!0,this.title="新增",this.form={cycleType:1,cycleDays:null,threshold:null,sign:null,indicatorId:null,indicatorName:null,isOnling:0},this.cycleDaysOnce=null,this.cycleDaysMuti=null},edit(e){this.form={...e},this.dialogFormVisible=!0,this.title="编辑",1==e.cycleType?this.cycleDaysOnce=e.cycleDays:this.cycleDaysMuti=e.cycleDays},async onoffline(e){let t={...e};t.isOnling=1==t.isOnling?0:1;try{e.loading=!0;const i=await Object(r["i"])(c["a"].mpapi.queryOnlineRuleSize);if(1==t.isOnling&&i>0)return this.$alert("当前已有预警规则执行，请先下线已上线的预警规则。","提示");await Object(r["i"])(c["a"].mpapi.editRule,t);this.$message({type:"success",message:1==t.isOnling?"上线成功":"下线成功"}),this.getList()}catch(i){}finally{e.loading=!1}},changeCycle(e){1===e?this.cycleDaysMuti=null:this.cycleDaysOnce=null},handleDelete(e){this.$confirm("即将删除该客群，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(async()=>{try{await Object(r["i"])(c["a"].mpapi.delRule,{ruleId:e}),this.getList(),this.$message({type:"success",message:"已删除!"})}catch(t){}}).catch(()=>{})},async save(){this.$refs.form.validate(async e=>{if(!e)return;let t="新增"===this.title?c["a"].mpapi.addRule:c["a"].mpapi.editRule;try{this.saveLoading=!0;await Object(r["i"])(t,this.form);this.$message({type:"success",message:this.title+"成功"}),this.dialogFormVisible=!1,this.getList()}catch(i){}finally{this.saveLoading=!1}})},toNum(e){1===this.form.cycleType?(this.cycleDaysOnce=e.replace(/[^\d]/g,""),this.form.cycleDays=+this.cycleDaysOnce):(this.cycleDaysMuti=e.replace(/[^\d]/g,""),this.form.cycleDays=+this.cycleDaysMuti)},toNumFloat(e){this.form.threshold=e.replace(/[^\d.]/g,"")},changeIndicator(e){let t=this.indicatorList.find(t=>t.enumKey===e);this.form.indicatorName=t.enumValue}},mounted(){this.getList(),this.getWarnTypeList()}},d=u,y=(i("210d"),i("2877")),h=Object(y["a"])(d,s,n,!1,null,"4aa1f473",null),p=h.exports,g={components:{List:p},data(){return{tabActive:"warningRuleConfig"}}},m=g,f=Object(y["a"])(m,a,l,!1,null,null,null);t["default"]=f.exports}}]);