(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f5aa0cee"],{"02a6":function(e,t,a){"use strict";a("1236")},1236:function(e,t,a){},"2c43":function(e,t,a){},"3e5b":function(e,t,a){"use strict";a("c3c5")},"64f8":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"clientele-content"},[t("el-tabs",{attrs:{type:"card"},model:{value:e.tabActive,callback:function(t){e.tabActive=t},expression:"tabActive"}},[t("el-tab-pane",{attrs:{label:"关怀短信",name:"SmsTemplate",lazy:!0}},[t("SmsTemplate")],1)],1)],1)},l=[],i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"template-wrap-content"},[t("div",{staticClass:"top-edit-part"},[t("div",{staticClass:"search-input"},[t("label",[e._v("模板内容：")]),t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{placeholder:"请输入模板内容",clearable:""},model:{value:e.searchParams.keyWords,callback:function(t){e.$set(e.searchParams,"keyWords","string"===typeof t?t.trim():t)},expression:"searchParams.keyWords"}})],1),t("div",{staticClass:"search-input"},[t("label",[e._v("模板状态：")]),t("el-select",{staticStyle:{width:"180px"},attrs:{placeholder:"请选择模板状态"},model:{value:e.searchParams.status,callback:function(t){e.$set(e.searchParams,"status",t)},expression:"searchParams.status"}},[t("el-option",{attrs:{value:"",label:"不限"}}),t("el-option",{attrs:{value:"1",label:"已引用"}}),t("el-option",{attrs:{value:"0",label:"未引用"}}),t("el-option",{attrs:{value:"2",label:"已弃用"}})],1)],1),t("div",{staticClass:"search-input"},[t("label",[e._v("创建人：")]),t("el-input",{directives:[{name:"clear-emoij",rawName:"v-clear-emoij"}],attrs:{placeholder:"请输入创建人",clearable:""},model:{value:e.searchParams.userName,callback:function(t){e.$set(e.searchParams,"userName","string"===typeof t?t.trim():t)},expression:"searchParams.userName"}})],1),t("div",{staticClass:"search-input"},[t("label",[e._v("创建时间：")]),t("el-date-picker",{staticStyle:{width:"215px"},attrs:{type:"daterange","value-format":"yyyy-MM-dd","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:e.dateChange},model:{value:e.queryTime,callback:function(t){e.queryTime=t},expression:"queryTime"}})],1),t("div",{staticClass:"btn-search"},[t("el-button",{attrs:{type:"primary"},on:{click:e.searchTable}},[e._v("查询")]),t("el-button",{attrs:{type:"primary"},on:{click:e.openAddDialog}},[e._v("新建模板")])],1)]),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tTable",staticClass:"template-table customTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"",height:600}},[t("el-table-column",{attrs:{type:"index",label:"序号","header-align":"center",align:"center",width:"45"}}),t("el-table-column",{attrs:{prop:"templateCode",label:"模板编码","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{prop:"msgSmsPlat",label:"消息类型","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{prop:"templateType",label:"模板类型","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{prop:"templateContent",label:"短信模板","header-align":"center",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"validDeadLine",label:"有效截止","header-align":"center",align:"center",width:"90"}}),t("el-table-column",{attrs:{label:"模板状态","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[e.today>a.validDeadLine?t("span",[e._v(" "+e._s(a.statusStr+"/已过期")+" ")]):t("span",[e._v(" "+e._s(a.statusStr)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"approvalStatusStr",label:"审批状态","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间","header-align":"center",align:"center",width:"90"}}),t("el-table-column",{attrs:{prop:"userName",label:"创建人","header-align":"center",align:"center"}}),t("el-table-column",{attrs:{label:"操作","header-align":"center",align:"left",width:"160",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleView(a.row)}}},[e._v(" 详情 ")]),a.row.createUserId==e.userId?[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleEdit(a.row)}}},[e._v(" 编辑 ")]),20==a.row.approvalStatus||41==a.row.approvalStatus?[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.openSubmitDialog(a.row)}}},[e._v(" 提交 ")]),t("el-button",{staticStyle:{color:"red"},attrs:{type:"text"},on:{click:function(t){return e.handleDelete(a.row)}}},[e._v(" 删除 ")])]:e._e()]:e._e()]}}])})],1),t("el-pagination",{attrs:{"current-page":e.query.current,"page-sizes":[10,20,30,40],"page-size":e.query.size,"pager-count":5,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),t("AddEdit",{attrs:{templateCode:e.currentRow.templateCode,isEdit:e.isEdit,dialogVisible:e.showAddDialog},on:{"update:dialogVisible":function(t){e.showAddDialog=t},"update:dialog-visible":function(t){e.showAddDialog=t},refresh:e.searchTable}}),t("SubmitDialog",{attrs:{dialogVisible:e.submitDialog,id:e.currentRow.templateCode,form:e.currentRow},on:{"update:dialogVisible":function(t){e.submitDialog=t},"update:dialog-visible":function(t){e.submitDialog=t},refresh:e.searchTable}})],1)},r=[],o=a("855e"),n=function(){var e=this,t=e._self._c;return t("BaseDialog",{attrs:{title:"提交审批",visible:e.dialogVisible,width:"450px","confirm-button-text":"提 交","confirm-loading":e.submitLoading},on:{confirm:e.submit,close:e.close}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"nextNodesApproverForm",attrs:{"label-width":"110px"}},e._l(e.nextNodesList,(function(a,s){return t("el-form-item",{key:s,attrs:{label:a.node.nodeName+"：",rules:[{required:!0,message:"请选择审批人",trigger:"change"}]}},[t("el-select",{attrs:{placeholder:"请选择审批人"},model:{value:e.approverUserList[s],callback:function(t){e.$set(e.approverUserList,s,t)},expression:"approverUserList[index]"}},e._l(a.approverUser,(function(e,a){return t("el-option",{key:a,attrs:{label:e.userName,value:e.userId}})})),1)],1)})),1)],1)},c=[],p=(a("14d9"),a("ea45")),d=a("0fea"),m=a("72ae"),u=a("89ff"),v={components:{BaseDialog:p["a"]},props:{dialogVisible:{type:Boolean,default:!1},id:{type:String|Number,default:""},form:{type:Object,default:()=>({})}},watch:{dialogVisible(e){e&&(this.approveParams.approvalType="作战地图"===this.form.templateType?"BATTLE_MAP":"MESSAGE_TEMPLATE",this.getNextApproverList())}},data(){return{loading:!1,submitLoading:!1,getSource:null,submitSource:null,nextNodesList:[],approverUserList:[],approveParams:{approvalType:"MESSAGE_TEMPLATE",berv:0,nodeId:"",businessId:"",nextNodesApprover:[]}}},methods:{close(){this.loading&&this.getSource.cancel(),this.submitLoading&&this.submitSource.cancel(),this.$emit("update:dialogVisible",!1)},async getNextApproverList(e=!1){this.loading&&this.getSource.cancel(),this.getSource=this.$CancelToken.source();try{this.loading=!0,this.approverUserList=[];const e=await Object(d["i"])(m["a"].ecapi.getApproveConfig+this.approveParams.approvalType),t={approvalType:this.approveParams.approvalType,processId:e.processId,berv:e.berv,nodeId:"",instanceId:null,triggerParm:{}},a=await Object(d["i"])(u["a"].messageTemplate.getCareSmsTemplateApprover,t,this.getSource.token,this.$retryDelay);this.nextNodesList=a.nextNodesApprover,this.approveParams.berv=e.berv,this.approveParams.nodeId=a.nodeId,this.approveParams.businessId=this.id,this.approveParams.processId=e.processId,this.loading=!1}catch(a){var t;if(null!==(t=a.message)&&void 0!==t&&t.includes("timeout")&&!0!==e)return this.getNextApproverList(!0);this.loading=!1}},async submit(){if(0===this.approverUserList.length||this.approverUserList.length!==this.nextNodesList.length)return this.$message.error("请选择审批人");const e=[];this.nextNodesList.forEach((t,a)=>{let s=this.approverUserList[a];const l=[];t.approverUser.map(e=>{e.userId===s&&l.push(e)}),e.push({approverUser:l,node:t.node})}),this.approveParams.nextNodesApprover=e,this.approveParams.businessId=this.id,this.submitLoading&&this.submitSource.cancel(),this.submitSource=this.$CancelToken.source();try{this.submitLoading=!0;await Object(d["i"])(u["a"].messageTemplate.subCareSmsTemplateApprove,this.approveParams,this.submitSource.token,this.$retryDelay);this.submitLoading=!1,this.$message.success("提交审批成功"),this.$emit("refresh"),this.$nextTick(()=>{this.close()})}catch(a){var t;if(null!==(t=a.message)&&void 0!==t&&t.includes("timeout")&&!0!==rePost)return this.submit(!0);this.submitLoading=!1}}}},g=v,h=(a("02a6"),a("2877")),f=Object(h["a"])(g,n,c,!1,null,"4b36434c",null),y=f.exports;const b=u["a"].messageTemplate;var C={components:{AddEdit:o["a"],SubmitDialog:y},data(){return{loading:!1,searchParams:{endTime:"",keyWords:"",startTime:"",status:"",templateCode:"",userName:""},query:{current:1,size:10},today:this.$moment().format("YYYY-MM-DD"),queryTime:null,total:0,tableData:[],showAddDialog:!1,submitDialog:!1,currentRow:{},userId:sessionStorage.getItem("userId"),isEdit:!1}},methods:{dateChange(e){e?(this.searchParams.startTime=e[0],this.searchParams.endTime=e[1]):(this.searchParams.startTime="",this.searchParams.endTime="")},searchTable(){this.query={...this.query,...this.searchParams},this.query.current=1,this.getTableData()},async getTableData(){try{this.loading=!0;const{records:e,total:t}=await Object(d["i"])(b.getCareSmsTemplate,this.query);this.tableData=e,this.total=t}catch(e){}finally{this.loading=!1}},handleSizeChange(e){this.query.current=1,this.query.size=e,this.getTableData()},handleCurrentChange(e){this.query.current=e,this.getTableData()},openAddDialog(){this.currentRow={},this.isEdit=!0,this.showAddDialog=!0},handleView(e){this.currentRow=e,this.isEdit=!1,this.showAddDialog=!0},handleEdit(e){this.currentRow=e,this.isEdit=!0,this.showAddDialog=!0},openSubmitDialog(e){this.currentRow=e,this.submitDialog=!0},async handleDelete(e){try{const t=await this.$confirm("此操作将永久删除该模板, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});"confirm"===t&&(await Object(d["i"])(b.delCareSmsTemplate,{id:e.templateCode}),"代维短信"==e.msgSmsPlat&&await Object(d["i"])(b.deleteTemplateLabel,{id:e.templateCode}),this.$message.success("删除成功"),this.getTableData())}catch(t){return t}}},mounted(){this.searchTable()}},L=C,T=(a("3e5b"),Object(h["a"])(L,i,r,!1,null,"473f7c6c",null)),S=T.exports,A={components:{SmsTemplate:S},data(){return{tabActive:"SmsTemplate"}}},D=A,k=(a("75f2"),Object(h["a"])(D,s,l,!1,null,"368f4c04",null));t["default"]=k.exports},"72ae":function(e,t,a){"use strict";const s="/mcd-cep-web/action",l="/evt-svc/api";t["a"]={ecapi:{queryEventClass:s+"/cep/rule/nx/queryEventClass.do",queryEventDictByDictCode:s+"/cep/rule/nx/queryEventDictByDictCode.do",queryParentDictByDictCode:s+"/cep/rule/nx/queryParentDictByDictCode.do",queryConfigDict:s+"/cep/rule/nx/queryConfigDict.do",queryEventClassLevel:s+"/cep/rule/queryEventClass.do",queryCepRuleNum:s+"/cep/rule/queryCepRuleNum.do",createRule:s+"/cep/rule/nx/createRule.do",manageList:l+"/event/list",manageUpdateStatus:l+"/event/updateStatus",manageDelete:l+"/event",manageListByParent:l+"/businessCategory/listByParent",manageListByLevel:l+"/businessCategory/listByLevel",manageCategoryList:l+"/businessCategory/list",manageGetDetail:l+"/event",eventSave:l+"/event/save",eventListByLevel:l+"/category/listByLevel",eventListByParent:l+"/category/listByParent",areaList:l+"/area/list",areaGetDetail:l+"/area",areaDelete:l+"/area",areaSave:l+"/area/save",areaStationList:l+"/area/stationList",stationList:l+"/station/list",listByCategory:l+"/categoryValue/listByCategory",queryEventsByUserId:"/plan-svc/api/action/cep/event/eventManager/queryEventsByUserId",queryShareById:"/plan-svc/cepRuleShare/queryShareById",saveOrUpdate:"/plan-svc/cepRuleShare/saveOrUpdate",delCampCoordinationTaskList:"/plan-svc/mcd/strategic/coordination/delCampCoordinationTaskList",exportExampleFile:"/plan-svc/mcd/strategic/coordination/exportExampleFile",pushCampCoordinationFile:"/plan-svc/mcd/strategic/coordination/pushCampCoordinationFile",queryCampCoordinationTask:"/plan-svc/mcd/strategic/coordination/queryCampCoordinationTask",queryStrategicCoordination:"/plan-svc/mcd/strategic/coordination/queryStrategicCoordination",saveStrategicCoordinationTask:"/plan-svc/mcd/strategic/coordination/saveStrategicCoordinationTask",selectAllStrategicCoordination:"/plan-svc/mcd/strategic/coordination/selectAllStrategicCoordination",recountCampTask:"/plan-svc/mcd/strategic/coordination/recountCampTask",queryCampCoordinationTaskDetail:"/plan-svc/mcd/strategic/coordination/queryCampCoordinationTaskDetail",childTaskRecord:"/plan-svc/mcd/strategic/coordination/childTaskRecord",approveTaskRecord:"/plan-svc/api/campCoordinate/taskApprove/approveTaskRecord",approveChildTaskRecord:"/plan-svc/api/campCoordinate/taskApprove/approveChildTaskRecord",subTaskApprove:"/plan-svc/api/campCoordinate/taskApprove/subTaskApprove",updateTaskStatus:"/plan-svc/api/campCoordinate/taskApprove/updateTaskStatus",queryAppTypeList:"/approve-svc/jx/cmpApprovalProcessConf/queryAppTypeList",getApproveConfig:"/approve-svc/jx/cmpApprovalProcessConf/getApproveConfig?systemId=",getNodeApprover:"/approve-svc/jx/cmpApproveProcessInstance/getNodeApprover",submitProcess:"/approve-svc/jx/cmpApproveProcessInstance/submitProcess",delPlanConfList:"/plan-svc/mcd/strategic/coordination/delPlanConfList",qryNotCfgPlanTypeAndPri:"/plan-svc/mcd/strategic/coordination/qryNotCfgPlanTypeAndPri",qryPlanConfList:"/plan-svc/mcd/strategic/coordination/qryPlanConfList",qryPlanConfListByPlanTypeOnSave:"/plan-svc/mcd/strategic/coordination/qryPlanConfListByPlanTypeOnSave",qryPlanConfListByPlanTypeOnUpdate:"/plan-svc/mcd/strategic/coordination/qryPlanConfListByPlanTypeOnUpdate",qryPlanTypeList:"/plan-svc/mcd/strategic/coordination/qryPlanTypeList",savePlanConf:"/plan-svc/mcd/strategic/coordination/savePlanConf",updatePriority:"/plan-svc/mcd/strategic/coordination/updatePriority",getSysDics:"/plan-svc/action/iop/common/getSysDics",delTagConfig:"/plan-svc/orchestrate/tag/delTagConfig",queryAccessLabel:"/plan-svc/orchestrate/tag/queryAccessLabel",queryTag:"/plan-svc/orchestrate/tag/queryTag",queryTagType:"/plan-svc/orchestrate/tag/queryTagType",saveTag:"/plan-svc/orchestrate/tag/saveTag",updateTagOrderBy:"/plan-svc/orchestrate/tag/updateTagOrderBy",queryAllTag:"/plan-svc/orchestrate/tag/queryAllTag"}}},"75f2":function(e,t,a){"use strict";a("ecae")},"855e":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{top:"8vh",width:"50%",title:e.dialogTitle,visible:e.dialogVisible,"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("i",{staticClass:"el-icon-close",on:{click:function(t){return e.$emit("update:dialogVisible",!1)}}}),t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ruleForm",attrs:{model:e.form,rules:e.rules,"label-width":"140px"}},[t("el-form-item",{attrs:{label:"消息类型：",prop:"msgSmsPlat"}},[t("el-select",{attrs:{disabled:"",placeholder:"请选择消息类型"},model:{value:e.form.msgSmsPlat,callback:function(t){e.$set(e.form,"msgSmsPlat",t)},expression:"form.msgSmsPlat"}},[t("el-option",{attrs:{value:"hmh5",label:"普通短信"}}),t("el-option",{attrs:{value:"daiwei",label:"代维短信"}})],1)],1),t("el-form-item",{attrs:{label:"模板类型：",prop:"templateType"}},[t("el-select",{attrs:{placeholder:"请选择模板类型",disabled:!e.isEdit},model:{value:e.form.templateType,callback:function(t){e.$set(e.form,"templateType",t)},expression:"form.templateType"}},[t("el-option",{attrs:{value:"生日祝福",label:"生日祝福"}}),t("el-option",{attrs:{value:"佳节祝福",label:"佳节祝福"}}),t("el-option",{attrs:{value:"友情提醒",label:"友情提醒"}}),t("el-option",{attrs:{value:"紧急通知",label:"紧急通知"}}),"hmh5"==e.form.msgSmsPlat?t("el-option",{attrs:{value:"作战地图",label:"作战地图"}}):e._e()],1)],1),t("el-form-item",{attrs:{label:"模板内容：",prop:"templateContent"}},[t("el-input",{ref:"inputRef",attrs:{disabled:!e.isEdit,type:"textarea",maxlength:"500","show-word-limit":"",rows:6},on:{blur:e.locatingPosition},model:{value:e.form.templateContent,callback:function(t){e.$set(e.form,"templateContent",t)},expression:"form.templateContent"}})],1),t("el-form-item",{attrs:{label:"营销用语替换变量："}},[t("div",{staticClass:"var-operation"},e._l(e.varList,(function(a){return t("div",{key:a.attrCol,class:["tag",{active:a.active},{disabled:a.disabled}],attrs:{title:a.attrCol},on:{click:function(t){return e.replaceVariable(a)}}},[e._v(e._s(a.attrColName))])})),0)]),"daiwei"===e.form.msgSmsPlat?[t("el-form-item",{attrs:{label:"关联客群标签："}},[e.isEdit?t("el-select",{attrs:{multiple:"",placeholder:"请选择关联客群标签"},model:{value:e.labelCodeList,callback:function(t){e.labelCodeList=t},expression:"labelCodeList"}},e._l(e.tagList,(function(e){return t("el-option",{key:e.labelCode+e.labelName,attrs:{value:e.labelCode,label:e.labelName}})})),1):t("span",[e._v(e._s(e.labelNames||"-"))])],1)]:e._e(),t("el-form-item",{attrs:{label:"有效期：",prop:"validDeadLine"}},[t("el-date-picker",{attrs:{disabled:!e.isEdit,type:"date",placeholder:"请选择日期",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd"},model:{value:e.form.validDeadLine,callback:function(t){e.$set(e.form,"validDeadLine",t)},expression:"form.validDeadLine"}})],1)],2),e.showApproveRecord?t("div",{staticClass:"approve-content"},[t("div",{staticClass:"approval-title"},[e._v("审批流程")]),20==e.form.approvalStatus?t("el-empty",{attrs:{description:"暂无审批记录"}}):t("Approve",{attrs:{businessId:e.templateCode,type:"作战地图"===e.form.templateType?"BATTLE_MAP":"MESSAGE_TEMPLATE"}})],1):e._e(),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.isEdit?t("el-button",{on:{click:function(t){return e.$emit("update:dialogVisible",!1)}}},[e._v("取 消")]):e._e(),t("el-button",{attrs:{type:"primary",loading:e.saveLoading},on:{click:e.submitForm}},[e._v(e._s(e.isEdit?"确 认":"关 闭"))])],1)],1)},l=[],i=(a("14d9"),a("0fea")),r=a("89ff"),o=a("8331"),n={props:{dialogVisible:{type:Boolean,default:!1},templateCode:{type:String,default:""},isEdit:{type:Boolean,default:!1}},components:{Approve:o["a"]},data(){return{dialogTitle:"新增模板",loading:!1,saveLoading:!1,source:null,form:{templateContent:"尊敬的$GLOBAL_LEVEL$客户，",msgSmsPlat:sessionStorage.getItem("roleIds").includes("888")?"daiwei":"hmh5",templateType:"生日祝福",validDeadLine:""},rules:{templateContent:[{required:!0,message:"请输入短信模板内容",trigger:"change"}],msgSmsPlat:[{required:!0,message:"请选择消息类型",trigger:"change"}],templateType:[{required:!0,message:"请选择模板类型",trigger:"change"}],validDeadLine:[{required:!0,message:"请选择有效期",trigger:"change"}]},varList:[],tagList:[],labelCodeList:[],labelNames:"",showApproveRecord:!1,wordPosition:0}},watch:{dialogVisible(e){e?(this.varList.length||this.getVarList(),this.tagList.length||this.getTagList(),this.templateCode?(this.dialogTitle=this.isEdit?"编辑模板":"查看模板",this.getDetail()):(this.dialogTitle="新增模板",this.$nextTick(()=>{this.$refs.inputRef.$el.querySelector("textarea").focus()}))):(this.form={templateContent:"尊敬的$GLOBAL_LEVEL$客户，",msgSmsPlat:sessionStorage.getItem("roleIds").includes("888")?"daiwei":"hmh5",templateType:"生日祝福",validDeadLine:""},this.labelCodeList=[],this.labelNames="",this.$refs.ruleForm.resetFields(),this.showApproveRecord=!1,this.saveLoading&&this.source.cancel("取消请求"))},"form.templateType"(e,t){e&&t&&("作战地图"!==e&&"作战地图"!==t||this.getVarList())}},methods:{async getDetail(){try{this.loading=!0;const e=await Object(i["i"])(r["a"].messageTemplate.getCareSmsTemplateDetail,{id:this.templateCode});"daiwei"===e.msgSmsPlat&&this.getLabelListByTemplateId(),this.showApproveRecord=!0,this.form=e,this.varList.length&&(this.varList.forEach(e=>{e.active=this.form.templateContent.includes("$"+e.attrCol+"$")}),this.$forceUpdate())}catch(e){}finally{this.loading=!1}},async getLabelListByTemplateId(){try{const e=await Object(i["g"])(r["a"].messageTemplate.getRelaLabels,{smsTemplateCode:this.templateCode});this.labelCodeList=e.map(e=>e.labelCode),this.labelNames=e.map(e=>e.labelName).join("，")}catch(e){}},async getVarList(){try{this.varList=[];const e=await Object(i["i"])(r["a"].messageTemplate.getCustGroupVars,{templateType:this.form.templateType||"生日祝福",smsType:this.form.msgSmsPlat});let t=[];this.form.templateCode&&(t=this.form.templateContent.split("$").filter(e=>e)),this.varList=e.map(e=>({attrCol:e.attrCol,attrColName:e.attrColName,disabled:"CUSTOMER_TITLE"===e.attrCol,active:t.some(t=>t===e.attrCol)}))}catch(e){}finally{this.varList.length>0&&this.varList.push({attrCol:"GLOBAL_LEVEL",attrColName:"全球通等级",disabled:!0,active:!0})}},locatingPosition(){this.wordPosition=this.$refs.inputRef.$el.querySelector("textarea").selectionStart},delay(e){return new Promise(t=>{setTimeout(()=>{t()},e)})},async replaceVariable(e){if(!this.isEdit)return;if(e.disabled)return;const t=e.attrCol;await this.delay(50),this.wordPosition?this.form.templateContent=this.form.templateContent.slice(0,this.wordPosition)+"$"+t+"$"+this.form.templateContent.slice(this.wordPosition):this.form.templateContent+="$"+t+"$",e.active=!0,this.wordPosition=this.wordPosition+t.length+2;const a=this.$refs.inputRef.$el.querySelector("textarea");a.focus(),this.$nextTick(()=>{a.setSelectionRange(this.wordPosition,this.wordPosition)})},async getTagList(){try{const e=await Object(i["i"])(r["a"].messageTemplate.getLabelListDaiwei);this.tagList=e}catch(e){}},submitForm(){this.isEdit?this.$refs["ruleForm"].validate(async e=>{if(e){this.source=this.$CancelToken.source();try{this.saveLoading=!0;const e=await Object(i["i"])(r["a"].messageTemplate.saveCareSmsTemplate,this.form,this.source.token);"daiwei"===this.form.msgSmsPlat&&await Object(i["i"])(r["a"].messageTemplate.saveOrUpdateRela,{smsTemplateCode:this.form.templateCode||e,labelCodes:this.labelCodeList.join(",")},this.source.token),this.$message.success(this.isEdit?"修改成功":"新增成功"),this.$emit("refresh"),this.$emit("update:dialogVisible",!1)}catch(t){}finally{this.saveLoading=!1}}}):this.$emit("update:dialogVisible",!1)}}},c=n,p=(a("ee24"),a("2877")),d=Object(p["a"])(c,s,l,!1,null,"0072d5e7",null);t["a"]=d.exports},"89ff":function(e,t,a){"use strict";t["a"]={bigSrceenConfig:{queryFrontSecondScreens:"/plan-svc/mcd/front/secondScreen/queryFrontSecondScreens",updateFrontSecondScreens:"/plan-svc/mcd/front/secondScreen/updateFrontSecondScreens"},blackList:{deleBlackList:"/plan-svc/customer/black/list/deleBlackList",downloadImpOrDelBlacklistTemplate:"/plan-svc/customer/black/list/downloadImpOrDelBlacklistTemplate",impOrDelBlacklistFile:"/plan-svc/customer/black/list/impOrDelBlacklistFile",queryBlackList:"/plan-svc/customer/black/list/queryBlackList",queryAllCitys:"/plan-svc/customer/black/list/queryAllCitys",createOrUpdate:"/plan-svc/mcd-hmh5-blacklist-task/createOrUpdate",delete:"/plan-svc/mcd-hmh5-blacklist-task/delete",listTask:"/plan-svc/mcd-hmh5-blacklist-task/listTask",getTaskDetailByTaskId:"/plan-svc/mcd-hmh5-blacklist-task/getTaskDetailByTaskId",submitBlacklist:"/plan-svc/mcd-hmh5-blacklist-task/submitBlacklist",getBlacklistApprover:"/plan-svc/mcd-hmh5-blacklist-task/getBlacklistApprover",approveBlacklistRecord:"/plan-svc/mcd-hmh5-blacklist-task/approveBlacklistRecord"},careRelation:{queryChannelByCityAndCounty:"/plan-svc/mcd/front/guardList/queryChannelByCityAndCounty",exportGuardUserList:"/plan-svc/mcd/front/guardList/exportGuardUserList",queryGuardUserList:"/plan-svc/mcd/front/guardList/queryGuardUserList"},messageTemplate:{approveSmsTemplateRecord:"/plan-svc/sms/template/approveSmsTemplateRecord",delCareSmsTemplate:"/plan-svc/sms/template/delCareSmsTemplate",deleteTemplateLabel:"/plan-svc/sms/template/deleteTemplateLabel",getCareSmsTemplate:"/plan-svc/sms/template/getCareSmsTemplate",getCareSmsTemplateApprover:"/plan-svc/sms/template/getCareSmsTemplateApprover",getCareSmsTemplateDetail:"/plan-svc/sms/template/getCareSmsTemplateDetail",getCustGroupVars:"/plan-svc/sms/template/getCustGroupVars",getLabelListDaiwei:"/plan-svc/sms/template/getLabelListDaiwei",getRelaLabels:"/plan-svc/sms/template/getRelaLabels",saveCareSmsTemplate:"/plan-svc/sms/template/saveCareSmsTemplate",saveOrUpdateRela:"/plan-svc/sms/template/saveOrUpdateRela",subCareSmsTemplateApprove:"/plan-svc/sms/template/subCareSmsTemplateApprove"},labelConfig:{mcdCustomLabelDefGet:"/plan-svc/mcdCustomLabelDef",mcdCustomLabelDefPut:"/plan-svc/mcdCustomLabelDef",commitProcess:"/plan-svc/mcdCustomLabelDef/commitProcess",getNodeApprover:"/plan-svc/mcdCustomLabelDef/getNodeApprover",modifySelfDefinedLabelConf:"/plan-svc/mcdCustomLabelDef/modifySelfDefinedLabelConf",selectSelfDefinedLabelConf:"/plan-svc/mcdCustomLabelDef/selectSelfDefinedLabelConf",selectSelfDefinedLabelConfDetail:"/plan-svc/mcdCustomLabelDef/selectSelfDefinedLabelConfDetail",mcdCustomLabelDef:"/plan-svc/mcdCustomLabelDef"},warningConfig:{mcdAppAlarmInfoGet:"/plan-svc/mcdAppAlarmInfo",mcdAppAlarmInfoPost:"/plan-svc/mcdAppAlarmInfo",mcdAppAlarmInfoPut:"/plan-svc/mcdAppAlarmInfo",mcdAppAlarmInfoDelete:"/plan-svc/mcdAppAlarmInfo",batchImportAutoClearAlarm:"/plan-svc/mcdAppAlarmInfo/batchImportAutoClearAlarm",commitProcess:"/plan-svc/mcdAppAlarmInfo/commitProcess",getNodeApprover:"/plan-svc/mcdAppAlarmInfo/getNodeApprover",queryDataSourceList:"/plan-svc/mcdAppAlarmInfo/queryDataSourceList",queryDataTableList:"/plan-svc/mcdAppAlarmInfo/queryDataTableList",querySourceTable:"/plan-svc/mcdAppAlarmInfo/querySourceTable",selectAlarmDetailById:"/plan-svc/mcdAppAlarmInfo/selectAlarmDetailById",selectAlarmType:"/plan-svc/mcdAppAlarmInfo/selectAlarmType",terminateAlarm:"/plan-svc/mcdAppAlarmInfo/terminateAlarm",queryHasRole:"/plan-svc/mcdAppAlarmInfo/queryHasRole",updateAlarmThreshold:"/plan-svc/mcdAppAlarmInfo/updateAlarmThreshold",queryAllCitys:"/plan-svc/mcdAppAlarmInfo/queryAllCitys"},customerCommunicationUseCondition:{exportCampsegHandleDetail:"/plan-svc/action/jx/onlinelChannel/exportCampsegHandleDetail",exportCampsegHandleSummary:"/plan-svc/action/jx/onlinelChannel/exportCampsegHandleSummary",exportChannelUsageList:"/plan-svc/action/jx/onlinelChannel/exportChannelUsageList",exportCityUsageList:"/plan-svc/action/jx/onlinelChannel/exportCityUsageList",exportCountyUsageList:"/plan-svc/action/jx/onlinelChannel/exportCountyUsageList",exportGridUsageList:"/plan-svc/action/jx/onlinelChannel/exportGridUsageList",exportOppoCampCityHandle:"/plan-svc/action/jx/onlinelChannel/exportOppoCampCityHandle",queryCampsegHandleDetail:"/plan-svc/action/jx/onlinelChannel/queryCampsegHandleDetail",queryCampsegHandleSummary:"/plan-svc/action/jx/onlinelChannel/queryCampsegHandleSummary",queryChannelUsageList:"/plan-svc/action/jx/onlinelChannel/queryChannelUsageList",queryCityUsageList:"/plan-svc/action/jx/onlinelChannel/queryCityUsageList",queryCountyUsageList:"/plan-svc/action/jx/onlinelChannel/queryCountyUsageList",queryGridUsageList:"/plan-svc/action/jx/onlinelChannel/queryGridUsageList",queryOppoCampCityHandle:"/plan-svc/action/jx/onlinelChannel/queryOppoCampCityHandle"},customerContactMaintainCondition:{reportSmsMessage:"/plan-svc/reportSmsMessage",export:"/plan-svc/reportSmsMessage/export"},customerCommunicationWarningCondition:{reportYjCityDetailNew:"/plan-svc/reportYjCityDetailNew",reportYjCityDetailNewExport:"/plan-svc/reportYjCityDetailNew/export",reportYjCountyDetailNew:"/plan-svc/reportYjCountyDetailNew",reportYjCountyDetailNewExport:"/plan-svc/reportYjCountyDetailNew/export",reportYjDetailInfo:"/plan-svc/reportYjDetailInfo",reportYjDetailInfoExport:"/plan-svc/reportYjDetailInfo/export",reportYjGridDetailNew:"/plan-svc/reportYjGridDetailNew",reportYjGridDetailNewExport:"/plan-svc/reportYjGridDetailNew/export",reportYjStaffDetailNew:"/plan-svc/reportYjStaffDetailNew",reportYjStaffDetailNewExport:"/plan-svc/reportYjStaffDetailNew/export"},jobNoQuery:{queryFrontStafferList:"/plan-svc/mcd/front/staffer/queryFrontStafferList"},problemFeedback:{addNewReply:"/plan-svc/mcdFeedbackQa/addNewReply",addNewReplyPicture:"/plan-svc/mcdFeedbackQa/addNewReplyPicture",downloadImage:"/plan-svc/mcdFeedbackQa/downloadImage",getAllRepliesByBusinessId:"/plan-svc/mcdFeedbackQa/getAllRepliesByBusinessId",getRecentlyReplyFeedback:"/plan-svc/mcdFeedbackQa/getRecentlyReplyFeedback",mcdManagerFeedback:"/plan-svc/mcdManagerFeedback"},proxyCustomerLabel:{mcdFrontCareSmsLabelGet:"/plan-svc/mcdFrontCareSmsLabel",mcdFrontCareSmsLabelPost:"/plan-svc/mcdFrontCareSmsLabel",mcdFrontCareSmsLabelPut:"/plan-svc/mcdFrontCareSmsLabel",mcdFrontCareSmsLabelDelete:"/plan-svc/mcdFrontCareSmsLabel"},noticeBoard:{mcdBulletinBoardGet:"/plan-svc/mcdBulletinBoard",mcdBulletinBoardPost:"/plan-svc/mcdBulletinBoard",mcdBulletinBoardPut:"/plan-svc/mcdBulletinBoard",mcdBulletinBoardDelete:"/plan-svc/mcdBulletinBoard",deleteImage:"/plan-svc/mcdBulletinBoard/deleteImage",downloadImage:"/plan-svc/mcdBulletinBoard/downloadImage",modifyBulletinStatus:"/plan-svc/mcdBulletinBoard/modifyBulletinStatus",uploadBulletinPictures:"/plan-svc/mcdBulletinBoard/uploadBulletinPictures"},mainPackageConfig:{queryFrontMainOffers:"/plan-svc/mcd/front/mainOfferInfo/queryFrontMainOffers",deleteMainOfferInfo:"/plan-svc/mcd/front/mainOfferInfo/deleteMainOfferInfo",getMainOfferInfoDetail:"/plan-svc/mcd/front/mainOfferInfo/getMainOfferInfoDetail",saveOrUpdateMainOffer:"/plan-svc/mcd/front/mainOfferInfo/saveOrUpdateMainOffer",updateMainOfferInfoStatus:"/plan-svc/mcd/front/mainOfferInfo/updateMainOfferInfoStatus"},keyMonitoring:{queryFrontKeyMonitors:"/plan-svc/mcd/front/keyMonitor/queryFrontKeyMonitors"}}},b62e:function(e,t,a){"use strict";a("bb6e")},bb6e:function(e,t,a){},c3c5:function(e,t,a){},ea45:function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("el-dialog",{class:{"title-center":e.titleCenter},attrs:{title:e.title,visible:void 0===e.value?e.visible:e.value,width:e.width,top:e.top,"append-to-body":"","show-close":!1,"close-on-click-modal":!1,"destroy-on-close":e.destroyOnClose},on:{"update:visible":function(t){void 0===e.value?e.visible:e.value=t}}},[t("i",{staticClass:"el-icon-close",on:{click:e.close}}),e._t("default"),t("div",{style:{textAlign:e.footerPosition},attrs:{slot:"footer"},slot:"footer"},[e.showCancelButton?t("el-button",{on:{click:e.close}},[e._v(e._s(e.cancelButtonText))]):e._e(),e._t("footerBtn"),t("el-button",{attrs:{type:"primary",loading:e.confirmLoading},on:{click:e.confirm}},[e._v(e._s(e.confirmButtonText))])],2)],2)},l=[],i={model:{prop:"value",event:"change"},props:{value:{type:void 0|Boolean},visible:{type:void 0|Boolean},titleCenter:{type:Boolean,default:!1},title:{type:String,required:!0},width:{type:String,default:"50%"},top:{type:void 0|String,default:void 0},confirmLoading:{type:Boolean,default:!1},confirmButtonText:{type:String,default:"确 认"},cancelButtonText:{type:String,default:"取 消"},showCancelButton:{type:Boolean,default:!0},footerPosition:{type:String,default:"center"},destroyOnClose:{type:Boolean,default:!0}},methods:{close(){void 0===this.value?this.$emit("close"):this.$emit("change",!1)},confirm(){this.$emit("confirm")}}},r=i,o=(a("b62e"),a("2877")),n=Object(o["a"])(r,s,l,!1,null,"1be2cb38",null);t["a"]=n.exports},ecae:function(e,t,a){},ee24:function(e,t,a){"use strict";a("2c43")}}]);