<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.asiainfo.biapp.pec.plan.jx.camp.dao.CustomerManageDao">
    <!--原符号 < <= > >= & ' "
    替换符号 &lt; &lt;= &gt; &gt;= &amp; &apos; &quot;
    例如：sql如下：
    create_date_time &gt;= #{startTime} and create_date_time &lt;= #{endTime}-->
    <select id="selectCustomerDetail" resultType="com.asiainfo.biapp.pec.plan.jx.camp.model.CustomerDetail">
        select distinct mcd.CUSTOM_GROUP_ID as customGroupId, mcd.CREATE_USER_ID as createUserId,mcd.FAIL_TIME,mcd.CREATE_TIME
        from mcd_custgroup_def mcd
        where mcd.UPDATE_CYCLE != 1 and FAIL_TIME>now() and CUSTOM_STATUS_ID=1
        <![CDATA[ and mcd.CREATE_TIME < date_add(now(),interval -30 day )]]>
        and not exists
        (select 1
        from mcd_camp_channel_list mccl
        left join mcd_camp_def def on mccl.CAMPSEG_PID =def.CAMPSEG_ID
        where mcd.CUSTOM_GROUP_ID = mccl.CUSTGROUP_ID
       <![CDATA[ and def.END_DATE > date_add(now(),interval -30 day ))]]>
    </select>

    <update id="updateCustStatus" parameterType="java.util.List">
        update mcd_custgroup_def set UPDATE_STATUS = 0 where CUSTOM_GROUP_ID in
        <foreach collection="params" item="customGroupId" separator="," open="(" close=")">
            #{customGroupId}
        </foreach>
    </update>
</mapper>
