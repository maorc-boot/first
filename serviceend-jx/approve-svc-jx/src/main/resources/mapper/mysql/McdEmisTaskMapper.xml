<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.asiainfo.biapp.pec.approve.jx.dao.McdEmisTaskDao">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.asiainfo.biapp.pec.approve.jx.model.McdEmisTask" >
        <id column="ID" property="id" />
        <result column="INSTANCE_ID"   property="instance_id" />
        <result column="INSTANCE_NAME" property="instance_name"/>
        <result column="NODE_ID" property="node_id"/>
        <result column="NODE_NAME" property="node_name"/>
        <result column="NEXT_NODES" property="next_nodes"/>
        <result column="APPROVAL_TIMES" property="approval_times"/>
        <result column="APPROVAL_USER" property="approval_user"/>
        <result column="SUBMIT_USER" property="submit_user"/>
        <result column="RESULT" property="result"/>
        <result column="ADVICE" property="advice"/>
        <result column="PREV_NODES" property="prev_nodes"/>
        <result column="CAMPSEG_ID" property="campseg_id"/>
        <result column="TASK_TYPE" property="task_type"/>


    </resultMap>


    <!-- 根据条件查询数据 -->
    <update id="updateMcdEmisTask" >
          UPDATE MCD_EMIS_TASK task
          SET task.RESULT = '9',
          task.ADVICE = '被动驳回或过期'
          where task.RESULT = '2'
          and task.CAMPSEG_ID in (select def.CAMPSEG_ID
          from MCD_CAMP_DEF def
          where def.CAMPSEG_STAT_ID = '41'
          or def.END_DATE &lt;= date_format(sysdate(), '%Y-%m-%d') )

    </update>

</mapper>
