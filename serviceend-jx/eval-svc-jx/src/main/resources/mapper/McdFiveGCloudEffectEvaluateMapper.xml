<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.asiainfo.biapp.pec.eval.jx.dao.McdFiveGCloudEffectEvaluateMapper">

    <select id="queryPage" resultType="com.asiainfo.biapp.pec.eval.jx.model.McdFiveGCloudEffectEvaluate" parameterType="com.asiainfo.biapp.pec.eval.jx.req.G5CloudEvalPageQuery">
        select START_DATE,
               END_DATE,
               CAMPSEG_TYPE,
               CAMPSEG_ROOT_ID,
               CAMPSEG_NAME,
               PLAN_TYPE,
               PLAN_NAME,
               CREATECITY_NAME,
               CREATE_USERID,
        <if test=" query.cityId != '0'.toString()  ">
               CITY_ID,
               CITY_NAME,
        </if>
        <if test=" query.countyId != '0'.toString()  ">
               COUNTY_ID,
               COUNTY_NAME,
        </if>
               CHANNEL_ID,
               CHANNEL_NAME,
        <if test=" query.callbackType != '0'.toString()  ">
               case when CALLBACK_TYPE = '1' then '纯文本必达消息（长时）'
                    when CALLBACK_TYPE = '2' then 'H5必达消息（长时）'
                    when CALLBACK_TYPE = '3' then '纯文本必达消息（短时）'
                    when CALLBACK_TYPE = '4' then '强显消息'
                    when CALLBACK_TYPE = '5' then '留空'
                    when CALLBACK_TYPE = '6' then '短信'
                    when CALLBACK_TYPE = '7' then 'H5必达消息（短时）'
                    when CALLBACK_TYPE = '8' then '语音通知'
                    when CALLBACK_TYPE = '9' then '强显消息（异网）'
                else '短信（异网）' end CALLBACK_TYPE,
        </if>
               AVG(CUST_NUM)                                  as CUST_NUM,
               AVG(SEND_NUM)                                  as SEND_NUM,
               SUM(SUCCESS_NUM)                               AS SUCCESS_NUM,
               round((SUM(SUCCESS_NUM) / AVG(SEND_NUM)) * 100, 4)           AS SUCCESS_RATE
        from mcd_fiveg_cloud_effect_evaluate
        where 1 = 1
        <if test="query.cityId != null and query.cityId != '0'.toString() and  query.cityId != '-1'.toString() and  query.cityId != ''.toString() ">
          AND CITY_ID = #{query.cityId}
        </if>
        <if test="query.countyId != null and query.countyId != '0'.toString() and  query.countyId != '-1'.toString() and  query.countyId != ''.toString() ">
          and COUNTY_ID = #{query.countyId}
        </if>
        <if test="query.callbackType != null and query.callbackType != '0'.toString() and  query.callbackType != '-1'.toString() and  query.callbackType != ''.toString() ">
          and CALLBACK_TYPE =  #{query.callbackType}
        </if>
        <if test="query.keyWords != null and   query.keyWords != ''.toString() ">
            and (CAMPSEG_ROOT_ID like  concat ('%',#{query.keyWords},'%') or  CAMPSEG_NAME like  concat ('%',#{query.keyWords},'%'))
        </if>
        group by START_DATE,
                 END_DATE,
<!--                 CAMPSEG_TYPE,-->
                 CAMPSEG_ROOT_ID,
                 CAMPSEG_NAME,
                 PLAN_TYPE,
                 PLAN_NAME,
                 CREATECITY_NAME,
                 CREATE_USERID,
        <if test=" query.cityId != '0'.toString()  ">
            CITY_ID,
            CITY_NAME,
        </if>
        <if test=" query.countyId != '0'.toString()  ">
            COUNTY_ID,
            COUNTY_NAME,
        </if>
        <if test=" query.callbackType != '0'.toString()  ">
            CALLBACK_TYPE,
        </if>
        CHANNEL_ID,
        CHANNEL_NAME
    </select>
</mapper>
