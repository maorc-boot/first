<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.asiainfo.biapp.pec.eval.jx.dao.McdFiveGEffectEvaluateMapper">

    <select id="queryPage" resultType="com.asiainfo.biapp.pec.eval.jx.model.McdFiveGEffectEvaluate" parameterType="com.asiainfo.biapp.pec.eval.jx.req.G5EvalPageQuery">
        select START_DATE,
               END_DATE,
               CAMPSEG_TYPE,
               CAMPSEG_ROOT_ID,
               CAMPSEG_NAME,
               PLAN_TYPE,
               PLAN_NAME,
               CREATECITY_NAME,
               CREATE_USERID,
        <if test=" query.cityId != '0'.toString()  ">
               CITY_ID,
               CITY_NAME,
        </if>
        <if test=" query.countyId != '0'.toString()  ">
               COUNTY_ID,
               COUNTY_NAME,
        </if>
               CHANNEL_ID,
               CHANNEL_NAME,
        <if test=" query.fallbackConfig != '0'.toString()  ">
               SOURCETYPE,
        </if>
        <if test=" query.fallbackType != '0'.toString()  ">
               FALLBACK_TYPE,
        </if>
               APPLICATION_NUM,
               SUM(CONTACT_NUM)                                       AS CONTACT_NUM,
               SUM(SUCCESS_NUM)                                       AS SUCCESS_NUM,
               AVG(SGMTNUM)                                           AS SGMTNUM,
               round((SUM(SUCCESS_NUM) / SUM(CONTACT_NUM)) * 100, 4)           AS SUCCESS_RATE,
               round((SUM(CONTACT_NUM) / AVG(SGMTNUM)) * 100, 4)               AS CONTACT_RATE,
               SUBSTRING_INDEX(SUM(SUCCESS_ORDER_NUM), ".", 1)                AS SUCCESS_ORDER_NUM,
               round((SUM(SUCCESS_ORDER_NUM) / SUM(SUCCESS_NUM)) * 100, 4)     AS SUCCESS_ORDER_RATE,
               SUBSTRING_INDEX(SUM(FALLBACK_SUCC_NUM), ".", 1)                              AS FALLBACK_SUCC_NUM,
               SUBSTRING_INDEX(SUM(FALLBACK_SUCC_PEOPLE_NUM), ".", 1)                          AS FALLBACK_SUCC_PEOPLE_NUM,
               round((SUM(FALLBACK_SUCC_NUM) / SUM(FALLBACK_SUCC_PEOPLE_NUM)) * 100, 4)  AS FALLBACK_SUCC_RATE,
               SUM(NON_FIVE_G_MESSAGE_NUM)                            AS NON_FIVE_G_MESSAGE_NUM
        from mcd_five_g_effect_evaluate
        where 1 = 1
        <if test="query.cityId != null and query.cityId != '0'.toString() and  query.cityId != '-1'.toString() and  query.cityId != ''.toString() ">
          AND CITY_ID = #{query.cityId}
        </if>
        <if test="query.countyId != null and query.countyId != '0'.toString() and  query.countyId != '-1'.toString() and  query.countyId != ''.toString() ">
          and COUNTY_ID = #{query.countyId}
        </if>
        <if test="query.fallbackConfig != null and query.fallbackConfig != '0'.toString() and  query.fallbackConfig != '-1'.toString() and  query.fallbackConfig != ''.toString() ">
          and SOURCETYPE = #{query.fallbackConfig}
        </if>
        <if test="query.fallbackType != null and query.fallbackType != '0'.toString() and  query.fallbackType != '-1'.toString() and  query.fallbackType != ''.toString() ">
          and FALLBACK_TYPE =  #{query.fallbackType}
        </if>
        <if test="query.keyWords != null and   query.keyWords != ''.toString() ">
            and ( CAMPSEG_ROOT_ID like  concat ('%',#{query.keyWords},'%') or  CAMPSEG_NAME like  concat ('%',#{query.keyWords},'%') )
        </if>
        group by START_DATE,
                 END_DATE,
                 CAMPSEG_TYPE,
                 CAMPSEG_ROOT_ID,
                 CAMPSEG_NAME,
                 PLAN_TYPE,
                 PLAN_NAME,
                 CREATECITY_NAME,
                 CREATE_USERID,
        <if test=" query.cityId != '0'.toString()  ">
            CITY_ID,
            CITY_NAME,
        </if>
        <if test=" query.countyId != '0'.toString()  ">
            COUNTY_ID,
            COUNTY_NAME,
        </if>
        CHANNEL_ID,
        CHANNEL_NAME,
        <if test=" query.fallbackConfig != '0'.toString()  ">
            SOURCETYPE,
        </if>
        <if test=" query.fallbackType != '0'.toString()  ">
            FALLBACK_TYPE,
        </if>
                 APPLICATION_NUM

    </select>
</mapper>
